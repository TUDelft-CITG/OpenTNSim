<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for C:\Users\floorbakker\OpenTNSim\opentnsim\core.py: 40%</title>
    <link rel="icon" sizes="32x32" href="favicon_32.png">
    <link rel="stylesheet" href="style.css" type="text/css">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">
<div id="header">
    <div class="content">
        <h1>Coverage for <b>C:\Users\floorbakker\OpenTNSim\opentnsim\core.py</b> :
            <span class="pc_cov">40%</span>
        </h1>
        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />
        <h2 class="stats">
            1928 statements &nbsp;
            <button type="button" class="run shortkey_r button_toggle_run" title="Toggle lines run">773 run</button>
            <button type="button" class="mis show_mis shortkey_m button_toggle_mis" title="Toggle lines missing">1155 missing</button>
            <button type="button" class="exc show_exc shortkey_x button_toggle_exc" title="Toggle lines excluded">0 excluded</button>
        </h2>
    </div>
</div>
<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>
<div id="source">
    <p id="t1" class="pln"><span class="n"><a href="#t1">1</a></span><span class="t"><span class="str">"""Main module."""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2" class="pln"><span class="n"><a href="#t2">2</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3" class="pln"><span class="n"><a href="#t3">3</a></span><span class="t"><span class="com"># package(s) related to time, space and id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t4" class="run"><span class="n"><a href="#t4">4</a></span><span class="t"><span class="key">import</span> <span class="nam">json</span>&nbsp;</span><span class="r"></span></p>
    <p id="t5" class="run"><span class="n"><a href="#t5">5</a></span><span class="t"><span class="key">import</span> <span class="nam">logging</span>&nbsp;</span><span class="r"></span></p>
    <p id="t6" class="run"><span class="n"><a href="#t6">6</a></span><span class="t"><span class="key">import</span> <span class="nam">uuid</span>&nbsp;</span><span class="r"></span></p>
    <p id="t7" class="pln"><span class="n"><a href="#t7">7</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t8" class="pln"><span class="n"><a href="#t8">8</a></span><span class="t"><span class="com"># you need these dependencies (you can get these from anaconda)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t9" class="pln"><span class="n"><a href="#t9">9</a></span><span class="t"><span class="com"># package(s) related to the simulation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t10" class="run"><span class="n"><a href="#t10">10</a></span><span class="t"><span class="key">import</span> <span class="nam">simpy</span>&nbsp;</span><span class="r"></span></p>
    <p id="t11" class="run"><span class="n"><a href="#t11">11</a></span><span class="t"><span class="key">import</span> <span class="nam">random</span>&nbsp;</span><span class="r"></span></p>
    <p id="t12" class="run"><span class="n"><a href="#t12">12</a></span><span class="t"><span class="key">import</span> <span class="nam">networkx</span> <span class="key">as</span> <span class="nam">nx</span>&nbsp;</span><span class="r"></span></p>
    <p id="t13" class="run"><span class="n"><a href="#t13">13</a></span><span class="t"><span class="key">import</span> <span class="nam">numpy</span> <span class="key">as</span> <span class="nam">np</span>&nbsp;</span><span class="r"></span></p>
    <p id="t14" class="run"><span class="n"><a href="#t14">14</a></span><span class="t"><span class="key">import</span> <span class="nam">math</span>&nbsp;</span><span class="r"></span></p>
    <p id="t15" class="run"><span class="n"><a href="#t15">15</a></span><span class="t"><span class="key">import</span> <span class="nam">bisect</span>&nbsp;</span><span class="r"></span></p>
    <p id="t16" class="run"><span class="n"><a href="#t16">16</a></span><span class="t"><span class="key">import</span> <span class="nam">scipy</span> <span class="key">as</span> <span class="nam">sc</span>&nbsp;</span><span class="r"></span></p>
    <p id="t17" class="run"><span class="n"><a href="#t17">17</a></span><span class="t"><span class="key">import</span> <span class="nam">scipy</span><span class="op">.</span><span class="nam">signal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t18" class="run"><span class="n"><a href="#t18">18</a></span><span class="t"><span class="key">import</span> <span class="nam">pandas</span> <span class="key">as</span> <span class="nam">pd</span>&nbsp;</span><span class="r"></span></p>
    <p id="t19" class="run"><span class="n"><a href="#t19">19</a></span><span class="t"><span class="key">import</span> <span class="nam">matplotlib</span><span class="op">.</span><span class="nam">pyplot</span> <span class="key">as</span> <span class="nam">plt</span>&nbsp;</span><span class="r"></span></p>
    <p id="t20" class="run"><span class="n"><a href="#t20">20</a></span><span class="t"><span class="key">import</span> <span class="nam">time</span> <span class="key">as</span> <span class="nam">timepy</span>&nbsp;</span><span class="r"></span></p>
    <p id="t21" class="run"><span class="n"><a href="#t21">21</a></span><span class="t"><span class="key">import</span> <span class="nam">hatyan</span>&nbsp;</span><span class="r"></span></p>
    <p id="t22" class="run"><span class="n"><a href="#t22">22</a></span><span class="t"><span class="key">import</span> <span class="nam">sys</span>&nbsp;</span><span class="r"></span></p>
    <p id="t23" class="run"><span class="n"><a href="#t23">23</a></span><span class="t"><span class="key">import</span> <span class="nam">os</span>&nbsp;</span><span class="r"></span></p>
    <p id="t24" class="pln"><span class="n"><a href="#t24">24</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t25" class="pln"><span class="n"><a href="#t25">25</a></span><span class="t"><span class="com"># OpenTNSim</span>&nbsp;</span><span class="r"></span></p>
    <p id="t26" class="run"><span class="n"><a href="#t26">26</a></span><span class="t"><span class="key">from</span> <span class="nam">opentnsim</span> <span class="key">import</span> <span class="nam">energy_consumption_module</span>&nbsp;</span><span class="r"></span></p>
    <p id="t27" class="run"><span class="n"><a href="#t27">27</a></span><span class="t"><span class="key">from</span> <span class="nam">opentnsim</span> <span class="key">import</span> <span class="nam">lock_module</span>&nbsp;</span><span class="r"></span></p>
    <p id="t28" class="run"><span class="n"><a href="#t28">28</a></span><span class="t"><span class="key">from</span> <span class="nam">operator</span> <span class="key">import</span> <span class="nam">itemgetter</span>&nbsp;</span><span class="r"></span></p>
    <p id="t29" class="run"><span class="n"><a href="#t29">29</a></span><span class="t"><span class="key">from</span> <span class="nam">sklearn</span><span class="op">.</span><span class="nam">decomposition</span> <span class="key">import</span> <span class="nam">PCA</span>&nbsp;</span><span class="r"></span></p>
    <p id="t30" class="pln"><span class="n"><a href="#t30">30</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t31" class="pln"><span class="n"><a href="#t31">31</a></span><span class="t"><span class="com"># spatial libraries</span>&nbsp;</span><span class="r"></span></p>
    <p id="t32" class="run"><span class="n"><a href="#t32">32</a></span><span class="t"><span class="key">import</span> <span class="nam">pyproj</span>&nbsp;</span><span class="r"></span></p>
    <p id="t33" class="run"><span class="n"><a href="#t33">33</a></span><span class="t"><span class="key">import</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span>&nbsp;</span><span class="r"></span></p>
    <p id="t34" class="pln"><span class="n"><a href="#t34">34</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t35" class="pln"><span class="n"><a href="#t35">35</a></span><span class="t"><span class="com"># additional packages</span>&nbsp;</span><span class="r"></span></p>
    <p id="t36" class="run"><span class="n"><a href="#t36">36</a></span><span class="t"><span class="key">import</span> <span class="nam">datetime</span>&nbsp;</span><span class="r"></span></p>
    <p id="t37" class="pln"><span class="n"><a href="#t37">37</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t38" class="run"><span class="n"><a href="#t38">38</a></span><span class="t"><span class="nam">logger</span> <span class="op">=</span> <span class="nam">logging</span><span class="op">.</span><span class="nam">getLogger</span><span class="op">(</span><span class="nam">__name__</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t39" class="pln"><span class="n"><a href="#t39">39</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t40" class="pln"><span class="n"><a href="#t40">40</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t41" class="run"><span class="n"><a href="#t41">41</a></span><span class="t"><span class="key">class</span> <span class="nam">SimpyObject</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t42" class="pln"><span class="n"><a href="#t42">42</a></span><span class="t">    <span class="str">"""General object which can be extended by any class requiring a simpy environment</span>&nbsp;</span><span class="r"></span></p>
    <p id="t43" class="pln"><span class="n"><a href="#t43">43</a></span><span class="t"><span class="str">    env: a simpy Environment</span>&nbsp;</span><span class="r"></span></p>
    <p id="t44" class="pln"><span class="n"><a href="#t44">44</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t45" class="pln"><span class="n"><a href="#t45">45</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t46" class="run"><span class="n"><a href="#t46">46</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">env</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t47" class="run"><span class="n"><a href="#t47">47</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t48" class="run"><span class="n"><a href="#t48">48</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">env</span> <span class="op">=</span> <span class="nam">env</span>&nbsp;</span><span class="r"></span></p>
    <p id="t49" class="pln"><span class="n"><a href="#t49">49</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t50" class="run"><span class="n"><a href="#t50">50</a></span><span class="t"><span class="key">class</span> <span class="nam">HasResource</span><span class="op">(</span><span class="nam">SimpyObject</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t51" class="pln"><span class="n"><a href="#t51">51</a></span><span class="t">    <span class="str">"""Something that has a resource limitation, a resource request must be granted before the object can be used.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t52" class="pln"><span class="n"><a href="#t52">52</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t53" class="pln"><span class="n"><a href="#t53">53</a></span><span class="t"><span class="str">    nr_resources: nr of requests that can be handled simultaneously"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t54" class="pln"><span class="n"><a href="#t54">54</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t55" class="run"><span class="n"><a href="#t55">55</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">nr_resources</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">priority</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t56" class="run"><span class="n"><a href="#t56">56</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t57" class="pln"><span class="n"><a href="#t57">57</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t58" class="run"><span class="n"><a href="#t58">58</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">resource</span> <span class="op">=</span> <span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t59" class="pln"><span class="n"><a href="#t59">59</a></span><span class="t">            <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="nam">nr_resources</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t60" class="pln"><span class="n"><a href="#t60">60</a></span><span class="t">            <span class="key">if</span> <span class="nam">priority</span>&nbsp;</span><span class="r"></span></p>
    <p id="t61" class="pln"><span class="n"><a href="#t61">61</a></span><span class="t">            <span class="key">else</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">Resource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="nam">nr_resources</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t62" class="pln"><span class="n"><a href="#t62">62</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t63" class="pln"><span class="n"><a href="#t63">63</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t64" class="run"><span class="n"><a href="#t64">64</a></span><span class="t"><span class="key">class</span> <span class="nam">Identifiable</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t65" class="pln"><span class="n"><a href="#t65">65</a></span><span class="t">    <span class="str">"""Mixin class: Something that has a name and id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t66" class="pln"><span class="n"><a href="#t66">66</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t67" class="pln"><span class="n"><a href="#t67">67</a></span><span class="t"><span class="str">    name: a name</span>&nbsp;</span><span class="r"></span></p>
    <p id="t68" class="pln"><span class="n"><a href="#t68">68</a></span><span class="t"><span class="str">    id: a unique id generated with uuid"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t69" class="pln"><span class="n"><a href="#t69">69</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t70" class="run"><span class="n"><a href="#t70">70</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">name</span><span class="op">,</span> <span class="nam">id</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t71" class="run"><span class="n"><a href="#t71">71</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t72" class="pln"><span class="n"><a href="#t72">72</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t73" class="run"><span class="n"><a href="#t73">73</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">name</span> <span class="op">=</span> <span class="nam">name</span>&nbsp;</span><span class="r"></span></p>
    <p id="t74" class="pln"><span class="n"><a href="#t74">74</a></span><span class="t">        <span class="com"># generate some id, in this case based on m</span>&nbsp;</span><span class="r"></span></p>
    <p id="t75" class="run"><span class="n"><a href="#t75">75</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">id</span> <span class="key">if</span> <span class="nam">id</span> <span class="key">else</span> <span class="nam">str</span><span class="op">(</span><span class="nam">uuid</span><span class="op">.</span><span class="nam">uuid1</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t76" class="pln"><span class="n"><a href="#t76">76</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t77" class="run"><span class="n"><a href="#t77">77</a></span><span class="t"><span class="key">class</span> <span class="nam">HasType</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t78" class="pln"><span class="n"><a href="#t78">78</a></span><span class="t">    <span class="str">"""Mixin class: Something that has a name and id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t79" class="pln"><span class="n"><a href="#t79">79</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t80" class="pln"><span class="n"><a href="#t80">80</a></span><span class="t"><span class="str">    name: a name</span>&nbsp;</span><span class="r"></span></p>
    <p id="t81" class="pln"><span class="n"><a href="#t81">81</a></span><span class="t"><span class="str">    id: a unique id generated with uuid"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t82" class="pln"><span class="n"><a href="#t82">82</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t83" class="run"><span class="n"><a href="#t83">83</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">type</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t84" class="mis show_mis"><span class="n"><a href="#t84">84</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t85" class="pln"><span class="n"><a href="#t85">85</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t86" class="mis show_mis"><span class="n"><a href="#t86">86</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t87" class="pln"><span class="n"><a href="#t87">87</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t88" class="run"><span class="n"><a href="#t88">88</a></span><span class="t"><span class="key">class</span> <span class="nam">Locatable</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t89" class="pln"><span class="n"><a href="#t89">89</a></span><span class="t">    <span class="str">"""Mixin class: Something with a geometry (geojson format)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t90" class="pln"><span class="n"><a href="#t90">90</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t91" class="pln"><span class="n"><a href="#t91">91</a></span><span class="t"><span class="str">    geometry: can be a point as well as a polygon"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t92" class="pln"><span class="n"><a href="#t92">92</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t93" class="run"><span class="n"><a href="#t93">93</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">geometry</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t94" class="run"><span class="n"><a href="#t94">94</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t95" class="pln"><span class="n"><a href="#t95">95</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t96" class="run"><span class="n"><a href="#t96">96</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">=</span> <span class="nam">geometry</span>&nbsp;</span><span class="r"></span></p>
    <p id="t97" class="run"><span class="n"><a href="#t97">97</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">node</span> <span class="op">=</span> <span class="key">None</span>&nbsp;</span><span class="r"></span></p>
    <p id="t98" class="pln"><span class="n"><a href="#t98">98</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t99" class="run"><span class="n"><a href="#t99">99</a></span><span class="t"><span class="key">class</span> <span class="nam">Neighbours</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t100" class="pln"><span class="n"><a href="#t100">100</a></span><span class="t">    <span class="str">"""Can be added to a locatable object (list)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t101" class="pln"><span class="n"><a href="#t101">101</a></span><span class="t"><span class="str">    travel_to: list of locatables to which can be travelled"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t102" class="pln"><span class="n"><a href="#t102">102</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t103" class="run"><span class="n"><a href="#t103">103</a></span><span class="t">    <span class="key">def</span> <span class="nam">___init</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">travel_to</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t104" class="mis show_mis"><span class="n"><a href="#t104">104</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t105" class="pln"><span class="n"><a href="#t105">105</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t106" class="mis show_mis"><span class="n"><a href="#t106">106</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">neighbours</span> <span class="op">=</span> <span class="nam">travel_to</span>&nbsp;</span><span class="r"></span></p>
    <p id="t107" class="pln"><span class="n"><a href="#t107">107</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t108" class="run"><span class="n"><a href="#t108">108</a></span><span class="t"><span class="key">class</span> <span class="nam">HasLength</span><span class="op">(</span><span class="nam">SimpyObject</span><span class="op">)</span><span class="op">:</span> <span class="com">#used by IsLock and IsLineUpArea to regulate number of vessels in each lock cycle and calculate repsective position in lock chamber/line-up area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t109" class="pln"><span class="n"><a href="#t109">109</a></span><span class="t">    <span class="str">"""Mixin class: Something with a storage capacity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t110" class="pln"><span class="n"><a href="#t110">110</a></span><span class="t"><span class="str">    capacity: amount the container can hold</span>&nbsp;</span><span class="r"></span></p>
    <p id="t111" class="pln"><span class="n"><a href="#t111">111</a></span><span class="t"><span class="str">    level: amount the container holds initially</span>&nbsp;</span><span class="r"></span></p>
    <p id="t112" class="pln"><span class="n"><a href="#t112">112</a></span><span class="t"><span class="str">    total_requested: a counter that helps to prevent over requesting"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t113" class="pln"><span class="n"><a href="#t113">113</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t114" class="run"><span class="n"><a href="#t114">114</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">length</span><span class="op">,</span> <span class="nam">remaining_length</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">total_requested</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t115" class="mis show_mis"><span class="n"><a href="#t115">115</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t116" class="pln"><span class="n"><a href="#t116">116</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t117" class="mis show_mis"><span class="n"><a href="#t117">117</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">length</span> <span class="op">=</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">Container</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span> <span class="op">=</span> <span class="nam">length</span><span class="op">,</span> <span class="nam">init</span><span class="op">=</span><span class="nam">remaining_length</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t118" class="mis show_mis"><span class="n"><a href="#t118">118</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">pos_length</span> <span class="op">=</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">Container</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span> <span class="op">=</span> <span class="nam">length</span><span class="op">,</span> <span class="nam">init</span><span class="op">=</span><span class="nam">remaining_length</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t119" class="pln"><span class="n"><a href="#t119">119</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t120" class="run"><span class="n"><a href="#t120">120</a></span><span class="t"><span class="key">class</span> <span class="nam">HasContainer</span><span class="op">(</span><span class="nam">SimpyObject</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t121" class="pln"><span class="n"><a href="#t121">121</a></span><span class="t">    <span class="str">"""Mixin class: Something with a storage capacity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t122" class="pln"><span class="n"><a href="#t122">122</a></span><span class="t"><span class="str">    capacity: amount the container can hold</span>&nbsp;</span><span class="r"></span></p>
    <p id="t123" class="pln"><span class="n"><a href="#t123">123</a></span><span class="t"><span class="str">    level: amount the container holds initially</span>&nbsp;</span><span class="r"></span></p>
    <p id="t124" class="pln"><span class="n"><a href="#t124">124</a></span><span class="t"><span class="str">    container: a simpy object that can hold stuff</span>&nbsp;</span><span class="r"></span></p>
    <p id="t125" class="pln"><span class="n"><a href="#t125">125</a></span><span class="t"><span class="str">    total_requested: a counter that helps to prevent over requesting"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t126" class="pln"><span class="n"><a href="#t126">126</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t127" class="run"><span class="n"><a href="#t127">127</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">,</span> <span class="nam">level</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">total_requested</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t128" class="mis show_mis"><span class="n"><a href="#t128">128</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t129" class="pln"><span class="n"><a href="#t129">129</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t130" class="mis show_mis"><span class="n"><a href="#t130">130</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">container</span> <span class="op">=</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">Container</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">,</span> <span class="nam">init</span><span class="op">=</span><span class="nam">level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t131" class="mis show_mis"><span class="n"><a href="#t131">131</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">total_requested</span> <span class="op">=</span> <span class="nam">total_requested</span>&nbsp;</span><span class="r"></span></p>
    <p id="t132" class="pln"><span class="n"><a href="#t132">132</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t133" class="run"><span class="n"><a href="#t133">133</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p id="t134" class="run"><span class="n"><a href="#t134">134</a></span><span class="t">    <span class="key">def</span> <span class="nam">is_loaded</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t135" class="mis show_mis"><span class="n"><a href="#t135">135</a></span><span class="t">        <span class="key">return</span> <span class="key">True</span> <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">container</span><span class="op">.</span><span class="nam">level</span> <span class="op">></span> <span class="num">0</span> <span class="key">else</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t136" class="pln"><span class="n"><a href="#t136">136</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t137" class="run"><span class="n"><a href="#t137">137</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p id="t138" class="run"><span class="n"><a href="#t138">138</a></span><span class="t">    <span class="key">def</span> <span class="nam">filling_degree</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t139" class="mis show_mis"><span class="n"><a href="#t139">139</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">container</span><span class="op">.</span><span class="nam">level</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">container</span><span class="op">.</span><span class="nam">capacity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t140" class="pln"><span class="n"><a href="#t140">140</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t141" class="run"><span class="n"><a href="#t141">141</a></span><span class="t"><span class="key">class</span> <span class="nam">Log</span><span class="op">(</span><span class="nam">SimpyObject</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t142" class="pln"><span class="n"><a href="#t142">142</a></span><span class="t">    <span class="str">"""Mixin class: Something that has logging capability</span>&nbsp;</span><span class="r"></span></p>
    <p id="t143" class="pln"><span class="n"><a href="#t143">143</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t144" class="pln"><span class="n"><a href="#t144">144</a></span><span class="t"><span class="str">    log: log message [format: 'start activity' or 'stop activity']</span>&nbsp;</span><span class="r"></span></p>
    <p id="t145" class="pln"><span class="n"><a href="#t145">145</a></span><span class="t"><span class="str">    t: timestamp</span>&nbsp;</span><span class="r"></span></p>
    <p id="t146" class="pln"><span class="n"><a href="#t146">146</a></span><span class="t"><span class="str">    value: a value can be logged as well</span>&nbsp;</span><span class="r"></span></p>
    <p id="t147" class="pln"><span class="n"><a href="#t147">147</a></span><span class="t"><span class="str">    geometry: value from locatable (lat, lon)"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t148" class="pln"><span class="n"><a href="#t148">148</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t149" class="run"><span class="n"><a href="#t149">149</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t150" class="run"><span class="n"><a href="#t150">150</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t151" class="pln"><span class="n"><a href="#t151">151</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t152" class="run"><span class="n"><a href="#t152">152</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log</span> <span class="op">=</span> <span class="op">{</span><span class="str">"Message"</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">"Timestamp"</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">"Value"</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">"Geometry"</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t153" class="pln"><span class="n"><a href="#t153">153</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t154" class="run"><span class="n"><a href="#t154">154</a></span><span class="t">    <span class="key">def</span> <span class="nam">log_entry</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">log</span><span class="op">,</span> <span class="nam">t</span><span class="op">,</span> <span class="nam">value</span><span class="op">,</span> <span class="nam">geometry_log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t155" class="pln"><span class="n"><a href="#t155">155</a></span><span class="t">        <span class="str">"""Log"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t156" class="mis show_mis"><span class="n"><a href="#t156">156</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Message"</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">log</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t157" class="mis show_mis"><span class="n"><a href="#t157">157</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Timestamp"</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">datetime</span><span class="op">.</span><span class="nam">datetime</span><span class="op">.</span><span class="nam">fromtimestamp</span><span class="op">(</span><span class="nam">t</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t158" class="mis show_mis"><span class="n"><a href="#t158">158</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Value"</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t159" class="mis show_mis"><span class="n"><a href="#t159">159</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Geometry"</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">geometry_log</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t160" class="pln"><span class="n"><a href="#t160">160</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t161" class="run"><span class="n"><a href="#t161">161</a></span><span class="t">    <span class="key">def</span> <span class="nam">get_log_as_json</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t162" class="mis show_mis"><span class="n"><a href="#t162">162</a></span><span class="t">        <span class="nam">json</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t163" class="mis show_mis"><span class="n"><a href="#t163">163</a></span><span class="t">        <span class="key">for</span> <span class="nam">msg</span><span class="op">,</span> <span class="nam">t</span><span class="op">,</span> <span class="nam">value</span><span class="op">,</span> <span class="nam">geometry_log</span> <span class="key">in</span> <span class="nam">zip</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t164" class="pln"><span class="n"><a href="#t164">164</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Message"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t165" class="pln"><span class="n"><a href="#t165">165</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Timestamp"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t166" class="pln"><span class="n"><a href="#t166">166</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Value"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t167" class="pln"><span class="n"><a href="#t167">167</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">log</span><span class="op">[</span><span class="str">"Geometry"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t168" class="pln"><span class="n"><a href="#t168">168</a></span><span class="t">        <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t169" class="mis show_mis"><span class="n"><a href="#t169">169</a></span><span class="t">            <span class="nam">json</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t170" class="pln"><span class="n"><a href="#t170">170</a></span><span class="t">                <span class="nam">dict</span><span class="op">(</span><span class="nam">message</span><span class="op">=</span><span class="nam">msg</span><span class="op">,</span> <span class="nam">time</span><span class="op">=</span><span class="nam">t</span><span class="op">,</span> <span class="nam">value</span><span class="op">=</span><span class="nam">value</span><span class="op">,</span> <span class="nam">geometry_log</span><span class="op">=</span><span class="nam">geometry_log</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t171" class="pln"><span class="n"><a href="#t171">171</a></span><span class="t">            <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t172" class="mis show_mis"><span class="n"><a href="#t172">172</a></span><span class="t">        <span class="key">return</span> <span class="nam">json</span>&nbsp;</span><span class="r"></span></p>
    <p id="t173" class="pln"><span class="n"><a href="#t173">173</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t174" class="run"><span class="n"><a href="#t174">174</a></span><span class="t"><span class="key">class</span> <span class="nam">ExtraMetadata</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t175" class="pln"><span class="n"><a href="#t175">175</a></span><span class="t">    <span class="str">"""store all leftover keyword arguments as metadata property (use as last mixin)"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t176" class="run"><span class="n"><a href="#t176">176</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t177" class="mis show_mis"><span class="n"><a href="#t177">177</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t178" class="pln"><span class="n"><a href="#t178">178</a></span><span class="t">        <span class="com"># store all other properties as metadata</span>&nbsp;</span><span class="r"></span></p>
    <p id="t179" class="mis show_mis"><span class="n"><a href="#t179">179</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">metadata</span> <span class="op">=</span> <span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t180" class="pln"><span class="n"><a href="#t180">180</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t181" class="run"><span class="n"><a href="#t181">181</a></span><span class="t"><span class="key">class</span> <span class="nam">VesselProperties</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t182" class="pln"><span class="n"><a href="#t182">182</a></span><span class="t">    <span class="str">"""Mixin class: Something that has vessel properties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t183" class="pln"><span class="n"><a href="#t183">183</a></span><span class="t"><span class="str">    This mixin is updated to better accommodate the ConsumesEnergy mixin</span>&nbsp;</span><span class="r"></span></p>
    <p id="t184" class="pln"><span class="n"><a href="#t184">184</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t185" class="pln"><span class="n"><a href="#t185">185</a></span><span class="t"><span class="str">    type: can contain info on vessel type (avv class, cemt_class or other)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t186" class="pln"><span class="n"><a href="#t186">186</a></span><span class="t"><span class="str">    B: vessel width</span>&nbsp;</span><span class="r"></span></p>
    <p id="t187" class="pln"><span class="n"><a href="#t187">187</a></span><span class="t"><span class="str">    L: vessel length</span>&nbsp;</span><span class="r"></span></p>
    <p id="t188" class="pln"><span class="n"><a href="#t188">188</a></span><span class="t"><span class="str">    H_e: vessel height unloaded</span>&nbsp;</span><span class="r"></span></p>
    <p id="t189" class="pln"><span class="n"><a href="#t189">189</a></span><span class="t"><span class="str">    H_f: vessel height loaded</span>&nbsp;</span><span class="r"></span></p>
    <p id="t190" class="pln"><span class="n"><a href="#t190">190</a></span><span class="t"><span class="str">    T_e: draught unloaded</span>&nbsp;</span><span class="r"></span></p>
    <p id="t191" class="pln"><span class="n"><a href="#t191">191</a></span><span class="t"><span class="str">    T_f: draught loaded</span>&nbsp;</span><span class="r"></span></p>
    <p id="t192" class="pln"><span class="n"><a href="#t192">192</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t193" class="pln"><span class="n"><a href="#t193">193</a></span><span class="t"><span class="str">    Add information on possible restrictions to the vessels, i.e. height, width, etc.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t194" class="pln"><span class="n"><a href="#t194">194</a></span><span class="t"><span class="str">    """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t195" class="pln"><span class="n"><a href="#t195">195</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t196" class="run"><span class="n"><a href="#t196">196</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t197" class="pln"><span class="n"><a href="#t197">197</a></span><span class="t">            <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t198" class="pln"><span class="n"><a href="#t198">198</a></span><span class="t">            <span class="nam">type</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t199" class="pln"><span class="n"><a href="#t199">199</a></span><span class="t">            <span class="nam">B</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t200" class="pln"><span class="n"><a href="#t200">200</a></span><span class="t">            <span class="nam">L</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t201" class="pln"><span class="n"><a href="#t201">201</a></span><span class="t">            <span class="nam">H_e</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t202" class="pln"><span class="n"><a href="#t202">202</a></span><span class="t">            <span class="nam">H_f</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t203" class="pln"><span class="n"><a href="#t203">203</a></span><span class="t">            <span class="nam">T_e</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t204" class="pln"><span class="n"><a href="#t204">204</a></span><span class="t">            <span class="nam">T_f</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t205" class="pln"><span class="n"><a href="#t205">205</a></span><span class="t">            <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t206" class="pln"><span class="n"><a href="#t206">206</a></span><span class="t">            <span class="op">**</span><span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t207" class="pln"><span class="n"><a href="#t207">207</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t208" class="mis show_mis"><span class="n"><a href="#t208">208</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t209" class="pln"><span class="n"><a href="#t209">209</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t210" class="pln"><span class="n"><a href="#t210">210</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t211" class="mis show_mis"><span class="n"><a href="#t211">211</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t212" class="pln"><span class="n"><a href="#t212">212</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t213" class="mis show_mis"><span class="n"><a href="#t213">213</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">B</span> <span class="op">=</span> <span class="nam">B</span>&nbsp;</span><span class="r"></span></p>
    <p id="t214" class="mis show_mis"><span class="n"><a href="#t214">214</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">L</span> <span class="op">=</span> <span class="nam">L</span>&nbsp;</span><span class="r"></span></p>
    <p id="t215" class="pln"><span class="n"><a href="#t215">215</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t216" class="mis show_mis"><span class="n"><a href="#t216">216</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">H_e</span> <span class="op">=</span> <span class="nam">H_e</span>&nbsp;</span><span class="r"></span></p>
    <p id="t217" class="mis show_mis"><span class="n"><a href="#t217">217</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">H_f</span> <span class="op">=</span> <span class="nam">H_e</span>&nbsp;</span><span class="r"></span></p>
    <p id="t218" class="pln"><span class="n"><a href="#t218">218</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t219" class="mis show_mis"><span class="n"><a href="#t219">219</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">T_e</span> <span class="op">=</span> <span class="nam">T_e</span>&nbsp;</span><span class="r"></span></p>
    <p id="t220" class="mis show_mis"><span class="n"><a href="#t220">220</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">T_f</span> <span class="op">=</span> <span class="nam">T_f</span>&nbsp;</span><span class="r"></span></p>
    <p id="t221" class="pln"><span class="n"><a href="#t221">221</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t222" class="run"><span class="n"><a href="#t222">222</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p id="t223" class="run"><span class="n"><a href="#t223">223</a></span><span class="t">    <span class="key">def</span> <span class="nam">H</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t224" class="pln"><span class="n"><a href="#t224">224</a></span><span class="t">        <span class="str">""" Calculate current height based on filling degree """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t225" class="pln"><span class="n"><a href="#t225">225</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t226" class="mis show_mis"><span class="n"><a href="#t226">226</a></span><span class="t">        <span class="key">return</span> <span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t227" class="pln"><span class="n"><a href="#t227">227</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">filling_degree</span> <span class="op">*</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">H_f</span> <span class="op">-</span> <span class="nam">self</span><span class="op">.</span><span class="nam">H_e</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t228" class="pln"><span class="n"><a href="#t228">228</a></span><span class="t">                <span class="op">+</span> <span class="nam">self</span><span class="op">.</span><span class="nam">H_e</span>&nbsp;</span><span class="r"></span></p>
    <p id="t229" class="pln"><span class="n"><a href="#t229">229</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t230" class="pln"><span class="n"><a href="#t230">230</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t231" class="run"><span class="n"><a href="#t231">231</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p id="t232" class="run"><span class="n"><a href="#t232">232</a></span><span class="t">    <span class="key">def</span> <span class="nam">T</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t233" class="pln"><span class="n"><a href="#t233">233</a></span><span class="t">        <span class="str">""" Calculate current draught based on filling degree</span>&nbsp;</span><span class="r"></span></p>
    <p id="t234" class="pln"><span class="n"><a href="#t234">234</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t235" class="pln"><span class="n"><a href="#t235">235</a></span><span class="t"><span class="str">        Here we should implement the rules from Van Dorsser et al</span>&nbsp;</span><span class="r"></span></p>
    <p id="t236" class="pln"><span class="n"><a href="#t236">236</a></span><span class="t"><span class="str">        https://www.researchgate.net/publication/344340126_The_effect_of_low_water_on_loading_capacity_of_inland_ships</span>&nbsp;</span><span class="r"></span></p>
    <p id="t237" class="pln"><span class="n"><a href="#t237">237</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t238" class="pln"><span class="n"><a href="#t238">238</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t239" class="mis show_mis"><span class="n"><a href="#t239">239</a></span><span class="t">        <span class="key">return</span> <span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t240" class="pln"><span class="n"><a href="#t240">240</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">filling_degree</span> <span class="op">*</span> <span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">T_f</span> <span class="op">-</span> <span class="nam">self</span><span class="op">.</span><span class="nam">T_e</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t241" class="pln"><span class="n"><a href="#t241">241</a></span><span class="t">                <span class="op">+</span> <span class="nam">self</span><span class="op">.</span><span class="nam">T_e</span>&nbsp;</span><span class="r"></span></p>
    <p id="t242" class="pln"><span class="n"><a href="#t242">242</a></span><span class="t">        <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t243" class="pln"><span class="n"><a href="#t243">243</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t244" class="run"><span class="n"><a href="#t244">244</a></span><span class="t">    <span class="key">def</span> <span class="nam">get_route</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t245" class="pln"><span class="n"><a href="#t245">245</a></span><span class="t">            <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t246" class="pln"><span class="n"><a href="#t246">246</a></span><span class="t">            <span class="nam">origin</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t247" class="pln"><span class="n"><a href="#t247">247</a></span><span class="t">            <span class="nam">destination</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t248" class="pln"><span class="n"><a href="#t248">248</a></span><span class="t">            <span class="nam">graph</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t249" class="pln"><span class="n"><a href="#t249">249</a></span><span class="t">            <span class="nam">minWidth</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t250" class="pln"><span class="n"><a href="#t250">250</a></span><span class="t">            <span class="nam">minHeight</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t251" class="pln"><span class="n"><a href="#t251">251</a></span><span class="t">            <span class="nam">minDepth</span><span class="op">=</span><span class="key">None</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t252" class="pln"><span class="n"><a href="#t252">252</a></span><span class="t">            <span class="nam">randomSeed</span><span class="op">=</span><span class="num">4</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t253" class="pln"><span class="n"><a href="#t253">253</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t254" class="pln"><span class="n"><a href="#t254">254</a></span><span class="t">        <span class="str">""" Calculate a path based on vessel restrictions """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t255" class="pln"><span class="n"><a href="#t255">255</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t256" class="mis show_mis"><span class="n"><a href="#t256">256</a></span><span class="t">        <span class="nam">graph</span> <span class="op">=</span> <span class="nam">graph</span> <span class="key">if</span> <span class="nam">graph</span> <span class="key">else</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t257" class="mis show_mis"><span class="n"><a href="#t257">257</a></span><span class="t">        <span class="nam">minWidth</span> <span class="op">=</span> <span class="nam">minWidth</span> <span class="key">if</span> <span class="nam">minWidth</span> <span class="key">else</span> <span class="num">1.1</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">B</span>&nbsp;</span><span class="r"></span></p>
    <p id="t258" class="mis show_mis"><span class="n"><a href="#t258">258</a></span><span class="t">        <span class="nam">minHeight</span> <span class="op">=</span> <span class="nam">minWidth</span> <span class="key">if</span> <span class="nam">minHeight</span> <span class="key">else</span> <span class="num">1.1</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">H</span>&nbsp;</span><span class="r"></span></p>
    <p id="t259" class="mis show_mis"><span class="n"><a href="#t259">259</a></span><span class="t">        <span class="nam">minDepth</span> <span class="op">=</span> <span class="nam">minWidth</span> <span class="key">if</span> <span class="nam">minDepth</span> <span class="key">else</span> <span class="num">1.1</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">T</span>&nbsp;</span><span class="r"></span></p>
    <p id="t260" class="pln"><span class="n"><a href="#t260">260</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t261" class="pln"><span class="n"><a href="#t261">261</a></span><span class="t">        <span class="com"># Check if information on restrictions is added to the edges</span>&nbsp;</span><span class="r"></span></p>
    <p id="t262" class="mis show_mis"><span class="n"><a href="#t262">262</a></span><span class="t">        <span class="nam">random</span><span class="op">.</span><span class="nam">seed</span><span class="op">(</span><span class="nam">randomSeed</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t263" class="mis show_mis"><span class="n"><a href="#t263">263</a></span><span class="t">        <span class="nam">edge</span> <span class="op">=</span> <span class="nam">random</span><span class="op">.</span><span class="nam">choice</span><span class="op">(</span><span class="nam">list</span><span class="op">(</span><span class="nam">graph</span><span class="op">.</span><span class="nam">edges</span><span class="op">(</span><span class="nam">data</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t264" class="mis show_mis"><span class="n"><a href="#t264">264</a></span><span class="t">        <span class="nam">edge_attrs</span> <span class="op">=</span> <span class="nam">list</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t265" class="pln"><span class="n"><a href="#t265">265</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t266" class="pln"><span class="n"><a href="#t266">266</a></span><span class="t">        <span class="com"># IMPROVE THIS TO CHECK ALL EDGES AND COMBINATIONS OF RESTRICTIONS</span>&nbsp;</span><span class="r"></span></p>
    <p id="t267" class="pln"><span class="n"><a href="#t267">267</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t268" class="mis show_mis"><span class="n"><a href="#t268">268</a></span><span class="t">        <span class="key">if</span> <span class="nam">all</span><span class="op">(</span><span class="nam">item</span> <span class="key">in</span> <span class="nam">edge_attrs</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="op">[</span><span class="str">"Width"</span><span class="op">,</span> <span class="str">"Height"</span><span class="op">,</span> <span class="str">"Depth"</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t269" class="mis show_mis"><span class="n"><a href="#t269">269</a></span><span class="t">            <span class="nam">edges</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t270" class="mis show_mis"><span class="n"><a href="#t270">270</a></span><span class="t">            <span class="nam">nodes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t271" class="pln"><span class="n"><a href="#t271">271</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t272" class="mis show_mis"><span class="n"><a href="#t272">272</a></span><span class="t">            <span class="key">for</span> <span class="nam">edge</span> <span class="key">in</span> <span class="nam">graph</span><span class="op">.</span><span class="nam">edges</span><span class="op">(</span><span class="nam">data</span><span class="op">=</span><span class="key">True</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t273" class="mis show_mis"><span class="n"><a href="#t273">273</a></span><span class="t">                <span class="key">if</span> <span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t274" class="pln"><span class="n"><a href="#t274">274</a></span><span class="t">                        <span class="nam">edge</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="str">"Width"</span><span class="op">]</span> <span class="op">>=</span> <span class="nam">minWidth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t275" class="pln"><span class="n"><a href="#t275">275</a></span><span class="t">                        <span class="key">and</span> <span class="nam">edge</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="str">"Height"</span><span class="op">]</span> <span class="op">>=</span> <span class="nam">minHeight</span>&nbsp;</span><span class="r"></span></p>
    <p id="t276" class="pln"><span class="n"><a href="#t276">276</a></span><span class="t">                        <span class="key">and</span> <span class="nam">edge</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="str">"Depth"</span><span class="op">]</span> <span class="op">>=</span> <span class="nam">minDepth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t277" class="pln"><span class="n"><a href="#t277">277</a></span><span class="t">                <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t278" class="mis show_mis"><span class="n"><a href="#t278">278</a></span><span class="t">                    <span class="nam">edges</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">edge</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t279" class="pln"><span class="n"><a href="#t279">279</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t280" class="mis show_mis"><span class="n"><a href="#t280">280</a></span><span class="t">                    <span class="nam">nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">graph</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t281" class="mis show_mis"><span class="n"><a href="#t281">281</a></span><span class="t">                    <span class="nam">nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">graph</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t282" class="pln"><span class="n"><a href="#t282">282</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t283" class="mis show_mis"><span class="n"><a href="#t283">283</a></span><span class="t">            <span class="nam">subGraph</span> <span class="op">=</span> <span class="nam">graph</span><span class="op">.</span><span class="nam">__class__</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t284" class="pln"><span class="n"><a href="#t284">284</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t285" class="mis show_mis"><span class="n"><a href="#t285">285</a></span><span class="t">            <span class="key">for</span> <span class="nam">node</span> <span class="key">in</span> <span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t286" class="mis show_mis"><span class="n"><a href="#t286">286</a></span><span class="t">                <span class="nam">subGraph</span><span class="op">.</span><span class="nam">add_node</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t287" class="pln"><span class="n"><a href="#t287">287</a></span><span class="t">                    <span class="nam">node</span><span class="op">[</span><span class="str">"name"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t288" class="pln"><span class="n"><a href="#t288">288</a></span><span class="t">                    <span class="nam">name</span><span class="op">=</span><span class="nam">node</span><span class="op">[</span><span class="str">"name"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t289" class="pln"><span class="n"><a href="#t289">289</a></span><span class="t">                    <span class="nam">geometry</span><span class="op">=</span><span class="nam">node</span><span class="op">[</span><span class="str">"geometry"</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t290" class="pln"><span class="n"><a href="#t290">290</a></span><span class="t">                    <span class="nam">position</span><span class="op">=</span><span class="op">(</span><span class="nam">node</span><span class="op">[</span><span class="str">"geometry"</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span> <span class="nam">node</span><span class="op">[</span><span class="str">"geometry"</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t291" class="pln"><span class="n"><a href="#t291">291</a></span><span class="t">                <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t292" class="pln"><span class="n"><a href="#t292">292</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t293" class="mis show_mis"><span class="n"><a href="#t293">293</a></span><span class="t">            <span class="key">for</span> <span class="nam">edge</span> <span class="key">in</span> <span class="nam">edges</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t294" class="mis show_mis"><span class="n"><a href="#t294">294</a></span><span class="t">                <span class="nam">subGraph</span><span class="op">.</span><span class="nam">add_edge</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">attr_dict</span><span class="op">=</span><span class="nam">edge</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t295" class="pln"><span class="n"><a href="#t295">295</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t296" class="mis show_mis"><span class="n"><a href="#t296">296</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t297" class="mis show_mis"><span class="n"><a href="#t297">297</a></span><span class="t">                <span class="key">return</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">subGraph</span><span class="op">,</span> <span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t298" class="pln"><span class="n"><a href="#t298">298</a></span><span class="t">                <span class="com"># return nx.bidirectional_dijkstra(subGraph, origin, destination)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t299" class="mis show_mis"><span class="n"><a href="#t299">299</a></span><span class="t">            <span class="key">except</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t300" class="mis show_mis"><span class="n"><a href="#t300">300</a></span><span class="t">                <span class="key">raise</span> <span class="nam">ValueError</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t301" class="pln"><span class="n"><a href="#t301">301</a></span><span class="t">                    <span class="str">"No path was found with the given boundary conditions."</span>&nbsp;</span><span class="r"></span></p>
    <p id="t302" class="pln"><span class="n"><a href="#t302">302</a></span><span class="t">                <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t303" class="pln"><span class="n"><a href="#t303">303</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t304" class="pln"><span class="n"><a href="#t304">304</a></span><span class="t">        <span class="com"># If not, return shortest path</span>&nbsp;</span><span class="r"></span></p>
    <p id="t305" class="pln"><span class="n"><a href="#t305">305</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t306" class="mis show_mis"><span class="n"><a href="#t306">306</a></span><span class="t">            <span class="key">return</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">graph</span><span class="op">,</span> <span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t307" class="pln"><span class="n"><a href="#t307">307</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t308" class="run"><span class="n"><a href="#t308">308</a></span><span class="t"><span class="key">class</span> <span class="nam">IsJunction</span><span class="op">(</span><span class="nam">Identifiable</span><span class="op">,</span><span class="nam">HasType</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t309" class="pln"><span class="n"><a href="#t309">309</a></span><span class="t">    <span class="str">"""Mixin class: Something has waiting area object properties as part of the lock complex [in SI-units]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t310" class="pln"><span class="n"><a href="#t310">310</a></span><span class="t"><span class="str">            creates a waiting area with a waiting_area resource which is requested when a vessels wants to enter the area with limited capacity"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t311" class="pln"><span class="n"><a href="#t311">311</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t312" class="run"><span class="n"><a href="#t312">312</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t313" class="pln"><span class="n"><a href="#t313">313</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t314" class="pln"><span class="n"><a href="#t314">314</a></span><span class="t">        <span class="nam">sections</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t315" class="pln"><span class="n"><a href="#t315">315</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t316" class="pln"><span class="n"><a href="#t316">316</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t317" class="pln"><span class="n"><a href="#t317">317</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t318" class="mis show_mis"><span class="n"><a href="#t318">318</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t319" class="pln"><span class="n"><a href="#t319">319</a></span><span class="t">        <span class="str">"Initialization"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t320" class="pln"><span class="n"><a href="#t320">320</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t321" class="mis show_mis"><span class="n"><a href="#t321">321</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">sections</span> <span class="op">=</span> <span class="nam">sections</span>&nbsp;</span><span class="r"></span></p>
    <p id="t322" class="mis show_mis"><span class="n"><a href="#t322">322</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">section</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t323" class="pln"><span class="n"><a href="#t323">323</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t324" class="pln"><span class="n"><a href="#t324">324</a></span><span class="t">        <span class="com"># Loop over the sections which are connected to the junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t325" class="mis show_mis"><span class="n"><a href="#t325">325</a></span><span class="t">        <span class="key">for</span> <span class="nam">edge</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">sections</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t326" class="pln"><span class="n"><a href="#t326">326</a></span><span class="t">            <span class="com"># If section is type 'one-way-traffic'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t327" class="mis show_mis"><span class="n"><a href="#t327">327</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">type</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'one-way_traffic'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t328" class="pln"><span class="n"><a href="#t328">328</a></span><span class="t">                <span class="com">#Set default direction parameter</span>&nbsp;</span><span class="r"></span></p>
    <p id="t329" class="mis show_mis"><span class="n"><a href="#t329">329</a></span><span class="t">                <span class="nam">direction</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t330" class="pln"><span class="n"><a href="#t330">330</a></span><span class="t">                <span class="com">#If longitude of first node of the edge is smaller than the second node and strictly not equal to each other: set direction = 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t331" class="mis show_mis"><span class="n"><a href="#t331">331</a></span><span class="t">                <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span> <span class="op">!=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t332" class="mis show_mis"><span class="n"><a href="#t332">332</a></span><span class="t">                    <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span> <span class="op">&lt;</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t333" class="mis show_mis"><span class="n"><a href="#t333">333</a></span><span class="t">                        <span class="nam">direction</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t334" class="pln"><span class="n"><a href="#t334">334</a></span><span class="t">                <span class="com"># Else is longitudes are equal: if latitude of first node of the edge is smaller than the second node: set direction = 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t335" class="mis show_mis"><span class="n"><a href="#t335">335</a></span><span class="t">                <span class="key">elif</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span> <span class="op">&lt;</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t336" class="mis show_mis"><span class="n"><a href="#t336">336</a></span><span class="t">                    <span class="nam">direction</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t337" class="pln"><span class="n"><a href="#t337">337</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t338" class="pln"><span class="n"><a href="#t338">338</a></span><span class="t">                <span class="com"># If direction: append two access resources to that node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t339" class="mis show_mis"><span class="n"><a href="#t339">339</a></span><span class="t">                <span class="key">if</span> <span class="nam">direction</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t340" class="mis show_mis"><span class="n"><a href="#t340">340</a></span><span class="t">                    <span class="key">if</span> <span class="str">'access1'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t341" class="mis show_mis"><span class="n"><a href="#t341">341</a></span><span class="t">                        <span class="nam">self</span><span class="op">.</span><span class="nam">access1</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t342" class="mis show_mis"><span class="n"><a href="#t342">342</a></span><span class="t">                        <span class="nam">self</span><span class="op">.</span><span class="nam">access2</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t343" class="pln"><span class="n"><a href="#t343">343</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t344" class="mis show_mis"><span class="n"><a href="#t344">344</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">access1</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">{</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t345" class="mis show_mis"><span class="n"><a href="#t345">345</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">access2</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">{</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t346" class="pln"><span class="n"><a href="#t346">346</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t347" class="pln"><span class="n"><a href="#t347">347</a></span><span class="t">            <span class="com"># Append a resource to the section with 'infinite' capacity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t348" class="mis show_mis"><span class="n"><a href="#t348">348</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">section</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">{</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">10000</span><span class="op">)</span><span class="op">,</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t349" class="pln"><span class="n"><a href="#t349">349</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t350" class="run"><span class="n"><a href="#t350">350</a></span><span class="t"><span class="key">class</span> <span class="nam">IsTerminal</span><span class="op">(</span><span class="nam">HasType</span><span class="op">,</span> <span class="nam">HasLength</span><span class="op">,</span> <span class="nam">Identifiable</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t351" class="pln"><span class="n"><a href="#t351">351</a></span><span class="t">    <span class="str">"""Mixin class: Something has waiting area object properties as part of the lock complex [in SI-units]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t352" class="pln"><span class="n"><a href="#t352">352</a></span><span class="t"><span class="str">            creates a waiting area with a waiting_area resource which is requested when a vessels wants to enter the area with limited capacity"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t353" class="run"><span class="n"><a href="#t353">353</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t354" class="pln"><span class="n"><a href="#t354">354</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t355" class="pln"><span class="n"><a href="#t355">355</a></span><span class="t">        <span class="nam">node_start</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t356" class="pln"><span class="n"><a href="#t356">356</a></span><span class="t">        <span class="nam">node_end</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t357" class="pln"><span class="n"><a href="#t357">357</a></span><span class="t">        <span class="nam">length</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t358" class="pln"><span class="n"><a href="#t358">358</a></span><span class="t">        <span class="nam">type</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t359" class="pln"><span class="n"><a href="#t359">359</a></span><span class="t">        <span class="nam">jetty_locations</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t360" class="pln"><span class="n"><a href="#t360">360</a></span><span class="t">        <span class="nam">jetty_lengths</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t361" class="pln"><span class="n"><a href="#t361">361</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t362" class="pln"><span class="n"><a href="#t362">362</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t363" class="pln"><span class="n"><a href="#t363">363</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t364" class="pln"><span class="n"><a href="#t364">364</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t365" class="pln"><span class="n"><a href="#t365">365</a></span><span class="t">        <span class="str">"Initialization"</span>&nbsp;</span><span class="r"></span></p>
    <p id="t366" class="mis show_mis"><span class="n"><a href="#t366">366</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t367" class="mis show_mis"><span class="n"><a href="#t367">367</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">output</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t368" class="mis show_mis"><span class="n"><a href="#t368">368</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="nam">type</span><span class="op">=</span><span class="nam">type</span><span class="op">,</span><span class="nam">length</span><span class="op">=</span><span class="nam">length</span><span class="op">,</span> <span class="nam">remaining_length</span><span class="op">=</span><span class="nam">length</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t369" class="pln"><span class="n"><a href="#t369">369</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t370" class="mis show_mis"><span class="n"><a href="#t370">370</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t371" class="mis show_mis"><span class="n"><a href="#t371">371</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">terminal</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t372" class="pln"><span class="n"><a href="#t372">372</a></span><span class="t">                <span class="nam">node_start</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">100</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t373" class="pln"><span class="n"><a href="#t373">373</a></span><span class="t">            <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t374" class="pln"><span class="n"><a href="#t374">374</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t375" class="mis show_mis"><span class="n"><a href="#t375">375</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">available_quay_lengths</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="nam">length</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t376" class="pln"><span class="n"><a href="#t376">376</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t377" class="mis show_mis"><span class="n"><a href="#t377">377</a></span><span class="t">        <span class="key">elif</span> <span class="nam">self</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t378" class="mis show_mis"><span class="n"><a href="#t378">378</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">terminal</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t379" class="mis show_mis"><span class="n"><a href="#t379">379</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">jetties_occupied</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t380" class="mis show_mis"><span class="n"><a href="#t380">380</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">jetty_locations</span> <span class="op">=</span> <span class="nam">jetty_locations</span>&nbsp;</span><span class="r"></span></p>
    <p id="t381" class="mis show_mis"><span class="n"><a href="#t381">381</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">jetty_lengths</span> <span class="op">=</span> <span class="nam">jetty_lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t382" class="mis show_mis"><span class="n"><a href="#t382">382</a></span><span class="t">            <span class="key">for</span> <span class="nam">jetty</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">jetty_locations</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t383" class="mis show_mis"><span class="n"><a href="#t383">383</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t384" class="pln"><span class="n"><a href="#t384">384</a></span><span class="t">                    <span class="nam">node_start</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t385" class="pln"><span class="n"><a href="#t385">385</a></span><span class="t">                <span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t386" class="pln"><span class="n"><a href="#t386">386</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t387" class="pln"><span class="n"><a href="#t387">387</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t388" class="run"><span class="n"><a href="#t388">388</a></span><span class="t"><span class="key">class</span> <span class="nam">IsOrigin</span><span class="op">(</span><span class="nam">Identifiable</span><span class="op">,</span><span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t389" class="pln"><span class="n"><a href="#t389">389</a></span><span class="t">    <span class="str">"""Mixin class: Something has waiting area object properties as part of the lock complex [in SI-units]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t390" class="pln"><span class="n"><a href="#t390">390</a></span><span class="t"><span class="str">            creates a waiting area with a waiting_area resource which is requested when a vessels wants to enter the area with limited capacity"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t391" class="pln"><span class="n"><a href="#t391">391</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t392" class="run"><span class="n"><a href="#t392">392</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t393" class="pln"><span class="n"><a href="#t393">393</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t394" class="pln"><span class="n"><a href="#t394">394</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t395" class="pln"><span class="n"><a href="#t395">395</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t396" class="pln"><span class="n"><a href="#t396">396</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t397" class="mis show_mis"><span class="n"><a href="#t397">397</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t398" class="pln"><span class="n"><a href="#t398">398</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t399" class="run"><span class="n"><a href="#t399">399</a></span><span class="t"><span class="key">class</span> <span class="nam">IsAnchorage</span><span class="op">(</span><span class="nam">Identifiable</span><span class="op">,</span><span class="nam">HasType</span><span class="op">,</span><span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t400" class="pln"><span class="n"><a href="#t400">400</a></span><span class="t">    <span class="str">"""Mixin class: Something has waiting area object properties as part of the lock complex [in SI-units]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t401" class="pln"><span class="n"><a href="#t401">401</a></span><span class="t"><span class="str">            creates a waiting area with a waiting_area resource which is requested when a vessels wants to enter the area with limited capacity"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t402" class="pln"><span class="n"><a href="#t402">402</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t403" class="run"><span class="n"><a href="#t403">403</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t404" class="pln"><span class="n"><a href="#t404">404</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t405" class="pln"><span class="n"><a href="#t405">405</a></span><span class="t">        <span class="nam">node</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t406" class="pln"><span class="n"><a href="#t406">406</a></span><span class="t">        <span class="nam">max_capacity</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t407" class="pln"><span class="n"><a href="#t407">407</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t408" class="pln"><span class="n"><a href="#t408">408</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t409" class="pln"><span class="n"><a href="#t409">409</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t410" class="mis show_mis"><span class="n"><a href="#t410">410</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t411" class="pln"><span class="n"><a href="#t411">411</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t412" class="mis show_mis"><span class="n"><a href="#t412">412</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">max_capacity</span> <span class="op">=</span> <span class="nam">max_capacity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t413" class="mis show_mis"><span class="n"><a href="#t413">413</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">output</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t414" class="mis show_mis"><span class="n"><a href="#t414">414</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">anchorage_area</span> <span class="op">=</span> <span class="op">{</span>&nbsp;</span><span class="r"></span></p>
    <p id="t415" class="pln"><span class="n"><a href="#t415">415</a></span><span class="t">            <span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="nam">max_capacity</span><span class="op">)</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t416" class="pln"><span class="n"><a href="#t416">416</a></span><span class="t">        <span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t417" class="pln"><span class="n"><a href="#t417">417</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t418" class="run"><span class="n"><a href="#t418">418</a></span><span class="t"><span class="key">class</span> <span class="nam">NetworkProperties</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t419" class="pln"><span class="n"><a href="#t419">419</a></span><span class="t">    <span class="str">"""Class: a collection of functions that append properties to the network"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t420" class="pln"><span class="n"><a href="#t420">420</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t421" class="run"><span class="n"><a href="#t421">421</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t422" class="pln"><span class="n"><a href="#t422">422</a></span><span class="t">                 <span class="nam">network</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t423" class="pln"><span class="n"><a href="#t423">423</a></span><span class="t">                 <span class="nam">W</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t424" class="pln"><span class="n"><a href="#t424">424</a></span><span class="t">                 <span class="nam">D</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t425" class="pln"><span class="n"><a href="#t425">425</a></span><span class="t">                 <span class="nam">eta</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t426" class="pln"><span class="n"><a href="#t426">426</a></span><span class="t">                 <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t427" class="pln"><span class="n"><a href="#t427">427</a></span><span class="t">                 <span class="op">**</span><span class="nam">kwargs</span>&nbsp;</span><span class="r"></span></p>
    <p id="t428" class="pln"><span class="n"><a href="#t428">428</a></span><span class="t">    <span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t429" class="mis show_mis"><span class="n"><a href="#t429">429</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t430" class="pln"><span class="n"><a href="#t430">430</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t431" class="run"><span class="n"><a href="#t431">431</a></span><span class="t">    <span class="key">def</span> <span class="nam">append_data_to_nodes</span><span class="op">(</span><span class="nam">network</span><span class="op">,</span><span class="nam">W</span><span class="op">,</span><span class="nam">D</span><span class="op">,</span><span class="nam">MBL</span><span class="op">,</span><span class="nam">eta</span><span class="op">,</span><span class="nam">vmag</span><span class="op">,</span><span class="nam">vdir</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t432" class="pln"><span class="n"><a href="#t432">432</a></span><span class="t">        <span class="str">""" Function: appends geometric and hydrodynamic data to the nodes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t433" class="pln"><span class="n"><a href="#t433">433</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t434" class="pln"><span class="n"><a href="#t434">434</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t435" class="pln"><span class="n"><a href="#t435">435</a></span><span class="t"><span class="str">                - network: a graph constructed with the DiGraph class of the networkx package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t436" class="pln"><span class="n"><a href="#t436">436</a></span><span class="t"><span class="str">                - W: a list with [[],[]]-format containing the geometry of the individual nodes imported as points constructed with</span>&nbsp;</span><span class="r"></span></p>
    <p id="t437" class="pln"><span class="n"><a href="#t437">437</a></span><span class="t"><span class="str">                     the geometry class of the shapely package in the first column and the actual waterway widths in [m] as floats</span>&nbsp;</span><span class="r"></span></p>
    <p id="t438" class="pln"><span class="n"><a href="#t438">438</a></span><span class="t"><span class="str">                     at the nodes in the second column. The indexes should be matching, containing information about the same node.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t439" class="pln"><span class="n"><a href="#t439">439</a></span><span class="t"><span class="str">                - D: a list with [[],[]]-format containing the geometry of the nodes imported as points constructed with</span>&nbsp;</span><span class="r"></span></p>
    <p id="t440" class="pln"><span class="n"><a href="#t440">440</a></span><span class="t"><span class="str">                     the geometry class of the shapely package in the first column and the actual waterway depths in [m] as floats</span>&nbsp;</span><span class="r"></span></p>
    <p id="t441" class="pln"><span class="n"><a href="#t441">441</a></span><span class="t"><span class="str">                     at the nodes in the second column. The indexes should be matching, containing information about the same node.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t442" class="pln"><span class="n"><a href="#t442">442</a></span><span class="t"><span class="str">                - MBL: a list with [[],[]]-format containing the geometry of the individual nodes imported as points constructed with</span>&nbsp;</span><span class="r"></span></p>
    <p id="t443" class="pln"><span class="n"><a href="#t443">443</a></span><span class="t"><span class="str">                       the geometry class of the shapely package in the first column and the actual maintained water depths of</span>&nbsp;</span><span class="r"></span></p>
    <p id="t444" class="pln"><span class="n"><a href="#t444">444</a></span><span class="t"><span class="str">                       the waterays in [m] as floats in the second column. The indexes should be matching, containing information about</span>&nbsp;</span><span class="r"></span></p>
    <p id="t445" class="pln"><span class="n"><a href="#t445">445</a></span><span class="t"><span class="str">                       the same node.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t446" class="pln"><span class="n"><a href="#t446">446</a></span><span class="t"><span class="str">                - eta: a list with [[],[]]-format containing the geometry of the individual nodes imported as points constructed with</span>&nbsp;</span><span class="r"></span></p>
    <p id="t447" class="pln"><span class="n"><a href="#t447">447</a></span><span class="t"><span class="str">                       the geometry class of the shapely package in the first column and a list with [[],[]]-format of time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t448" class="pln"><span class="n"><a href="#t448">448</a></span><span class="t"><span class="str">                       series of the actual water levels in [m] in the second column. The indexes should be matching, containing information</span>&nbsp;</span><span class="r"></span></p>
    <p id="t449" class="pln"><span class="n"><a href="#t449">449</a></span><span class="t"><span class="str">                       about the same node. The list in the second column should consist of the timestamps of the data in the first column</span>&nbsp;</span><span class="r"></span></p>
    <p id="t450" class="pln"><span class="n"><a href="#t450">450</a></span><span class="t"><span class="str">                       and the values of the property as floats in the second column. The time series should be in chronological order.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t451" class="pln"><span class="n"><a href="#t451">451</a></span><span class="t"><span class="str">                - vmag: a list with [[],[]]-format containing the geometry of the individual nodes imported as points constructed with</span>&nbsp;</span><span class="r"></span></p>
    <p id="t452" class="pln"><span class="n"><a href="#t452">452</a></span><span class="t"><span class="str">                        the geometry class of the shapely package in the first column and a list with [[],[]]-format of time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t453" class="pln"><span class="n"><a href="#t453">453</a></span><span class="t"><span class="str">                        series of the actual current velocity magnitudes in [m/s] in the second column. The indexes should be matching,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t454" class="pln"><span class="n"><a href="#t454">454</a></span><span class="t"><span class="str">                        containing information about the same node. The list in the second column should consist of the timestamps of the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t455" class="pln"><span class="n"><a href="#t455">455</a></span><span class="t"><span class="str">                        data in the first column and the values of the property as floats in the second column. The time series should be</span>&nbsp;</span><span class="r"></span></p>
    <p id="t456" class="pln"><span class="n"><a href="#t456">456</a></span><span class="t"><span class="str">                        in chronological order.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t457" class="pln"><span class="n"><a href="#t457">457</a></span><span class="t"><span class="str">                - vdir: a list with [[],[]]-format containing the geometry of the individual nodes imported as points constructed with</span>&nbsp;</span><span class="r"></span></p>
    <p id="t458" class="pln"><span class="n"><a href="#t458">458</a></span><span class="t"><span class="str">                        the geometry class of the shapely package in the first column and a list with [[],[]]-format of time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t459" class="pln"><span class="n"><a href="#t459">459</a></span><span class="t"><span class="str">                        series of the actual current directions in [rad] in the second column. The indexes should be matching, containing</span>&nbsp;</span><span class="r"></span></p>
    <p id="t460" class="pln"><span class="n"><a href="#t460">460</a></span><span class="t"><span class="str">                        information about the same node. The list in the second column should consist of the timestamps of the data in the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t461" class="pln"><span class="n"><a href="#t461">461</a></span><span class="t"><span class="str">                        first column and the values of the property as floats in the second column. The time series should be in chronological</span>&nbsp;</span><span class="r"></span></p>
    <p id="t462" class="pln"><span class="n"><a href="#t462">462</a></span><span class="t"><span class="str">                        order. Additionally, the reference system of the current direction should be in [0,2pi]-form with the northern direction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t463" class="pln"><span class="n"><a href="#t463">463</a></span><span class="t"><span class="str">                        corresponding to 0 and 2pi radians.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t464" class="pln"><span class="n"><a href="#t464">464</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t465" class="pln"><span class="n"><a href="#t465">465</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t466" class="pln"><span class="n"><a href="#t466">466</a></span><span class="t">        <span class="com">#Some functions used in the append_data_to_node_function</span>&nbsp;</span><span class="r"></span></p>
    <p id="t467" class="run"><span class="n"><a href="#t467">467</a></span><span class="t">        <span class="key">def</span> <span class="nam">fixed2bearing</span><span class="op">(</span><span class="nam">east_velocity</span><span class="op">,</span> <span class="nam">north_velocity</span><span class="op">,</span> <span class="nam">principal_direction</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t468" class="pln"><span class="n"><a href="#t468">468</a></span><span class="t">            <span class="str">""" Function: calculates the velocity components in a reference frame parallel to the principal direction of the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t469" class="pln"><span class="n"><a href="#t469">469</a></span><span class="t"><span class="str">                          velocity cluster. It returns the decomposed current velocity magnitudes in a reference frame relative</span>&nbsp;</span><span class="r"></span></p>
    <p id="t470" class="pln"><span class="n"><a href="#t470">470</a></span><span class="t"><span class="str">                          to the given principal direction.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t471" class="pln"><span class="n"><a href="#t471">471</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t472" class="pln"><span class="n"><a href="#t472">472</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t473" class="pln"><span class="n"><a href="#t473">473</a></span><span class="t"><span class="str">                    - east_velocity: velocity in Eastern direction in m/s (float)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t474" class="pln"><span class="n"><a href="#t474">474</a></span><span class="t"><span class="str">                    - north_velocity: velocity in Northern direction in m/s (float)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t475" class="pln"><span class="n"><a href="#t475">475</a></span><span class="t"><span class="str">                    - principal_direction: principal direction in degrees in fixed reference frame North-East (float)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t476" class="pln"><span class="n"><a href="#t476">476</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t477" class="pln"><span class="n"><a href="#t477">477</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t478" class="mis show_mis"><span class="n"><a href="#t478">478</a></span><span class="t">            <span class="nam">bearing_rad</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">radians</span><span class="op">(</span><span class="nam">principal_direction</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t479" class="mis show_mis"><span class="n"><a href="#t479">479</a></span><span class="t">            <span class="nam">x_velocity</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">cos</span><span class="op">(</span><span class="nam">bearing_rad</span><span class="op">)</span> <span class="op">*</span> <span class="nam">east_velocity</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sin</span><span class="op">(</span><span class="nam">bearing_rad</span><span class="op">)</span> <span class="op">*</span> <span class="nam">north_velocity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t480" class="mis show_mis"><span class="n"><a href="#t480">480</a></span><span class="t">            <span class="nam">y_velocity</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span> <span class="op">*</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sin</span><span class="op">(</span><span class="nam">bearing_rad</span><span class="op">)</span> <span class="op">*</span> <span class="nam">east_velocity</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">cos</span><span class="op">(</span><span class="nam">bearing_rad</span><span class="op">)</span> <span class="op">*</span> <span class="nam">north_velocity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t481" class="pln"><span class="n"><a href="#t481">481</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t482" class="mis show_mis"><span class="n"><a href="#t482">482</a></span><span class="t">            <span class="key">return</span> <span class="nam">x_velocity</span><span class="op">,</span> <span class="nam">y_velocity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t483" class="pln"><span class="n"><a href="#t483">483</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t484" class="run"><span class="n"><a href="#t484">484</a></span><span class="t">        <span class="key">def</span> <span class="nam">fixed2principal_components</span><span class="op">(</span><span class="nam">east_velocity_list</span><span class="op">,</span> <span class="nam">north_velocity_list</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t485" class="pln"><span class="n"><a href="#t485">485</a></span><span class="t">            <span class="str">""" Function: calculates the principal components from a cluster of velocities. It returns principal direction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t486" class="pln"><span class="n"><a href="#t486">486</a></span><span class="t"><span class="str">                          in degrees (float)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t487" class="pln"><span class="n"><a href="#t487">487</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t488" class="pln"><span class="n"><a href="#t488">488</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t489" class="pln"><span class="n"><a href="#t489">489</a></span><span class="t"><span class="str">                    - east_velocity_list: list of velocities in Eastern direction (list)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t490" class="pln"><span class="n"><a href="#t490">490</a></span><span class="t"><span class="str">                    - north_velocity_list: list of velocities in Northern direction (list)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t491" class="pln"><span class="n"><a href="#t491">491</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t492" class="pln"><span class="n"><a href="#t492">492</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t493" class="mis show_mis"><span class="n"><a href="#t493">493</a></span><span class="t">            <span class="nam">pca</span> <span class="op">=</span> <span class="nam">PCA</span><span class="op">(</span><span class="nam">n_components</span><span class="op">=</span><span class="num">2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t494" class="mis show_mis"><span class="n"><a href="#t494">494</a></span><span class="t">            <span class="nam">X</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">column_stack</span><span class="op">(</span><span class="op">(</span><span class="nam">east_velocity_list</span><span class="op">,</span> <span class="nam">north_velocity_list</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t495" class="mis show_mis"><span class="n"><a href="#t495">495</a></span><span class="t">            <span class="nam">X_pca</span> <span class="op">=</span> <span class="nam">pca</span><span class="op">.</span><span class="nam">fit</span><span class="op">(</span><span class="nam">X</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t496" class="mis show_mis"><span class="n"><a href="#t496">496</a></span><span class="t">            <span class="nam">y_pca</span> <span class="op">=</span> <span class="nam">pca</span><span class="op">.</span><span class="nam">components_</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t497" class="mis show_mis"><span class="n"><a href="#t497">497</a></span><span class="t">            <span class="nam">x_pca</span> <span class="op">=</span> <span class="nam">pca</span><span class="op">.</span><span class="nam">components_</span><span class="op">[</span><span class="op">:</span><span class="op">,</span> <span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t498" class="mis show_mis"><span class="n"><a href="#t498">498</a></span><span class="t">            <span class="nam">theta</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arctan2</span><span class="op">(</span><span class="nam">y_pca</span><span class="op">,</span> <span class="nam">x_pca</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t499" class="mis show_mis"><span class="n"><a href="#t499">499</a></span><span class="t">            <span class="nam">alpha</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">degrees</span><span class="op">(</span><span class="nam">theta</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t500" class="pln"><span class="n"><a href="#t500">500</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t501" class="pln"><span class="n"><a href="#t501">501</a></span><span class="t">            <span class="com"># Correction for positive alpha in coordinate system with positive x-direction upestuary</span>&nbsp;</span><span class="r"></span></p>
    <p id="t502" class="mis show_mis"><span class="n"><a href="#t502">502</a></span><span class="t">            <span class="key">if</span> <span class="nam">alpha</span> <span class="op">>=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t503" class="mis show_mis"><span class="n"><a href="#t503">503</a></span><span class="t">                <span class="nam">alpha</span> <span class="op">=</span> <span class="nam">alpha</span> <span class="op">-</span> <span class="num">180</span>  <span class="com"># in degrees</span>&nbsp;</span><span class="r"></span></p>
    <p id="t504" class="mis show_mis"><span class="n"><a href="#t504">504</a></span><span class="t">            <span class="key">return</span> <span class="nam">alpha</span>&nbsp;</span><span class="r"></span></p>
    <p id="t505" class="pln"><span class="n"><a href="#t505">505</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t506" class="run"><span class="n"><a href="#t506">506</a></span><span class="t">        <span class="key">def</span> <span class="nam">astronomical_tide</span><span class="op">(</span><span class="nam">signal_time</span><span class="op">,</span><span class="nam">signal_values</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t507" class="run"><span class="n"><a href="#t507">507</a></span><span class="t">            <span class="nam">old_stdout</span> <span class="op">=</span> <span class="nam">sys</span><span class="op">.</span><span class="nam">stdout</span>  <span class="com"># backup current stdout</span>&nbsp;</span><span class="r"></span></p>
    <p id="t508" class="run"><span class="n"><a href="#t508">508</a></span><span class="t">            <span class="nam">sys</span><span class="op">.</span><span class="nam">stdout</span> <span class="op">=</span> <span class="nam">open</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">devnull</span><span class="op">,</span> <span class="str">"w"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t509" class="run"><span class="n"><a href="#t509">509</a></span><span class="t">            <span class="nam">signal_datetime</span> <span class="op">=</span> <span class="op">[</span><span class="nam">datetime</span><span class="op">.</span><span class="nam">datetime</span><span class="op">.</span><span class="nam">fromtimestamp</span><span class="op">(</span><span class="nam">y</span><span class="op">)</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">signal_time</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t510" class="run"><span class="n"><a href="#t510">510</a></span><span class="t">            <span class="nam">const_list</span> <span class="op">=</span> <span class="nam">hatyan</span><span class="op">.</span><span class="nam">get_const_list_hatyan</span><span class="op">(</span><span class="str">'tidalcycle'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t511" class="run"><span class="n"><a href="#t511">511</a></span><span class="t">            <span class="nam">ts_meas</span> <span class="op">=</span> <span class="nam">pd</span><span class="op">.</span><span class="nam">DataFrame</span><span class="op">(</span><span class="op">{</span><span class="str">'values'</span><span class="op">:</span> <span class="nam">signal_values</span><span class="op">}</span><span class="op">,</span> <span class="nam">index</span><span class="op">=</span><span class="nam">signal_datetime</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t512" class="run"><span class="n"><a href="#t512">512</a></span><span class="t">            <span class="nam">ts_meas</span> <span class="op">=</span> <span class="nam">hatyan</span><span class="op">.</span><span class="nam">crop_timeseries</span><span class="op">(</span><span class="nam">ts</span><span class="op">=</span><span class="nam">ts_meas</span><span class="op">,</span> <span class="nam">times_ext</span><span class="op">=</span><span class="nam">signal_datetime</span><span class="op">)</span><span class="op">;</span>&nbsp;</span><span class="r"></span></p>
    <p id="t513" class="run"><span class="n"><a href="#t513">513</a></span><span class="t">            <span class="nam">comp_frommeas</span><span class="op">,</span> <span class="nam">comp_allyears</span> <span class="op">=</span> <span class="nam">hatyan</span><span class="op">.</span><span class="nam">get_components_from_ts</span><span class="op">(</span><span class="nam">ts</span><span class="op">=</span><span class="nam">ts_meas</span><span class="op">,</span> <span class="nam">const_list</span><span class="op">=</span><span class="nam">const_list</span><span class="op">,</span> <span class="nam">nodalfactors</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">return_allyears</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">fu_alltimes</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">analysis_peryear</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t514" class="run"><span class="n"><a href="#t514">514</a></span><span class="t">            <span class="nam">ts_prediction</span> <span class="op">=</span> <span class="nam">hatyan</span><span class="op">.</span><span class="nam">prediction</span><span class="op">(</span><span class="nam">comp</span><span class="op">=</span><span class="nam">comp_frommeas</span><span class="op">,</span> <span class="nam">nodalfactors</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">xfac</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">fu_alltimes</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">times_ext</span><span class="op">=</span><span class="nam">signal_datetime</span><span class="op">,</span> <span class="nam">timestep_min</span><span class="op">=</span><span class="num">10</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t515" class="run"><span class="n"><a href="#t515">515</a></span><span class="t">            <span class="nam">sys</span><span class="op">.</span><span class="nam">stdout</span> <span class="op">=</span> <span class="nam">old_stdout</span>  <span class="com"># reset old stdout</span>&nbsp;</span><span class="r"></span></p>
    <p id="t516" class="run"><span class="n"><a href="#t516">516</a></span><span class="t">            <span class="key">return</span> <span class="op">[</span><span class="op">[</span><span class="nam">index</span><span class="op">.</span><span class="nam">timestamp</span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="num">3600</span> <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">ts_prediction</span><span class="op">.</span><span class="nam">index</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="nam">value</span> <span class="key">for</span> <span class="nam">value</span> <span class="key">in</span> <span class="nam">ts_prediction</span><span class="op">[</span><span class="str">'values'</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t517" class="pln"><span class="n"><a href="#t517">517</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t518" class="run"><span class="n"><a href="#t518">518</a></span><span class="t">        <span class="key">def</span> <span class="nam">H99</span><span class="op">(</span><span class="nam">t</span><span class="op">,</span><span class="nam">wlev</span><span class="op">,</span><span class="nam">node</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t519" class="pln"><span class="n"><a href="#t519">519</a></span><span class="t">            <span class="str">""" Function: calculates the water level which is exceeded 99% of the tides for a given node in the network.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t520" class="pln"><span class="n"><a href="#t520">520</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t521" class="pln"><span class="n"><a href="#t521">521</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t522" class="pln"><span class="n"><a href="#t522">522</a></span><span class="t"><span class="str">                    - t: a list containing the chronological sequence of timestamps for the specific node, derived from the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t523" class="pln"><span class="n"><a href="#t523">523</a></span><span class="t"><span class="str">                         list of the time series containing the water level at the specific node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t524" class="pln"><span class="n"><a href="#t524">524</a></span><span class="t"><span class="str">                    - wlev: a list containing the chronological sequence of water levels for the specific node, derived from the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t525" class="pln"><span class="n"><a href="#t525">525</a></span><span class="t"><span class="str">                            list of the time series containing the water level at the specific node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t526" class="pln"><span class="n"><a href="#t526">526</a></span><span class="t"><span class="str">                    - node: the name string of the node in the given network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t527" class="pln"><span class="n"><a href="#t527">527</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t528" class="pln"><span class="n"><a href="#t528">528</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t529" class="pln"><span class="n"><a href="#t529">529</a></span><span class="t">            <span class="com"># Deriving some properties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t530" class="run"><span class="n"><a href="#t530">530</a></span><span class="t">            <span class="nam">mean_wlev</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">wlev</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t531" class="run"><span class="n"><a href="#t531">531</a></span><span class="t">            <span class="nam">deltat</span> <span class="op">=</span> <span class="nam">t</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">t</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t532" class="pln"><span class="n"><a href="#t532">532</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t533" class="pln"><span class="n"><a href="#t533">533</a></span><span class="t">            <span class="com"># Interpolation of the variation of the water level and calculation of the zero crossing times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t534" class="run"><span class="n"><a href="#t534">534</a></span><span class="t">            <span class="nam">intp</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t</span><span class="op">,</span> <span class="op">[</span><span class="nam">w</span> <span class="op">-</span> <span class="nam">mean_wlev</span> <span class="key">for</span> <span class="nam">w</span> <span class="key">in</span> <span class="nam">wlev</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t535" class="run"><span class="n"><a href="#t535">535</a></span><span class="t">            <span class="nam">roots</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t536" class="run"><span class="n"><a href="#t536">536</a></span><span class="t">            <span class="key">for</span> <span class="nam">root</span> <span class="key">in</span> <span class="nam">intp</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t537" class="run"><span class="n"><a href="#t537">537</a></span><span class="t">                <span class="key">if</span> <span class="nam">root</span> <span class="op">&lt;</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">or</span> <span class="nam">root</span> <span class="op">></span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t538" class="run"><span class="n"><a href="#t538">538</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t539" class="run"><span class="n"><a href="#t539">539</a></span><span class="t">                <span class="nam">roots</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">root</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t540" class="pln"><span class="n"><a href="#t540">540</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t541" class="pln"><span class="n"><a href="#t541">541</a></span><span class="t">            <span class="com"># Calculation of the maximum water level for each tidal cycle (when water level is greater than mean water level)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t542" class="run"><span class="n"><a href="#t542">542</a></span><span class="t">            <span class="nam">max_index</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t543" class="run"><span class="n"><a href="#t543">543</a></span><span class="t">            <span class="nam">max_t</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t544" class="run"><span class="n"><a href="#t544">544</a></span><span class="t">            <span class="nam">max_wlev</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t545" class="run"><span class="n"><a href="#t545">545</a></span><span class="t">            <span class="nam">prev_root</span> <span class="op">=</span> <span class="nam">t</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t546" class="run"><span class="n"><a href="#t546">546</a></span><span class="t">            <span class="key">for</span> <span class="nam">root</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">roots</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t547" class="run"><span class="n"><a href="#t547">547</a></span><span class="t">                <span class="key">if</span> <span class="nam">wlev</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">mean_wlev</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t548" class="run"><span class="n"><a href="#t548">548</a></span><span class="t">                    <span class="key">if</span> <span class="nam">root</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">%</span> <span class="num">2</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t549" class="run"><span class="n"><a href="#t549">549</a></span><span class="t">                        <span class="nam">prev_root</span> <span class="op">=</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t550" class="run"><span class="n"><a href="#t550">550</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t551" class="pln"><span class="n"><a href="#t551">551</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t552" class="run"><span class="n"><a href="#t552">552</a></span><span class="t">                    <span class="key">if</span> <span class="nam">root</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">%</span> <span class="num">2</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t553" class="run"><span class="n"><a href="#t553">553</a></span><span class="t">                        <span class="nam">prev_root</span> <span class="op">=</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t554" class="run"><span class="n"><a href="#t554">554</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t555" class="pln"><span class="n"><a href="#t555">555</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t556" class="run"><span class="n"><a href="#t556">556</a></span><span class="t">                <span class="nam">index_range_min</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t</span><span class="op">,</span> <span class="nam">prev_root</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t557" class="run"><span class="n"><a href="#t557">557</a></span><span class="t">                <span class="key">if</span> <span class="nam">t</span><span class="op">[</span><span class="nam">index_range_min</span><span class="op">]</span> <span class="op">-</span> <span class="nam">prev_root</span> <span class="op">&lt;</span> <span class="nam">deltat</span> <span class="op">/</span> <span class="num">2</span><span class="op">:</span> <span class="nam">index_range_min</span> <span class="op">=</span> <span class="nam">index_range_min</span> <span class="op">-</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t558" class="run"><span class="n"><a href="#t558">558</a></span><span class="t">                <span class="nam">index_range_max</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t</span><span class="op">,</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t559" class="run"><span class="n"><a href="#t559">559</a></span><span class="t">                <span class="key">if</span> <span class="nam">index_range_max</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">t</span><span class="op">)</span> <span class="key">or</span> <span class="nam">t</span><span class="op">[</span><span class="nam">index_range_max</span><span class="op">]</span> <span class="op">-</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">deltat</span> <span class="op">/</span> <span class="num">2</span><span class="op">:</span> <span class="nam">index_range_max</span> <span class="op">=</span> <span class="nam">index_range_max</span> <span class="op">-</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t560" class="run"><span class="n"><a href="#t560">560</a></span><span class="t">                <span class="key">if</span> <span class="nam">index_range_min</span> <span class="op">==</span> <span class="nam">index_range_max</span><span class="op">:</span> <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t561" class="run"><span class="n"><a href="#t561">561</a></span><span class="t">                <span class="nam">max_index</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">wlev</span><span class="op">[</span><span class="nam">index_range_min</span><span class="op">:</span><span class="nam">index_range_max</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">index_range_min</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t562" class="run"><span class="n"><a href="#t562">562</a></span><span class="t">                <span class="nam">max_t</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">t</span><span class="op">[</span><span class="nam">max_index</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t563" class="run"><span class="n"><a href="#t563">563</a></span><span class="t">                <span class="nam">max_wlev</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">wlev</span><span class="op">[</span><span class="nam">max_index</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t564" class="pln"><span class="n"><a href="#t564">564</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t565" class="pln"><span class="n"><a href="#t565">565</a></span><span class="t">            <span class="com"># Sorting lists from highest to lowest maximum water level</span>&nbsp;</span><span class="r"></span></p>
    <p id="t566" class="run"><span class="n"><a href="#t566">566</a></span><span class="t">            <span class="nam">zipped_lists</span> <span class="op">=</span> <span class="nam">zip</span><span class="op">(</span><span class="nam">max_wlev</span><span class="op">,</span> <span class="nam">max_index</span><span class="op">,</span> <span class="nam">max_t</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t567" class="run"><span class="n"><a href="#t567">567</a></span><span class="t">            <span class="nam">sorted_pairs</span> <span class="op">=</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zipped_lists</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t568" class="run"><span class="n"><a href="#t568">568</a></span><span class="t">            <span class="nam">tuples</span> <span class="op">=</span> <span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">sorted_pairs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t569" class="run"><span class="n"><a href="#t569">569</a></span><span class="t">            <span class="nam">mwlev</span><span class="op">,</span> <span class="nam">mindex</span><span class="op">,</span> <span class="nam">mt</span> <span class="op">=</span> <span class="op">[</span><span class="nam">list</span><span class="op">(</span><span class="nam">tuple</span><span class="op">)</span> <span class="key">for</span> <span class="nam">tuple</span> <span class="key">in</span> <span class="nam">tuples</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t570" class="pln"><span class="n"><a href="#t570">570</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t571" class="pln"><span class="n"><a href="#t571">571</a></span><span class="t">            <span class="com"># Returning the water level in the list closest to the 99% value</span>&nbsp;</span><span class="r"></span></p>
    <p id="t572" class="run"><span class="n"><a href="#t572">572</a></span><span class="t">            <span class="key">return</span> <span class="nam">mwlev</span><span class="op">[</span><span class="nam">round</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">max_wlev</span><span class="op">)</span> <span class="op">*</span> <span class="num">0.01</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t573" class="pln"><span class="n"><a href="#t573">573</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t574" class="run"><span class="n"><a href="#t574">574</a></span><span class="t">        <span class="key">def</span> <span class="nam">tidal_periods</span><span class="op">(</span><span class="nam">t_astro_tide_wlev</span><span class="op">,</span> <span class="nam">astro_tide_wlev</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t575" class="pln"><span class="n"><a href="#t575">575</a></span><span class="t">            <span class="str">""" Function: calculates the water level which is exceeded 99% of the tides for a given node in the network.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t576" class="pln"><span class="n"><a href="#t576">576</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t577" class="pln"><span class="n"><a href="#t577">577</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t578" class="pln"><span class="n"><a href="#t578">578</a></span><span class="t"><span class="str">                    - t_astro_wlev: a list containing the chronological sequence of timestamps for the specific node, derived from the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t579" class="pln"><span class="n"><a href="#t579">579</a></span><span class="t"><span class="str">                                    list of the time series containing the water level at the specific node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t580" class="pln"><span class="n"><a href="#t580">580</a></span><span class="t"><span class="str">                    - astro_wlev: a list containing the chronological sequence of water levels for the specific node, derived from the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t581" class="pln"><span class="n"><a href="#t581">581</a></span><span class="t"><span class="str">                                  list of the time series containing the water level at the specific node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t582" class="pln"><span class="n"><a href="#t582">582</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t583" class="pln"><span class="n"><a href="#t583">583</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t584" class="pln"><span class="n"><a href="#t584">584</a></span><span class="t">            <span class="com"># Deriving some properties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t585" class="run"><span class="n"><a href="#t585">585</a></span><span class="t">            <span class="nam">mean_astro_wlev</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">astro_tide_wlev</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t586" class="pln"><span class="n"><a href="#t586">586</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t587" class="pln"><span class="n"><a href="#t587">587</a></span><span class="t">            <span class="com"># Interpolation of the variation of the water level and calculation of the zero crossing times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t588" class="run"><span class="n"><a href="#t588">588</a></span><span class="t">            <span class="nam">cor_astro_tide</span> <span class="op">=</span> <span class="op">[</span><span class="nam">astro_wlev</span> <span class="op">-</span> <span class="nam">mean_astro_wlev</span> <span class="key">for</span> <span class="nam">astro_wlev</span> <span class="key">in</span> <span class="nam">astro_tide_wlev</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t589" class="run"><span class="n"><a href="#t589">589</a></span><span class="t">            <span class="nam">intp</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_astro_tide_wlev</span><span class="op">,</span> <span class="nam">cor_astro_tide</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t590" class="run"><span class="n"><a href="#t590">590</a></span><span class="t">            <span class="nam">times_tidal_periods</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t591" class="run"><span class="n"><a href="#t591">591</a></span><span class="t">            <span class="nam">index_prev_root</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t592" class="run"><span class="n"><a href="#t592">592</a></span><span class="t">            <span class="key">for</span> <span class="nam">root</span> <span class="key">in</span> <span class="nam">intp</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t593" class="run"><span class="n"><a href="#t593">593</a></span><span class="t">                <span class="nam">index_current_root</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_astro_tide_wlev</span><span class="op">,</span> <span class="nam">root</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t594" class="run"><span class="n"><a href="#t594">594</a></span><span class="t">                <span class="key">if</span> <span class="nam">root</span> <span class="op">>=</span> <span class="nam">t_astro_tide_wlev</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">root</span> <span class="op">&lt;=</span> <span class="nam">t_astro_tide_wlev</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">cor_astro_tide</span><span class="op">[</span><span class="nam">index_prev_root</span><span class="op">:</span><span class="nam">index_current_root</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t595" class="run"><span class="n"><a href="#t595">595</a></span><span class="t">                    <span class="nam">index</span> <span class="op">=</span> <span class="nam">cor_astro_tide</span><span class="op">[</span><span class="nam">index_prev_root</span><span class="op">:</span><span class="nam">index_current_root</span><span class="op">]</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">cor_astro_tide</span><span class="op">[</span><span class="nam">index_prev_root</span><span class="op">:</span><span class="nam">index_current_root</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t596" class="run"><span class="n"><a href="#t596">596</a></span><span class="t">                    <span class="nam">time_start_next_tidal_period</span> <span class="op">=</span> <span class="nam">t_astro_tide_wlev</span><span class="op">[</span><span class="nam">index</span> <span class="op">+</span> <span class="nam">index_prev_root</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t597" class="run"><span class="n"><a href="#t597">597</a></span><span class="t">                    <span class="nam">times_tidal_periods</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">time_start_next_tidal_period</span><span class="op">,</span> <span class="str">'Ebb Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t598" class="run"><span class="n"><a href="#t598">598</a></span><span class="t">                    <span class="nam">index_prev_root</span> <span class="op">=</span> <span class="nam">index_current_root</span>&nbsp;</span><span class="r"></span></p>
    <p id="t599" class="run"><span class="n"><a href="#t599">599</a></span><span class="t">                <span class="key">elif</span> <span class="nam">root</span> <span class="op">>=</span> <span class="nam">t_astro_tide_wlev</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">root</span> <span class="op">&lt;=</span> <span class="nam">t_astro_tide_wlev</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">cor_astro_tide</span><span class="op">[</span><span class="nam">index_prev_root</span><span class="op">:</span><span class="nam">index_current_root</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t600" class="run"><span class="n"><a href="#t600">600</a></span><span class="t">                    <span class="nam">index</span> <span class="op">=</span> <span class="nam">cor_astro_tide</span><span class="op">[</span><span class="nam">index_prev_root</span><span class="op">:</span><span class="nam">index_current_root</span><span class="op">]</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">cor_astro_tide</span><span class="op">[</span><span class="nam">index_prev_root</span><span class="op">:</span><span class="nam">index_current_root</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t601" class="run"><span class="n"><a href="#t601">601</a></span><span class="t">                    <span class="nam">time_start_next_tidal_period</span> <span class="op">=</span> <span class="nam">t_astro_tide_wlev</span><span class="op">[</span><span class="nam">index</span> <span class="op">+</span> <span class="nam">index_prev_root</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t602" class="run"><span class="n"><a href="#t602">602</a></span><span class="t">                    <span class="nam">times_tidal_periods</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">time_start_next_tidal_period</span><span class="op">,</span> <span class="str">'Flood Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t603" class="run"><span class="n"><a href="#t603">603</a></span><span class="t">                    <span class="nam">index_prev_root</span> <span class="op">=</span> <span class="nam">index_current_root</span>&nbsp;</span><span class="r"></span></p>
    <p id="t604" class="pln"><span class="n"><a href="#t604">604</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t605" class="run"><span class="n"><a href="#t605">605</a></span><span class="t">            <span class="key">return</span> <span class="nam">times_tidal_periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t606" class="pln"><span class="n"><a href="#t606">606</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t607" class="run"><span class="n"><a href="#t607">607</a></span><span class="t">        <span class="key">def</span> <span class="nam">append_info_to_edges</span><span class="op">(</span><span class="nam">network</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t608" class="pln"><span class="n"><a href="#t608">608</a></span><span class="t">            <span class="str">""" Function: appends nodal data to the edges of the network for visualisation purposes only</span>&nbsp;</span><span class="r"></span></p>
    <p id="t609" class="pln"><span class="n"><a href="#t609">609</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t610" class="pln"><span class="n"><a href="#t610">610</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t611" class="pln"><span class="n"><a href="#t611">611</a></span><span class="t"><span class="str">                    - network: a graph constructed with the DiGraph class of the networkx package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t612" class="pln"><span class="n"><a href="#t612">612</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t613" class="pln"><span class="n"><a href="#t613">613</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t614" class="pln"><span class="n"><a href="#t614">614</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t615" class="pln"><span class="n"><a href="#t615">615</a></span><span class="t">            <span class="com">#Function that is used in the calculation of info that needs to be appended to the edges</span>&nbsp;</span><span class="r"></span></p>
    <p id="t616" class="run"><span class="n"><a href="#t616">616</a></span><span class="t">            <span class="key">def</span> <span class="nam">lag_finder</span><span class="op">(</span><span class="nam">time_signal</span><span class="op">,</span> <span class="nam">signal1</span><span class="op">,</span> <span class="nam">signal2</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t617" class="run"><span class="n"><a href="#t617">617</a></span><span class="t">                <span class="nam">nsamples</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">signal2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t618" class="run"><span class="n"><a href="#t618">618</a></span><span class="t">                <span class="nam">b</span><span class="op">,</span> <span class="nam">a</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">signal</span><span class="op">.</span><span class="nam">butter</span><span class="op">(</span><span class="num">2</span><span class="op">,</span> <span class="num">0.1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t619" class="run"><span class="n"><a href="#t619">619</a></span><span class="t">                <span class="nam">signal2</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">signal</span><span class="op">.</span><span class="nam">filtfilt</span><span class="op">(</span><span class="nam">b</span><span class="op">,</span> <span class="nam">a</span><span class="op">,</span> <span class="nam">signal2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t620" class="pln"><span class="n"><a href="#t620">620</a></span><span class="t">                <span class="com"># regularize datasets by subtracting mean and dividing by s.d.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t621" class="run"><span class="n"><a href="#t621">621</a></span><span class="t">                <span class="nam">signal2</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">signal2</span><span class="op">)</span><span class="op">;</span>&nbsp;</span><span class="r"></span></p>
    <p id="t622" class="run"><span class="n"><a href="#t622">622</a></span><span class="t">                <span class="nam">signal2</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">signal2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t623" class="run"><span class="n"><a href="#t623">623</a></span><span class="t">                <span class="nam">signal1</span> <span class="op">-=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">signal1</span><span class="op">)</span><span class="op">;</span>&nbsp;</span><span class="r"></span></p>
    <p id="t624" class="run"><span class="n"><a href="#t624">624</a></span><span class="t">                <span class="nam">signal1</span> <span class="op">/=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">std</span><span class="op">(</span><span class="nam">signal1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t625" class="pln"><span class="n"><a href="#t625">625</a></span><span class="t">                <span class="com"># Find cross-correlation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t626" class="run"><span class="n"><a href="#t626">626</a></span><span class="t">                <span class="nam">xcorr</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">signal</span><span class="op">.</span><span class="nam">correlate</span><span class="op">(</span><span class="nam">signal2</span><span class="op">,</span> <span class="nam">signal1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t627" class="pln"><span class="n"><a href="#t627">627</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t628" class="pln"><span class="n"><a href="#t628">628</a></span><span class="t">                <span class="com"># delta time array to match xcorr</span>&nbsp;</span><span class="r"></span></p>
    <p id="t629" class="run"><span class="n"><a href="#t629">629</a></span><span class="t">                <span class="nam">dt</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="num">1</span> <span class="op">-</span> <span class="nam">nsamples</span><span class="op">,</span> <span class="nam">nsamples</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t630" class="run"><span class="n"><a href="#t630">630</a></span><span class="t">                <span class="nam">time_step</span> <span class="op">=</span> <span class="nam">time_signal</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">time_signal</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t631" class="run"><span class="n"><a href="#t631">631</a></span><span class="t">                <span class="nam">delay</span> <span class="op">=</span> <span class="nam">dt</span><span class="op">[</span><span class="nam">xcorr</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="op">)</span><span class="op">]</span> <span class="op">*</span> <span class="nam">time_step</span>&nbsp;</span><span class="r"></span></p>
    <p id="t632" class="run"><span class="n"><a href="#t632">632</a></span><span class="t">                <span class="key">return</span> <span class="nam">delay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t633" class="pln"><span class="n"><a href="#t633">633</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t634" class="pln"><span class="n"><a href="#t634">634</a></span><span class="t">            <span class="com"># Loops over the edges of the network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t635" class="run"><span class="n"><a href="#t635">635</a></span><span class="t">            <span class="key">for</span> <span class="nam">edge</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t636" class="pln"><span class="n"><a href="#t636">636</a></span><span class="t">                <span class="com"># Adds parameters to the dictionary</span>&nbsp;</span><span class="r"></span></p>
    <p id="t637" class="run"><span class="n"><a href="#t637">637</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Width'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t638" class="run"><span class="n"><a href="#t638">638</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t639" class="run"><span class="n"><a href="#t639">639</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t640" class="run"><span class="n"><a href="#t640">640</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Tidal phase lag'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t641" class="pln"><span class="n"><a href="#t641">641</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t642" class="pln"><span class="n"><a href="#t642">642</a></span><span class="t">                <span class="com">#Appends data to the edges</span>&nbsp;</span><span class="r"></span></p>
    <p id="t643" class="run"><span class="n"><a href="#t643">643</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Width'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Width'</span><span class="op">]</span><span class="op">,</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Width'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t644" class="run"><span class="n"><a href="#t644">644</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Tidal phase lag'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">lag_finder</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t645" class="pln"><span class="n"><a href="#t645">645</a></span><span class="t">                                                                               <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t646" class="pln"><span class="n"><a href="#t646">646</a></span><span class="t">                                                                               <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t647" class="pln"><span class="n"><a href="#t647">647</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t648" class="pln"><span class="n"><a href="#t648">648</a></span><span class="t">                <span class="com">#If there is a terminal in the edge, the greatest value for the MBL or depth of the two nodes creating the edge are used</span>&nbsp;</span><span class="r"></span></p>
    <p id="t649" class="run"><span class="n"><a href="#t649">649</a></span><span class="t">                <span class="key">if</span> <span class="str">'Terminal'</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t650" class="mis show_mis"><span class="n"><a href="#t650">650</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span><span class="op">,</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t651" class="mis show_mis"><span class="n"><a href="#t651">651</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span><span class="op">,</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t652" class="pln"><span class="n"><a href="#t652">652</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t653" class="run"><span class="n"><a href="#t653">653</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span><span class="op">,</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t654" class="run"><span class="n"><a href="#t654">654</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span><span class="op">,</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t655" class="pln"><span class="n"><a href="#t655">655</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t656" class="run"><span class="n"><a href="#t656">656</a></span><span class="t">        <span class="key">def</span> <span class="nam">calculate_and_append_current_components_to_nodes</span><span class="op">(</span><span class="nam">network</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t657" class="pln"><span class="n"><a href="#t657">657</a></span><span class="t">            <span class="str">""" Function: calculates the longitudinal and lateral (cross-) current velocity with respect to the sailing path of</span>&nbsp;</span><span class="r"></span></p>
    <p id="t658" class="pln"><span class="n"><a href="#t658">658</a></span><span class="t"><span class="str">                          the vessel (alignment of the edge) for each node (there can be multiple time series for each node as</span>&nbsp;</span><span class="r"></span></p>
    <p id="t659" class="pln"><span class="n"><a href="#t659">659</a></span><span class="t"><span class="str">                          multiple edges can be connected at this node) and appends this information to the nodes of the network.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t660" class="pln"><span class="n"><a href="#t660">660</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t661" class="pln"><span class="n"><a href="#t661">661</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t662" class="pln"><span class="n"><a href="#t662">662</a></span><span class="t"><span class="str">                    - network: a graph constructed with the DiGraph class of the networkx package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t663" class="pln"><span class="n"><a href="#t663">663</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t664" class="pln"><span class="n"><a href="#t664">664</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t665" class="pln"><span class="n"><a href="#t665">665</a></span><span class="t">            <span class="com">#Loops over the nodes of the network and finds the edges attached to this node by a second loop over the nodes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t666" class="run"><span class="n"><a href="#t666">666</a></span><span class="t">            <span class="key">for</span> <span class="nam">node1</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t667" class="run"><span class="n"><a href="#t667">667</a></span><span class="t">                <span class="nam">nodes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t668" class="run"><span class="n"><a href="#t668">668</a></span><span class="t">                <span class="key">for</span> <span class="nam">node2</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t669" class="run"><span class="n"><a href="#t669">669</a></span><span class="t">                    <span class="key">if</span> <span class="op">(</span><span class="nam">node1</span><span class="op">,</span> <span class="nam">node2</span><span class="op">)</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t670" class="run"><span class="n"><a href="#t670">670</a></span><span class="t">                        <span class="nam">nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">node2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t671" class="pln"><span class="n"><a href="#t671">671</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t672" class="pln"><span class="n"><a href="#t672">672</a></span><span class="t">                <span class="com">#If there is only one edge connected to the node (boundary nodes): longitudinal and cross-currents are assumed 0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t673" class="run"><span class="n"><a href="#t673">673</a></span><span class="t">                <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">nodes</span><span class="op">)</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t674" class="run"><span class="n"><a href="#t674">674</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Cross-current'</span><span class="op">]</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t675" class="run"><span class="n"><a href="#t675">675</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Longitudinal current'</span><span class="op">]</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t676" class="run"><span class="n"><a href="#t676">676</a></span><span class="t">                    <span class="nam">time_current_velocity</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t677" class="run"><span class="n"><a href="#t677">677</a></span><span class="t">                    <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">time_current_velocity</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t678" class="run"><span class="n"><a href="#t678">678</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Cross-current'</span><span class="op">]</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time_current_velocity</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t679" class="run"><span class="n"><a href="#t679">679</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Cross-current'</span><span class="op">]</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t680" class="run"><span class="n"><a href="#t680">680</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Longitudinal current'</span><span class="op">]</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time_current_velocity</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t681" class="run"><span class="n"><a href="#t681">681</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Longitudinal current'</span><span class="op">]</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t682" class="run"><span class="n"><a href="#t682">682</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t683" class="pln"><span class="n"><a href="#t683">683</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t684" class="pln"><span class="n"><a href="#t684">684</a></span><span class="t">                <span class="com"># Else if there is multiple edges connected to the node: loop over the connected edges</span>&nbsp;</span><span class="r"></span></p>
    <p id="t685" class="run"><span class="n"><a href="#t685">685</a></span><span class="t">                <span class="key">for</span> <span class="nam">node2</span> <span class="key">in</span> <span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t686" class="run"><span class="n"><a href="#t686">686</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Cross-current'</span><span class="op">]</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t687" class="run"><span class="n"><a href="#t687">687</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Longitudinal current'</span><span class="op">]</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t688" class="run"><span class="n"><a href="#t688">688</a></span><span class="t">                    <span class="nam">time_current</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t689" class="run"><span class="n"><a href="#t689">689</a></span><span class="t">                    <span class="nam">current_velocity</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t690" class="run"><span class="n"><a href="#t690">690</a></span><span class="t">                    <span class="nam">current_direction</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current direction'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t691" class="pln"><span class="n"><a href="#t691">691</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t692" class="pln"><span class="n"><a href="#t692">692</a></span><span class="t">                    <span class="com">#Calculation of the orientation of the edge</span>&nbsp;</span><span class="r"></span></p>
    <p id="t693" class="run"><span class="n"><a href="#t693">693</a></span><span class="t">                    <span class="nam">origin_lat</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span>&nbsp;</span><span class="r"></span></p>
    <p id="t694" class="run"><span class="n"><a href="#t694">694</a></span><span class="t">                    <span class="nam">origin_lon</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span>&nbsp;</span><span class="r"></span></p>
    <p id="t695" class="run"><span class="n"><a href="#t695">695</a></span><span class="t">                    <span class="nam">node_lat</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span>&nbsp;</span><span class="r"></span></p>
    <p id="t696" class="run"><span class="n"><a href="#t696">696</a></span><span class="t">                    <span class="nam">node_lon</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span>&nbsp;</span><span class="r"></span></p>
    <p id="t697" class="run"><span class="n"><a href="#t697">697</a></span><span class="t">                    <span class="nam">course</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">"WGS84"</span><span class="op">)</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">origin_lat</span><span class="op">,</span> <span class="nam">origin_lon</span><span class="op">,</span> <span class="nam">node_lat</span><span class="op">,</span> <span class="nam">node_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t698" class="run"><span class="n"><a href="#t698">698</a></span><span class="t">                    <span class="key">if</span> <span class="nam">course</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t699" class="run"><span class="n"><a href="#t699">699</a></span><span class="t">                        <span class="nam">course</span> <span class="op">=</span> <span class="num">360</span> <span class="op">+</span> <span class="nam">course</span>&nbsp;</span><span class="r"></span></p>
    <p id="t700" class="pln"><span class="n"><a href="#t700">700</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t701" class="pln"><span class="n"><a href="#t701">701</a></span><span class="t">                    <span class="com">#Calculation of the current velocity components</span>&nbsp;</span><span class="r"></span></p>
    <p id="t702" class="run"><span class="n"><a href="#t702">702</a></span><span class="t">                    <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">time_current</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t703" class="run"><span class="n"><a href="#t703">703</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Cross-current'</span><span class="op">]</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time_current</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t704" class="run"><span class="n"><a href="#t704">704</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Cross-current'</span><span class="op">]</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">abs</span><span class="op">(</span><span class="nam">current_velocity</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">*</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sin</span><span class="op">(</span><span class="op">(</span><span class="nam">current_direction</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">-</span> <span class="nam">course</span><span class="op">)</span> <span class="op">/</span> <span class="num">180</span> <span class="op">*</span> <span class="nam">math</span><span class="op">.</span><span class="nam">pi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t705" class="run"><span class="n"><a href="#t705">705</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Longitudinal current'</span><span class="op">]</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time_current</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t706" class="run"><span class="n"><a href="#t706">706</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node1</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Longitudinal current'</span><span class="op">]</span><span class="op">[</span><span class="nam">node2</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">abs</span><span class="op">(</span><span class="nam">current_velocity</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">*</span> <span class="nam">np</span><span class="op">.</span><span class="nam">cos</span><span class="op">(</span><span class="op">(</span><span class="nam">current_direction</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">-</span> <span class="nam">course</span><span class="op">)</span> <span class="op">/</span> <span class="num">180</span> <span class="op">*</span> <span class="nam">math</span><span class="op">.</span><span class="nam">pi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t707" class="pln"><span class="n"><a href="#t707">707</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t708" class="pln"><span class="n"><a href="#t708">708</a></span><span class="t">        <span class="com">#Continuation of the append_data_to_nodes function by looping over all the nodes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t709" class="run"><span class="n"><a href="#t709">709</a></span><span class="t">        <span class="key">for</span> <span class="nam">node</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t710" class="pln"><span class="n"><a href="#t710">710</a></span><span class="t">            <span class="com">#Creating a dictionary attached to the nodes of the network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t711" class="run"><span class="n"><a href="#t711">711</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'Tidal periods'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="str">'Horizontal tidal restriction'</span><span class="op">:</span> <span class="op">{</span><span class="op">}</span><span class="op">,</span><span class="str">'Vertical tidal restriction'</span><span class="op">:</span> <span class="op">{</span><span class="op">}</span><span class="op">,</span> <span class="str">'Width'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">'Depth'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">'MBL'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">'Astronomical tide'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">'H_99%'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="str">'Water level'</span><span class="op">:</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span><span class="op">,</span>  <span class="str">'Current velocity'</span><span class="op">:</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="str">'Current direction'</span><span class="op">:</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="str">'Cross-current'</span><span class="op">:</span> <span class="op">{</span><span class="op">}</span><span class="op">,</span> <span class="str">'Longitudinal current'</span><span class="op">:</span> <span class="op">{</span><span class="op">}</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t712" class="pln"><span class="n"><a href="#t712">712</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t713" class="pln"><span class="n"><a href="#t713">713</a></span><span class="t">            <span class="com">#Appending the specific data to the network if the geometry of the node of the data is the same as the geometry of the node of the network for the static data</span>&nbsp;</span><span class="r"></span></p>
    <p id="t714" class="run"><span class="n"><a href="#t714">714</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="nam">MBL</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">MBL</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t715" class="run"><span class="n"><a href="#t715">715</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">MBL</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t716" class="run"><span class="n"><a href="#t716">716</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="nam">W</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">W</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t717" class="run"><span class="n"><a href="#t717">717</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Width'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">W</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t718" class="run"><span class="n"><a href="#t718">718</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="nam">D</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">D</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t719" class="run"><span class="n"><a href="#t719">719</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Depth'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">D</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t720" class="pln"><span class="n"><a href="#t720">720</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t721" class="pln"><span class="n"><a href="#t721">721</a></span><span class="t">            <span class="com"># Appending the data to the specific lists by looping over the times in the time series for the dynamic data</span>&nbsp;</span><span class="r"></span></p>
    <p id="t722" class="run"><span class="n"><a href="#t722">722</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="nam">eta</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">eta</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t723" class="run"><span class="n"><a href="#t723">723</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">eta</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t724" class="run"><span class="n"><a href="#t724">724</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">eta</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t725" class="run"><span class="n"><a href="#t725">725</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="nam">vmag</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">vmag</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t726" class="run"><span class="n"><a href="#t726">726</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vmag</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t727" class="run"><span class="n"><a href="#t727">727</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vmag</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t728" class="run"><span class="n"><a href="#t728">728</a></span><span class="t">            <span class="key">if</span> <span class="op">(</span><span class="nam">vdir</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">vdir</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t729" class="run"><span class="n"><a href="#t729">729</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current direction'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vdir</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t730" class="run"><span class="n"><a href="#t730">730</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current direction'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vdir</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t731" class="pln"><span class="n"><a href="#t731">731</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t732" class="pln"><span class="n"><a href="#t732">732</a></span><span class="t">            <span class="com"># Calculation of the water level which is exceeded 99% of the tides</span>&nbsp;</span><span class="r"></span></p>
    <p id="t733" class="run"><span class="n"><a href="#t733">733</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">astronomical_tide</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t734" class="run"><span class="n"><a href="#t734">734</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'H_99%'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">H99</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t735" class="run"><span class="n"><a href="#t735">735</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Tidal periods'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">tidal_periods</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t736" class="pln"><span class="n"><a href="#t736">736</a></span><span class="t">                                                                            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Astronomical tide'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t737" class="pln"><span class="n"><a href="#t737">737</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t738" class="pln"><span class="n"><a href="#t738">738</a></span><span class="t">        <span class="com"># Appending longitudinal and cross-current velocity components to the nodes of the network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t739" class="run"><span class="n"><a href="#t739">739</a></span><span class="t">        <span class="nam">calculate_and_append_current_components_to_nodes</span><span class="op">(</span><span class="nam">network</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t740" class="pln"><span class="n"><a href="#t740">740</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t741" class="pln"><span class="n"><a href="#t741">741</a></span><span class="t">        <span class="com"># Appending static data to the edges</span>&nbsp;</span><span class="r"></span></p>
    <p id="t742" class="run"><span class="n"><a href="#t742">742</a></span><span class="t">        <span class="nam">append_info_to_edges</span><span class="op">(</span><span class="nam">network</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t743" class="pln"><span class="n"><a href="#t743">743</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t744" class="run"><span class="n"><a href="#t744">744</a></span><span class="t">    <span class="key">def</span> <span class="nam">append_vertical_tidal_restriction_to_network</span><span class="op">(</span><span class="nam">network</span><span class="op">,</span><span class="nam">node</span><span class="op">,</span><span class="nam">vertical_tidal_window_input</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t745" class="pln"><span class="n"><a href="#t745">745</a></span><span class="t">        <span class="str">""" Function: appends vertical tidal restrictions to the node of the network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t746" class="pln"><span class="n"><a href="#t746">746</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t747" class="pln"><span class="n"><a href="#t747">747</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t748" class="pln"><span class="n"><a href="#t748">748</a></span><span class="t"><span class="str">                - network: a graph constructed with the DiGraph class of the networkx package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t749" class="pln"><span class="n"><a href="#t749">749</a></span><span class="t"><span class="str">                - node: the name string of the node in the given network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t750" class="pln"><span class="n"><a href="#t750">750</a></span><span class="t"><span class="str">                - vertical_tidal_window_input: assembly of specific information that defines the restriction (see specific input classes in the notebook)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t751" class="pln"><span class="n"><a href="#t751">751</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t752" class="pln"><span class="n"><a href="#t752">752</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t753" class="pln"><span class="n"><a href="#t753">753</a></span><span class="t">        <span class="com">#Specifies two parameters in the dictionary with a corresponding data structure of lists</span>&nbsp;</span><span class="r"></span></p>
    <p id="t754" class="run"><span class="n"><a href="#t754">754</a></span><span class="t">        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t755" class="run"><span class="n"><a href="#t755">755</a></span><span class="t">        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t756" class="pln"><span class="n"><a href="#t756">756</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t757" class="pln"><span class="n"><a href="#t757">757</a></span><span class="t">        <span class="com">#Loops over the number of types of restrictions that may hold for different classes of vessels</span>&nbsp;</span><span class="r"></span></p>
    <p id="t758" class="run"><span class="n"><a href="#t758">758</a></span><span class="t">        <span class="key">for</span> <span class="nam">input_data</span> <span class="key">in</span> <span class="nam">vertical_tidal_window_input</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t759" class="pln"><span class="n"><a href="#t759">759</a></span><span class="t">            <span class="com"># Unpacks the data for flood and ebb and appends it to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t760" class="run"><span class="n"><a href="#t760">760</a></span><span class="t">            <span class="nam">ukc_p</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t761" class="run"><span class="n"><a href="#t761">761</a></span><span class="t">            <span class="nam">ukc_s</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t762" class="run"><span class="n"><a href="#t762">762</a></span><span class="t">            <span class="nam">fwa</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t763" class="run"><span class="n"><a href="#t763">763</a></span><span class="t">            <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">input_data</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">ukc_p</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t764" class="run"><span class="n"><a href="#t764">764</a></span><span class="t">                <span class="nam">ukc_p</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">ukc_p</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t765" class="run"><span class="n"><a href="#t765">765</a></span><span class="t">            <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">input_data</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">ukc_s</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t766" class="run"><span class="n"><a href="#t766">766</a></span><span class="t">                <span class="nam">ukc_s</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">ukc_s</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t767" class="run"><span class="n"><a href="#t767">767</a></span><span class="t">            <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">input_data</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">fwa</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t768" class="run"><span class="n"><a href="#t768">768</a></span><span class="t">                <span class="nam">fwa</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">fwa</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t769" class="pln"><span class="n"><a href="#t769">769</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t770" class="pln"><span class="n"><a href="#t770">770</a></span><span class="t">            <span class="com"># Appends the specific data regarding the type of the restriction to data structure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t771" class="run"><span class="n"><a href="#t771">771</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">ukc_s</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t772" class="run"><span class="n"><a href="#t772">772</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">ukc_p</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t773" class="run"><span class="n"><a href="#t773">773</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">fwa</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t774" class="pln"><span class="n"><a href="#t774">774</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t775" class="pln"><span class="n"><a href="#t775">775</a></span><span class="t">            <span class="com"># Unpacks the data for the different vessel criteria and appends it to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t776" class="run"><span class="n"><a href="#t776">776</a></span><span class="t">            <span class="nam">vessel_characteristics_type</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t777" class="run"><span class="n"><a href="#t777">777</a></span><span class="t">            <span class="nam">vessel_characteristics_spec</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t778" class="run"><span class="n"><a href="#t778">778</a></span><span class="t">            <span class="nam">vessel_characteristics_value</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t779" class="run"><span class="n"><a href="#t779">779</a></span><span class="t">            <span class="nam">vessel_characteristics</span> <span class="op">=</span> <span class="nam">input_data</span><span class="op">.</span><span class="nam">vessel_specifications</span><span class="op">.</span><span class="nam">characteristic_dicts</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t780" class="run"><span class="n"><a href="#t780">780</a></span><span class="t">            <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">vessel_characteristics</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t781" class="run"><span class="n"><a href="#t781">781</a></span><span class="t">                <span class="nam">vessel_characteristics_type</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">info</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t782" class="run"><span class="n"><a href="#t782">782</a></span><span class="t">                <span class="nam">vessel_characteristics_spec</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t783" class="run"><span class="n"><a href="#t783">783</a></span><span class="t">                <span class="nam">vessel_characteristics_value</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t784" class="pln"><span class="n"><a href="#t784">784</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t785" class="pln"><span class="n"><a href="#t785">785</a></span><span class="t">            <span class="com"># Unravels the boolean operators between the restrictions and appends it to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t786" class="run"><span class="n"><a href="#t786">786</a></span><span class="t">            <span class="nam">vessel_method_list</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t787" class="run"><span class="n"><a href="#t787">787</a></span><span class="t">            <span class="nam">sign_list</span> <span class="op">=</span> <span class="nam">input_data</span><span class="op">.</span><span class="nam">vessel_specifications</span><span class="op">.</span><span class="nam">vessel_method</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t788" class="run"><span class="n"><a href="#t788">788</a></span><span class="t">            <span class="key">for</span> <span class="nam">sign</span> <span class="key">in</span> <span class="nam">sign_list</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t789" class="run"><span class="n"><a href="#t789">789</a></span><span class="t">                <span class="key">if</span> <span class="nam">sign</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'('</span> <span class="key">and</span> <span class="nam">sign</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">')'</span> <span class="key">and</span> <span class="nam">sign</span> <span class="op">!=</span> <span class="str">'x'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t790" class="mis show_mis"><span class="n"><a href="#t790">790</a></span><span class="t">                    <span class="nam">vessel_method_list</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">sign</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t791" class="pln"><span class="n"><a href="#t791">791</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t792" class="pln"><span class="n"><a href="#t792">792</a></span><span class="t">            <span class="com"># Appends the specific data regarding the properties for which the restriction holds to data structure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t793" class="run"><span class="n"><a href="#t793">793</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_type</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t794" class="run"><span class="n"><a href="#t794">794</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t795" class="run"><span class="n"><a href="#t795">795</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">.</span><span class="nam">vessel_specifications</span><span class="op">.</span><span class="nam">vessel_direction</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t796" class="run"><span class="n"><a href="#t796">796</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_spec</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t797" class="run"><span class="n"><a href="#t797">797</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_spec</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t798" class="run"><span class="n"><a href="#t798">798</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_method_list</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t799" class="run"><span class="n"><a href="#t799">799</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t800" class="pln"><span class="n"><a href="#t800">800</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t801" class="run"><span class="n"><a href="#t801">801</a></span><span class="t">    <span class="key">def</span> <span class="nam">append_horizontal_tidal_restriction_to_network</span><span class="op">(</span><span class="nam">network</span><span class="op">,</span><span class="nam">node</span><span class="op">,</span><span class="nam">horizontal_tidal_window_input</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t802" class="pln"><span class="n"><a href="#t802">802</a></span><span class="t">        <span class="str">""" Function: appends horizontal tidal restrictions to the node of the network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t803" class="pln"><span class="n"><a href="#t803">803</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t804" class="pln"><span class="n"><a href="#t804">804</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t805" class="pln"><span class="n"><a href="#t805">805</a></span><span class="t"><span class="str">                - network: a graph constructed with the DiGraph class of the networkx package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t806" class="pln"><span class="n"><a href="#t806">806</a></span><span class="t"><span class="str">                - node: the name string of the node in the given network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t807" class="pln"><span class="n"><a href="#t807">807</a></span><span class="t"><span class="str">                - horizontal_tidal_window_input: assembly of specific information that defines the restriction (see specific input classes in the notebook)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t808" class="pln"><span class="n"><a href="#t808">808</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t809" class="pln"><span class="n"><a href="#t809">809</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t810" class="pln"><span class="n"><a href="#t810">810</a></span><span class="t">        <span class="com"># Specifies two parameters in the dictionary with a corresponding data structure of lists</span>&nbsp;</span><span class="r"></span></p>
    <p id="t811" class="run"><span class="n"><a href="#t811">811</a></span><span class="t">        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t812" class="run"><span class="n"><a href="#t812">812</a></span><span class="t">        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t813" class="run"><span class="n"><a href="#t813">813</a></span><span class="t">        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t814" class="pln"><span class="n"><a href="#t814">814</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t815" class="pln"><span class="n"><a href="#t815">815</a></span><span class="t">        <span class="com"># Loops over the number of types of restrictions that may hold for different classes of vessels</span>&nbsp;</span><span class="r"></span></p>
    <p id="t816" class="run"><span class="n"><a href="#t816">816</a></span><span class="t">        <span class="key">for</span> <span class="nam">input_data</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">horizontal_tidal_window_input</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t817" class="pln"><span class="n"><a href="#t817">817</a></span><span class="t">            <span class="com"># Unpacks the data for flood and ebb and appends it to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t818" class="run"><span class="n"><a href="#t818">818</a></span><span class="t">            <span class="nam">current_velocity_value</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t819" class="run"><span class="n"><a href="#t819">819</a></span><span class="t">            <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">current_velocity_values</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t820" class="run"><span class="n"><a href="#t820">820</a></span><span class="t">                <span class="nam">current_velocity_value</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">current_velocity_values</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t821" class="pln"><span class="n"><a href="#t821">821</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t822" class="pln"><span class="n"><a href="#t822">822</a></span><span class="t">            <span class="com"># Dependent on the type of restriction, additional information should be unpacked and appended to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t823" class="run"><span class="n"><a href="#t823">823</a></span><span class="t">            <span class="nam">current_velocity_range</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t824" class="pln"><span class="n"><a href="#t824">824</a></span><span class="t">            <span class="com"># - if no necessary:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t825" class="run"><span class="n"><a href="#t825">825</a></span><span class="t">            <span class="key">if</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">current_velocity_ranges</span> <span class="op">==</span> <span class="nam">dict</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t826" class="mis show_mis"><span class="n"><a href="#t826">826</a></span><span class="t">                <span class="nam">current_velocity_range</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t827" class="pln"><span class="n"><a href="#t827">827</a></span><span class="t">            <span class="com"># - elif necessary:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t828" class="pln"><span class="n"><a href="#t828">828</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t829" class="run"><span class="n"><a href="#t829">829</a></span><span class="t">                <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">current_velocity_ranges</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t830" class="run"><span class="n"><a href="#t830">830</a></span><span class="t">                    <span class="nam">current_velocity_range</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">current_velocity_ranges</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t831" class="pln"><span class="n"><a href="#t831">831</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t832" class="pln"><span class="n"><a href="#t832">832</a></span><span class="t">            <span class="com"># Appends the specific data regarding the type of the restriction to data structure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t833" class="run"><span class="n"><a href="#t833">833</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">window_specifications</span><span class="op">.</span><span class="nam">window_method</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t834" class="run"><span class="n"><a href="#t834">834</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">current_velocity_value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t835" class="run"><span class="n"><a href="#t835">835</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">current_velocity_range</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t836" class="pln"><span class="n"><a href="#t836">836</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t837" class="pln"><span class="n"><a href="#t837">837</a></span><span class="t">            <span class="com"># Unpacks the data for the different vessel criteria and appends it to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t838" class="run"><span class="n"><a href="#t838">838</a></span><span class="t">            <span class="nam">vessel_characteristics_type</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t839" class="run"><span class="n"><a href="#t839">839</a></span><span class="t">            <span class="nam">vessel_characteristics_spec</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t840" class="run"><span class="n"><a href="#t840">840</a></span><span class="t">            <span class="nam">vessel_characteristics_value</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t841" class="run"><span class="n"><a href="#t841">841</a></span><span class="t">            <span class="nam">vessel_characteristics</span> <span class="op">=</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">vessel_specifications</span><span class="op">.</span><span class="nam">characteristic_dicts</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t842" class="run"><span class="n"><a href="#t842">842</a></span><span class="t">            <span class="key">for</span> <span class="nam">info</span> <span class="key">in</span> <span class="nam">vessel_characteristics</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t843" class="run"><span class="n"><a href="#t843">843</a></span><span class="t">                <span class="nam">vessel_characteristics_type</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">info</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t844" class="run"><span class="n"><a href="#t844">844</a></span><span class="t">                <span class="nam">vessel_characteristics_spec</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t845" class="run"><span class="n"><a href="#t845">845</a></span><span class="t">                <span class="nam">vessel_characteristics_value</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics</span><span class="op">[</span><span class="nam">info</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t846" class="pln"><span class="n"><a href="#t846">846</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t847" class="pln"><span class="n"><a href="#t847">847</a></span><span class="t">            <span class="com"># Unravels the boolean operators between the restrictions and appends it to a list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t848" class="run"><span class="n"><a href="#t848">848</a></span><span class="t">            <span class="nam">vessel_method_list</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t849" class="run"><span class="n"><a href="#t849">849</a></span><span class="t">            <span class="nam">sign_list</span> <span class="op">=</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">vessel_specifications</span><span class="op">.</span><span class="nam">vessel_method</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t850" class="run"><span class="n"><a href="#t850">850</a></span><span class="t">            <span class="key">for</span> <span class="nam">sign</span> <span class="key">in</span> <span class="nam">sign_list</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t851" class="run"><span class="n"><a href="#t851">851</a></span><span class="t">                <span class="key">if</span> <span class="nam">sign</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'('</span> <span class="key">and</span> <span class="nam">sign</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">')'</span> <span class="key">and</span> <span class="nam">sign</span> <span class="op">!=</span> <span class="str">'x'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t852" class="mis show_mis"><span class="n"><a href="#t852">852</a></span><span class="t">                    <span class="nam">vessel_method_list</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">sign</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t853" class="pln"><span class="n"><a href="#t853">853</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t854" class="pln"><span class="n"><a href="#t854">854</a></span><span class="t">            <span class="com"># Appends the specific data regarding the properties for which the restriction holds to data structure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t855" class="run"><span class="n"><a href="#t855">855</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_type</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t856" class="run"><span class="n"><a href="#t856">856</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_value</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t857" class="run"><span class="n"><a href="#t857">857</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">vessel_specifications</span><span class="op">.</span><span class="nam">vessel_direction</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t858" class="run"><span class="n"><a href="#t858">858</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_characteristics_spec</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t859" class="run"><span class="n"><a href="#t859">859</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel_method_list</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t860" class="run"><span class="n"><a href="#t860">860</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">condition</span><span class="op">[</span><span class="str">'Origin'</span><span class="op">]</span><span class="op">,</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">condition</span><span class="op">[</span><span class="str">'Destination'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t861" class="pln"><span class="n"><a href="#t861">861</a></span><span class="t">            <span class="com"># Unpacks the specific current velocity data used for the restriction and appends it to the data structure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t862" class="pln"><span class="n"><a href="#t862">862</a></span><span class="t">            <span class="com"># - if pre-calculated data from the model should be used:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t863" class="run"><span class="n"><a href="#t863">863</a></span><span class="t">            <span class="key">if</span> <span class="nam">type</span><span class="op">(</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t864" class="pln"><span class="n"><a href="#t864">864</a></span><span class="t">                <span class="com"># - if raw current velocity data should be used:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t865" class="run"><span class="n"><a href="#t865">865</a></span><span class="t">                <span class="key">if</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Current velocity'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t866" class="run"><span class="n"><a href="#t866">866</a></span><span class="t">                    <span class="key">for</span> <span class="nam">n</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">input_data</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t867" class="run"><span class="n"><a href="#t867">867</a></span><span class="t">                        <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t868" class="pln"><span class="n"><a href="#t868">868</a></span><span class="t">                <span class="com"># - elif longitudinal or cross-current velocity should be used:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t869" class="pln"><span class="n"><a href="#t869">869</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t870" class="mis show_mis"><span class="n"><a href="#t870">870</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t871" class="pln"><span class="n"><a href="#t871">871</a></span><span class="t">            <span class="com"># - elif manual data should be used:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t872" class="pln"><span class="n"><a href="#t872">872</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t873" class="mis show_mis"><span class="n"><a href="#t873">873</a></span><span class="t">                <span class="key">for</span> <span class="nam">n</span> <span class="key">in</span> <span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t874" class="mis show_mis"><span class="n"><a href="#t874">874</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t875" class="mis show_mis"><span class="n"><a href="#t875">875</a></span><span class="t">                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">=</span> <span class="nam">input_data</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">data</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t876" class="pln"><span class="n"><a href="#t876">876</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t877" class="run"><span class="n"><a href="#t877">877</a></span><span class="t"><span class="key">class</span> <span class="nam">VesselTrafficService</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t878" class="pln"><span class="n"><a href="#t878">878</a></span><span class="t">    <span class="str">"""Class: a collection of functions that processes requests of vessels regarding the nautical processes on ow to enter the port safely"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t879" class="pln"><span class="n"><a href="#t879">879</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t880" class="run"><span class="n"><a href="#t880">880</a></span><span class="t">    <span class="op">@</span><span class="nam">staticmethod</span>&nbsp;</span><span class="r"></span></p>
    <p id="t881" class="run"><span class="n"><a href="#t881">881</a></span><span class="t">    <span class="key">def</span> <span class="nam">provide_sailing_direction</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">edge</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t882" class="run"><span class="n"><a href="#t882">882</a></span><span class="t">        <span class="nam">initial_bound</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span>&nbsp;</span><span class="r"></span></p>
    <p id="t883" class="run"><span class="n"><a href="#t883">883</a></span><span class="t">        <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t884" class="run"><span class="n"><a href="#t884">884</a></span><span class="t">        <span class="nam">phase_lag</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Tidal phase lag'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t885" class="run"><span class="n"><a href="#t885">885</a></span><span class="t">        <span class="key">if</span> <span class="nam">phase_lag</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span> <span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t886" class="run"><span class="n"><a href="#t886">886</a></span><span class="t">        <span class="key">elif</span> <span class="nam">phase_lag</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span> <span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t887" class="run"><span class="n"><a href="#t887">887</a></span><span class="t">        <span class="key">else</span><span class="op">:</span> <span class="nam">bound</span> <span class="op">=</span> <span class="nam">initial_bound</span>&nbsp;</span><span class="r"></span></p>
    <p id="t888" class="run"><span class="n"><a href="#t888">888</a></span><span class="t">        <span class="key">return</span> <span class="nam">bound</span>&nbsp;</span><span class="r"></span></p>
    <p id="t889" class="pln"><span class="n"><a href="#t889">889</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t890" class="run"><span class="n"><a href="#t890">890</a></span><span class="t">    <span class="key">def</span> <span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">node</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">components_calc</span> <span class="op">=</span> <span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t891" class="pln"><span class="n"><a href="#t891">891</a></span><span class="t">        <span class="str">""" Function: calculates the sail-in-times for a specific vssel with certain properties and a pre-determined route and provides this information to the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t892" class="pln"><span class="n"><a href="#t892">892</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t893" class="pln"><span class="n"><a href="#t893">893</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t894" class="pln"><span class="n"><a href="#t894">894</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t895" class="pln"><span class="n"><a href="#t895">895</a></span><span class="t"><span class="str">                - node:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t896" class="pln"><span class="n"><a href="#t896">896</a></span><span class="t"><span class="str">                - components_calc:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t897" class="pln"><span class="n"><a href="#t897">897</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t898" class="pln"><span class="n"><a href="#t898">898</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t899" class="pln"><span class="n"><a href="#t899">899</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t900" class="mis show_mis"><span class="n"><a href="#t900">900</a></span><span class="t">        <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_sail_in_times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">,</span> <span class="nam">ukc_calc</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t901" class="mis show_mis"><span class="n"><a href="#t901">901</a></span><span class="t">        <span class="nam">net_ukc</span> <span class="op">=</span> <span class="nam">interp_wdep</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">+</span><span class="nam">delay</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'ukc'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t902" class="pln"><span class="n"><a href="#t902">902</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t903" class="mis show_mis"><span class="n"><a href="#t903">903</a></span><span class="t">        <span class="key">if</span> <span class="nam">components_calc</span> <span class="op">==</span> <span class="key">False</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t904" class="mis show_mis"><span class="n"><a href="#t904">904</a></span><span class="t">            <span class="key">return</span> <span class="nam">net_ukc</span>&nbsp;</span><span class="r"></span></p>
    <p id="t905" class="pln"><span class="n"><a href="#t905">905</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t906" class="mis show_mis"><span class="n"><a href="#t906">906</a></span><span class="t">            <span class="key">if</span> <span class="nam">net_ukc</span> <span class="op">&lt;</span> <span class="nam">ukc_s</span><span class="op">+</span><span class="nam">ukc_p</span><span class="op">+</span><span class="nam">fwa</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t907" class="mis show_mis"><span class="n"><a href="#t907">907</a></span><span class="t">                <span class="key">return</span> <span class="nam">ukc_s</span><span class="op">+</span><span class="nam">ukc_p</span><span class="op">+</span><span class="nam">fwa</span>&nbsp;</span><span class="r"></span></p>
    <p id="t908" class="pln"><span class="n"><a href="#t908">908</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t909" class="mis show_mis"><span class="n"><a href="#t909">909</a></span><span class="t">                <span class="key">return</span> <span class="nam">net_ukc</span>&nbsp;</span><span class="r"></span></p>
    <p id="t910" class="pln"><span class="n"><a href="#t910">910</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t911" class="run"><span class="n"><a href="#t911">911</a></span><span class="t">    <span class="key">def</span> <span class="nam">provide_sail_in_times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">=</span><span class="key">True</span><span class="op">,</span><span class="nam">visualization_calculation</span><span class="op">=</span><span class="key">False</span><span class="op">,</span><span class="nam">ukc_calc</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t912" class="pln"><span class="n"><a href="#t912">912</a></span><span class="t">        <span class="str">""" Function: calculates the sail-in-times for a specific vessel with certain properties and a pre-determined route and provides this information to the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t913" class="pln"><span class="n"><a href="#t913">913</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t914" class="pln"><span class="n"><a href="#t914">914</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t915" class="pln"><span class="n"><a href="#t915">915</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t916" class="pln"><span class="n"><a href="#t916">916</a></span><span class="t"><span class="str">                - route: a list of strings of node names that resemble the route that the vessel is planning to sail (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t917" class="pln"><span class="n"><a href="#t917">917</a></span><span class="t"><span class="str">                - plot: provide a visualization of the calculation for each vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t918" class="pln"><span class="n"><a href="#t918">918</a></span><span class="t"><span class="str">                - sailing_time_correction: a bool that indicates whether the calculation should correct for sailing_speed (dynamic calculation) or not (static calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t919" class="pln"><span class="n"><a href="#t919">919</a></span><span class="t"><span class="str">                - visualization_calculation: a bool that indicates whether the calculation should be made for a single node or not (for a route with multiple nodes)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t920" class="pln"><span class="n"><a href="#t920">920</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t921" class="pln"><span class="n"><a href="#t921">921</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t922" class="pln"><span class="n"><a href="#t922">922</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t923" class="pln"><span class="n"><a href="#t923">923</a></span><span class="t">        <span class="com"># Functions used to calculate the sail-in-times for a specific vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t924" class="run"><span class="n"><a href="#t924">924</a></span><span class="t">        <span class="key">def</span> <span class="nam">tidal_window_restriction_determinator</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">types</span><span class="op">,</span> <span class="nam">specifications</span><span class="op">,</span> <span class="nam">node</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t925" class="pln"><span class="n"><a href="#t925">925</a></span><span class="t">            <span class="str">""" Function: determines which tidal window restriction applies to the vessel at the specific node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t926" class="pln"><span class="n"><a href="#t926">926</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t927" class="pln"><span class="n"><a href="#t927">927</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t928" class="pln"><span class="n"><a href="#t928">928</a></span><span class="t"><span class="str">                    - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t929" class="pln"><span class="n"><a href="#t929">929</a></span><span class="t"><span class="str">                    - route:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t930" class="pln"><span class="n"><a href="#t930">930</a></span><span class="t"><span class="str">                    - types: the type of the restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t931" class="pln"><span class="n"><a href="#t931">931</a></span><span class="t"><span class="str">                    - specifications: the specific data regarding the properties for which the restriction holds</span>&nbsp;</span><span class="r"></span></p>
    <p id="t932" class="pln"><span class="n"><a href="#t932">932</a></span><span class="t"><span class="str">                    - node: a string that defines the node of the tidal window restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t933" class="pln"><span class="n"><a href="#t933">933</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t934" class="pln"><span class="n"><a href="#t934">934</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t935" class="pln"><span class="n"><a href="#t935">935</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t936" class="pln"><span class="n"><a href="#t936">936</a></span><span class="t">            <span class="com"># Predefined bool</span>&nbsp;</span><span class="r"></span></p>
    <p id="t937" class="run"><span class="n"><a href="#t937">937</a></span><span class="t">            <span class="nam">boolean</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t938" class="run"><span class="n"><a href="#t938">938</a></span><span class="t">            <span class="nam">no_tidal_window</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t939" class="pln"><span class="n"><a href="#t939">939</a></span><span class="t">            <span class="com"># Determining if and which restriction applies for the vessel by looping over the restriction class</span>&nbsp;</span><span class="r"></span></p>
    <p id="t940" class="run"><span class="n"><a href="#t940">940</a></span><span class="t">            <span class="key">for</span> <span class="nam">restriction_class</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">specifications</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t941" class="pln"><span class="n"><a href="#t941">941</a></span><span class="t">                <span class="com"># - if restriction does not apply to vessel because it is for vessels sailing in the opposite direction: continue loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t942" class="run"><span class="n"><a href="#t942">942</a></span><span class="t">                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">!=</span> <span class="nam">specifications</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t943" class="mis show_mis"><span class="n"><a href="#t943">943</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t944" class="run"><span class="n"><a href="#t944">944</a></span><span class="t">                <span class="key">if</span> <span class="nam">specifications</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="op">(</span><span class="nam">specifications</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">route</span> <span class="key">or</span> <span class="nam">specifications</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">route</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t945" class="mis show_mis"><span class="n"><a href="#t945">945</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t946" class="pln"><span class="n"><a href="#t946">946</a></span><span class="t">                <span class="com"># - else: looping over the restriction criteria</span>&nbsp;</span><span class="r"></span></p>
    <p id="t947" class="run"><span class="n"><a href="#t947">947</a></span><span class="t">                <span class="key">for</span> <span class="nam">restriction_type</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t948" class="pln"><span class="n"><a href="#t948">948</a></span><span class="t">                    <span class="com"># - if previous condition is not met and there are no more restriction criteria and the previous condition has an 'AND' boolean statement: continue loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t949" class="run"><span class="n"><a href="#t949">949</a></span><span class="t">                    <span class="key">if</span> <span class="key">not</span> <span class="nam">boolean</span> <span class="key">and</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">specifications</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'and'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t950" class="mis show_mis"><span class="n"><a href="#t950">950</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t951" class="pln"><span class="n"><a href="#t951">951</a></span><span class="t">                    <span class="com"># - if previous condition is not met and there are more restriction criteria and the next condition has an 'AND' boolean statement: continue loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t952" class="run"><span class="n"><a href="#t952">952</a></span><span class="t">                    <span class="key">if</span> <span class="key">not</span> <span class="nam">boolean</span> <span class="key">and</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">specifications</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'and'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t953" class="mis show_mis"><span class="n"><a href="#t953">953</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t954" class="pln"><span class="n"><a href="#t954">954</a></span><span class="t">                    <span class="com"># - if previous condition is not met and the next condition has an 'OR' boolean statement: continue loop with predefined boolean</span>&nbsp;</span><span class="r"></span></p>
    <p id="t955" class="run"><span class="n"><a href="#t955">955</a></span><span class="t">                    <span class="key">if</span> <span class="key">not</span> <span class="nam">boolean</span> <span class="key">and</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">specifications</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'or'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t956" class="mis show_mis"><span class="n"><a href="#t956">956</a></span><span class="t">                        <span class="nam">boolean</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t957" class="mis show_mis"><span class="n"><a href="#t957">957</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t958" class="pln"><span class="n"><a href="#t958">958</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t959" class="pln"><span class="n"><a href="#t959">959</a></span><span class="t">                    <span class="com"># Extracting the correct vessel property for the restriction type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t960" class="run"><span class="n"><a href="#t960">960</a></span><span class="t">                    <span class="key">if</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">'Length'</span><span class="op">)</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span> <span class="nam">value</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="str">'L'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t961" class="run"><span class="n"><a href="#t961">961</a></span><span class="t">                    <span class="key">if</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">'Draught'</span><span class="op">)</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span> <span class="nam">value</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="str">'T_f'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t962" class="run"><span class="n"><a href="#t962">962</a></span><span class="t">                    <span class="key">if</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">'Beam'</span><span class="op">)</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span> <span class="nam">value</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="str">'B'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t963" class="run"><span class="n"><a href="#t963">963</a></span><span class="t">                    <span class="key">if</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">'UKC'</span><span class="op">)</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span> <span class="nam">value</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">node</span><span class="op">,</span><span class="nam">sailing_time_to_next_node</span><span class="op">,</span><span class="nam">components_calc</span> <span class="op">=</span> <span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t964" class="run"><span class="n"><a href="#t964">964</a></span><span class="t">                    <span class="key">if</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">'Type'</span><span class="op">)</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span> <span class="nam">value</span> <span class="op">=</span> <span class="nam">getattr</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="str">'type'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t965" class="pln"><span class="n"><a href="#t965">965</a></span><span class="t">                    <span class="com"># Determine if the value for the property satisfies the condition of the restriction type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t966" class="run"><span class="n"><a href="#t966">966</a></span><span class="t">                    <span class="nam">df</span> <span class="op">=</span> <span class="nam">pd</span><span class="op">.</span><span class="nam">DataFrame</span><span class="op">(</span><span class="op">{</span><span class="str">'Value'</span><span class="op">:</span> <span class="op">[</span><span class="nam">value</span><span class="op">]</span><span class="op">,</span><span class="str">'Restriction'</span><span class="op">:</span> <span class="op">[</span><span class="nam">specifications</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">}</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t967" class="run"><span class="n"><a href="#t967">967</a></span><span class="t">                    <span class="nam">boolean</span> <span class="op">=</span> <span class="nam">df</span><span class="op">.</span><span class="nam">eval</span><span class="op">(</span><span class="str">'Value'</span> <span class="op">+</span> <span class="nam">specifications</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="str">'Restriction'</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t968" class="pln"><span class="n"><a href="#t968">968</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t969" class="pln"><span class="n"><a href="#t969">969</a></span><span class="t">                    <span class="com"># - if condition is not met: continue loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t970" class="run"><span class="n"><a href="#t970">970</a></span><span class="t">                    <span class="key">if</span> <span class="key">not</span> <span class="nam">boolean</span> <span class="key">and</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t971" class="mis show_mis"><span class="n"><a href="#t971">971</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t972" class="pln"><span class="n"><a href="#t972">972</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t973" class="pln"><span class="n"><a href="#t973">973</a></span><span class="t">                    <span class="com"># - if one of the conditions is met and the restriction contains an 'OR' boolean statement:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t974" class="run"><span class="n"><a href="#t974">974</a></span><span class="t">                    <span class="key">if</span> <span class="nam">boolean</span> <span class="key">and</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">and</span> <span class="nam">specifications</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'or'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t975" class="mis show_mis"><span class="n"><a href="#t975">975</a></span><span class="t">                        <span class="nam">no_tidal_window</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t976" class="mis show_mis"><span class="n"><a href="#t976">976</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t977" class="pln"><span class="n"><a href="#t977">977</a></span><span class="t">                    <span class="com"># - elif all the conditions are met and the restriction contains solely 'AND' boolean statements:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t978" class="run"><span class="n"><a href="#t978">978</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">boolean</span> <span class="key">and</span> <span class="nam">restriction_type</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">restriction_class</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t979" class="run"><span class="n"><a href="#t979">979</a></span><span class="t">                        <span class="nam">no_tidal_window</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t980" class="run"><span class="n"><a href="#t980">980</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t981" class="pln"><span class="n"><a href="#t981">981</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t982" class="pln"><span class="n"><a href="#t982">982</a></span><span class="t">                <span class="com"># - if condition is met: break the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t983" class="run"><span class="n"><a href="#t983">983</a></span><span class="t">                <span class="key">if</span> <span class="nam">boolean</span> <span class="op">==</span> <span class="key">True</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t984" class="run"><span class="n"><a href="#t984">984</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t985" class="pln"><span class="n"><a href="#t985">985</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t986" class="pln"><span class="n"><a href="#t986">986</a></span><span class="t">                <span class="com"># - else: restart the loop with predefined bool</span>&nbsp;</span><span class="r"></span></p>
    <p id="t987" class="pln"><span class="n"><a href="#t987">987</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t988" class="mis show_mis"><span class="n"><a href="#t988">988</a></span><span class="t">                    <span class="nam">boolean</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t989" class="pln"><span class="n"><a href="#t989">989</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t990" class="run"><span class="n"><a href="#t990">990</a></span><span class="t">            <span class="key">return</span> <span class="nam">restriction_class</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">no_tidal_window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t991" class="pln"><span class="n"><a href="#t991">991</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t992" class="run"><span class="n"><a href="#t992">992</a></span><span class="t">        <span class="key">def</span> <span class="nam">times_vertical_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">axis</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">=</span><span class="key">True</span><span class="op">,</span><span class="nam">ukc_calc</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t993" class="pln"><span class="n"><a href="#t993">993</a></span><span class="t">            <span class="str">""" Function: calculates the windows available to sail-in and -out of the port given the vertical tidal restrictions according to the tidal window policy.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t994" class="pln"><span class="n"><a href="#t994">994</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t995" class="pln"><span class="n"><a href="#t995">995</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t996" class="pln"><span class="n"><a href="#t996">996</a></span><span class="t"><span class="str">                    - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t997" class="pln"><span class="n"><a href="#t997">997</a></span><span class="t"><span class="str">                    - route: a list of strings of node names that resemble the route that the vessel is planning to sail (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t998" class="pln"><span class="n"><a href="#t998">998</a></span><span class="t"><span class="str">                    - plot: provide a visualization of the calculation for each vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t999" class="pln"><span class="n"><a href="#t999">999</a></span><span class="t"><span class="str">                    - axis: axes class from the matplotlib package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1000" class="pln"><span class="n"><a href="#t1000">1000</a></span><span class="t"><span class="str">                    - sailing_time_correction: a bool that indicates whether the calculation should correct for sailing_speed (dynamic calculation) or not (static calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1001" class="pln"><span class="n"><a href="#t1001">1001</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1002" class="pln"><span class="n"><a href="#t1002">1002</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1003" class="pln"><span class="n"><a href="#t1003">1003</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1004" class="pln"><span class="n"><a href="#t1004">1004</a></span><span class="t">            <span class="com"># Function used in the determination of the calculation of the sail-in-times given the policy for determining the vertical tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1005" class="run"><span class="n"><a href="#t1005">1005</a></span><span class="t">            <span class="key">def</span> <span class="nam">minimum_available_water_depth_along_route</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="nam">sailing_time_correction</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">ukc_calc</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1006" class="pln"><span class="n"><a href="#t1006">1006</a></span><span class="t">                <span class="str">""" Function: calculates the minimum available water depth (predicted/modelled/measured water level minus the local maintained bed level) along the route over time,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1007" class="pln"><span class="n"><a href="#t1007">1007</a></span><span class="t"><span class="str">                              subtracted with the difference between the gross ukc and net ukc (hence: subtracted with additional safety margins consisting of vessel-related factors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1008" class="pln"><span class="n"><a href="#t1008">1008</a></span><span class="t"><span class="str">                              and water level factors). The bottom-related factors are already accounted for in the use of the MBL instead of the actual depth.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1009" class="pln"><span class="n"><a href="#t1009">1009</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1010" class="pln"><span class="n"><a href="#t1010">1010</a></span><span class="t"><span class="str">                    Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1011" class="pln"><span class="n"><a href="#t1011">1011</a></span><span class="t"><span class="str">                        - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1012" class="pln"><span class="n"><a href="#t1012">1012</a></span><span class="t"><span class="str">                        - route: a list of strings of node names that resemble the route that the vessel is planning to sail (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1013" class="pln"><span class="n"><a href="#t1013">1013</a></span><span class="t"><span class="str">                        - plot: provide a visualization of the calculation for each vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1014" class="pln"><span class="n"><a href="#t1014">1014</a></span><span class="t"><span class="str">                        - axis: axes class from the matplotlib package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1015" class="pln"><span class="n"><a href="#t1015">1015</a></span><span class="t"><span class="str">                        - sailing_time_correction: a bool that indicates whether the calculation should correct for sailing_speed (dynamic calculation) or not (static calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1016" class="pln"><span class="n"><a href="#t1016">1016</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1017" class="pln"><span class="n"><a href="#t1017">1017</a></span><span class="t"><span class="str">                """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1018" class="pln"><span class="n"><a href="#t1018">1018</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1019" class="pln"><span class="n"><a href="#t1019">1019</a></span><span class="t">                <span class="com"># Continuation of the calculation of the minimum available water depth along the route of the vessel by predefining some parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1020" class="run"><span class="n"><a href="#t1020">1020</a></span><span class="t">                <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1021" class="run"><span class="n"><a href="#t1021">1021</a></span><span class="t">                <span class="nam">distance_to_next_node</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1022" class="run"><span class="n"><a href="#t1022">1022</a></span><span class="t">                <span class="nam">ukc</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1023" class="run"><span class="n"><a href="#t1023">1023</a></span><span class="t">                <span class="nam">wdep_nodes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1024" class="run"><span class="n"><a href="#t1024">1024</a></span><span class="t">                <span class="nam">t_min_wdep</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1025" class="run"><span class="n"><a href="#t1025">1025</a></span><span class="t">                <span class="nam">min_wdep</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1026" class="pln"><span class="n"><a href="#t1026">1026</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1027" class="pln"><span class="n"><a href="#t1027">1027</a></span><span class="t">                <span class="com"># Start of calculation by looping over the nodes of the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1028" class="run"><span class="n"><a href="#t1028">1028</a></span><span class="t">                <span class="key">for</span> <span class="nam">nodes</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">route</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1029" class="pln"><span class="n"><a href="#t1029">1029</a></span><span class="t">                    <span class="com"># - if a correction for the sailing time should be applied: the total distance should be keep track of</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1030" class="run"><span class="n"><a href="#t1030">1030</a></span><span class="t">                    <span class="key">if</span> <span class="nam">sailing_time_correction</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">ukc_calc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1031" class="run"><span class="n"><a href="#t1031">1031</a></span><span class="t">                        <span class="key">if</span> <span class="key">not</span> <span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1032" class="run"><span class="n"><a href="#t1032">1032</a></span><span class="t">                            <span class="nam">distance_to_next_node</span> <span class="op">+=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">'WGS84'</span><span class="op">)</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1033" class="pln"><span class="n"><a href="#t1033">1033</a></span><span class="t">                                                                                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1034" class="pln"><span class="n"><a href="#t1034">1034</a></span><span class="t">                                                                                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1035" class="pln"><span class="n"><a href="#t1035">1035</a></span><span class="t">                                                                                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1036" class="pln"><span class="n"><a href="#t1036">1036</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1037" class="pln"><span class="n"><a href="#t1037">1037</a></span><span class="t">                    <span class="com"># Sailing time is calculated by the distance of the route up to the specific node, divided by the sailing speed (if no correction for the sailing time should be applied: distance is always 0)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1038" class="run"><span class="n"><a href="#t1038">1038</a></span><span class="t">                    <span class="nam">sailing_time_to_next_node</span> <span class="op">=</span> <span class="nam">distance_to_next_node</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1039" class="pln"><span class="n"><a href="#t1039">1039</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1040" class="pln"><span class="n"><a href="#t1040">1040</a></span><span class="t">                    <span class="com"># Importing some node specific data on the time series of the water levels, depth, and ukc policy (corrected for the sailing time if correction was applied)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1041" class="run"><span class="n"><a href="#t1041">1041</a></span><span class="t">                    <span class="nam">t_wlev</span> <span class="op">=</span> <span class="op">[</span><span class="nam">t</span> <span class="op">-</span> <span class="nam">sailing_time_to_next_node</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1042" class="run"><span class="n"><a href="#t1042">1042</a></span><span class="t">                    <span class="nam">wlev</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Water level'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1043" class="run"><span class="n"><a href="#t1043">1043</a></span><span class="t">                    <span class="nam">depth</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'MBL'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1044" class="run"><span class="n"><a href="#t1044">1044</a></span><span class="t">                    <span class="nam">types</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1045" class="run"><span class="n"><a href="#t1045">1045</a></span><span class="t">                    <span class="nam">specifications</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Vertical tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1046" class="pln"><span class="n"><a href="#t1046">1046</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1047" class="pln"><span class="n"><a href="#t1047">1047</a></span><span class="t">                    <span class="com"># Determine which restriction applies to vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1048" class="run"><span class="n"><a href="#t1048">1048</a></span><span class="t">                    <span class="nam">restriction_index</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">tidal_window_restriction_determinator</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">types</span><span class="op">,</span> <span class="nam">specifications</span><span class="op">,</span> <span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1049" class="pln"><span class="n"><a href="#t1049">1049</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1050" class="pln"><span class="n"><a href="#t1050">1050</a></span><span class="t">                    <span class="com"># Calculate ukc policy based on the applied restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1051" class="run"><span class="n"><a href="#t1051">1051</a></span><span class="t">                    <span class="nam">ukc_s</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1052" class="run"><span class="n"><a href="#t1052">1052</a></span><span class="t">                    <span class="nam">ukc_p</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">*</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1053" class="run"><span class="n"><a href="#t1053">1053</a></span><span class="t">                    <span class="nam">fwa</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">*</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1054" class="pln"><span class="n"><a href="#t1054">1054</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1055" class="pln"><span class="n"><a href="#t1055">1055</a></span><span class="t">                    <span class="com"># Interpolation of the available water depth over time and append data to list of the available water depths for the whole route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1056" class="run"><span class="n"><a href="#t1056">1056</a></span><span class="t">                    <span class="nam">interp_wdep</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_wlev</span><span class="op">,</span> <span class="op">[</span><span class="nam">y</span> <span class="op">+</span> <span class="nam">depth</span> <span class="op">-</span> <span class="nam">ukc_s</span> <span class="op">-</span> <span class="nam">ukc_p</span> <span class="op">-</span> <span class="nam">fwa</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">wlev</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1057" class="run"><span class="n"><a href="#t1057">1057</a></span><span class="t">                    <span class="key">if</span> <span class="nam">ukc_calc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1058" class="mis show_mis"><span class="n"><a href="#t1058">1058</a></span><span class="t">                        <span class="key">return</span> <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1059" class="run"><span class="n"><a href="#t1059">1059</a></span><span class="t">                    <span class="nam">wdep</span> <span class="op">=</span> <span class="nam">interp_wdep</span><span class="op">(</span><span class="nam">t_min_wdep</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1060" class="run"><span class="n"><a href="#t1060">1060</a></span><span class="t">                    <span class="nam">wdep_nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">wdep</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1061" class="pln"><span class="n"><a href="#t1061">1061</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1062" class="pln"><span class="n"><a href="#t1062">1062</a></span><span class="t">                    <span class="com"># Add to axes of the plot (if plot is requested): the available water depths at all the nodes of the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1063" class="run"><span class="n"><a href="#t1063">1063</a></span><span class="t">                    <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1064" class="mis show_mis"><span class="n"><a href="#t1064">1064</a></span><span class="t">                        <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">t_min_wdep</span><span class="op">,</span> <span class="nam">wdep</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'lightskyblue'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.4</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1065" class="pln"><span class="n"><a href="#t1065">1065</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1066" class="pln"><span class="n"><a href="#t1066">1066</a></span><span class="t">                <span class="com"># Pick the minimum of the water depths for each time and each node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1067" class="run"><span class="n"><a href="#t1067">1067</a></span><span class="t">                <span class="nam">min_wdep</span> <span class="op">=</span> <span class="op">[</span><span class="nam">min</span><span class="op">(</span><span class="nam">idx</span><span class="op">)</span> <span class="key">for</span> <span class="nam">idx</span> <span class="key">in</span> <span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">wdep_nodes</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1068" class="pln"><span class="n"><a href="#t1068">1068</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1069" class="run"><span class="n"><a href="#t1069">1069</a></span><span class="t">                <span class="key">return</span> <span class="nam">t_min_wdep</span><span class="op">,</span> <span class="nam">min_wdep</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1070" class="pln"><span class="n"><a href="#t1070">1070</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1071" class="pln"><span class="n"><a href="#t1071">1071</a></span><span class="t">            <span class="com">#Continuation of the calculation of the windows given the vertical tidal restrictions by setting some parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1072" class="run"><span class="n"><a href="#t1072">1072</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">ukc_calc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1073" class="run"><span class="n"><a href="#t1073">1073</a></span><span class="t">                <span class="nam">times_vertical_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1074" class="run"><span class="n"><a href="#t1074">1074</a></span><span class="t">                <span class="nam">water_depth_required</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'ukc'</span><span class="op">]</span> <span class="com">#vessel draught + additional vessel-related factors (if applicable)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1075" class="pln"><span class="n"><a href="#t1075">1075</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1076" class="pln"><span class="n"><a href="#t1076">1076</a></span><span class="t">            <span class="com">#Calculation of the minimum available water depth along the route of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1077" class="run"><span class="n"><a href="#t1077">1077</a></span><span class="t">            <span class="key">if</span> <span class="key">not</span> <span class="nam">ukc_calc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1078" class="run"><span class="n"><a href="#t1078">1078</a></span><span class="t">                <span class="nam">new_t</span><span class="op">,</span> <span class="nam">min_wdep</span> <span class="op">=</span> <span class="nam">minimum_available_water_depth_along_route</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">axis</span><span class="op">,</span> <span class="nam">plot</span><span class="op">,</span> <span class="nam">sailing_time_correction</span><span class="op">,</span> <span class="nam">ukc_calc</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1079" class="pln"><span class="n"><a href="#t1079">1079</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1080" class="mis show_mis"><span class="n"><a href="#t1080">1080</a></span><span class="t">                <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span> <span class="op">=</span> <span class="nam">minimum_available_water_depth_along_route</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">ukc_calc</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1081" class="mis show_mis"><span class="n"><a href="#t1081">1081</a></span><span class="t">                <span class="key">return</span> <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1082" class="pln"><span class="n"><a href="#t1082">1082</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1083" class="pln"><span class="n"><a href="#t1083">1083</a></span><span class="t">            <span class="com">#Interpolation of the net ukc</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1084" class="run"><span class="n"><a href="#t1084">1084</a></span><span class="t">            <span class="nam">root_interp_water_level_at_edge</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="op">[</span><span class="nam">x</span><span class="op">-</span><span class="nam">water_depth_required</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">min_wdep</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1085" class="pln"><span class="n"><a href="#t1085">1085</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1086" class="pln"><span class="n"><a href="#t1086">1086</a></span><span class="t">            <span class="com">#If there is not enough available water depth over time: no tidal window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1087" class="run"><span class="n"><a href="#t1087">1087</a></span><span class="t">            <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="nam">x</span> <span class="op">-</span> <span class="nam">water_depth_required</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">min_wdep</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1088" class="mis show_mis"><span class="n"><a href="#t1088">1088</a></span><span class="t">                <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span> <span class="com">#tidal restriction starts at t_start</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1089" class="mis show_mis"><span class="n"><a href="#t1089">1089</a></span><span class="t">                <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">+</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span> <span class="com">#tidal restriction ends at t_end</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1090" class="pln"><span class="n"><a href="#t1090">1090</a></span><span class="t">            <span class="com">#Else if there is enough available water depth at certain moments: calculate tidal windows by looping over the roots of the interpolation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1091" class="pln"><span class="n"><a href="#t1091">1091</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1092" class="run"><span class="n"><a href="#t1092">1092</a></span><span class="t">                <span class="key">for</span> <span class="nam">root</span> <span class="key">in</span> <span class="nam">root_interp_water_level_at_edge</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1093" class="pln"><span class="n"><a href="#t1093">1093</a></span><span class="t">                    <span class="com">#-if root falls within time series of the data on the net ukc, and the net ukc a moment later than the root is higher than the required water depth:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1094" class="run"><span class="n"><a href="#t1094">1094</a></span><span class="t">                    <span class="key">if</span> <span class="nam">root</span> <span class="op">></span> <span class="nam">new_t</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">root</span> <span class="op">&lt;</span> <span class="nam">new_t</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">min_wdep</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="nam">root</span><span class="op">)</span><span class="op">]</span> <span class="op">></span> <span class="nam">water_depth_required</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1095" class="pln"><span class="n"><a href="#t1095">1095</a></span><span class="t">                        <span class="com"># -if there are no values in the list of vertical tidal windows yet or there are values and the last value indicates that the tidal restriction has started and not ended and the net ukc a moment ealier than the root is less than the required water depth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1096" class="mis show_mis"><span class="n"><a href="#t1096">1096</a></span><span class="t">                        <span class="key">if</span> <span class="op">(</span><span class="nam">times_vertical_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span> <span class="key">or</span> <span class="op">(</span><span class="nam">times_vertical_tidal_window</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="nam">times_vertical_tidal_window</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'Stop'</span><span class="op">)</span><span class="op">)</span> <span class="key">and</span> <span class="nam">min_wdep</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="nam">root</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">water_depth_required</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1097" class="mis show_mis"><span class="n"><a href="#t1097">1097</a></span><span class="t">                            <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">root</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span> <span class="com">#tidal restriction ends at t=root</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1098" class="pln"><span class="n"><a href="#t1098">1098</a></span><span class="t">                    <span class="com"># -if root falls within time series of the data on the net ukc, and the net ukc a moment later than the root is less than the required water depth:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1099" class="run"><span class="n"><a href="#t1099">1099</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">root</span> <span class="op">></span> <span class="nam">new_t</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">root</span> <span class="op">&lt;</span> <span class="nam">new_t</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">min_wdep</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="nam">root</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">water_depth_required</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1100" class="pln"><span class="n"><a href="#t1100">1100</a></span><span class="t">                        <span class="com"># -if there are no values in the list of vertical tidal windows yet or there are values and the last value indicates that the tidal restriction has ended and not ended and the net ukc a moment ealier than the root is higher than the required water depth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1101" class="mis show_mis"><span class="n"><a href="#t1101">1101</a></span><span class="t">                        <span class="key">if</span> <span class="op">(</span><span class="nam">times_vertical_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span> <span class="key">or</span> <span class="op">(</span><span class="nam">times_vertical_tidal_window</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="nam">times_vertical_tidal_window</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'Start'</span><span class="op">)</span><span class="op">)</span> <span class="key">and</span> <span class="nam">min_wdep</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="nam">root</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="nam">water_depth_required</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1102" class="mis show_mis"><span class="n"><a href="#t1102">1102</a></span><span class="t">                            <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">root</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span> <span class="com">#tidal restriction starts at t=root</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1103" class="pln"><span class="n"><a href="#t1103">1103</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1104" class="pln"><span class="n"><a href="#t1104">1104</a></span><span class="t">                <span class="com">#If the sail-in or -out-times given the vertical tidal restrictions are not empty: set the initial value at t=0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1105" class="run"><span class="n"><a href="#t1105">1105</a></span><span class="t">                <span class="key">if</span> <span class="nam">times_vertical_tidal_window</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1106" class="pln"><span class="n"><a href="#t1106">1106</a></span><span class="t">                    <span class="com">#-if the first value in the list indicates that the tidal restriction starts: append that the tidal restriction ends at t=0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1107" class="mis show_mis"><span class="n"><a href="#t1107">1107</a></span><span class="t">                    <span class="key">if</span> <span class="nam">times_vertical_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">times_vertical_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">></span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1108" class="mis show_mis"><span class="n"><a href="#t1108">1108</a></span><span class="t">                            <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1109" class="pln"><span class="n"><a href="#t1109">1109</a></span><span class="t">                    <span class="com"># -if the first value in the list indicates that the tidal restriction stop: append that the tidal restriction starts at t=0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1110" class="mis show_mis"><span class="n"><a href="#t1110">1110</a></span><span class="t">                    <span class="key">if</span> <span class="nam">times_vertical_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">times_vertical_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">></span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1111" class="mis show_mis"><span class="n"><a href="#t1111">1111</a></span><span class="t">                            <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1112" class="pln"><span class="n"><a href="#t1112">1112</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1113" class="pln"><span class="n"><a href="#t1113">1113</a></span><span class="t">            <span class="com">#If there are still no sail-in or -out-times (meaning the vessel can enter regardless the vertical tidal restriction): set start- and end-times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1114" class="run"><span class="n"><a href="#t1114">1114</a></span><span class="t">            <span class="key">if</span> <span class="nam">times_vertical_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1115" class="run"><span class="n"><a href="#t1115">1115</a></span><span class="t">                <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span> <span class="com">#tidal restriction stops at t_start</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1116" class="run"><span class="n"><a href="#t1116">1116</a></span><span class="t">                <span class="nam">times_vertical_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">+</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span> <span class="com">#tidal restriction starts at t_end</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1117" class="pln"><span class="n"><a href="#t1117">1117</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1118" class="pln"><span class="n"><a href="#t1118">1118</a></span><span class="t">            <span class="com">#If plot is requested: plot the minimum available water depth, the required water depth of the vessel, the resulting vertical tidal windows, and add some lay-out</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1119" class="run"><span class="n"><a href="#t1119">1119</a></span><span class="t">            <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1120" class="mis show_mis"><span class="n"><a href="#t1120">1120</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="nam">min_wdep</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">'deepskyblue'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1121" class="mis show_mis"><span class="n"><a href="#t1121">1121</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">x</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">times_vertical_tidal_window</span><span class="op">]</span><span class="op">,</span> <span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'ukc'</span><span class="op">]</span><span class="op">+</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span><span class="op">)</span> <span class="op">*</span> <span class="nam">np</span><span class="op">.</span><span class="nam">ones</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_vertical_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'deepskyblue'</span><span class="op">,</span><span class="nam">marker</span><span class="op">=</span><span class="str">'o'</span><span class="op">,</span><span class="nam">linestyle</span><span class="op">=</span><span class="str">'None'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1122" class="mis show_mis"><span class="n"><a href="#t1122">1122</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">+</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">,</span> <span class="num">1.01</span><span class="op">*</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'ukc'</span><span class="op">]</span><span class="op">+</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span><span class="op">)</span><span class="op">,</span> <span class="str">'Required water depth'</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'deepskyblue'</span><span class="op">,</span><span class="nam">horizontalalignment</span><span class="op">=</span><span class="str">'center'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1123" class="mis show_mis"><span class="n"><a href="#t1123">1123</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'ukc'</span><span class="op">]</span><span class="op">+</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span><span class="op">)</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'deepskyblue'</span><span class="op">,</span> <span class="nam">linestyle</span><span class="op">=</span><span class="str">'--'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1124" class="mis show_mis"><span class="n"><a href="#t1124">1124</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">T_f</span><span class="op">+</span><span class="num">5</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1125" class="pln"><span class="n"><a href="#t1125">1125</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1126" class="pln"><span class="n"><a href="#t1126">1126</a></span><span class="t">            <span class="com">#Return the sail-in or -out-times given the vertical tidal restrictions over the route of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1127" class="run"><span class="n"><a href="#t1127">1127</a></span><span class="t">            <span class="key">return</span> <span class="nam">times_vertical_tidal_window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1128" class="pln"><span class="n"><a href="#t1128">1128</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1129" class="run"><span class="n"><a href="#t1129">1129</a></span><span class="t">        <span class="key">def</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">axis</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="nam">plot</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">=</span><span class="key">True</span><span class="op">,</span><span class="nam">visualization_calculation</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1130" class="pln"><span class="n"><a href="#t1130">1130</a></span><span class="t">            <span class="str">""" Function: calculates the windows available to sail-in and -out of the port given the horizontal tidal restrictions according to the tidal window policy.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1131" class="pln"><span class="n"><a href="#t1131">1131</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1132" class="pln"><span class="n"><a href="#t1132">1132</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1133" class="pln"><span class="n"><a href="#t1133">1133</a></span><span class="t"><span class="str">                    - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1134" class="pln"><span class="n"><a href="#t1134">1134</a></span><span class="t"><span class="str">                    - route: a list of strings of node names that resemble the route that the vessel is planning to sail (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1135" class="pln"><span class="n"><a href="#t1135">1135</a></span><span class="t"><span class="str">                    - plot: provide a visualization of the calculation for each vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1136" class="pln"><span class="n"><a href="#t1136">1136</a></span><span class="t"><span class="str">                    - axis: axes class from the matplotlib package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1137" class="pln"><span class="n"><a href="#t1137">1137</a></span><span class="t"><span class="str">                    - sailing_time_correction: a bool that indicates whether the calculation should correct for sailing_speed (dynamic calculation) or not (static calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1138" class="pln"><span class="n"><a href="#t1138">1138</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1139" class="pln"><span class="n"><a href="#t1139">1139</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1140" class="pln"><span class="n"><a href="#t1140">1140</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1141" class="run"><span class="n"><a href="#t1141">1141</a></span><span class="t">            <span class="key">def</span> <span class="nam">tidal_windows_tightest_current_restriction_along_route</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">axis</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">,</span> <span class="nam">sailing_time_correction</span><span class="op">=</span><span class="key">True</span><span class="op">,</span> <span class="nam">visualization_calculation</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1142" class="pln"><span class="n"><a href="#t1142">1142</a></span><span class="t">                <span class="str">""" Function: calculates the normative current restrictions along the route over time and calculates the resulting horizontal tidal windows from these locations.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1143" class="pln"><span class="n"><a href="#t1143">1143</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1144" class="pln"><span class="n"><a href="#t1144">1144</a></span><span class="t"><span class="str">                    Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1145" class="pln"><span class="n"><a href="#t1145">1145</a></span><span class="t"><span class="str">                        - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1146" class="pln"><span class="n"><a href="#t1146">1146</a></span><span class="t"><span class="str">                        - route: a list of strings of node names that resemble the route that the vessel is planning to sail (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1147" class="pln"><span class="n"><a href="#t1147">1147</a></span><span class="t"><span class="str">                        - plot: provide a visualization of the calculation for each vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1148" class="pln"><span class="n"><a href="#t1148">1148</a></span><span class="t"><span class="str">                        - axis: axes class from the matplotlib package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1149" class="pln"><span class="n"><a href="#t1149">1149</a></span><span class="t"><span class="str">                        - sailing_time_correction: a bool that indicates whether the calculation should correct for sailing_speed (dynamic calculation) or not (static calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1150" class="pln"><span class="n"><a href="#t1150">1150</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1151" class="pln"><span class="n"><a href="#t1151">1151</a></span><span class="t"><span class="str">                """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1152" class="pln"><span class="n"><a href="#t1152">1152</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1153" class="pln"><span class="n"><a href="#t1153">1153</a></span><span class="t">                <span class="com"># Functions used for the calculation of the normative restriction along the route and the subsequent horizontal tidal windows over time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1154" class="run"><span class="n"><a href="#t1154">1154</a></span><span class="t">                <span class="key">def</span> <span class="nam">calculate_and_store_normative_current_velocity_data</span><span class="op">(</span><span class="nam">node</span><span class="op">,</span> <span class="nam">data_nodes</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">,</span> <span class="nam">t_ccur_raw</span><span class="op">,</span> <span class="nam">ccur</span><span class="op">,</span> <span class="nam">critcur_nodes</span><span class="op">,</span> <span class="nam">mccur_nodes</span><span class="op">,</span> <span class="nam">method</span><span class="op">,</span> <span class="nam">crit_ccur</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="op">,</span> <span class="nam">crit_ccur_flood</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">crit_ccur_ebb</span><span class="op">=</span><span class="num">0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1155" class="pln"><span class="n"><a href="#t1155">1155</a></span><span class="t">                    <span class="str">""" Function: imports the current velocity data time series, corrects the time for the sailing time of the vessel, and subtracts the velocity data with the critical</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1156" class="pln"><span class="n"><a href="#t1156">1156</a></span><span class="t"><span class="str">                                  cross-current in order to find the times when the velocity exceeds the limit (by interpolation). The correct critical cross-current limit is picked by</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1157" class="pln"><span class="n"><a href="#t1157">1157</a></span><span class="t"><span class="str">                                  determining to what tidal period part of the time series belongs to (by determining what is the next tidal period). It appends the corrected data and</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1158" class="pln"><span class="n"><a href="#t1158">1158</a></span><span class="t"><span class="str">                                  the corresponding limits to separate lists.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1159" class="pln"><span class="n"><a href="#t1159">1159</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1160" class="pln"><span class="n"><a href="#t1160">1160</a></span><span class="t"><span class="str">                        Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1161" class="pln"><span class="n"><a href="#t1161">1161</a></span><span class="t"><span class="str">                            - node: the name string of the node in the given network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1162" class="pln"><span class="n"><a href="#t1162">1162</a></span><span class="t"><span class="str">                            - data_nodes: a list containing the two name string of the node in the given network the data is located. These locations depend on the direction of the vessel around the node of the restriction.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1163" class="pln"><span class="n"><a href="#t1163">1163</a></span><span class="t"><span class="str">                            - sailing_time_to_next_node: time in s that the vessel needs to reach the node at which the restiction holds</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1164" class="pln"><span class="n"><a href="#t1164">1164</a></span><span class="t"><span class="str">                            - t_ccur_raw: a list of the raw, uncorrected timestamps of the time series for the current velocity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1165" class="pln"><span class="n"><a href="#t1165">1165</a></span><span class="t"><span class="str">                            - ccur: a list to which the corrected current data will be appended</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1166" class="pln"><span class="n"><a href="#t1166">1166</a></span><span class="t"><span class="str">                            - critcur_nodes: a list to which the list of critical cross-currents corresponding to the maximum corrected current data will be appended to (for each node at which a horizontal tidal restriction is installed separately)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1167" class="pln"><span class="n"><a href="#t1167">1167</a></span><span class="t"><span class="str">                            - mccur_nodes: a list to which the list of maximum corrected current data will be appended to (for each node at which a horizontal tidal restriction is installed separately)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1168" class="pln"><span class="n"><a href="#t1168">1168</a></span><span class="t"><span class="str">                            - method: type of horizontal tidal restriction (method used)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1169" class="pln"><span class="n"><a href="#t1169">1169</a></span><span class="t"><span class="str">                            - crit_ccur: a list to which the critical current velocity limit corresponding to the current data will be appended</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1170" class="pln"><span class="n"><a href="#t1170">1170</a></span><span class="t"><span class="str">                            - crit_ccur_flood: critical cross-current limit applied during flood in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1171" class="pln"><span class="n"><a href="#t1171">1171</a></span><span class="t"><span class="str">                            - crit_ccur_ebb: critical cross-current limit applied during ebb in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1172" class="pln"><span class="n"><a href="#t1172">1172</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1173" class="pln"><span class="n"><a href="#t1173">1173</a></span><span class="t"><span class="str">                    """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1174" class="pln"><span class="n"><a href="#t1174">1174</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1175" class="pln"><span class="n"><a href="#t1175">1175</a></span><span class="t">                    <span class="com"># Setting some default bools</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1176" class="run"><span class="n"><a href="#t1176">1176</a></span><span class="t">                    <span class="nam">critical_cross_current_method_in_restrictions</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1177" class="run"><span class="n"><a href="#t1177">1177</a></span><span class="t">                    <span class="nam">point_based_method_in_restrictions</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1178" class="pln"><span class="n"><a href="#t1178">1178</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1179" class="pln"><span class="n"><a href="#t1179">1179</a></span><span class="t">                    <span class="com"># Looping over the two nodes, one prior and one after the node at which the horizontal tidal restriction is installed, determining the direction of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1180" class="run"><span class="n"><a href="#t1180">1180</a></span><span class="t">                    <span class="key">for</span> <span class="nam">rep</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">2</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1181" class="pln"><span class="n"><a href="#t1181">1181</a></span><span class="t">                        <span class="com"># Import current data and correct time series with sailing time, and import tidal periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1182" class="run"><span class="n"><a href="#t1182">1182</a></span><span class="t">                        <span class="nam">t_ccur</span> <span class="op">=</span> <span class="op">[</span><span class="nam">t</span> <span class="op">-</span> <span class="nam">sailing_time_to_next_node</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">data_nodes</span><span class="op">[</span><span class="nam">rep</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1183" class="run"><span class="n"><a href="#t1183">1183</a></span><span class="t">                        <span class="nam">cur</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">data_nodes</span><span class="op">[</span><span class="nam">rep</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1184" class="run"><span class="n"><a href="#t1184">1184</a></span><span class="t">                        <span class="nam">times_tidal_periods</span> <span class="op">=</span> <span class="op">[</span><span class="nam">z</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">sailing_time_to_next_node</span> <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Tidal periods'</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1185" class="run"><span class="n"><a href="#t1185">1185</a></span><span class="t">                        <span class="nam">tidal_periods</span> <span class="op">=</span> <span class="op">[</span><span class="nam">z</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Tidal periods'</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1186" class="pln"><span class="n"><a href="#t1186">1186</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1187" class="pln"><span class="n"><a href="#t1187">1187</a></span><span class="t">                        <span class="com"># Different procedure for the methods:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1188" class="run"><span class="n"><a href="#t1188">1188</a></span><span class="t">                        <span class="key">if</span> <span class="nam">method</span> <span class="op">==</span> <span class="str">'Critical cross-current'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1189" class="mis show_mis"><span class="n"><a href="#t1189">1189</a></span><span class="t">                            <span class="nam">critical_cross_current_method_in_restrictions</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1190" class="pln"><span class="n"><a href="#t1190">1190</a></span><span class="t">                            <span class="com"># Determine the next tidal period of the time series</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1191" class="mis show_mis"><span class="n"><a href="#t1191">1191</a></span><span class="t">                            <span class="nam">t_ccur_tidal_periods</span> <span class="op">=</span> <span class="op">[</span><span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">times_tidal_periods</span><span class="op">,</span><span class="nam">y</span><span class="op">)</span><span class="op">]</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">&lt;</span> <span class="nam">times_tidal_periods</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">else</span> <span class="nam">tidal_periods</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">t_ccur</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1192" class="pln"><span class="n"><a href="#t1192">1192</a></span><span class="t">                            <span class="com"># Interpolate new time series</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1193" class="mis show_mis"><span class="n"><a href="#t1193">1193</a></span><span class="t">                            <span class="nam">interp_ccur</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">cur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1194" class="pln"><span class="n"><a href="#t1194">1194</a></span><span class="t">                            <span class="com"># If the next tidal period is ebb, then it means that the current period is flood. Hence, append interpolated current data subtracted with the critical cross-current, and the critical cross-current itself to the predefined lists</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1195" class="mis show_mis"><span class="n"><a href="#t1195">1195</a></span><span class="t">                            <span class="nam">ccur</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">y</span> <span class="op">-</span> <span class="nam">crit_ccur_flood</span> <span class="key">if</span> <span class="nam">t_ccur_tidal_periods</span><span class="op">[</span><span class="nam">x</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Ebb Start'</span> <span class="key">else</span> <span class="nam">y</span> <span class="op">-</span> <span class="nam">crit_ccur_ebb</span> <span class="key">for</span> <span class="nam">x</span><span class="op">,</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">interp_ccur</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1196" class="mis show_mis"><span class="n"><a href="#t1196">1196</a></span><span class="t">                            <span class="nam">crit_ccur</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">crit_ccur_flood</span> <span class="key">if</span> <span class="nam">t_ccur_tidal_periods</span><span class="op">[</span><span class="nam">x</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Ebb Start'</span> <span class="key">else</span> <span class="nam">crit_ccur_ebb</span> <span class="key">for</span> <span class="nam">x</span><span class="op">,</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">data_nodes</span><span class="op">[</span><span class="nam">rep</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1197" class="pln"><span class="n"><a href="#t1197">1197</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1198" class="run"><span class="n"><a href="#t1198">1198</a></span><span class="t">                        <span class="key">elif</span> <span class="nam">method</span> <span class="op">==</span> <span class="str">'Point-based'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1199" class="run"><span class="n"><a href="#t1199">1199</a></span><span class="t">                            <span class="nam">point_based_method_in_restrictions</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1200" class="pln"><span class="n"><a href="#t1200">1200</a></span><span class="t">                            <span class="com"># Just append the raw current data to the predefined list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1201" class="run"><span class="n"><a href="#t1201">1201</a></span><span class="t">                            <span class="nam">ccur</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Data'</span><span class="op">]</span><span class="op">[</span><span class="nam">data_nodes</span><span class="op">[</span><span class="nam">rep</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1202" class="pln"><span class="n"><a href="#t1202">1202</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1203" class="pln"><span class="n"><a href="#t1203">1203</a></span><span class="t">                    <span class="com"># Take the maximum of both lists with the exceedance of the cross-current (positive values)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1204" class="run"><span class="n"><a href="#t1204">1204</a></span><span class="t">                    <span class="nam">mccur</span> <span class="op">=</span> <span class="op">[</span><span class="nam">max</span><span class="op">(</span><span class="nam">idx</span><span class="op">)</span> <span class="key">for</span> <span class="nam">idx</span> <span class="key">in</span> <span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">ccur</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1205" class="pln"><span class="n"><a href="#t1205">1205</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1206" class="run"><span class="n"><a href="#t1206">1206</a></span><span class="t">                    <span class="key">if</span> <span class="nam">method</span> <span class="op">==</span> <span class="str">'Critical cross-current'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1207" class="pln"><span class="n"><a href="#t1207">1207</a></span><span class="t">                        <span class="com"># Take the cross-currents of both lists which belong to the maximum cross-current limit exceeding velocities</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1208" class="mis show_mis"><span class="n"><a href="#t1208">1208</a></span><span class="t">                        <span class="nam">critcur</span> <span class="op">=</span> <span class="op">[</span><span class="nam">crit_ccur</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">val</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span> <span class="key">for</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">val</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">ccur</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1209" class="mis show_mis"><span class="n"><a href="#t1209">1209</a></span><span class="t">                        <span class="nam">critcur_nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">critcur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1210" class="mis show_mis"><span class="n"><a href="#t1210">1210</a></span><span class="t">                        <span class="nam">mccur_nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">mccur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1211" class="pln"><span class="n"><a href="#t1211">1211</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1212" class="run"><span class="n"><a href="#t1212">1212</a></span><span class="t">                    <span class="key">if</span> <span class="nam">method</span> <span class="op">==</span> <span class="str">'Point-based'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1213" class="pln"><span class="n"><a href="#t1213">1213</a></span><span class="t">                        <span class="com"># Interpolate new time series</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1214" class="run"><span class="n"><a href="#t1214">1214</a></span><span class="t">                        <span class="nam">interp_ccur</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">mccur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1215" class="run"><span class="n"><a href="#t1215">1215</a></span><span class="t">                        <span class="nam">mccur</span> <span class="op">=</span> <span class="nam">interp_ccur</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1216" class="run"><span class="n"><a href="#t1216">1216</a></span><span class="t">                        <span class="nam">critcur</span> <span class="op">=</span> <span class="num">10</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">ones</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">mccur</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1217" class="run"><span class="n"><a href="#t1217">1217</a></span><span class="t">                        <span class="nam">critcur_nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">critcur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1218" class="run"><span class="n"><a href="#t1218">1218</a></span><span class="t">                        <span class="nam">mccur_nodes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">-</span><span class="num">10</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">ones</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">mccur</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1219" class="pln"><span class="n"><a href="#t1219">1219</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1220" class="pln"><span class="n"><a href="#t1220">1220</a></span><span class="t">                    <span class="com">#Returns the determined tidal periods which may be used in a later stage of the calculation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1221" class="run"><span class="n"><a href="#t1221">1221</a></span><span class="t">                    <span class="key">return</span> <span class="nam">critical_cross_current_method_in_restrictions</span><span class="op">,</span> <span class="nam">point_based_method_in_restrictions</span><span class="op">,</span> <span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">mccur</span><span class="op">,</span> <span class="nam">critcur</span><span class="op">,</span> <span class="nam">times_tidal_periods</span><span class="op">,</span> <span class="nam">tidal_periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1222" class="pln"><span class="n"><a href="#t1222">1222</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1223" class="run"><span class="n"><a href="#t1223">1223</a></span><span class="t">                <span class="key">def</span> <span class="nam">calculate_and_append_individual_horizontal_tidal_windows_critical_cross_current_method</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span><span class="nam">max_ccur</span><span class="op">,</span><span class="nam">max_crit_ccur</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1224" class="pln"><span class="n"><a href="#t1224">1224</a></span><span class="t">                    <span class="str">""" Function: calculates and appends the horizontal tidal windows (available sail-in and -out times given the horizontal tidal restrictions) and corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1225" class="pln"><span class="n"><a href="#t1225">1225</a></span><span class="t"><span class="str">                                  velocities to the appropriate lists for the 'critical cross-curent'-method</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1226" class="pln"><span class="n"><a href="#t1226">1226</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1227" class="pln"><span class="n"><a href="#t1227">1227</a></span><span class="t"><span class="str">                        Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1228" class="pln"><span class="n"><a href="#t1228">1228</a></span><span class="t"><span class="str">                            - new_t: time of the time series for the current velocity corrected for the sailing time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1229" class="pln"><span class="n"><a href="#t1229">1229</a></span><span class="t"><span class="str">                            - max_ccur: a list of the governing current velocities of the time series of the governing cross-currents in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1230" class="pln"><span class="n"><a href="#t1230">1230</a></span><span class="t"><span class="str">                            - max_crit_ccur: a list containing the critical-cross currents corrspeonding to the governing current velocities of the time series of the governing cross-currents in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1231" class="pln"><span class="n"><a href="#t1231">1231</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1232" class="pln"><span class="n"><a href="#t1232">1232</a></span><span class="t"><span class="str">                    """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1233" class="pln"><span class="n"><a href="#t1233">1233</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1234" class="mis show_mis"><span class="n"><a href="#t1234">1234</a></span><span class="t">                    <span class="nam">times_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1235" class="mis show_mis"><span class="n"><a href="#t1235">1235</a></span><span class="t">                    <span class="nam">crit_ccurs_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1236" class="pln"><span class="n"><a href="#t1236">1236</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1237" class="pln"><span class="n"><a href="#t1237">1237</a></span><span class="t">                    <span class="com"># Interpolate the data of the exceedance of the critical cross-current velocity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1238" class="mis show_mis"><span class="n"><a href="#t1238">1238</a></span><span class="t">                    <span class="nam">interp_max_cross_current</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span> <span class="op">[</span><span class="nam">x</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">max_ccur</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1239" class="pln"><span class="n"><a href="#t1239">1239</a></span><span class="t">                    <span class="com"># Loop over the roots (crossings where the cross-current velocity exceeds the cross-current velocity limit)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1240" class="mis show_mis"><span class="n"><a href="#t1240">1240</a></span><span class="t">                    <span class="key">for</span> <span class="nam">root</span> <span class="key">in</span> <span class="nam">interp_max_cross_current</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1241" class="pln"><span class="n"><a href="#t1241">1241</a></span><span class="t">                        <span class="com"># If the root falls within the time series and the next cross-current does not exceed the limit and the list of tidal restrictions is still empty or there are some restrictions identified but the previous restriction is not a stopping criteria</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1242" class="mis show_mis"><span class="n"><a href="#t1242">1242</a></span><span class="t">                        <span class="key">if</span> <span class="nam">root</span> <span class="op">></span> <span class="nam">new_t</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">root</span> <span class="op">&lt;</span> <span class="nam">new_t</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">max_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span> <span class="nam">root</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1243" class="mis show_mis"><span class="n"><a href="#t1243">1243</a></span><span class="t">                            <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span> <span class="key">or</span> <span class="op">(</span><span class="nam">times_horizontal_tidal_window</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'Stop'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1244" class="pln"><span class="n"><a href="#t1244">1244</a></span><span class="t">                                <span class="com"># Append a stopping time of the restriction and the corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1245" class="mis show_mis"><span class="n"><a href="#t1245">1245</a></span><span class="t">                                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">root</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1246" class="mis show_mis"><span class="n"><a href="#t1246">1246</a></span><span class="t">                                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span> <span class="nam">root</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1247" class="pln"><span class="n"><a href="#t1247">1247</a></span><span class="t">                        <span class="com"># If the root falls within the time series and the next cross-current exceeds the limit as well and the list of tidal restrictions is still empty or there are some restrictions identified but the previous restriction is not a starting criteria</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1248" class="mis show_mis"><span class="n"><a href="#t1248">1248</a></span><span class="t">                        <span class="key">elif</span> <span class="nam">root</span> <span class="op">></span> <span class="nam">new_t</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">root</span> <span class="op">&lt;</span> <span class="nam">new_t</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">max_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span> <span class="nam">root</span><span class="op">)</span><span class="op">]</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1249" class="mis show_mis"><span class="n"><a href="#t1249">1249</a></span><span class="t">                            <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span> <span class="key">or</span> <span class="op">(</span><span class="nam">times_horizontal_tidal_window</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'Start'</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1250" class="pln"><span class="n"><a href="#t1250">1250</a></span><span class="t">                                <span class="com"># Append a starting time of the restriction and the corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1251" class="mis show_mis"><span class="n"><a href="#t1251">1251</a></span><span class="t">                                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">root</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1252" class="mis show_mis"><span class="n"><a href="#t1252">1252</a></span><span class="t">                                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span> <span class="nam">root</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1253" class="pln"><span class="n"><a href="#t1253">1253</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1254" class="pln"><span class="n"><a href="#t1254">1254</a></span><span class="t">                    <span class="com"># If the list of tidal windows are still empty: there is no horizontal tidal restriction for the particular vessel, so restriction stops at t_start and ends at t_end of the simulation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1255" class="mis show_mis"><span class="n"><a href="#t1255">1255</a></span><span class="t">                    <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1256" class="mis show_mis"><span class="n"><a href="#t1256">1256</a></span><span class="t">                        <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1257" class="mis show_mis"><span class="n"><a href="#t1257">1257</a></span><span class="t">                        <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">new_t</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1258" class="mis show_mis"><span class="n"><a href="#t1258">1258</a></span><span class="t">                        <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">new_t</span><span class="op">)</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1259" class="mis show_mis"><span class="n"><a href="#t1259">1259</a></span><span class="t">                        <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1260" class="pln"><span class="n"><a href="#t1260">1260</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1261" class="pln"><span class="n"><a href="#t1261">1261</a></span><span class="t">                    <span class="com"># If the last restriction contains a starting time and is smaller than the end of the time series: add a stopping time restriction at the t_end of the simulation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1262" class="mis show_mis"><span class="n"><a href="#t1262">1262</a></span><span class="t">                    <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">new_t</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1263" class="mis show_mis"><span class="n"><a href="#t1263">1263</a></span><span class="t">                        <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">new_t</span><span class="op">)</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1264" class="mis show_mis"><span class="n"><a href="#t1264">1264</a></span><span class="t">                        <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1265" class="pln"><span class="n"><a href="#t1265">1265</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1266" class="mis show_mis"><span class="n"><a href="#t1266">1266</a></span><span class="t">                    <span class="key">return</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">crit_ccurs_horizontal_tidal_window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1267" class="pln"><span class="n"><a href="#t1267">1267</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1268" class="run"><span class="n"><a href="#t1268">1268</a></span><span class="t">                <span class="key">def</span> <span class="nam">finding_current_velocity_bounds_point_based_method</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">mccur</span><span class="op">,</span> <span class="nam">p_range</span><span class="op">,</span> <span class="nam">crit_ccur_tidal_period</span><span class="op">,</span> <span class="nam">times_tidal_periods</span><span class="op">,</span> <span class="nam">tidal_periods</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1269" class="pln"><span class="n"><a href="#t1269">1269</a></span><span class="t">                    <span class="str">""" Function: defines the bounds around the point-based current velocity and finds the times at which the current velocity crosses these bounds by solving the roots of the interpolation.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1270" class="pln"><span class="n"><a href="#t1270">1270</a></span><span class="t"><span class="str">                                  Furthermore, the tidal periods for each time the current velocity intersects with the bounds around the point-based current velocity.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1271" class="pln"><span class="n"><a href="#t1271">1271</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1272" class="pln"><span class="n"><a href="#t1272">1272</a></span><span class="t"><span class="str">                        Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1273" class="pln"><span class="n"><a href="#t1273">1273</a></span><span class="t"><span class="str">                            - t_ccur: time of the time series for the current velocity corrected for the sailing time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1274" class="pln"><span class="n"><a href="#t1274">1274</a></span><span class="t"><span class="str">                            - mccur: a list of times of the governing cross-currents in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1275" class="pln"><span class="n"><a href="#t1275">1275</a></span><span class="t"><span class="str">                            - p_range: the range in % around the point-based current velocity</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1276" class="pln"><span class="n"><a href="#t1276">1276</a></span><span class="t"><span class="str">                            - crit_ccur_tidal_period: critical cross-current limit applied during the tidal period in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1277" class="pln"><span class="n"><a href="#t1277">1277</a></span><span class="t"><span class="str">                            - times_tidal_periods: the starting times of the tidal periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1278" class="pln"><span class="n"><a href="#t1278">1278</a></span><span class="t"><span class="str">                            - tidal_periods: the definition of the tidal periods (Ebb or Flood Start)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1279" class="pln"><span class="n"><a href="#t1279">1279</a></span><span class="t"><span class="str">                            - sailing_time_to_next_node: time in s that the vessel needs to reach the node at which the restiction holds</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1280" class="pln"><span class="n"><a href="#t1280">1280</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1281" class="pln"><span class="n"><a href="#t1281">1281</a></span><span class="t"><span class="str">                    """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1282" class="pln"><span class="n"><a href="#t1282">1282</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1283" class="pln"><span class="n"><a href="#t1283">1283</a></span><span class="t">                    <span class="com"># Interpolate the interpolated cross-current velocity, corrected for the sailing time, subtracted with the critical cross-current for the upper and lower bound separately and calculate roots, and corresponding next tidal periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1284" class="run"><span class="n"><a href="#t1284">1284</a></span><span class="t">                    <span class="nam">crit_ccur_upper_bound</span> <span class="op">=</span> <span class="nam">crit_ccur_tidal_period</span> <span class="op">*</span> <span class="op">(</span><span class="num">1</span> <span class="op">+</span> <span class="nam">p_range</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1285" class="run"><span class="n"><a href="#t1285">1285</a></span><span class="t">                    <span class="nam">crit_ccur_lower_bound</span> <span class="op">=</span> <span class="nam">crit_ccur_tidal_period</span> <span class="op">*</span> <span class="op">(</span><span class="num">1</span> <span class="op">-</span> <span class="nam">p_range</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1286" class="run"><span class="n"><a href="#t1286">1286</a></span><span class="t">                    <span class="nam">interp_ccur_upper_bound</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="op">[</span><span class="nam">ccur</span> <span class="op">-</span> <span class="nam">crit_ccur_upper_bound</span> <span class="key">for</span> <span class="nam">ccur</span> <span class="key">in</span> <span class="nam">mccur</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1287" class="run"><span class="n"><a href="#t1287">1287</a></span><span class="t">                    <span class="nam">interp_ccur_lower_bound</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="op">[</span><span class="nam">ccur</span> <span class="op">-</span> <span class="nam">crit_ccur_lower_bound</span> <span class="key">for</span> <span class="nam">ccur</span> <span class="key">in</span> <span class="nam">mccur</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1288" class="run"><span class="n"><a href="#t1288">1288</a></span><span class="t">                    <span class="nam">roots_upper_bound</span> <span class="op">=</span> <span class="nam">interp_ccur_upper_bound</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1289" class="run"><span class="n"><a href="#t1289">1289</a></span><span class="t">                    <span class="nam">roots_lower_bound</span> <span class="op">=</span> <span class="nam">interp_ccur_lower_bound</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1290" class="run"><span class="n"><a href="#t1290">1290</a></span><span class="t">                    <span class="nam">t_ccur_tidal_periods_upper_bound</span> <span class="op">=</span> <span class="op">[</span><span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">times_tidal_periods</span><span class="op">,</span><span class="nam">y</span><span class="op">)</span><span class="op">]</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">&lt;=</span> <span class="nam">times_tidal_periods</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">else</span> <span class="nam">tidal_periods</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">roots_upper_bound</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1291" class="run"><span class="n"><a href="#t1291">1291</a></span><span class="t">                    <span class="nam">t_ccur_tidal_periods_lower_bound</span> <span class="op">=</span> <span class="op">[</span><span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">times_tidal_periods</span><span class="op">,</span><span class="nam">y</span><span class="op">)</span><span class="op">]</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">&lt;=</span> <span class="nam">times_tidal_periods</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">else</span> <span class="nam">tidal_periods</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">roots_lower_bound</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1292" class="run"><span class="n"><a href="#t1292">1292</a></span><span class="t">                    <span class="key">return</span> <span class="nam">crit_ccur_upper_bound</span><span class="op">,</span> <span class="nam">crit_ccur_lower_bound</span><span class="op">,</span> <span class="nam">roots_upper_bound</span> <span class="op">,</span><span class="nam">roots_lower_bound</span><span class="op">,</span> <span class="nam">t_ccur_tidal_periods_upper_bound</span><span class="op">,</span> <span class="nam">t_ccur_tidal_periods_lower_bound</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1293" class="pln"><span class="n"><a href="#t1293">1293</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1294" class="run"><span class="n"><a href="#t1294">1294</a></span><span class="t">                <span class="key">def</span> <span class="nam">calculate_and_append_individual_horizontal_tidal_windows_point_based_method</span><span class="op">(</span><span class="nam">previous_time</span><span class="op">,</span> <span class="nam">next_time</span><span class="op">,</span> <span class="nam">next_tidal_period</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">,</span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">,</span> <span class="nam">roots_bounds_tidal_period</span><span class="op">,</span> <span class="nam">t_ccur_tidal_periods_bounds_period</span><span class="op">,</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">,</span> <span class="nam">p_tidal_periods</span><span class="op">,</span> <span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">mccur</span><span class="op">,</span> <span class="nam">horizontal_tidal_window</span><span class="op">,</span> <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1295" class="pln"><span class="n"><a href="#t1295">1295</a></span><span class="t">                    <span class="str">""" Function: calculates and appends the horizontal tidal windows (available sail-in and -out times given the horizontal tidal restrictions) and corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1296" class="pln"><span class="n"><a href="#t1296">1296</a></span><span class="t"><span class="str">                                  velocities to the appropriate lists for the 'point-based'-method</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1297" class="pln"><span class="n"><a href="#t1297">1297</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1298" class="pln"><span class="n"><a href="#t1298">1298</a></span><span class="t"><span class="str">                        Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1299" class="pln"><span class="n"><a href="#t1299">1299</a></span><span class="t"><span class="str">                            - previous_time: stopping (starting) time of the previous (current) tidal window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1300" class="pln"><span class="n"><a href="#t1300">1300</a></span><span class="t"><span class="str">                            - next_time:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1301" class="pln"><span class="n"><a href="#t1301">1301</a></span><span class="t"><span class="str">                            - next_tidal_period: the string containing information about the next tidal period (Flood/Ebb Start)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1302" class="pln"><span class="n"><a href="#t1302">1302</a></span><span class="t"><span class="str">                            - sailing_time_to_next_node: time in s that the vessel needs to reach the node at which the restiction holds</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1303" class="pln"><span class="n"><a href="#t1303">1303</a></span><span class="t"><span class="str">                            - crit_ccur_bound_tidal_period: a list containing the upper and lower bounds around the critical cross-currents in m/s respectively</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1304" class="pln"><span class="n"><a href="#t1304">1304</a></span><span class="t"><span class="str">                            - roots_bounds_tidal_period: a list containing the lists with the times that the current velocity intersects with the upper and lower bound around the point-based current velocity respectively</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1305" class="pln"><span class="n"><a href="#t1305">1305</a></span><span class="t"><span class="str">                            - t_ccur_tidal_periods_bounds_period: a list containing the lists with the tidal periods for each time the current velocity intersects with the upper and lower bound around the point-based current velocity respectively</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1306" class="pln"><span class="n"><a href="#t1306">1306</a></span><span class="t"><span class="str">                            - crit_ccur_tidal_periods: a list containing the critical cross-currents in m/s during flood and ebb respectively</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1307" class="pln"><span class="n"><a href="#t1307">1307</a></span><span class="t"><span class="str">                            - p_tidal_periods: a list containing the ranges around the critical cross-currents in [-] during flood and ebb respectively</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1308" class="pln"><span class="n"><a href="#t1308">1308</a></span><span class="t"><span class="str">                            - t_ccur: a list of times of the times series of the governing cross-currents in s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1309" class="pln"><span class="n"><a href="#t1309">1309</a></span><span class="t"><span class="str">                            - mccur: a list of the current velocities of the time series of the governing cross-currents in m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1310" class="pln"><span class="n"><a href="#t1310">1310</a></span><span class="t"><span class="str">                            - horizontal_tidal_window: a list to which the horizontal tidal windows should be appended</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1311" class="pln"><span class="n"><a href="#t1311">1311</a></span><span class="t"><span class="str">                            - crit_vel_horizontal_tidal_window: a list to which the critical cross-currents corresponding to the horizontal tidal windows should be appended</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1312" class="pln"><span class="n"><a href="#t1312">1312</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1313" class="pln"><span class="n"><a href="#t1313">1313</a></span><span class="t"><span class="str">                    """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1314" class="pln"><span class="n"><a href="#t1314">1314</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1315" class="pln"><span class="n"><a href="#t1315">1315</a></span><span class="t">                    <span class="com"># Determine the time index for the boundary of the next tidal period and if index is smaller than 0, then set index to 0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1316" class="run"><span class="n"><a href="#t1316">1316</a></span><span class="t">                    <span class="nam">next_previous_time_tidal_periods</span> <span class="op">=</span> <span class="nam">times_tidal_periods</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">next_time</span><span class="op">)</span><span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1317" class="run"><span class="n"><a href="#t1317">1317</a></span><span class="t">                    <span class="key">if</span> <span class="nam">next_previous_time_tidal_periods</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span> <span class="nam">next_previous_time_tidal_periods</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1318" class="pln"><span class="n"><a href="#t1318">1318</a></span><span class="t">                    <span class="com"># Calculate the time index of the starting point and ending point of the current tidal period (corrected for the sailing time)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1319" class="run"><span class="n"><a href="#t1319">1319</a></span><span class="t">                    <span class="nam">start_time</span> <span class="op">=</span> <span class="nam">previous_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1320" class="run"><span class="n"><a href="#t1320">1320</a></span><span class="t">                    <span class="nam">stop_time</span> <span class="op">=</span> <span class="nam">next_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1321" class="run"><span class="n"><a href="#t1321">1321</a></span><span class="t">                    <span class="nam">index_previous_time</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">start_time</span><span class="op">)</span><span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1322" class="run"><span class="n"><a href="#t1322">1322</a></span><span class="t">                    <span class="nam">index_now</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1323" class="run"><span class="n"><a href="#t1323">1323</a></span><span class="t">                    <span class="nam">index_next</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">stop_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1324" class="pln"><span class="n"><a href="#t1324">1324</a></span><span class="t">                    <span class="com"># If the flood tide is freely accessible (critical cross-current limit is -1)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1325" class="run"><span class="n"><a href="#t1325">1325</a></span><span class="t">                    <span class="nam">tide_index</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1326" class="run"><span class="n"><a href="#t1326">1326</a></span><span class="t">                    <span class="nam">next_tide_index</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1327" class="run"><span class="n"><a href="#t1327">1327</a></span><span class="t">                    <span class="key">if</span> <span class="nam">next_tidal_period</span> <span class="op">==</span> <span class="str">'Flood Start'</span><span class="op">:</span> <span class="nam">tide_index</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1328" class="run"><span class="n"><a href="#t1328">1328</a></span><span class="t">                    <span class="nam">next_tide_index</span> <span class="op">=</span> <span class="nam">next_tide_index</span> <span class="op">-</span> <span class="nam">tide_index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1329" class="run"><span class="n"><a href="#t1329">1329</a></span><span class="t">                    <span class="key">if</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1330" class="pln"><span class="n"><a href="#t1330">1330</a></span><span class="t">                        <span class="com"># If the accessibility of the ebb tide is not limited to the slack tides: add stop of tidal restriction at the start of flood tide and append 0 m/s as critical cross-current to list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1331" class="run"><span class="n"><a href="#t1331">1331</a></span><span class="t">                        <span class="key">if</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'min'</span> <span class="key">and</span> <span class="nam">index_previous_time</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1332" class="run"><span class="n"><a href="#t1332">1332</a></span><span class="t">                            <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">times_tidal_periods</span><span class="op">[</span><span class="nam">next_previous_time_tidal_periods</span><span class="op">]</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1333" class="run"><span class="n"><a href="#t1333">1333</a></span><span class="t">                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1334" class="pln"><span class="n"><a href="#t1334">1334</a></span><span class="t">                        <span class="com"># And add the start of the tidal restriction at the end of flood tide and append 0 m/s as critical cross-current to list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1335" class="run"><span class="n"><a href="#t1335">1335</a></span><span class="t">                        <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">next_time</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1336" class="run"><span class="n"><a href="#t1336">1336</a></span><span class="t">                        <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1337" class="pln"><span class="n"><a href="#t1337">1337</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1338" class="pln"><span class="n"><a href="#t1338">1338</a></span><span class="t">                    <span class="com"># Else if the accessibility during the ebb tide is limited to the slack waters and there is current data within this tidal period</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1339" class="run"><span class="n"><a href="#t1339">1339</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="str">'min'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1340" class="run"><span class="n"><a href="#t1340">1340</a></span><span class="t">                        <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1341" class="pln"><span class="n"><a href="#t1341">1341</a></span><span class="t">                            <span class="com"># Interpolation of the maximum current velocities during this specific tidal period subtracted with the critical point-based cross-current and calculate the times at which the cross-current equals this critical limit</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1342" class="run"><span class="n"><a href="#t1342">1342</a></span><span class="t">                            <span class="nam">interp</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="nam">y</span> <span class="op">-</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1343" class="run"><span class="n"><a href="#t1343">1343</a></span><span class="t">                            <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">interp</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span> <span class="key">if</span> <span class="op">(</span><span class="nam">x</span> <span class="op">>=</span> <span class="nam">previous_time</span> <span class="key">and</span> <span class="nam">x</span> <span class="op">&lt;=</span> <span class="nam">next_time</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1344" class="pln"><span class="n"><a href="#t1344">1344</a></span><span class="t">                            <span class="com"># If there are no crossings (minimum number of crossings should be at least two)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1345" class="run"><span class="n"><a href="#t1345">1345</a></span><span class="t">                            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">times</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">1</span><span class="op">:</span> <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">]</span><span class="op">,</span> <span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_next</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1346" class="pln"><span class="n"><a href="#t1346">1346</a></span><span class="t">                            <span class="com"># Take the first and last value of the crossings, and append to tidal windows and critical cross-currents: restriction starts at time of first crossing and ends at time of last crossing</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1347" class="run"><span class="n"><a href="#t1347">1347</a></span><span class="t">                            <span class="nam">time</span> <span class="op">=</span> <span class="nam">next</span><span class="op">(</span><span class="nam">item</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">times</span> <span class="key">if</span> <span class="nam">item</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1348" class="run"><span class="n"><a href="#t1348">1348</a></span><span class="t">                            <span class="key">if</span> <span class="nam">time</span> <span class="op">&lt;</span> <span class="nam">t_ccur</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">index_previous_time</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1349" class="run"><span class="n"><a href="#t1349">1349</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">next</span><span class="op">(</span><span class="nam">item</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">times</span> <span class="key">if</span> <span class="nam">item</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">)</span><span class="op">,</span><span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1350" class="run"><span class="n"><a href="#t1350">1350</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1351" class="run"><span class="n"><a href="#t1351">1351</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">next</span><span class="op">(</span><span class="nam">item</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">reversed</span><span class="op">(</span><span class="nam">times</span><span class="op">)</span> <span class="key">if</span> <span class="nam">item</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">)</span><span class="op">,</span><span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1352" class="run"><span class="n"><a href="#t1352">1352</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1353" class="pln"><span class="n"><a href="#t1353">1353</a></span><span class="t">                            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1354" class="run"><span class="n"><a href="#t1354">1354</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">next</span><span class="op">(</span><span class="nam">item</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">times</span> <span class="key">if</span> <span class="nam">item</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">)</span><span class="op">,</span><span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1355" class="run"><span class="n"><a href="#t1355">1355</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1356" class="run"><span class="n"><a href="#t1356">1356</a></span><span class="t">                            <span class="key">if</span> <span class="nam">index_previous_time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span> <span class="com">#next_previous_time_tidal_periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1357" class="run"><span class="n"><a href="#t1357">1357</a></span><span class="t">                                <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1358" class="run"><span class="n"><a href="#t1358">1358</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1359" class="run"><span class="n"><a href="#t1359">1359</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1360" class="pln"><span class="n"><a href="#t1360">1360</a></span><span class="t">                                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1361" class="run"><span class="n"><a href="#t1361">1361</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span><span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1362" class="run"><span class="n"><a href="#t1362">1362</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1363" class="pln"><span class="n"><a href="#t1363">1363</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1364" class="pln"><span class="n"><a href="#t1364">1364</a></span><span class="t">                    <span class="com"># Else (flood tide is restricted and accessilibity of ebb tide is not limited to the slack waters) if there is current data within this tidal period</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1365" class="run"><span class="n"><a href="#t1365">1365</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1366" class="pln"><span class="n"><a href="#t1366">1366</a></span><span class="t">                        <span class="com"># If the maximum cross-current in the tidal period does not exceed the upper bound limit: append to list that restriction stops at the maximum cross-current, with the corresponding maximum cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1367" class="run"><span class="n"><a href="#t1367">1367</a></span><span class="t">                        <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;</span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1368" class="run"><span class="n"><a href="#t1368">1368</a></span><span class="t">                            <span class="key">if</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1369" class="run"><span class="n"><a href="#t1369">1369</a></span><span class="t">                                <span class="key">if</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1370" class="run"><span class="n"><a href="#t1370">1370</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">index_previous_time</span><span class="op">]</span><span class="op">,</span><span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1371" class="run"><span class="n"><a href="#t1371">1371</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1372" class="pln"><span class="n"><a href="#t1372">1372</a></span><span class="t">                                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1373" class="run"><span class="n"><a href="#t1373">1373</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">index_previous_time</span><span class="op">]</span><span class="op">,</span><span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1374" class="run"><span class="n"><a href="#t1374">1374</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1375" class="pln"><span class="n"><a href="#t1375">1375</a></span><span class="t">                            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1376" class="run"><span class="n"><a href="#t1376">1376</a></span><span class="t">                                <span class="key">if</span> <span class="nam">index_previous_time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span> <span class="com">#next_previous_time_tidal_periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1377" class="run"><span class="n"><a href="#t1377">1377</a></span><span class="t">                                    <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1378" class="mis show_mis"><span class="n"><a href="#t1378">1378</a></span><span class="t">                                        <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1379" class="mis show_mis"><span class="n"><a href="#t1379">1379</a></span><span class="t">                                        <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1380" class="pln"><span class="n"><a href="#t1380">1380</a></span><span class="t">                                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1381" class="run"><span class="n"><a href="#t1381">1381</a></span><span class="t">                                        <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1382" class="run"><span class="n"><a href="#t1382">1382</a></span><span class="t">                                        <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1383" class="pln"><span class="n"><a href="#t1383">1383</a></span><span class="t">                                    <span class="com">#horizontal_tidal_window.append([vessel.waiting_time_start, 'Stop'])</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1384" class="pln"><span class="n"><a href="#t1384">1384</a></span><span class="t">                                    <span class="com">#crit_vel_horizontal_tidal_window.append(0)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1385" class="pln"><span class="n"><a href="#t1385">1385</a></span><span class="t">                                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1386" class="mis show_mis"><span class="n"><a href="#t1386">1386</a></span><span class="t">                                    <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1387" class="mis show_mis"><span class="n"><a href="#t1387">1387</a></span><span class="t">                                        <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">]</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1388" class="mis show_mis"><span class="n"><a href="#t1388">1388</a></span><span class="t">                                        <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1389" class="pln"><span class="n"><a href="#t1389">1389</a></span><span class="t">                                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1390" class="mis show_mis"><span class="n"><a href="#t1390">1390</a></span><span class="t">                                        <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">]</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1391" class="mis show_mis"><span class="n"><a href="#t1391">1391</a></span><span class="t">                                        <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1392" class="pln"><span class="n"><a href="#t1392">1392</a></span><span class="t">                                    <span class="com">#horizontal_tidal_window.append([t_ccur[index_previous_time], 'Stop'])</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1393" class="pln"><span class="n"><a href="#t1393">1393</a></span><span class="t">                                    <span class="com">#crit_vel_horizontal_tidal_window.append(0)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1394" class="pln"><span class="n"><a href="#t1394">1394</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1395" class="pln"><span class="n"><a href="#t1395">1395</a></span><span class="t">                        <span class="com"># Limit the analysis to the tidal period from this time to the end of the period</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1396" class="run"><span class="n"><a href="#t1396">1396</a></span><span class="t">                        <span class="nam">index_previous_time2</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">index_previous_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1397" class="pln"><span class="n"><a href="#t1397">1397</a></span><span class="t">                        <span class="com"># If the maximum cross-current in the remainder of the tidal period does not exceed the lower bound limit and flood is accessible (crit-current is not 0 m/s and the ebb accessibility is not limited to the slack waters (critical cross-current is not 'min'): append to list that restriction starts at the minimum cross-current, with the corresponding minimum cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1398" class="run"><span class="n"><a href="#t1398">1398</a></span><span class="t">                        <span class="key">if</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time2</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">></span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'min'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1399" class="mis show_mis"><span class="n"><a href="#t1399">1399</a></span><span class="t">                            <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time2</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">index_previous_time2</span><span class="op">]</span><span class="op">,</span><span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1400" class="mis show_mis"><span class="n"><a href="#t1400">1400</a></span><span class="t">                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time2</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1401" class="pln"><span class="n"><a href="#t1401">1401</a></span><span class="t">                        <span class="com"># Else if the flood tide is not accessible and the accessibility of the ebb tide is not limited to the slack waters: only append the start time of the tidal window and the corresponding cross-current (= 0 m/s)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1402" class="run"><span class="n"><a href="#t1402">1402</a></span><span class="t">                        <span class="key">elif</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="str">'min'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1403" class="run"><span class="n"><a href="#t1403">1403</a></span><span class="t">                            <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">next_time</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1404" class="run"><span class="n"><a href="#t1404">1404</a></span><span class="t">                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1405" class="run"><span class="n"><a href="#t1405">1405</a></span><span class="t">                            <span class="key">if</span> <span class="nam">index_previous_time</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span> <span class="com">#next_previous_time_tidal_periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1406" class="run"><span class="n"><a href="#t1406">1406</a></span><span class="t">                                <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1407" class="run"><span class="n"><a href="#t1407">1407</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1408" class="run"><span class="n"><a href="#t1408">1408</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1409" class="pln"><span class="n"><a href="#t1409">1409</a></span><span class="t">                                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1410" class="run"><span class="n"><a href="#t1410">1410</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1411" class="run"><span class="n"><a href="#t1411">1411</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1412" class="run"><span class="n"><a href="#t1412">1412</a></span><span class="t">                            <span class="key">if</span> <span class="nam">next_previous_time_tidal_periods</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">times_tidal_periods</span><span class="op">)</span><span class="op">-</span><span class="num">2</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1413" class="run"><span class="n"><a href="#t1413">1413</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">next_time</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1414" class="run"><span class="n"><a href="#t1414">1414</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1415" class="pln"><span class="n"><a href="#t1415">1415</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1416" class="pln"><span class="n"><a href="#t1416">1416</a></span><span class="t">                        <span class="com"># Else if the accessibility of the ebb tide is limited to the slack waters: only append the start time of the tidal window and the corresponding cross-current (= critical cross-current during ebb)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1417" class="run"><span class="n"><a href="#t1417">1417</a></span><span class="t">                        <span class="key">elif</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="str">'min'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1418" class="pln"><span class="n"><a href="#t1418">1418</a></span><span class="t">                            <span class="com"># Interpolation of the maximum current velocities during this specific tidal period subtracted with the critical point-based cross-current for ebb tide and calculate the times at which the cross-current equals this critical limit</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1419" class="run"><span class="n"><a href="#t1419">1419</a></span><span class="t">                            <span class="nam">interp</span> <span class="op">=</span> <span class="nam">sc</span><span class="op">.</span><span class="nam">interpolate</span><span class="op">.</span><span class="nam">CubicSpline</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="nam">y</span> <span class="op">-</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1420" class="run"><span class="n"><a href="#t1420">1420</a></span><span class="t">                            <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">interp</span><span class="op">.</span><span class="nam">roots</span><span class="op">(</span><span class="op">)</span> <span class="key">if</span> <span class="op">(</span><span class="nam">x</span> <span class="op">>=</span> <span class="nam">previous_time</span> <span class="key">and</span> <span class="nam">x</span> <span class="op">&lt;=</span> <span class="nam">next_time</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1421" class="pln"><span class="n"><a href="#t1421">1421</a></span><span class="t">                            <span class="com"># If there are no crossings (minimum number of crossings should be at least two)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1422" class="run"><span class="n"><a href="#t1422">1422</a></span><span class="t">                            <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">times</span><span class="op">)</span> <span class="op">&lt;</span> <span class="num">1</span><span class="op">:</span> <span class="nam">times</span> <span class="op">=</span> <span class="op">[</span><span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">]</span><span class="op">,</span> <span class="nam">t_ccur</span><span class="op">[</span><span class="nam">index_next</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1423" class="pln"><span class="n"><a href="#t1423">1423</a></span><span class="t">                            <span class="com"># Take the first and last value of the crossings, and append to tidal windows and critical cross-currents: restriction starts at time of first crossing</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1424" class="run"><span class="n"><a href="#t1424">1424</a></span><span class="t">                            <span class="nam">time</span> <span class="op">=</span> <span class="nam">next</span><span class="op">(</span><span class="nam">item</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="nam">times</span> <span class="key">if</span> <span class="nam">item</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1425" class="run"><span class="n"><a href="#t1425">1425</a></span><span class="t">                            <span class="key">if</span> <span class="nam">time</span> <span class="op">&lt;</span> <span class="nam">t_ccur</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">:</span><span class="nam">index_next</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="nam">index_previous_time</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1426" class="run"><span class="n"><a href="#t1426">1426</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">time</span><span class="op">,</span><span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1427" class="run"><span class="n"><a href="#t1427">1427</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">p_tidal_periods</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1428" class="run"><span class="n"><a href="#t1428">1428</a></span><span class="t">                            <span class="key">if</span> <span class="nam">index_previous_time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span> <span class="com">#next_previous_time_tidal_periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1429" class="run"><span class="n"><a href="#t1429">1429</a></span><span class="t">                                <span class="key">if</span> <span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">)</span> <span class="key">or</span> <span class="op">(</span><span class="nam">mccur</span><span class="op">[</span><span class="nam">index_previous_time</span><span class="op">]</span> <span class="op">></span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1430" class="run"><span class="n"><a href="#t1430">1430</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1431" class="run"><span class="n"><a href="#t1431">1431</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1432" class="pln"><span class="n"><a href="#t1432">1432</a></span><span class="t">                                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1433" class="run"><span class="n"><a href="#t1433">1433</a></span><span class="t">                                    <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1434" class="run"><span class="n"><a href="#t1434">1434</a></span><span class="t">                                    <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1435" class="pln"><span class="n"><a href="#t1435">1435</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1436" class="run"><span class="n"><a href="#t1436">1436</a></span><span class="t">                        <span class="key">if</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">index_previous_time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1437" class="run"><span class="n"><a href="#t1437">1437</a></span><span class="t">                            <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1438" class="run"><span class="n"><a href="#t1438">1438</a></span><span class="t">                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1439" class="pln"><span class="n"><a href="#t1439">1439</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1440" class="run"><span class="n"><a href="#t1440">1440</a></span><span class="t">                        <span class="key">elif</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">next_tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">index_previous_time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1441" class="run"><span class="n"><a href="#t1441">1441</a></span><span class="t">                            <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1442" class="run"><span class="n"><a href="#t1442">1442</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1443" class="run"><span class="n"><a href="#t1443">1443</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1444" class="run"><span class="n"><a href="#t1444">1444</a></span><span class="t">                            <span class="key">elif</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">></span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1445" class="mis show_mis"><span class="n"><a href="#t1445">1445</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1446" class="mis show_mis"><span class="n"><a href="#t1446">1446</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1447" class="run"><span class="n"><a href="#t1447">1447</a></span><span class="t">                            <span class="key">elif</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index_now</span><span class="op">]</span> <span class="op">></span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">p_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1448" class="run"><span class="n"><a href="#t1448">1448</a></span><span class="t">                                <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1449" class="run"><span class="n"><a href="#t1449">1449</a></span><span class="t">                                <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1450" class="pln"><span class="n"><a href="#t1450">1450</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1451" class="pln"><span class="n"><a href="#t1451">1451</a></span><span class="t">                    <span class="com"># If none of the above applies and hence the regular cross-current velocity bounds (resulting from finding_current_velocity_bounds_point_based_method) apply:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1452" class="run"><span class="n"><a href="#t1452">1452</a></span><span class="t">                    <span class="key">if</span> <span class="nam">type</span><span class="op">(</span><span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="nam">str</span> <span class="key">and</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span> <span class="key">and</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1453" class="run"><span class="n"><a href="#t1453">1453</a></span><span class="t">                        <span class="key">for</span> <span class="nam">bound_index</span> <span class="key">in</span> <span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1454" class="run"><span class="n"><a href="#t1454">1454</a></span><span class="t">                            <span class="nam">bool_restriction</span> <span class="op">=</span> <span class="str">'Stop'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1455" class="run"><span class="n"><a href="#t1455">1455</a></span><span class="t">                            <span class="key">if</span> <span class="nam">bound_index</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span> <span class="nam">bool_restriction</span> <span class="op">=</span> <span class="str">'Start'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1456" class="run"><span class="n"><a href="#t1456">1456</a></span><span class="t">                            <span class="key">for</span> <span class="nam">root</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">roots_bounds_tidal_period</span><span class="op">[</span><span class="nam">bound_index</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1457" class="run"><span class="n"><a href="#t1457">1457</a></span><span class="t">                                <span class="key">if</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">>=</span> <span class="nam">start_time</span> <span class="key">and</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">stop_time</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1458" class="pln"><span class="n"><a href="#t1458">1458</a></span><span class="t">                                    <span class="com"># calculate the time index of the root</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1459" class="run"><span class="n"><a href="#t1459">1459</a></span><span class="t">                                    <span class="nam">index</span> <span class="op">=</span> <span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1460" class="pln"><span class="n"><a href="#t1460">1460</a></span><span class="t">                                    <span class="com"># if the index is greater than the length of the time series: index = -1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1461" class="run"><span class="n"><a href="#t1461">1461</a></span><span class="t">                                    <span class="key">if</span> <span class="nam">index</span> <span class="op">>=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">)</span><span class="op">:</span> <span class="nam">index</span> <span class="op">-=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1462" class="pln"><span class="n"><a href="#t1462">1462</a></span><span class="t">                                    <span class="com"># if the critical cross-current at the index is lower than the upper bound of the critical cross-current and is located in the flood tidal period and the accessibility during flood tide is not limited to the slack waters: append root (corrected for the sailing time) and the corresponding cross-current to the stopping times of the tidal restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1463" class="run"><span class="n"><a href="#t1463">1463</a></span><span class="t">                                    <span class="key">if</span> <span class="nam">mccur</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="nam">bound_index</span><span class="op">]</span> <span class="key">and</span> <span class="nam">t_ccur_tidal_periods_bounds_period</span><span class="op">[</span><span class="nam">bound_index</span><span class="op">]</span><span class="op">[</span><span class="nam">root</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="nam">next_tidal_period</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1464" class="run"><span class="n"><a href="#t1464">1464</a></span><span class="t">                                        <span class="key">if</span> <span class="nam">crit_ccur_tidal_periods</span><span class="op">[</span><span class="nam">tide_index</span><span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1465" class="run"><span class="n"><a href="#t1465">1465</a></span><span class="t">                                            <span class="nam">horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">root</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">bool_restriction</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1466" class="run"><span class="n"><a href="#t1466">1466</a></span><span class="t">                                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">crit_ccur_bound_tidal_period</span><span class="op">[</span><span class="nam">bound_index</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1467" class="pln"><span class="n"><a href="#t1467">1467</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1468" class="pln"><span class="n"><a href="#t1468">1468</a></span><span class="t">                    <span class="com">#Data appended to the lists, nothing has to be returned</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1469" class="run"><span class="n"><a href="#t1469">1469</a></span><span class="t">                    <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1470" class="pln"><span class="n"><a href="#t1470">1470</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1471" class="pln"><span class="n"><a href="#t1471">1471</a></span><span class="t">                <span class="com"># Predefining some parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1472" class="run"><span class="n"><a href="#t1472">1472</a></span><span class="t">                <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1473" class="run"><span class="n"><a href="#t1473">1473</a></span><span class="t">                <span class="nam">distance_to_next_node</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1474" class="run"><span class="n"><a href="#t1474">1474</a></span><span class="t">                <span class="nam">mccur_nodes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1475" class="run"><span class="n"><a href="#t1475">1475</a></span><span class="t">                <span class="nam">t_ccur</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1476" class="run"><span class="n"><a href="#t1476">1476</a></span><span class="t">                <span class="nam">max_ccur</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1477" class="run"><span class="n"><a href="#t1477">1477</a></span><span class="t">                <span class="nam">list_of_nodes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1478" class="run"><span class="n"><a href="#t1478">1478</a></span><span class="t">                <span class="nam">critcur_nodes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1479" class="run"><span class="n"><a href="#t1479">1479</a></span><span class="t">                <span class="nam">times_horizontal_tidal_windows</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1480" class="run"><span class="n"><a href="#t1480">1480</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_windows</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1481" class="run"><span class="n"><a href="#t1481">1481</a></span><span class="t">                <span class="nam">list_of_list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1482" class="run"><span class="n"><a href="#t1482">1482</a></span><span class="t">                <span class="nam">critical_cross_current_method_in_restrictions</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1483" class="run"><span class="n"><a href="#t1483">1483</a></span><span class="t">                <span class="nam">point_based_method_in_restrictions</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1484" class="run"><span class="n"><a href="#t1484">1484</a></span><span class="t">                <span class="nam">t_ccur_raw</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1485" class="pln"><span class="n"><a href="#t1485">1485</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1486" class="pln"><span class="n"><a href="#t1486">1486</a></span><span class="t">                <span class="com"># Start of calculation by looping over the nodes of the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1487" class="run"><span class="n"><a href="#t1487">1487</a></span><span class="t">                <span class="key">for</span> <span class="nam">nodes</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">route</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1488" class="pln"><span class="n"><a href="#t1488">1488</a></span><span class="t">                    <span class="com"># - if a correction for the sailing time should be applied: the total distance should be keep track of</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1489" class="run"><span class="n"><a href="#t1489">1489</a></span><span class="t">                    <span class="key">if</span> <span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1490" class="run"><span class="n"><a href="#t1490">1490</a></span><span class="t">                        <span class="key">if</span> <span class="str">'bound'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">vessel</span><span class="op">)</span><span class="op">:</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>  <span class="com"># to be removed later: should be part of the vessel generator in which the user should define the initial direction of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1491" class="pln"><span class="n"><a href="#t1491">1491</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1492" class="run"><span class="n"><a href="#t1492">1492</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_sailing_direction</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1493" class="pln"><span class="n"><a href="#t1493">1493</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1494" class="run"><span class="n"><a href="#t1494">1494</a></span><span class="t">                    <span class="key">if</span> <span class="nam">sailing_time_correction</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1495" class="run"><span class="n"><a href="#t1495">1495</a></span><span class="t">                        <span class="key">if</span> <span class="key">not</span> <span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1496" class="run"><span class="n"><a href="#t1496">1496</a></span><span class="t">                            <span class="nam">distance_to_next_node</span> <span class="op">+=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">'WGS84'</span><span class="op">)</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1497" class="pln"><span class="n"><a href="#t1497">1497</a></span><span class="t">                                                                                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1498" class="pln"><span class="n"><a href="#t1498">1498</a></span><span class="t">                                                                                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1499" class="pln"><span class="n"><a href="#t1499">1499</a></span><span class="t">                                                                                    <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1500" class="pln"><span class="n"><a href="#t1500">1500</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1501" class="pln"><span class="n"><a href="#t1501">1501</a></span><span class="t">                    <span class="com"># Sailing time is calculated by the distance of the route up to the specific node, divided by the sailing speed (if no correction for the sailing time should be applied: distance is always 0)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1502" class="run"><span class="n"><a href="#t1502">1502</a></span><span class="t">                    <span class="nam">sailing_time_to_next_node</span> <span class="op">=</span> <span class="nam">distance_to_next_node</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1503" class="pln"><span class="n"><a href="#t1503">1503</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1504" class="pln"><span class="n"><a href="#t1504">1504</a></span><span class="t">                    <span class="com"># If there is no horizontal tidal restriction at the specific node in the route: continue loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1505" class="run"><span class="n"><a href="#t1505">1505</a></span><span class="t">                    <span class="key">if</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span> <span class="op">==</span> <span class="op">{</span><span class="op">}</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1506" class="run"><span class="n"><a href="#t1506">1506</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1507" class="pln"><span class="n"><a href="#t1507">1507</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1508" class="pln"><span class="n"><a href="#t1508">1508</a></span><span class="t">                    <span class="com"># Else: importing some node specific data on the type and specifications of the horizontal tidal restriction and predefining some bools</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1509" class="run"><span class="n"><a href="#t1509">1509</a></span><span class="t">                    <span class="nam">types</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Type'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1510" class="run"><span class="n"><a href="#t1510">1510</a></span><span class="t">                    <span class="nam">specifications</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1511" class="pln"><span class="n"><a href="#t1511">1511</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1512" class="pln"><span class="n"><a href="#t1512">1512</a></span><span class="t">                    <span class="com"># Determine which restriction applies to vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1513" class="run"><span class="n"><a href="#t1513">1513</a></span><span class="t">                    <span class="nam">restriction_index</span><span class="op">,</span> <span class="nam">no_tidal_window</span> <span class="op">=</span> <span class="nam">tidal_window_restriction_determinator</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">types</span><span class="op">,</span> <span class="nam">specifications</span><span class="op">,</span> <span class="nam">nodes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1514" class="pln"><span class="n"><a href="#t1514">1514</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1515" class="pln"><span class="n"><a href="#t1515">1515</a></span><span class="t">                    <span class="com"># If no horizontal tidal window applies to vessel at the specific node: continue loop over nodes of the route of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1516" class="run"><span class="n"><a href="#t1516">1516</a></span><span class="t">                    <span class="key">if</span> <span class="nam">no_tidal_window</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1517" class="mis show_mis"><span class="n"><a href="#t1517">1517</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1518" class="pln"><span class="n"><a href="#t1518">1518</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1519" class="pln"><span class="n"><a href="#t1519">1519</a></span><span class="t">                    <span class="com"># Else if there applies a horizontal tidal window: continue tidal window calculation by predefining some parameters and importing critical cross-currents</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1520" class="run"><span class="n"><a href="#t1520">1520</a></span><span class="t">                    <span class="nam">ccur</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1521" class="run"><span class="n"><a href="#t1521">1521</a></span><span class="t">                    <span class="nam">crit_ccur</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1522" class="run"><span class="n"><a href="#t1522">1522</a></span><span class="t">                    <span class="nam">times_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1523" class="run"><span class="n"><a href="#t1523">1523</a></span><span class="t">                    <span class="nam">crit_vel_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1524" class="run"><span class="n"><a href="#t1524">1524</a></span><span class="t">                    <span class="nam">crit_ccur_flood_old</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1525" class="run"><span class="n"><a href="#t1525">1525</a></span><span class="t">                    <span class="nam">crit_ccur_ebb_old</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1526" class="pln"><span class="n"><a href="#t1526">1526</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1527" class="pln"><span class="n"><a href="#t1527">1527</a></span><span class="t">                    <span class="com"># Determination of the direction of the vessel and the nodes that the vessel passes by in order, in order to extract the correct data</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1528" class="run"><span class="n"><a href="#t1528">1528</a></span><span class="t">                    <span class="nam">restriction_on_route</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1529" class="pln"><span class="n"><a href="#t1529">1529</a></span><span class="t">                    <span class="com"># -if the calculation is requested to be performed for visualization purposes (no route, but for single node), then use the given direction of the specified vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1530" class="run"><span class="n"><a href="#t1530">1530</a></span><span class="t">                    <span class="key">if</span> <span class="nam">visualization_calculation</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1531" class="mis show_mis"><span class="n"><a href="#t1531">1531</a></span><span class="t">                        <span class="nam">restriction_on_route</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1532" class="mis show_mis"><span class="n"><a href="#t1532">1532</a></span><span class="t">                        <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">==</span> <span class="str">'inbound'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1533" class="mis show_mis"><span class="n"><a href="#t1533">1533</a></span><span class="t">                            <span class="nam">n1</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1534" class="mis show_mis"><span class="n"><a href="#t1534">1534</a></span><span class="t">                            <span class="nam">n2</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1535" class="mis show_mis"><span class="n"><a href="#t1535">1535</a></span><span class="t">                        <span class="key">elif</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">==</span> <span class="str">'outbound'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1536" class="mis show_mis"><span class="n"><a href="#t1536">1536</a></span><span class="t">                            <span class="nam">n2</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1537" class="mis show_mis"><span class="n"><a href="#t1537">1537</a></span><span class="t">                            <span class="nam">n1</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1538" class="pln"><span class="n"><a href="#t1538">1538</a></span><span class="t">                    <span class="com"># -else: select the nodes by the modelled direction of the vessel by nested looping over the nodes in the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1539" class="pln"><span class="n"><a href="#t1539">1539</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1540" class="run"><span class="n"><a href="#t1540">1540</a></span><span class="t">                        <span class="key">for</span> <span class="nam">n1</span> <span class="key">in</span> <span class="nam">route</span><span class="op">[</span><span class="op">:</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1541" class="run"><span class="n"><a href="#t1541">1541</a></span><span class="t">                            <span class="key">if</span> <span class="nam">n1</span> <span class="op">==</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1542" class="run"><span class="n"><a href="#t1542">1542</a></span><span class="t">                                <span class="key">for</span> <span class="nam">n2</span> <span class="key">in</span> <span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1543" class="run"><span class="n"><a href="#t1543">1543</a></span><span class="t">                                    <span class="key">if</span> <span class="nam">n2</span> <span class="op">==</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Horizontal tidal restriction'</span><span class="op">]</span><span class="op">[</span><span class="str">'Specification'</span><span class="op">]</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1544" class="run"><span class="n"><a href="#t1544">1544</a></span><span class="t">                                        <span class="nam">restriction_on_route</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1545" class="run"><span class="n"><a href="#t1545">1545</a></span><span class="t">                                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1546" class="run"><span class="n"><a href="#t1546">1546</a></span><span class="t">                                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1547" class="pln"><span class="n"><a href="#t1547">1547</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1548" class="pln"><span class="n"><a href="#t1548">1548</a></span><span class="t">                    <span class="com">#Determining critical cross-current limits based on critical cross-current limit input (potentially integers [-1,0] or strings) by subtracting it with vessel-specific cross-current (if applicable)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1549" class="pln"><span class="n"><a href="#t1549">1549</a></span><span class="t">                    <span class="com"># if passing the node during flood period is not restricted to the slack water (critical cross-current = type&lt;str> = 'min') or freely or never accessible, then import cricital cross-current for flood and subtract it with vessel-specific cross-current (if applicable)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1550" class="run"><span class="n"><a href="#t1550">1550</a></span><span class="t">                    <span class="key">if</span> <span class="nam">crit_ccur_flood_old</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span> <span class="key">and</span> <span class="nam">crit_ccur_flood_old</span> <span class="op">!=</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">type</span><span class="op">(</span><span class="nam">crit_ccur_flood_old</span><span class="op">)</span> <span class="op">!=</span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1551" class="run"><span class="n"><a href="#t1551">1551</a></span><span class="t">                        <span class="nam">crit_ccur_flood</span> <span class="op">=</span> <span class="nam">crit_ccur_flood_old</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_cross_current'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1552" class="pln"><span class="n"><a href="#t1552">1552</a></span><span class="t">                    <span class="com"># else if flood is freely accessible: set critical cross-current for flood at the very high level of 10 m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1553" class="run"><span class="n"><a href="#t1553">1553</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">crit_ccur_flood_old</span> <span class="op">==</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1554" class="run"><span class="n"><a href="#t1554">1554</a></span><span class="t">                        <span class="nam">crit_ccur_flood</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1555" class="run"><span class="n"><a href="#t1555">1555</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">crit_ccur_flood_old</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1556" class="run"><span class="n"><a href="#t1556">1556</a></span><span class="t">                        <span class="nam">crit_ccur_flood</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1557" class="pln"><span class="n"><a href="#t1557">1557</a></span><span class="t">                    <span class="com"># if passing the node during ebb period is not restricted to the slack water (critical cross-current = type&lt;str> = 'min') or freely or never accessible, then import cricital cross-current for ebb and subtract it with vessel-specific cross-current (if applicable)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1558" class="run"><span class="n"><a href="#t1558">1558</a></span><span class="t">                    <span class="key">if</span> <span class="nam">crit_ccur_ebb_old</span> <span class="op">!=</span> <span class="op">-</span><span class="num">1</span> <span class="key">and</span> <span class="nam">crit_ccur_ebb_old</span> <span class="op">!=</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">type</span><span class="op">(</span><span class="nam">crit_ccur_ebb_old</span><span class="op">)</span> <span class="op">!=</span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1559" class="run"><span class="n"><a href="#t1559">1559</a></span><span class="t">                        <span class="nam">crit_ccur_ebb</span> <span class="op">=</span> <span class="nam">crit_ccur_ebb_old</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_cross_current'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1560" class="pln"><span class="n"><a href="#t1560">1560</a></span><span class="t">                    <span class="com"># else if flood is freely accessible: set critical cross-current for ebb at the very high level of 10 m/s</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1561" class="run"><span class="n"><a href="#t1561">1561</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">crit_ccur_ebb_old</span> <span class="op">==</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1562" class="run"><span class="n"><a href="#t1562">1562</a></span><span class="t">                        <span class="nam">crit_ccur_ebb</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1563" class="run"><span class="n"><a href="#t1563">1563</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">crit_ccur_ebb_old</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1564" class="run"><span class="n"><a href="#t1564">1564</a></span><span class="t">                        <span class="nam">crit_ccur_ebb</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1565" class="pln"><span class="n"><a href="#t1565">1565</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1566" class="pln"><span class="n"><a href="#t1566">1566</a></span><span class="t">                    <span class="com">#Import and store data</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1567" class="run"><span class="n"><a href="#t1567">1567</a></span><span class="t">                    <span class="key">if</span> <span class="nam">types</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Critical cross-current'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1568" class="mis show_mis"><span class="n"><a href="#t1568">1568</a></span><span class="t">                        <span class="nam">critical_cross_current_method_in_restrictions</span><span class="op">,</span><span class="nam">_</span><span class="op">,</span><span class="nam">t_ccur</span><span class="op">,</span><span class="nam">mccur</span><span class="op">,</span><span class="nam">critcur</span><span class="op">,</span><span class="nam">_</span><span class="op">,</span><span class="nam">_</span> <span class="op">=</span> <span class="nam">calculate_and_store_normative_current_velocity_data</span><span class="op">(</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="nam">n1</span><span class="op">,</span><span class="nam">n2</span><span class="op">]</span><span class="op">,</span><span class="nam">sailing_time_to_next_node</span><span class="op">,</span><span class="nam">t_ccur_raw</span><span class="op">,</span><span class="nam">ccur</span><span class="op">,</span><span class="nam">critcur_nodes</span><span class="op">,</span><span class="nam">mccur_nodes</span><span class="op">,</span><span class="str">'Critical cross-current'</span><span class="op">,</span><span class="nam">crit_ccur</span><span class="op">,</span><span class="nam">crit_ccur_flood</span><span class="op">,</span><span class="nam">crit_ccur_ebb</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1569" class="pln"><span class="n"><a href="#t1569">1569</a></span><span class="t">                        <span class="com"># If a plot is requested, then plot the cross-current velocities and the corresponding critical cross-currents</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1570" class="mis show_mis"><span class="n"><a href="#t1570">1570</a></span><span class="t">                        <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1571" class="mis show_mis"><span class="n"><a href="#t1571">1571</a></span><span class="t">                            <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="op">[</span><span class="nam">y</span> <span class="op">+</span> <span class="nam">critcur</span><span class="op">[</span><span class="nam">x</span><span class="op">]</span> <span class="key">for</span> <span class="nam">x</span><span class="op">,</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">mccur</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'lightcoral'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.4</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1572" class="mis show_mis"><span class="n"><a href="#t1572">1572</a></span><span class="t">                            <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="op">[</span><span class="nam">y</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">!=</span> <span class="num">10</span> <span class="key">else</span> <span class="key">None</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">critcur</span><span class="op">]</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'lightcoral'</span><span class="op">,</span> <span class="nam">linestyle</span><span class="op">=</span><span class="str">'--'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.4</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1573" class="pln"><span class="n"><a href="#t1573">1573</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1574" class="run"><span class="n"><a href="#t1574">1574</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">types</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Point-based'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1575" class="run"><span class="n"><a href="#t1575">1575</a></span><span class="t">                        <span class="nam">_</span><span class="op">,</span><span class="nam">point_based_method_in_restrictions</span><span class="op">,</span><span class="nam">t_ccur</span><span class="op">,</span><span class="nam">mccur</span><span class="op">,</span><span class="nam">critcur</span><span class="op">,</span><span class="nam">times_tidal_periods</span><span class="op">,</span><span class="nam">tidal_periods</span> <span class="op">=</span> <span class="nam">calculate_and_store_normative_current_velocity_data</span><span class="op">(</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="nam">n1</span><span class="op">,</span><span class="nam">n2</span><span class="op">]</span><span class="op">,</span><span class="nam">sailing_time_to_next_node</span><span class="op">,</span><span class="nam">t_ccur_raw</span><span class="op">,</span><span class="nam">ccur</span><span class="op">,</span><span class="nam">critcur_nodes</span><span class="op">,</span><span class="nam">mccur_nodes</span><span class="op">,</span><span class="str">'Point-based'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1576" class="pln"><span class="n"><a href="#t1576">1576</a></span><span class="t">                        <span class="com"># Setting some default parameters and lists and importing some information about the range outside the point of entry of vessels</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1577" class="run"><span class="n"><a href="#t1577">1577</a></span><span class="t">                        <span class="nam">p_flood</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1578" class="run"><span class="n"><a href="#t1578">1578</a></span><span class="t">                        <span class="nam">p_ebb</span> <span class="op">=</span> <span class="nam">types</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="nam">restriction_index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1579" class="pln"><span class="n"><a href="#t1579">1579</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1580" class="pln"><span class="n"><a href="#t1580">1580</a></span><span class="t">                        <span class="com"># if passing the node during flood period is not restricted to the slack water (critical cross-current = type&lt;str> = 'min')</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1581" class="run"><span class="n"><a href="#t1581">1581</a></span><span class="t">                        <span class="key">if</span> <span class="nam">type</span><span class="op">(</span><span class="nam">crit_ccur_flood_old</span><span class="op">)</span> <span class="op">!=</span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1582" class="pln"><span class="n"><a href="#t1582">1582</a></span><span class="t">                            <span class="com"># Interpolate the interpolated cross-current velocity, corrected for the sailing time, subtracted with the critical cross-current for the upper and lower bound separately and calculate roots, and corresponding next tidal periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1583" class="run"><span class="n"><a href="#t1583">1583</a></span><span class="t">                            <span class="op">[</span><span class="nam">crit_ccur_upper_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1584" class="pln"><span class="n"><a href="#t1584">1584</a></span><span class="t">                             <span class="nam">crit_ccur_lower_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1585" class="pln"><span class="n"><a href="#t1585">1585</a></span><span class="t">                             <span class="nam">roots_upper_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1586" class="pln"><span class="n"><a href="#t1586">1586</a></span><span class="t">                             <span class="nam">roots_lower_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1587" class="pln"><span class="n"><a href="#t1587">1587</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_upper_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1588" class="pln"><span class="n"><a href="#t1588">1588</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_lower_bound_flood</span><span class="op">]</span> <span class="op">=</span> <span class="nam">finding_current_velocity_bounds_point_based_method</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">mccur</span><span class="op">,</span> <span class="nam">p_flood</span><span class="op">,</span> <span class="nam">crit_ccur_flood</span><span class="op">,</span> <span class="nam">times_tidal_periods</span><span class="op">,</span> <span class="nam">tidal_periods</span><span class="op">,</span> <span class="nam">sailing_time_to_next_node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1589" class="pln"><span class="n"><a href="#t1589">1589</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1590" class="run"><span class="n"><a href="#t1590">1590</a></span><span class="t">                            <span class="op">[</span><span class="nam">crit_ccur_upper_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1591" class="pln"><span class="n"><a href="#t1591">1591</a></span><span class="t">                             <span class="nam">crit_ccur_lower_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1592" class="pln"><span class="n"><a href="#t1592">1592</a></span><span class="t">                             <span class="nam">roots_upper_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1593" class="pln"><span class="n"><a href="#t1593">1593</a></span><span class="t">                             <span class="nam">roots_lower_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1594" class="pln"><span class="n"><a href="#t1594">1594</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_upper_bound_flood</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1595" class="pln"><span class="n"><a href="#t1595">1595</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_lower_bound_flood</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">crit_ccur_flood_old</span><span class="op">,</span><span class="nam">crit_ccur_flood_old</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1596" class="run"><span class="n"><a href="#t1596">1596</a></span><span class="t">                            <span class="nam">crit_ccur_flood</span> <span class="op">=</span> <span class="nam">crit_ccur_upper_bound_flood</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1597" class="pln"><span class="n"><a href="#t1597">1597</a></span><span class="t">                        <span class="com"># if passing the node during ebb period is not restricted to the slack water (critical cross-current = type&lt;str> = 'min')</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1598" class="run"><span class="n"><a href="#t1598">1598</a></span><span class="t">                        <span class="key">if</span> <span class="nam">type</span><span class="op">(</span><span class="nam">crit_ccur_ebb_old</span><span class="op">)</span> <span class="op">!=</span> <span class="nam">str</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1599" class="pln"><span class="n"><a href="#t1599">1599</a></span><span class="t">                            <span class="com"># Interpolate the interpolated cross-current velocity, corrected for the sailing time, subtracted with the critical cross-current for the upper and lower bound separately and calculate roots, and corresponding next tidal periods</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1600" class="run"><span class="n"><a href="#t1600">1600</a></span><span class="t">                            <span class="op">[</span><span class="nam">crit_ccur_upper_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1601" class="pln"><span class="n"><a href="#t1601">1601</a></span><span class="t">                             <span class="nam">crit_ccur_lower_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1602" class="pln"><span class="n"><a href="#t1602">1602</a></span><span class="t">                             <span class="nam">roots_upper_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1603" class="pln"><span class="n"><a href="#t1603">1603</a></span><span class="t">                             <span class="nam">roots_lower_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1604" class="pln"><span class="n"><a href="#t1604">1604</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_upper_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1605" class="pln"><span class="n"><a href="#t1605">1605</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_lower_bound_ebb</span><span class="op">]</span> <span class="op">=</span> <span class="nam">finding_current_velocity_bounds_point_based_method</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">mccur</span><span class="op">,</span> <span class="nam">p_ebb</span><span class="op">,</span> <span class="nam">crit_ccur_ebb</span><span class="op">,</span> <span class="nam">times_tidal_periods</span><span class="op">,</span> <span class="nam">tidal_periods</span><span class="op">,</span><span class="nam">sailing_time_to_next_node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1606" class="pln"><span class="n"><a href="#t1606">1606</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1607" class="run"><span class="n"><a href="#t1607">1607</a></span><span class="t">                            <span class="op">[</span><span class="nam">crit_ccur_upper_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1608" class="pln"><span class="n"><a href="#t1608">1608</a></span><span class="t">                             <span class="nam">crit_ccur_lower_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1609" class="pln"><span class="n"><a href="#t1609">1609</a></span><span class="t">                             <span class="nam">roots_upper_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1610" class="pln"><span class="n"><a href="#t1610">1610</a></span><span class="t">                             <span class="nam">roots_lower_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1611" class="pln"><span class="n"><a href="#t1611">1611</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_upper_bound_ebb</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1612" class="pln"><span class="n"><a href="#t1612">1612</a></span><span class="t">                             <span class="nam">t_ccur_tidal_periods_lower_bound_ebb</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">crit_ccur_ebb_old</span><span class="op">,</span><span class="nam">crit_ccur_ebb_old</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1613" class="run"><span class="n"><a href="#t1613">1613</a></span><span class="t">                            <span class="nam">crit_ccur_ebb</span> <span class="op">=</span> <span class="nam">crit_ccur_upper_bound_ebb</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1614" class="pln"><span class="n"><a href="#t1614">1614</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1615" class="pln"><span class="n"><a href="#t1615">1615</a></span><span class="t">                        <span class="com">#Setting a a default starting time for the tidal period and looping over each tidal period to determine whether there are special cases (special restrictions or currents within tidal periods that do not reach the lower and/or upper bound)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1616" class="run"><span class="n"><a href="#t1616">1616</a></span><span class="t">                        <span class="nam">previous_time</span> <span class="op">=</span> <span class="nam">t_ccur</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1617" class="run"><span class="n"><a href="#t1617">1617</a></span><span class="t">                        <span class="key">for</span> <span class="nam">period</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">times_tidal_periods</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1618" class="pln"><span class="n"><a href="#t1618">1618</a></span><span class="t">                            <span class="com">#If next tidal period is ebb, hence current tidal period is flood:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1619" class="run"><span class="n"><a href="#t1619">1619</a></span><span class="t">                            <span class="key">if</span> <span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Ebb Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1620" class="run"><span class="n"><a href="#t1620">1620</a></span><span class="t">                                <span class="nam">calculate_and_append_individual_horizontal_tidal_windows_point_based_method</span><span class="op">(</span><span class="nam">previous_time</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1621" class="pln"><span class="n"><a href="#t1621">1621</a></span><span class="t">                                                                                                            <span class="nam">period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1622" class="pln"><span class="n"><a href="#t1622">1622</a></span><span class="t">                                                                                                            <span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1623" class="pln"><span class="n"><a href="#t1623">1623</a></span><span class="t">                                                                                                            <span class="nam">sailing_time_to_next_node</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1624" class="pln"><span class="n"><a href="#t1624">1624</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">crit_ccur_upper_bound_flood</span><span class="op">,</span><span class="nam">crit_ccur_lower_bound_flood</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1625" class="pln"><span class="n"><a href="#t1625">1625</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">roots_upper_bound_flood</span><span class="op">,</span><span class="nam">roots_lower_bound_flood</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1626" class="pln"><span class="n"><a href="#t1626">1626</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">t_ccur_tidal_periods_upper_bound_flood</span><span class="op">,</span><span class="nam">t_ccur_tidal_periods_lower_bound_flood</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1627" class="pln"><span class="n"><a href="#t1627">1627</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">crit_ccur_flood</span><span class="op">,</span><span class="nam">crit_ccur_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1628" class="pln"><span class="n"><a href="#t1628">1628</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">p_flood</span><span class="op">,</span><span class="nam">p_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1629" class="pln"><span class="n"><a href="#t1629">1629</a></span><span class="t">                                                                                                            <span class="nam">t_ccur</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1630" class="pln"><span class="n"><a href="#t1630">1630</a></span><span class="t">                                                                                                            <span class="nam">mccur</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1631" class="pln"><span class="n"><a href="#t1631">1631</a></span><span class="t">                                                                                                            <span class="nam">times_horizontal_tidal_window</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1632" class="pln"><span class="n"><a href="#t1632">1632</a></span><span class="t">                                                                                                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1633" class="pln"><span class="n"><a href="#t1633">1633</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1634" class="pln"><span class="n"><a href="#t1634">1634</a></span><span class="t">                            <span class="com"># Else if next tidal period is flood, hence current tidal period is ebb:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1635" class="run"><span class="n"><a href="#t1635">1635</a></span><span class="t">                            <span class="key">elif</span> <span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Flood Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1636" class="run"><span class="n"><a href="#t1636">1636</a></span><span class="t">                                <span class="nam">calculate_and_append_individual_horizontal_tidal_windows_point_based_method</span><span class="op">(</span><span class="nam">previous_time</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1637" class="pln"><span class="n"><a href="#t1637">1637</a></span><span class="t">                                                                                                            <span class="nam">period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1638" class="pln"><span class="n"><a href="#t1638">1638</a></span><span class="t">                                                                                                            <span class="nam">tidal_periods</span><span class="op">[</span><span class="nam">period</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1639" class="pln"><span class="n"><a href="#t1639">1639</a></span><span class="t">                                                                                                            <span class="nam">sailing_time_to_next_node</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1640" class="pln"><span class="n"><a href="#t1640">1640</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">crit_ccur_upper_bound_ebb</span><span class="op">,</span><span class="nam">crit_ccur_lower_bound_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1641" class="pln"><span class="n"><a href="#t1641">1641</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">roots_upper_bound_ebb</span><span class="op">,</span><span class="nam">roots_lower_bound_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1642" class="pln"><span class="n"><a href="#t1642">1642</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">t_ccur_tidal_periods_upper_bound_ebb</span><span class="op">,</span><span class="nam">t_ccur_tidal_periods_lower_bound_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1643" class="pln"><span class="n"><a href="#t1643">1643</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">crit_ccur_flood</span><span class="op">,</span><span class="nam">crit_ccur_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1644" class="pln"><span class="n"><a href="#t1644">1644</a></span><span class="t">                                                                                                            <span class="op">[</span><span class="nam">p_flood</span><span class="op">,</span><span class="nam">p_ebb</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1645" class="pln"><span class="n"><a href="#t1645">1645</a></span><span class="t">                                                                                                            <span class="nam">t_ccur</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1646" class="pln"><span class="n"><a href="#t1646">1646</a></span><span class="t">                                                                                                            <span class="nam">mccur</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1647" class="pln"><span class="n"><a href="#t1647">1647</a></span><span class="t">                                                                                                            <span class="nam">times_horizontal_tidal_window</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1648" class="pln"><span class="n"><a href="#t1648">1648</a></span><span class="t">                                                                                                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1649" class="pln"><span class="n"><a href="#t1649">1649</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1650" class="pln"><span class="n"><a href="#t1650">1650</a></span><span class="t">                            <span class="com"># Setting new starting time for the tidal period equalling the end time of the previous tidal period</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1651" class="run"><span class="n"><a href="#t1651">1651</a></span><span class="t">                            <span class="nam">previous_time</span> <span class="op">=</span> <span class="nam">period</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1652" class="pln"><span class="n"><a href="#t1652">1652</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1653" class="pln"><span class="n"><a href="#t1653">1653</a></span><span class="t">                        <span class="com"># Combine the lists for the restrictions and corresponding critical cross-currents and sort on the starting and stopping times of the restrictions</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1654" class="run"><span class="n"><a href="#t1654">1654</a></span><span class="t">                        <span class="nam">zipped_lists</span> <span class="op">=</span> <span class="nam">zip</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1655" class="run"><span class="n"><a href="#t1655">1655</a></span><span class="t">                        <span class="nam">sorted_pairs</span> <span class="op">=</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zipped_lists</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1656" class="run"><span class="n"><a href="#t1656">1656</a></span><span class="t">                        <span class="nam">tuples</span> <span class="op">=</span> <span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">sorted_pairs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1657" class="run"><span class="n"><a href="#t1657">1657</a></span><span class="t">                        <span class="nam">times_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">crit_vel_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="nam">list</span><span class="op">(</span><span class="nam">tuple</span><span class="op">)</span> <span class="key">for</span> <span class="nam">tuple</span> <span class="key">in</span> <span class="nam">tuples</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1658" class="pln"><span class="n"><a href="#t1658">1658</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1659" class="pln"><span class="n"><a href="#t1659">1659</a></span><span class="t">                        <span class="com"># Set a default list of indexes in the restrictions list that should be removed based on the following conditions by looping over all the times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1660" class="run"><span class="n"><a href="#t1660">1660</a></span><span class="t">                        <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1661" class="run"><span class="n"><a href="#t1661">1661</a></span><span class="t">                        <span class="key">for</span> <span class="nam">time</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1662" class="pln"><span class="n"><a href="#t1662">1662</a></span><span class="t">                            <span class="com"># Skip the first index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1663" class="run"><span class="n"><a href="#t1663">1663</a></span><span class="t">                            <span class="key">if</span> <span class="nam">time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1664" class="run"><span class="n"><a href="#t1664">1664</a></span><span class="t">                                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1665" class="pln"><span class="n"><a href="#t1665">1665</a></span><span class="t">                            <span class="com"># If there are two stopping restrictions in sequence in the list, add the index of the previous stopping time of the restriction to the list of indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1666" class="run"><span class="n"><a href="#t1666">1666</a></span><span class="t">                            <span class="key">elif</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1667" class="run"><span class="n"><a href="#t1667">1667</a></span><span class="t">                                <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1668" class="pln"><span class="n"><a href="#t1668">1668</a></span><span class="t">                            <span class="com"># If there are two starting restrictions in sequence in the list, add the index of the next starting time of the restriction to the list of indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1669" class="run"><span class="n"><a href="#t1669">1669</a></span><span class="t">                            <span class="key">elif</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1670" class="run"><span class="n"><a href="#t1670">1670</a></span><span class="t">                                <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1671" class="pln"><span class="n"><a href="#t1671">1671</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1672" class="pln"><span class="n"><a href="#t1672">1672</a></span><span class="t">                        <span class="com"># Remove the indexes in the list of the restrictions and corresponding cross-currents</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1673" class="run"><span class="n"><a href="#t1673">1673</a></span><span class="t">                        <span class="key">for</span> <span class="nam">remove_index</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">reversed</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1674" class="run"><span class="n"><a href="#t1674">1674</a></span><span class="t">                            <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1675" class="run"><span class="n"><a href="#t1675">1675</a></span><span class="t">                            <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1676" class="pln"><span class="n"><a href="#t1676">1676</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1677" class="pln"><span class="n"><a href="#t1677">1677</a></span><span class="t">                        <span class="com"># Add the horizontal tidal window to the list of all horizontal tidal windows along the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1678" class="run"><span class="n"><a href="#t1678">1678</a></span><span class="t">                        <span class="nam">times_horizontal_tidal_windows</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1679" class="run"><span class="n"><a href="#t1679">1679</a></span><span class="t">                        <span class="nam">crit_ccurs_horizontal_tidal_windows</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1680" class="run"><span class="n"><a href="#t1680">1680</a></span><span class="t">                        <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">ones</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1681" class="pln"><span class="n"><a href="#t1681">1681</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1682" class="pln"><span class="n"><a href="#t1682">1682</a></span><span class="t">                        <span class="com"># If a plot is requested: plot the maximum cross-currents and the critical point-based cross-currents</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1683" class="run"><span class="n"><a href="#t1683">1683</a></span><span class="t">                        <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1684" class="mis show_mis"><span class="n"><a href="#t1684">1684</a></span><span class="t">                            <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="op">[</span><span class="nam">y</span> <span class="key">for</span> <span class="nam">x</span><span class="op">,</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">mccur</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'rosybrown'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1685" class="mis show_mis"><span class="n"><a href="#t1685">1685</a></span><span class="t">                            <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">x</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">]</span><span class="op">,</span> <span class="nam">crit_vel_horizontal_tidal_window</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">'sienna'</span><span class="op">,</span> <span class="nam">marker</span><span class="op">=</span><span class="str">'o'</span><span class="op">,</span> <span class="nam">linestyle</span><span class="op">=</span><span class="str">'None'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1686" class="pln"><span class="n"><a href="#t1686">1686</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1687" class="pln"><span class="n"><a href="#t1687">1687</a></span><span class="t">                <span class="com"># Pick the maximum cross-current and cross-current limits of all the tidal restrictions</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1688" class="run"><span class="n"><a href="#t1688">1688</a></span><span class="t">                <span class="nam">max_ccur</span> <span class="op">=</span> <span class="op">[</span><span class="nam">max</span><span class="op">(</span><span class="nam">idx</span><span class="op">)</span> <span class="key">for</span> <span class="nam">idx</span> <span class="key">in</span> <span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">mccur_nodes</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1689" class="run"><span class="n"><a href="#t1689">1689</a></span><span class="t">                <span class="nam">max_critcur</span> <span class="op">=</span> <span class="op">[</span><span class="nam">critcur_nodes</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmax</span><span class="op">(</span><span class="nam">val</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="nam">idx</span><span class="op">]</span> <span class="key">for</span> <span class="nam">idx</span><span class="op">,</span> <span class="nam">val</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="op">*</span><span class="nam">mccur_nodes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1690" class="pln"><span class="n"><a href="#t1690">1690</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1691" class="run"><span class="n"><a href="#t1691">1691</a></span><span class="t">                <span class="key">if</span> <span class="nam">critical_cross_current_method_in_restrictions</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1692" class="mis show_mis"><span class="n"><a href="#t1692">1692</a></span><span class="t">                    <span class="op">[</span><span class="nam">times_horizontal_tidal_window</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1693" class="pln"><span class="n"><a href="#t1693">1693</a></span><span class="t">                     <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">]</span> <span class="op">=</span> <span class="nam">calculate_and_append_individual_horizontal_tidal_windows_critical_cross_current_method</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span><span class="nam">max_ccur</span><span class="op">,</span><span class="nam">max_critcur</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1694" class="mis show_mis"><span class="n"><a href="#t1694">1694</a></span><span class="t">                    <span class="nam">times_horizontal_tidal_windows</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1695" class="mis show_mis"><span class="n"><a href="#t1695">1695</a></span><span class="t">                    <span class="nam">crit_ccurs_horizontal_tidal_windows</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1696" class="mis show_mis"><span class="n"><a href="#t1696">1696</a></span><span class="t">                    <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">zeros</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1697" class="pln"><span class="n"><a href="#t1697">1697</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1698" class="pln"><span class="n"><a href="#t1698">1698</a></span><span class="t">                <span class="com"># If a plot is requested and the list of maximum cross-current limits is not empty: plot these maximum cross-currents except for when the tidal period is fully accessible (cross-current limit was set to 10 m/s)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1699" class="run"><span class="n"><a href="#t1699">1699</a></span><span class="t">                <span class="key">if</span> <span class="nam">plot</span> <span class="key">and</span> <span class="nam">max_critcur</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1700" class="mis show_mis"><span class="n"><a href="#t1700">1700</a></span><span class="t">                    <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="op">[</span><span class="nam">y</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">!=</span> <span class="num">10</span> <span class="key">else</span> <span class="key">None</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">max_critcur</span><span class="op">]</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'lightcoral'</span><span class="op">,</span> <span class="nam">alpha</span><span class="op">=</span><span class="num">0.4</span><span class="op">,</span><span class="nam">linestyle</span><span class="op">=</span><span class="str">'--'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1701" class="pln"><span class="n"><a href="#t1701">1701</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1702" class="pln"><span class="n"><a href="#t1702">1702</a></span><span class="t">                <span class="com"># Return the modified time series for the cross-currents, critical cross-currents and if applicable the calculated horizontal tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1703" class="run"><span class="n"><a href="#t1703">1703</a></span><span class="t">                <span class="key">return</span> <span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">max_ccur</span><span class="op">,</span> <span class="nam">max_critcur</span><span class="op">,</span> <span class="nam">times_horizontal_tidal_windows</span><span class="op">,</span> <span class="nam">crit_ccurs_horizontal_tidal_windows</span><span class="op">,</span> <span class="nam">list_of_list_indexes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1704" class="pln"><span class="n"><a href="#t1704">1704</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1705" class="pln"><span class="n"><a href="#t1705">1705</a></span><span class="t">            <span class="com">#Continuation of the calculation by defining the network</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1706" class="run"><span class="n"><a href="#t1706">1706</a></span><span class="t">            <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1707" class="pln"><span class="n"><a href="#t1707">1707</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1708" class="pln"><span class="n"><a href="#t1708">1708</a></span><span class="t">            <span class="com"># Calculate the maximum current-velocity at each node of the route in order to set the y-lim of the plot properly</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1709" class="run"><span class="n"><a href="#t1709">1709</a></span><span class="t">            <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1710" class="mis show_mis"><span class="n"><a href="#t1710">1710</a></span><span class="t">                <span class="nam">max_cur</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1711" class="mis show_mis"><span class="n"><a href="#t1711">1711</a></span><span class="t">                <span class="key">for</span> <span class="nam">node</span> <span class="key">in</span> <span class="nam">route</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1712" class="mis show_mis"><span class="n"><a href="#t1712">1712</a></span><span class="t">                    <span class="nam">max_cur</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Info'</span><span class="op">]</span><span class="op">[</span><span class="str">'Current velocity'</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1713" class="pln"><span class="n"><a href="#t1713">1713</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1714" class="pln"><span class="n"><a href="#t1714">1714</a></span><span class="t">            <span class="com"># Set some default parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1715" class="run"><span class="n"><a href="#t1715">1715</a></span><span class="t">            <span class="nam">times_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1716" class="run"><span class="n"><a href="#t1716">1716</a></span><span class="t">            <span class="nam">crit_ccurs_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1717" class="run"><span class="n"><a href="#t1717">1717</a></span><span class="t">            <span class="nam">list_of_list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1718" class="run"><span class="n"><a href="#t1718">1718</a></span><span class="t">            <span class="nam">list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1719" class="pln"><span class="n"><a href="#t1719">1719</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1720" class="pln"><span class="n"><a href="#t1720">1720</a></span><span class="t">            <span class="com"># Determine the data of the governing horizontal tidal restriction (critical cross-current method) and/or the governing horizontal tidal restriction (point-based method)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1721" class="run"><span class="n"><a href="#t1721">1721</a></span><span class="t">            <span class="op">[</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">max_ccur</span><span class="op">,</span> <span class="nam">max_crit_ccur</span><span class="op">,</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">list_of_list_indexes</span><span class="op">]</span> <span class="op">=</span> <span class="nam">tidal_windows_tightest_current_restriction_along_route</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">axis</span><span class="op">,</span> <span class="nam">plot</span><span class="op">,</span> <span class="nam">sailing_time_correction</span><span class="op">,</span> <span class="nam">visualization_calculation</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1722" class="pln"><span class="n"><a href="#t1722">1722</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1723" class="pln"><span class="n"><a href="#t1723">1723</a></span><span class="t">            <span class="com"># If the list of tidal windows are still empty: there is no horizontal tidal restriction for the particular vessel, so restriction stops at t_start and ends at t_end of the simulation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1724" class="run"><span class="n"><a href="#t1724">1724</a></span><span class="t">            <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1725" class="mis show_mis"><span class="n"><a href="#t1725">1725</a></span><span class="t">                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1726" class="mis show_mis"><span class="n"><a href="#t1726">1726</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1727" class="mis show_mis"><span class="n"><a href="#t1727">1727</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>  <span class="com"># integer = 0 meaning that the restriction is of type critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1728" class="mis show_mis"><span class="n"><a href="#t1728">1728</a></span><span class="t">                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">)</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1729" class="mis show_mis"><span class="n"><a href="#t1729">1729</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1730" class="mis show_mis"><span class="n"><a href="#t1730">1730</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>  <span class="com"># integer = 0 meaning that the restriction is of type critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1731" class="pln"><span class="n"><a href="#t1731">1731</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1732" class="pln"><span class="n"><a href="#t1732">1732</a></span><span class="t">            <span class="com"># Combine the list of the horizontal tidal windows and the restriction types and critical cross-currents respectively and sort it chronologically</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1733" class="run"><span class="n"><a href="#t1733">1733</a></span><span class="t">            <span class="nam">list_of_list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span> <span class="key">for</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">list_of_list_indexes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1734" class="run"><span class="n"><a href="#t1734">1734</a></span><span class="t">            <span class="nam">crit_ccurs_horizontal_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span> <span class="key">for</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">,</span> <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1735" class="run"><span class="n"><a href="#t1735">1735</a></span><span class="t">            <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">sort</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1736" class="pln"><span class="n"><a href="#t1736">1736</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1737" class="pln"><span class="n"><a href="#t1737">1737</a></span><span class="t">            <span class="com"># Set a default list of indexes in the restrictions list that should be removed based on the following conditions by nested looping over the restriction types and all the starting and stopping times of the restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1738" class="run"><span class="n"><a href="#t1738">1738</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1739" class="run"><span class="n"><a href="#t1739">1739</a></span><span class="t">            <span class="key">for</span> <span class="nam">list_index</span> <span class="key">in</span> <span class="nam">list_indexes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1740" class="run"><span class="n"><a href="#t1740">1740</a></span><span class="t">                <span class="key">for</span> <span class="nam">time1</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1741" class="pln"><span class="n"><a href="#t1741">1741</a></span><span class="t">                    <span class="com"># If the time is a starting time of a restriction and is the same as the selected restriction type: loop over the times again and find the next stopping time of the restriction with the same restriction type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1742" class="run"><span class="n"><a href="#t1742">1742</a></span><span class="t">                    <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">list_of_list_indexes</span><span class="op">[</span><span class="nam">time1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">list_index</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1743" class="run"><span class="n"><a href="#t1743">1743</a></span><span class="t">                        <span class="key">for</span> <span class="nam">time2</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1744" class="run"><span class="n"><a href="#t1744">1744</a></span><span class="t">                            <span class="key">if</span> <span class="nam">time2</span> <span class="op">></span> <span class="nam">time1</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time2</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">list_of_list_indexes</span><span class="op">[</span><span class="nam">time2</span><span class="op">]</span> <span class="op">==</span> <span class="nam">list_index</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1745" class="pln"><span class="n"><a href="#t1745">1745</a></span><span class="t">                                <span class="com"># select all the integers between the starting and stopping time of the restriction and add them to the indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1746" class="run"><span class="n"><a href="#t1746">1746</a></span><span class="t">                                <span class="nam">indexes</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">time1</span> <span class="op">+</span> <span class="num">1</span><span class="op">,</span> <span class="nam">time2</span><span class="op">,</span> <span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1747" class="run"><span class="n"><a href="#t1747">1747</a></span><span class="t">                                <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">indexes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1748" class="mis show_mis"><span class="n"><a href="#t1748">1748</a></span><span class="t">                                    <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1749" class="run"><span class="n"><a href="#t1749">1749</a></span><span class="t">                                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1750" class="pln"><span class="n"><a href="#t1750">1750</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1751" class="pln"><span class="n"><a href="#t1751">1751</a></span><span class="t">            <span class="com"># Sort the indexes to be removed and remove the duplicates</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1752" class="run"><span class="n"><a href="#t1752">1752</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">sort</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1753" class="run"><span class="n"><a href="#t1753">1753</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="nam">list</span><span class="op">(</span><span class="nam">dict</span><span class="op">.</span><span class="nam">fromkeys</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1754" class="pln"><span class="n"><a href="#t1754">1754</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1755" class="pln"><span class="n"><a href="#t1755">1755</a></span><span class="t">            <span class="com"># Remove the times of the restriction, the corresponding type of restriction and critical cross-current of the restriction by looping over the indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1756" class="run"><span class="n"><a href="#t1756">1756</a></span><span class="t">            <span class="key">for</span> <span class="nam">remove_index</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">reversed</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1757" class="mis show_mis"><span class="n"><a href="#t1757">1757</a></span><span class="t">                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1758" class="mis show_mis"><span class="n"><a href="#t1758">1758</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1759" class="mis show_mis"><span class="n"><a href="#t1759">1759</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1760" class="pln"><span class="n"><a href="#t1760">1760</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1761" class="pln"><span class="n"><a href="#t1761">1761</a></span><span class="t">            <span class="com"># Set a new default list of indexes in the restrictions list that should be removed based on the following conditions by looping over all the times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1762" class="run"><span class="n"><a href="#t1762">1762</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1763" class="run"><span class="n"><a href="#t1763">1763</a></span><span class="t">            <span class="key">for</span> <span class="nam">time</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_horizontal_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1764" class="pln"><span class="n"><a href="#t1764">1764</a></span><span class="t">                <span class="com"># Skip the first index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1765" class="run"><span class="n"><a href="#t1765">1765</a></span><span class="t">                <span class="key">if</span> <span class="nam">time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1766" class="run"><span class="n"><a href="#t1766">1766</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1767" class="pln"><span class="n"><a href="#t1767">1767</a></span><span class="t">                <span class="com"># If there are two stopping restrictions in sequence in the list, add the index of the previous stopping time of the restriction to the list of indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1768" class="run"><span class="n"><a href="#t1768">1768</a></span><span class="t">                <span class="key">elif</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1769" class="mis show_mis"><span class="n"><a href="#t1769">1769</a></span><span class="t">                    <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1770" class="pln"><span class="n"><a href="#t1770">1770</a></span><span class="t">                <span class="com"># If there are two starting restrictions in sequence in the list, add the index of the next starting time of the restriction to the list of indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1771" class="run"><span class="n"><a href="#t1771">1771</a></span><span class="t">                <span class="key">elif</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1772" class="mis show_mis"><span class="n"><a href="#t1772">1772</a></span><span class="t">                    <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1773" class="pln"><span class="n"><a href="#t1773">1773</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1774" class="pln"><span class="n"><a href="#t1774">1774</a></span><span class="t">            <span class="com"># Again remove the times of the restriction, the corresponding type of restriction and critical cross-current of the restriction by looping over the indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1775" class="run"><span class="n"><a href="#t1775">1775</a></span><span class="t">            <span class="key">for</span> <span class="nam">remove_index</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">reversed</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1776" class="mis show_mis"><span class="n"><a href="#t1776">1776</a></span><span class="t">                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1777" class="mis show_mis"><span class="n"><a href="#t1777">1777</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1778" class="mis show_mis"><span class="n"><a href="#t1778">1778</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1779" class="pln"><span class="n"><a href="#t1779">1779</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1780" class="pln"><span class="n"><a href="#t1780">1780</a></span><span class="t">            <span class="com"># If the first restriction in the list is a starting time and is greater than the starting time of the waiting time of the vessel: add a stopping condition at the starting time of the vessel and add the corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1781" class="run"><span class="n"><a href="#t1781">1781</a></span><span class="t">            <span class="key">if</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">></span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1782" class="run"><span class="n"><a href="#t1782">1782</a></span><span class="t">                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Stop'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1783" class="run"><span class="n"><a href="#t1783">1783</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1784" class="pln"><span class="n"><a href="#t1784">1784</a></span><span class="t">            <span class="com"># If the first restriction in the list is a stopping time and is greater than the starting time of the waiting time of the vessel: add a starting condition at the starting time of the vessel and add the corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1785" class="run"><span class="n"><a href="#t1785">1785</a></span><span class="t">            <span class="key">elif</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">></span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1786" class="run"><span class="n"><a href="#t1786">1786</a></span><span class="t">                <span class="nam">times_horizontal_tidal_window</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">,</span> <span class="str">'Start'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1787" class="run"><span class="n"><a href="#t1787">1787</a></span><span class="t">                <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1788" class="pln"><span class="n"><a href="#t1788">1788</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1789" class="pln"><span class="n"><a href="#t1789">1789</a></span><span class="t">            <span class="com"># If a plot is requested: plot the governing maximum cross-current limits and cross-current with a corresponding label and add a lay-out</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1790" class="run"><span class="n"><a href="#t1790">1790</a></span><span class="t">            <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1791" class="mis show_mis"><span class="n"><a href="#t1791">1791</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span><span class="op">[</span><span class="nam">y</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">!=</span> <span class="num">10</span> <span class="key">else</span> <span class="key">None</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">max_crit_ccur</span><span class="op">]</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'indianred'</span><span class="op">,</span> <span class="nam">linestyle</span><span class="op">=</span><span class="str">'--'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1792" class="mis show_mis"><span class="n"><a href="#t1792">1792</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">t</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">t_ccur</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="nam">y</span> <span class="op">+</span> <span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span><span class="op">,</span><span class="nam">y</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">max_ccur</span><span class="op">)</span><span class="op">]</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">'indianred'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1793" class="mis show_mis"><span class="n"><a href="#t1793">1793</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Cross-current velocity [m/s]'</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'indianred'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1794" class="mis show_mis"><span class="n"><a href="#t1794">1794</a></span><span class="t">                <span class="nam">axis</span><span class="op">.</span><span class="nam">set_ylim</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="num">1.05</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">max_cur</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1795" class="mis show_mis"><span class="n"><a href="#t1795">1795</a></span><span class="t">                <span class="nam">y_loc</span> <span class="op">=</span> <span class="op">[</span><span class="nam">y</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">!=</span> <span class="num">10</span> <span class="key">else</span> <span class="key">None</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">max_crit_ccur</span><span class="op">]</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1796" class="pln"><span class="n"><a href="#t1796">1796</a></span><span class="t">                <span class="com"># If the location of the label for the critical cross-current is not visible in the plot (exceeds the y-lim): calculate a new location for the label when the critical cross-current is visible</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1797" class="mis show_mis"><span class="n"><a href="#t1797">1797</a></span><span class="t">                <span class="key">if</span> <span class="key">True</span> <span class="key">in</span> <span class="op">[</span><span class="nam">y</span> <span class="op">&lt;</span> <span class="num">1.05</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">max_cur</span><span class="op">)</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">max_crit_ccur</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="num">0.5</span><span class="op">*</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">)</span><span class="op">:</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="num">1.5</span><span class="op">*</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="key">and</span> <span class="nam">y_loc</span> <span class="op">==</span> <span class="key">None</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1798" class="mis show_mis"><span class="n"><a href="#t1798">1798</a></span><span class="t">                    <span class="nam">y_loc</span> <span class="op">=</span> <span class="nam">next</span><span class="op">(</span><span class="nam">item</span> <span class="key">for</span> <span class="nam">item</span> <span class="key">in</span> <span class="op">[</span><span class="nam">y</span> <span class="key">if</span> <span class="nam">y</span> <span class="op">&lt;</span> <span class="num">1.05</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">max_cur</span><span class="op">)</span> <span class="key">else</span> <span class="key">None</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">max_crit_ccur</span><span class="op">]</span><span class="op">[</span><span class="nam">bisect</span><span class="op">.</span><span class="nam">bisect_right</span><span class="op">(</span><span class="nam">t_ccur</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">)</span><span class="op">:</span><span class="op">]</span> <span class="key">if</span> <span class="nam">item</span> <span class="key">is</span> <span class="key">not</span> <span class="key">None</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1799" class="mis show_mis"><span class="n"><a href="#t1799">1799</a></span><span class="t">                <span class="key">if</span> <span class="nam">y_loc</span> <span class="op">!=</span> <span class="key">None</span> <span class="key">and</span> <span class="nam">y_loc</span> <span class="op">&lt;</span> <span class="num">1.05</span><span class="op">*</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">max_cur</span><span class="op">)</span><span class="op">:</span> <span class="com">#if a new value is found: plot the critical cross-currents limits corresponding to the horizontal tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1800" class="mis show_mis"><span class="n"><a href="#t1800">1800</a></span><span class="t">                    <span class="nam">axis</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">x</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="nam">y</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">crit_ccurs_horizontal_tidal_window</span><span class="op">]</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'indianred'</span><span class="op">,</span> <span class="nam">marker</span><span class="op">=</span><span class="str">'o'</span><span class="op">,</span><span class="nam">linestyle</span><span class="op">=</span><span class="str">'None'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1801" class="mis show_mis"><span class="n"><a href="#t1801">1801</a></span><span class="t">                    <span class="nam">axis</span><span class="op">.</span><span class="nam">text</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">,</span><span class="nam">y_loc</span><span class="op">,</span> <span class="str">'Critical cross-current'</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'indianred'</span><span class="op">,</span><span class="nam">horizontalalignment</span><span class="op">=</span><span class="str">'center'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1802" class="pln"><span class="n"><a href="#t1802">1802</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1803" class="pln"><span class="n"><a href="#t1803">1803</a></span><span class="t">            <span class="com"># Return the horizontal tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1804" class="run"><span class="n"><a href="#t1804">1804</a></span><span class="t">            <span class="key">return</span> <span class="nam">times_horizontal_tidal_window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1805" class="pln"><span class="n"><a href="#t1805">1805</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1806" class="run"><span class="n"><a href="#t1806">1806</a></span><span class="t">        <span class="key">def</span> <span class="nam">times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">axes</span><span class="op">=</span><span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">=</span><span class="key">True</span><span class="op">,</span><span class="nam">visualization_calculation</span><span class="op">=</span><span class="key">False</span><span class="op">,</span><span class="nam">ukc_calc</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1807" class="pln"><span class="n"><a href="#t1807">1807</a></span><span class="t">            <span class="str">""" Function: calculates the windows available to sail-in and -out of the port by combining the tidal windows of the horizontal and vertical tidal restrictions given the tidal window polciy</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1808" class="pln"><span class="n"><a href="#t1808">1808</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1809" class="pln"><span class="n"><a href="#t1809">1809</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1810" class="pln"><span class="n"><a href="#t1810">1810</a></span><span class="t"><span class="str">                    - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1811" class="pln"><span class="n"><a href="#t1811">1811</a></span><span class="t"><span class="str">                    - route: a list of strings of node names that resemble the route that the vessel is planning to sail (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1812" class="pln"><span class="n"><a href="#t1812">1812</a></span><span class="t"><span class="str">                    - plot: provide a visualization of the calculation for each vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1813" class="pln"><span class="n"><a href="#t1813">1813</a></span><span class="t"><span class="str">                    - axes: list of two axes classes from the matplotlib package</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1814" class="pln"><span class="n"><a href="#t1814">1814</a></span><span class="t"><span class="str">                    - sailing_time_correction: a bool that indicates whether the calculation should correct for sailing_speed (dynamic calculation) or not (static calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1815" class="pln"><span class="n"><a href="#t1815">1815</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1816" class="pln"><span class="n"><a href="#t1816">1816</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1817" class="pln"><span class="n"><a href="#t1817">1817</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1818" class="pln"><span class="n"><a href="#t1818">1818</a></span><span class="t">            <span class="com"># If just a calculation of the net_ukc is required:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1819" class="run"><span class="n"><a href="#t1819">1819</a></span><span class="t">            <span class="key">if</span> <span class="nam">ukc_calc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1820" class="mis show_mis"><span class="n"><a href="#t1820">1820</a></span><span class="t">                <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span> <span class="op">=</span> <span class="nam">times_vertical_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">ukc_calc</span><span class="op">=</span><span class="nam">ukc_calc</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1821" class="mis show_mis"><span class="n"><a href="#t1821">1821</a></span><span class="t">                <span class="key">return</span> <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1822" class="pln"><span class="n"><a href="#t1822">1822</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1823" class="pln"><span class="n"><a href="#t1823">1823</a></span><span class="t">            <span class="com"># Else: calculate the tidal window restriction for the vertical and horizontal tide respectively</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1824" class="run"><span class="n"><a href="#t1824">1824</a></span><span class="t">            <span class="nam">list_of_times_vertical_tidal_window</span> <span class="op">=</span> <span class="nam">times_vertical_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">axes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">plot</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">,</span><span class="nam">ukc_calc</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1825" class="run"><span class="n"><a href="#t1825">1825</a></span><span class="t">            <span class="nam">list_of_times_horizontal_tidal_window</span> <span class="op">=</span> <span class="nam">times_horizontal_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">axes</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">plot</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">,</span><span class="nam">visualization_calculation</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1826" class="pln"><span class="n"><a href="#t1826">1826</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1827" class="pln"><span class="n"><a href="#t1827">1827</a></span><span class="t">            <span class="com"># Set some default parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1828" class="run"><span class="n"><a href="#t1828">1828</a></span><span class="t">            <span class="nam">list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1829" class="run"><span class="n"><a href="#t1829">1829</a></span><span class="t">            <span class="nam">times_tidal_window</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1830" class="run"><span class="n"><a href="#t1830">1830</a></span><span class="t">            <span class="nam">list_of_list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1831" class="pln"><span class="n"><a href="#t1831">1831</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1832" class="pln"><span class="n"><a href="#t1832">1832</a></span><span class="t">            <span class="com">#Append data to the lists and append a corresponding indentification index (0=vertical, 1=horizontal)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1833" class="run"><span class="n"><a href="#t1833">1833</a></span><span class="t">            <span class="key">for</span> <span class="nam">time</span> <span class="key">in</span> <span class="nam">list_of_times_vertical_tidal_window</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1834" class="run"><span class="n"><a href="#t1834">1834</a></span><span class="t">                <span class="nam">times_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1835" class="run"><span class="n"><a href="#t1835">1835</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1836" class="run"><span class="n"><a href="#t1836">1836</a></span><span class="t">            <span class="key">for</span> <span class="nam">time</span> <span class="key">in</span> <span class="nam">list_of_times_horizontal_tidal_window</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1837" class="run"><span class="n"><a href="#t1837">1837</a></span><span class="t">                <span class="nam">times_tidal_window</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1838" class="run"><span class="n"><a href="#t1838">1838</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1839" class="pln"><span class="n"><a href="#t1839">1839</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1840" class="pln"><span class="n"><a href="#t1840">1840</a></span><span class="t">            <span class="com">#Sort lists on time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1841" class="run"><span class="n"><a href="#t1841">1841</a></span><span class="t">            <span class="nam">list_of_list_indexes</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span> <span class="key">for</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">times_tidal_window</span><span class="op">,</span> <span class="nam">list_of_list_indexes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1842" class="run"><span class="n"><a href="#t1842">1842</a></span><span class="t">            <span class="nam">times_tidal_window</span><span class="op">.</span><span class="nam">sort</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1843" class="pln"><span class="n"><a href="#t1843">1843</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1844" class="pln"><span class="n"><a href="#t1844">1844</a></span><span class="t">            <span class="com">#Remove values that fall within restrictive periods of both tidal policies.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1845" class="run"><span class="n"><a href="#t1845">1845</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1846" class="run"><span class="n"><a href="#t1846">1846</a></span><span class="t">            <span class="key">for</span> <span class="nam">list_index</span> <span class="key">in</span> <span class="nam">list_indexes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1847" class="run"><span class="n"><a href="#t1847">1847</a></span><span class="t">                <span class="key">for</span> <span class="nam">time1</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1848" class="run"><span class="n"><a href="#t1848">1848</a></span><span class="t">                    <span class="key">if</span> <span class="nam">times_tidal_window</span><span class="op">[</span><span class="nam">time1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">list_of_list_indexes</span><span class="op">[</span><span class="nam">time1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">list_index</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1849" class="run"><span class="n"><a href="#t1849">1849</a></span><span class="t">                        <span class="key">for</span> <span class="nam">time2</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1850" class="run"><span class="n"><a href="#t1850">1850</a></span><span class="t">                            <span class="key">if</span> <span class="nam">time2</span> <span class="op">></span> <span class="nam">time1</span> <span class="key">and</span> <span class="nam">times_tidal_window</span><span class="op">[</span><span class="nam">time2</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">list_of_list_indexes</span><span class="op">[</span><span class="nam">time2</span><span class="op">]</span> <span class="op">==</span> <span class="nam">list_index</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1851" class="run"><span class="n"><a href="#t1851">1851</a></span><span class="t">                                <span class="nam">indexes</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">arange</span><span class="op">(</span><span class="nam">time1</span> <span class="op">+</span> <span class="num">1</span><span class="op">,</span> <span class="nam">time2</span><span class="op">,</span> <span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1852" class="run"><span class="n"><a href="#t1852">1852</a></span><span class="t">                                <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">indexes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1853" class="run"><span class="n"><a href="#t1853">1853</a></span><span class="t">                                    <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1854" class="run"><span class="n"><a href="#t1854">1854</a></span><span class="t">                                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1855" class="pln"><span class="n"><a href="#t1855">1855</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1856" class="pln"><span class="n"><a href="#t1856">1856</a></span><span class="t">            <span class="com">#Sort the indexes that should be removed and remove duplicates</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1857" class="run"><span class="n"><a href="#t1857">1857</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">sort</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1858" class="run"><span class="n"><a href="#t1858">1858</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="nam">list</span><span class="op">(</span><span class="nam">dict</span><span class="op">.</span><span class="nam">fromkeys</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1859" class="pln"><span class="n"><a href="#t1859">1859</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1860" class="pln"><span class="n"><a href="#t1860">1860</a></span><span class="t">            <span class="com">#Remove the values on the indexes that should be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1861" class="run"><span class="n"><a href="#t1861">1861</a></span><span class="t">            <span class="key">for</span> <span class="nam">remove_index</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">reversed</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1862" class="run"><span class="n"><a href="#t1862">1862</a></span><span class="t">                <span class="nam">times_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1863" class="run"><span class="n"><a href="#t1863">1863</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1864" class="pln"><span class="n"><a href="#t1864">1864</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1865" class="pln"><span class="n"><a href="#t1865">1865</a></span><span class="t">            <span class="com"># Set a new default list of indexes in the restrictions list that should be removed based on the following conditions by looping over all the times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1866" class="run"><span class="n"><a href="#t1866">1866</a></span><span class="t">            <span class="nam">indexes_to_be_removed</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1867" class="run"><span class="n"><a href="#t1867">1867</a></span><span class="t">            <span class="key">for</span> <span class="nam">time</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">times_tidal_window</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1868" class="run"><span class="n"><a href="#t1868">1868</a></span><span class="t">                <span class="key">if</span> <span class="nam">time</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1869" class="run"><span class="n"><a href="#t1869">1869</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1870" class="pln"><span class="n"><a href="#t1870">1870</a></span><span class="t">                <span class="com"># If there are two stopping restrictions in sequence in the list, add the index of the previous stopping time of the restriction to the list of indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1871" class="run"><span class="n"><a href="#t1871">1871</a></span><span class="t">                <span class="key">elif</span> <span class="nam">times_tidal_window</span><span class="op">[</span><span class="nam">time</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span> <span class="key">and</span> <span class="nam">times_tidal_window</span><span class="op">[</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Stop'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1872" class="run"><span class="n"><a href="#t1872">1872</a></span><span class="t">                    <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1873" class="pln"><span class="n"><a href="#t1873">1873</a></span><span class="t">                <span class="com"># If the first restriction in the list is a stopping time and is greater than the starting time of the waiting time of the vessel: add a starting condition at the starting time of the vessel and add the corresponding critical cross-current</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1874" class="run"><span class="n"><a href="#t1874">1874</a></span><span class="t">                <span class="key">elif</span> <span class="nam">times_tidal_window</span><span class="op">[</span><span class="nam">time</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">times_tidal_window</span><span class="op">[</span><span class="nam">time</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1875" class="run"><span class="n"><a href="#t1875">1875</a></span><span class="t">                    <span class="nam">indexes_to_be_removed</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1876" class="pln"><span class="n"><a href="#t1876">1876</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1877" class="pln"><span class="n"><a href="#t1877">1877</a></span><span class="t">            <span class="com"># Again remove the values on the indexes that should be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1878" class="run"><span class="n"><a href="#t1878">1878</a></span><span class="t">            <span class="key">for</span> <span class="nam">remove_index</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">reversed</span><span class="op">(</span><span class="nam">indexes_to_be_removed</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1879" class="run"><span class="n"><a href="#t1879">1879</a></span><span class="t">                <span class="nam">times_tidal_window</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1880" class="run"><span class="n"><a href="#t1880">1880</a></span><span class="t">                <span class="nam">list_of_list_indexes</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">remove_index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1881" class="pln"><span class="n"><a href="#t1881">1881</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1882" class="pln"><span class="n"><a href="#t1882">1882</a></span><span class="t">            <span class="com"># Return the final tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1883" class="run"><span class="n"><a href="#t1883">1883</a></span><span class="t">            <span class="key">return</span> <span class="nam">times_tidal_window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1884" class="pln"><span class="n"><a href="#t1884">1884</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1885" class="pln"><span class="n"><a href="#t1885">1885</a></span><span class="t">        <span class="com"># Continuation of the calculation of the available sail-in-times by setting the starting time and some lists</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1886" class="run"><span class="n"><a href="#t1886">1886</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">ukc_calc</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1887" class="run"><span class="n"><a href="#t1887">1887</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_start</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1888" class="run"><span class="n"><a href="#t1888">1888</a></span><span class="t">            <span class="nam">axes</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1889" class="pln"><span class="n"><a href="#t1889">1889</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1890" class="mis show_mis"><span class="n"><a href="#t1890">1890</a></span><span class="t">            <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span> <span class="op">=</span> <span class="nam">times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">ukc_calc</span><span class="op">=</span><span class="nam">ukc_calc</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1891" class="mis show_mis"><span class="n"><a href="#t1891">1891</a></span><span class="t">            <span class="key">return</span> <span class="nam">interp_wdep</span><span class="op">,</span> <span class="nam">ukc_s</span><span class="op">,</span> <span class="nam">ukc_p</span><span class="op">,</span> <span class="nam">fwa</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1892" class="pln"><span class="n"><a href="#t1892">1892</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1893" class="pln"><span class="n"><a href="#t1893">1893</a></span><span class="t">        <span class="com"># If plot requested: create an empty figure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1894" class="run"><span class="n"><a href="#t1894">1894</a></span><span class="t">        <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1895" class="mis show_mis"><span class="n"><a href="#t1895">1895</a></span><span class="t">            <span class="nam">fig</span><span class="op">,</span> <span class="nam">ax1</span> <span class="op">=</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">subplots</span><span class="op">(</span><span class="nam">figsize</span><span class="op">=</span><span class="op">[</span><span class="num">10</span><span class="op">,</span> <span class="num">10</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1896" class="mis show_mis"><span class="n"><a href="#t1896">1896</a></span><span class="t">            <span class="nam">ax2</span> <span class="op">=</span> <span class="nam">ax1</span><span class="op">.</span><span class="nam">twinx</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1897" class="mis show_mis"><span class="n"><a href="#t1897">1897</a></span><span class="t">            <span class="nam">axes</span> <span class="op">=</span> <span class="op">[</span><span class="nam">ax1</span><span class="op">,</span><span class="nam">ax2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1898" class="pln"><span class="n"><a href="#t1898">1898</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1899" class="pln"><span class="n"><a href="#t1899">1899</a></span><span class="t">        <span class="com"># Running the above functions to determine the available-sail-in-times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1900" class="run"><span class="n"><a href="#t1900">1900</a></span><span class="t">        <span class="nam">available_sail_in_times</span> <span class="op">=</span> <span class="nam">times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">axes</span><span class="op">,</span><span class="nam">plot</span><span class="op">,</span><span class="nam">sailing_time_correction</span><span class="op">,</span><span class="nam">visualization_calculation</span><span class="op">,</span><span class="nam">ukc_calc</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1901" class="pln"><span class="n"><a href="#t1901">1901</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1902" class="pln"><span class="n"><a href="#t1902">1902</a></span><span class="t">        <span class="com"># If plot requested: add the following to the plot</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1903" class="run"><span class="n"><a href="#t1903">1903</a></span><span class="t">        <span class="key">if</span> <span class="nam">plot</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1904" class="pln"><span class="n"><a href="#t1904">1904</a></span><span class="t">            <span class="com"># Predefining some lists</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1905" class="mis show_mis"><span class="n"><a href="#t1905">1905</a></span><span class="t">            <span class="nam">line</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1906" class="mis show_mis"><span class="n"><a href="#t1906">1906</a></span><span class="t">            <span class="nam">linelist</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1907" class="pln"><span class="n"><a href="#t1907">1907</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1908" class="pln"><span class="n"><a href="#t1908">1908</a></span><span class="t">            <span class="com"># Appending the tidal windows to the list by looping over the resulting available sail-in-times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1909" class="mis show_mis"><span class="n"><a href="#t1909">1909</a></span><span class="t">            <span class="key">for</span> <span class="nam">t2</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">available_sail_in_times</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1910" class="mis show_mis"><span class="n"><a href="#t1910">1910</a></span><span class="t">                <span class="key">if</span> <span class="nam">available_sail_in_times</span><span class="op">[</span><span class="nam">t2</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span> <span class="key">and</span> <span class="nam">t2</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1911" class="mis show_mis"><span class="n"><a href="#t1911">1911</a></span><span class="t">                    <span class="nam">linelist</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="op">[</span><span class="nam">available_sail_in_times</span><span class="op">[</span><span class="nam">t2</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">available_sail_in_times</span><span class="op">[</span><span class="nam">t2</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1912" class="pln"><span class="n"><a href="#t1912">1912</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1913" class="pln"><span class="n"><a href="#t1913">1913</a></span><span class="t">            <span class="com"># Visualization of the list of tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1914" class="mis show_mis"><span class="n"><a href="#t1914">1914</a></span><span class="t">            <span class="key">for</span> <span class="nam">lines</span> <span class="key">in</span> <span class="nam">linelist</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1915" class="mis show_mis"><span class="n"><a href="#t1915">1915</a></span><span class="t">                <span class="nam">line</span><span class="op">,</span> <span class="op">=</span> <span class="nam">ax1</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="op">[</span><span class="nam">lines</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">lines</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="num">0.05</span><span class="op">,</span><span class="num">0.05</span><span class="op">]</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">'darkslateblue'</span><span class="op">,</span> <span class="nam">marker</span><span class="op">=</span><span class="str">'o'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1916" class="pln"><span class="n"><a href="#t1916">1916</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1917" class="pln"><span class="n"><a href="#t1917">1917</a></span><span class="t">            <span class="com"># Lay-out of the plot</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1918" class="mis show_mis"><span class="n"><a href="#t1918">1918</a></span><span class="t">            <span class="nam">plt</span><span class="op">.</span><span class="nam">title</span><span class="op">(</span><span class="str">'Tidal window calculation for a '</span><span class="op">+</span><span class="nam">str</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">name</span><span class="op">)</span> <span class="op">+</span> <span class="str">'-class '</span> <span class="op">+</span><span class="nam">str</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span><span class="op">)</span> <span class="op">+</span> <span class="str">', sailing '</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1919" class="mis show_mis"><span class="n"><a href="#t1919">1919</a></span><span class="t">            <span class="nam">plt</span><span class="op">.</span><span class="nam">xlim</span><span class="op">(</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">-</span><span class="num">0.5</span><span class="op">*</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="num">1.5</span><span class="op">*</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1920" class="mis show_mis"><span class="n"><a href="#t1920">1920</a></span><span class="t">            <span class="nam">plt</span><span class="op">.</span><span class="nam">legend</span><span class="op">(</span><span class="op">[</span><span class="nam">line</span><span class="op">]</span><span class="op">,</span> <span class="op">[</span><span class="str">'Tidal window'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1921" class="mis show_mis"><span class="n"><a href="#t1921">1921</a></span><span class="t">            <span class="nam">ax1</span><span class="op">.</span><span class="nam">set_xlabel</span><span class="op">(</span><span class="str">'time (s)'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1922" class="mis show_mis"><span class="n"><a href="#t1922">1922</a></span><span class="t">            <span class="nam">ax1</span><span class="op">.</span><span class="nam">set_ylabel</span><span class="op">(</span><span class="str">'Experienced water depth [m]'</span><span class="op">,</span> <span class="nam">color</span><span class="op">=</span><span class="str">'deepskyblue'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1923" class="mis show_mis"><span class="n"><a href="#t1923">1923</a></span><span class="t">            <span class="nam">ax2</span><span class="op">.</span><span class="nam">spines</span><span class="op">[</span><span class="str">'left'</span><span class="op">]</span><span class="op">.</span><span class="nam">set_color</span><span class="op">(</span><span class="str">'deepskyblue'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1924" class="mis show_mis"><span class="n"><a href="#t1924">1924</a></span><span class="t">            <span class="nam">ax2</span><span class="op">.</span><span class="nam">spines</span><span class="op">[</span><span class="str">'right'</span><span class="op">]</span><span class="op">.</span><span class="nam">set_color</span><span class="op">(</span><span class="str">'indianred'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1925" class="mis show_mis"><span class="n"><a href="#t1925">1925</a></span><span class="t">            <span class="nam">plt</span><span class="op">.</span><span class="nam">show</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1926" class="pln"><span class="n"><a href="#t1926">1926</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1927" class="run"><span class="n"><a href="#t1927">1927</a></span><span class="t">        <span class="key">return</span> <span class="nam">available_sail_in_times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1928" class="pln"><span class="n"><a href="#t1928">1928</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1929" class="run"><span class="n"><a href="#t1929">1929</a></span><span class="t"><span class="key">class</span> <span class="nam">Routeable</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1930" class="pln"><span class="n"><a href="#t1930">1930</a></span><span class="t">    <span class="str">"""Mixin class: Something with a route (networkx format)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1931" class="pln"><span class="n"><a href="#t1931">1931</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1932" class="pln"><span class="n"><a href="#t1932">1932</a></span><span class="t"><span class="str">    route: a networkx path"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1933" class="pln"><span class="n"><a href="#t1933">1933</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1934" class="run"><span class="n"><a href="#t1934">1934</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">complete_path</span><span class="op">=</span><span class="key">None</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1935" class="mis show_mis"><span class="n"><a href="#t1935">1935</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1936" class="pln"><span class="n"><a href="#t1936">1936</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1937" class="mis show_mis"><span class="n"><a href="#t1937">1937</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1938" class="mis show_mis"><span class="n"><a href="#t1938">1938</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">complete_path</span> <span class="op">=</span> <span class="nam">complete_path</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1939" class="pln"><span class="n"><a href="#t1939">1939</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1940" class="run"><span class="n"><a href="#t1940">1940</a></span><span class="t"><span class="key">class</span> <span class="nam">IsLockWaitingArea</span><span class="op">(</span><span class="nam">HasResource</span><span class="op">,</span> <span class="nam">Identifiable</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1941" class="pln"><span class="n"><a href="#t1941">1941</a></span><span class="t">    <span class="str">"""Mixin class: Something has waiting area object properties as part of the lock complex [in SI-units]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1942" class="pln"><span class="n"><a href="#t1942">1942</a></span><span class="t"><span class="str">            creates a waiting area with a waiting_area resource which is requested when a vessels wants to enter the area with limited capacity"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1943" class="pln"><span class="n"><a href="#t1943">1943</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1944" class="run"><span class="n"><a href="#t1944">1944</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1945" class="pln"><span class="n"><a href="#t1945">1945</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1946" class="pln"><span class="n"><a href="#t1946">1946</a></span><span class="t">        <span class="nam">node</span><span class="op">,</span> <span class="com">#a string which indicates the location of the start of the waiting area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1947" class="pln"><span class="n"><a href="#t1947">1947</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1948" class="pln"><span class="n"><a href="#t1948">1948</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1949" class="pln"><span class="n"><a href="#t1949">1949</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1950" class="mis show_mis"><span class="n"><a href="#t1950">1950</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1951" class="pln"><span class="n"><a href="#t1951">1951</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1952" class="pln"><span class="n"><a href="#t1952">1952</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1953" class="mis show_mis"><span class="n"><a href="#t1953">1953</a></span><span class="t">        <span class="nam">waiting_area_resources</span> <span class="op">=</span> <span class="num">100</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1954" class="mis show_mis"><span class="n"><a href="#t1954">1954</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">waiting_area</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="nam">waiting_area_resources</span><span class="op">)</span><span class="op">,</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1955" class="pln"><span class="n"><a href="#t1955">1955</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1956" class="run"><span class="n"><a href="#t1956">1956</a></span><span class="t"><span class="key">class</span> <span class="nam">IsLockLineUpArea</span><span class="op">(</span><span class="nam">HasResource</span><span class="op">,</span> <span class="nam">HasLength</span><span class="op">,</span> <span class="nam">Identifiable</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1957" class="pln"><span class="n"><a href="#t1957">1957</a></span><span class="t">    <span class="str">"""Mixin class: Something has line-up area object properties as part of the lock complex [in SI-units]:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1958" class="pln"><span class="n"><a href="#t1958">1958</a></span><span class="t"><span class="str">            creates a line-up area with the following resources:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1959" class="pln"><span class="n"><a href="#t1959">1959</a></span><span class="t"><span class="str">                - enter_line_up_area: resource used when entering the line-up area (assures one-by-one entry of the line-up area by vessels)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1960" class="pln"><span class="n"><a href="#t1960">1960</a></span><span class="t"><span class="str">                - line_up_area: resource with unlimited capacity used to formally request access to the line-up area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1961" class="pln"><span class="n"><a href="#t1961">1961</a></span><span class="t"><span class="str">                - converting_while_in_line_up_area: resource used when requesting for an empty conversion of the lock chamber</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1962" class="pln"><span class="n"><a href="#t1962">1962</a></span><span class="t"><span class="str">                - pass_line_up_area: resource used to pass the second encountered line-up area"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1963" class="pln"><span class="n"><a href="#t1963">1963</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1964" class="run"><span class="n"><a href="#t1964">1964</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1965" class="pln"><span class="n"><a href="#t1965">1965</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1966" class="pln"><span class="n"><a href="#t1966">1966</a></span><span class="t">        <span class="nam">node</span><span class="op">,</span> <span class="com">#a string which indicates the location of the start of the line-up area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1967" class="pln"><span class="n"><a href="#t1967">1967</a></span><span class="t">        <span class="nam">lineup_length</span><span class="op">,</span> <span class="com">#a float which contains the length of the line-up area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1968" class="pln"><span class="n"><a href="#t1968">1968</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1969" class="pln"><span class="n"><a href="#t1969">1969</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1970" class="pln"><span class="n"><a href="#t1970">1970</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1971" class="mis show_mis"><span class="n"><a href="#t1971">1971</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="nam">length</span> <span class="op">=</span> <span class="nam">lineup_length</span><span class="op">,</span> <span class="nam">remaining_length</span> <span class="op">=</span> <span class="nam">lineup_length</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1972" class="pln"><span class="n"><a href="#t1972">1972</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1973" class="pln"><span class="n"><a href="#t1973">1973</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1974" class="pln"><span class="n"><a href="#t1974">1974</a></span><span class="t">        <span class="com"># Lay-Out</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1975" class="mis show_mis"><span class="n"><a href="#t1975">1975</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">enter_line_up_area</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span> <span class="com">#used to regulate one by one entering of line-up area, so capacity must be 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1976" class="mis show_mis"><span class="n"><a href="#t1976">1976</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">line_up_area</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">100</span><span class="op">)</span><span class="op">,</span><span class="op">}</span> <span class="com">#line-up area itself, infinite capacity, as this is regulated by the HasLength, so capacity = inf</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1977" class="mis show_mis"><span class="n"><a href="#t1977">1977</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">converting_while_in_line_up_area</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span> <span class="com">#used to minimize the number of empty convertion requests by one by multiple waiting vessels, so capacity must be 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1978" class="mis show_mis"><span class="n"><a href="#t1978">1978</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">pass_line_up_area</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span> <span class="com">#used to prevent vessel from entering the lock before all previously locked vessels have passed the line-up area one by one, so capacity must be 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1979" class="pln"><span class="n"><a href="#t1979">1979</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1980" class="run"><span class="n"><a href="#t1980">1980</a></span><span class="t"><span class="key">class</span> <span class="nam">IsTurningBasin</span><span class="op">(</span><span class="nam">HasResource</span><span class="op">,</span> <span class="nam">Identifiable</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1981" class="pln"><span class="n"><a href="#t1981">1981</a></span><span class="t">    <span class="str">"""Mixin class: Something which has a turning basin object properties as part of a lock complex [in SI-units] """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1982" class="pln"><span class="n"><a href="#t1982">1982</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1983" class="run"><span class="n"><a href="#t1983">1983</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1984" class="pln"><span class="n"><a href="#t1984">1984</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1985" class="pln"><span class="n"><a href="#t1985">1985</a></span><span class="t">        <span class="nam">node</span><span class="op">,</span> <span class="com">#a string which indicates the location of the start of the waiting area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1986" class="pln"><span class="n"><a href="#t1986">1986</a></span><span class="t">        <span class="nam">length</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1987" class="pln"><span class="n"><a href="#t1987">1987</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1988" class="pln"><span class="n"><a href="#t1988">1988</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1989" class="pln"><span class="n"><a href="#t1989">1989</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1990" class="mis show_mis"><span class="n"><a href="#t1990">1990</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1991" class="pln"><span class="n"><a href="#t1991">1991</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1992" class="mis show_mis"><span class="n"><a href="#t1992">1992</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">length</span> <span class="op">=</span> <span class="nam">length</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1993" class="mis show_mis"><span class="n"><a href="#t1993">1993</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">turning_basin</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1994" class="pln"><span class="n"><a href="#t1994">1994</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1995" class="run"><span class="n"><a href="#t1995">1995</a></span><span class="t"><span class="key">class</span> <span class="nam">IsLock</span><span class="op">(</span><span class="nam">HasResource</span><span class="op">,</span> <span class="nam">HasLength</span><span class="op">,</span> <span class="nam">Identifiable</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1996" class="pln"><span class="n"><a href="#t1996">1996</a></span><span class="t">    <span class="str">"""Mixin class: Something which has lock chamber object properties as part of a lock complex [in SI-units] """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1997" class="pln"><span class="n"><a href="#t1997">1997</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t1998" class="run"><span class="n"><a href="#t1998">1998</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t1999" class="pln"><span class="n"><a href="#t1999">1999</a></span><span class="t">        <span class="nam">self</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2000" class="pln"><span class="n"><a href="#t2000">2000</a></span><span class="t">        <span class="nam">node_1</span><span class="op">,</span> <span class="com">#a string which indicates the location of the first pair of lock doors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2001" class="pln"><span class="n"><a href="#t2001">2001</a></span><span class="t">        <span class="nam">node_2</span><span class="op">,</span> <span class="com">#a string which indicates the center of the lock chamber</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2002" class="pln"><span class="n"><a href="#t2002">2002</a></span><span class="t">        <span class="nam">node_3</span><span class="op">,</span> <span class="com">#a string which indicates the location of the second pair of lock doors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2003" class="pln"><span class="n"><a href="#t2003">2003</a></span><span class="t">        <span class="nam">lock_length</span><span class="op">,</span> <span class="com">#a float which contains the length of the lock chamber</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2004" class="pln"><span class="n"><a href="#t2004">2004</a></span><span class="t">        <span class="nam">lock_width</span><span class="op">,</span> <span class="com">#a float which contains the width of the lock chamber</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2005" class="pln"><span class="n"><a href="#t2005">2005</a></span><span class="t">        <span class="nam">lock_depth</span><span class="op">,</span> <span class="com">#a float which contains the depth of the lock chamber</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2006" class="pln"><span class="n"><a href="#t2006">2006</a></span><span class="t">        <span class="nam">doors_open</span><span class="op">,</span> <span class="com">#a float which contains the time it takes to open the doors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2007" class="pln"><span class="n"><a href="#t2007">2007</a></span><span class="t">        <span class="nam">doors_close</span><span class="op">,</span> <span class="com">#a float which contains the time it takes to close the doors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2008" class="pln"><span class="n"><a href="#t2008">2008</a></span><span class="t">        <span class="nam">wlev_dif</span><span class="op">,</span> <span class="com">#a float or list of floats which resembles the water level difference over the lock</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2009" class="pln"><span class="n"><a href="#t2009">2009</a></span><span class="t">        <span class="nam">disch_coeff</span><span class="op">,</span> <span class="com">#a float which contains the discharge coefficient of filling system</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2010" class="pln"><span class="n"><a href="#t2010">2010</a></span><span class="t">        <span class="nam">opening_area</span><span class="op">,</span> <span class="com">#a float which contains the cross-sectional area of filling system</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2011" class="pln"><span class="n"><a href="#t2011">2011</a></span><span class="t">        <span class="nam">opening_depth</span><span class="op">,</span> <span class="com">#a float which contains the depth at which filling system is located</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2012" class="pln"><span class="n"><a href="#t2012">2012</a></span><span class="t">        <span class="nam">simulation_start</span><span class="op">,</span> <span class="com">#a datetime which contains the simulation start time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2013" class="pln"><span class="n"><a href="#t2013">2013</a></span><span class="t">        <span class="nam">operating_time</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2014" class="pln"><span class="n"><a href="#t2014">2014</a></span><span class="t">        <span class="nam">grav_acc</span> <span class="op">=</span> <span class="num">9.81</span><span class="op">,</span> <span class="com">#a float which contains the gravitational acceleration</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2015" class="pln"><span class="n"><a href="#t2015">2015</a></span><span class="t">        <span class="op">*</span><span class="nam">args</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2016" class="pln"><span class="n"><a href="#t2016">2016</a></span><span class="t">        <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2017" class="pln"><span class="n"><a href="#t2017">2017</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2018" class="pln"><span class="n"><a href="#t2018">2018</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2019" class="pln"><span class="n"><a href="#t2019">2019</a></span><span class="t">        <span class="com"># Properties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2020" class="mis show_mis"><span class="n"><a href="#t2020">2020</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">lock_length</span> <span class="op">=</span> <span class="nam">lock_length</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2021" class="mis show_mis"><span class="n"><a href="#t2021">2021</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">lock_width</span> <span class="op">=</span> <span class="nam">lock_width</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2022" class="mis show_mis"><span class="n"><a href="#t2022">2022</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">lock_depth</span> <span class="op">=</span> <span class="nam">lock_depth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2023" class="mis show_mis"><span class="n"><a href="#t2023">2023</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span> <span class="op">=</span> <span class="nam">wlev_dif</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2024" class="mis show_mis"><span class="n"><a href="#t2024">2024</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">disch_coeff</span> <span class="op">=</span> <span class="nam">disch_coeff</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2025" class="mis show_mis"><span class="n"><a href="#t2025">2025</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">grav_acc</span> <span class="op">=</span> <span class="nam">grav_acc</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2026" class="mis show_mis"><span class="n"><a href="#t2026">2026</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">opening_area</span> <span class="op">=</span> <span class="nam">opening_area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2027" class="mis show_mis"><span class="n"><a href="#t2027">2027</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">opening_depth</span> <span class="op">=</span> <span class="nam">opening_depth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2028" class="mis show_mis"><span class="n"><a href="#t2028">2028</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">operating_time</span> <span class="op">=</span> <span class="nam">operating_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2029" class="mis show_mis"><span class="n"><a href="#t2029">2029</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">simulation_start</span> <span class="op">=</span> <span class="nam">simulation_start</span><span class="op">.</span><span class="nam">timestamp</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2030" class="pln"><span class="n"><a href="#t2030">2030</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2031" class="mis show_mis"><span class="n"><a href="#t2031">2031</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="nam">length</span> <span class="op">=</span> <span class="nam">lock_length</span><span class="op">,</span> <span class="nam">remaining_length</span> <span class="op">=</span> <span class="nam">lock_length</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2032" class="pln"><span class="n"><a href="#t2032">2032</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2033" class="mis show_mis"><span class="n"><a href="#t2033">2033</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">doors_1</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node_1</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span> <span class="op">=</span> <span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span> <span class="com">#Only one ship can pass at a time: capacity = 1, request can have priority</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2034" class="mis show_mis"><span class="n"><a href="#t2034">2034</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">doors_2</span> <span class="op">=</span> <span class="op">{</span><span class="nam">node_3</span><span class="op">:</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">PriorityResource</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">,</span> <span class="nam">capacity</span> <span class="op">=</span> <span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="op">}</span> <span class="com">#Only one ship can pass at a time: capacity = 1, request can have priority</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2035" class="pln"><span class="n"><a href="#t2035">2035</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2036" class="pln"><span class="n"><a href="#t2036">2036</a></span><span class="t">        <span class="com"># Operating</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2037" class="mis show_mis"><span class="n"><a href="#t2037">2037</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">doors_open</span> <span class="op">=</span> <span class="nam">doors_open</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2038" class="mis show_mis"><span class="n"><a href="#t2038">2038</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">doors_close</span> <span class="op">=</span> <span class="nam">doors_close</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2039" class="pln"><span class="n"><a href="#t2039">2039</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2040" class="pln"><span class="n"><a href="#t2040">2040</a></span><span class="t">        <span class="com"># Water level</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2041" class="mis show_mis"><span class="n"><a href="#t2041">2041</a></span><span class="t">        <span class="key">assert</span> <span class="nam">node_1</span> <span class="op">!=</span> <span class="nam">node_3</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2042" class="pln"><span class="n"><a href="#t2042">2042</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2043" class="mis show_mis"><span class="n"><a href="#t2043">2043</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">node_1</span> <span class="op">=</span> <span class="nam">node_1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2044" class="mis show_mis"><span class="n"><a href="#t2044">2044</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">node_3</span> <span class="op">=</span> <span class="nam">node_3</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2045" class="mis show_mis"><span class="n"><a href="#t2045">2045</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span> <span class="op">=</span> <span class="nam">random</span><span class="op">.</span><span class="nam">choice</span><span class="op">(</span><span class="op">[</span><span class="nam">node_1</span><span class="op">,</span> <span class="nam">node_3</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2046" class="pln"><span class="n"><a href="#t2046">2046</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2047" class="run"><span class="n"><a href="#t2047">2047</a></span><span class="t">    <span class="key">def</span> <span class="nam">operation_time</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">environment</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2048" class="pln"><span class="n"><a href="#t2048">2048</a></span><span class="t">        <span class="str">""" Function which calculates the operation time: based on the constant or nearest in the signal of the water level difference</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2049" class="pln"><span class="n"><a href="#t2049">2049</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2050" class="pln"><span class="n"><a href="#t2050">2050</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2051" class="pln"><span class="n"><a href="#t2051">2051</a></span><span class="t"><span class="str">                - environment: see init function"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2052" class="pln"><span class="n"><a href="#t2052">2052</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2053" class="mis show_mis"><span class="n"><a href="#t2053">2053</a></span><span class="t">        <span class="key">if</span> <span class="nam">type</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span><span class="op">)</span> <span class="op">==</span> <span class="nam">list</span><span class="op">:</span> <span class="com">#picks the wlev_dif from measurement signal closest to the discrete time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2054" class="mis show_mis"><span class="n"><a href="#t2054">2054</a></span><span class="t">            <span class="nam">operating_time</span> <span class="op">=</span> <span class="op">(</span><span class="num">2</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_width</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_length</span><span class="op">*</span><span class="nam">abs</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">abs</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="op">(</span><span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">-</span><span class="nam">self</span><span class="op">.</span><span class="nam">simulation_start</span><span class="op">)</span><span class="op">)</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">disch_coeff</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">opening_area</span><span class="op">*</span><span class="nam">math</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">2</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">grav_acc</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">opening_depth</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2055" class="pln"><span class="n"><a href="#t2055">2055</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2056" class="mis show_mis"><span class="n"><a href="#t2056">2056</a></span><span class="t">        <span class="key">elif</span> <span class="nam">type</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span><span class="op">)</span> <span class="op">==</span> <span class="nam">float</span> <span class="key">or</span> <span class="nam">type</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span><span class="op">)</span> <span class="op">==</span> <span class="nam">int</span><span class="op">:</span> <span class="com">#constant water level difference</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2057" class="mis show_mis"><span class="n"><a href="#t2057">2057</a></span><span class="t">            <span class="nam">operating_time</span> <span class="op">=</span> <span class="op">(</span><span class="num">2</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_width</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_length</span><span class="op">*</span><span class="nam">abs</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">wlev_dif</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">disch_coeff</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">opening_area</span><span class="op">*</span><span class="nam">math</span><span class="op">.</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">2</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">grav_acc</span><span class="op">*</span><span class="nam">self</span><span class="op">.</span><span class="nam">opening_depth</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2058" class="pln"><span class="n"><a href="#t2058">2058</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2059" class="mis show_mis"><span class="n"><a href="#t2059">2059</a></span><span class="t">        <span class="key">return</span> <span class="nam">operating_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2060" class="pln"><span class="n"><a href="#t2060">2060</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2061" class="run"><span class="n"><a href="#t2061">2061</a></span><span class="t">    <span class="key">def</span> <span class="nam">convert_chamber</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">environment</span><span class="op">,</span> <span class="nam">new_level</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2062" class="pln"><span class="n"><a href="#t2062">2062</a></span><span class="t">        <span class="str">""" Function which converts the lock chamber and logs this event.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2063" class="pln"><span class="n"><a href="#t2063">2063</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2064" class="pln"><span class="n"><a href="#t2064">2064</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2065" class="pln"><span class="n"><a href="#t2065">2065</a></span><span class="t"><span class="str">                - environment: see init function</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2066" class="pln"><span class="n"><a href="#t2066">2066</a></span><span class="t"><span class="str">                - new_level: a string which represents the node and indicates the side at which the lock is currently levelled</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2067" class="pln"><span class="n"><a href="#t2067">2067</a></span><span class="t"><span class="str">                - number_of_vessels: the total number of vessels which are levelled simultaneously"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2068" class="pln"><span class="n"><a href="#t2068">2068</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2069" class="pln"><span class="n"><a href="#t2069">2069</a></span><span class="t">        <span class="com"># Close the doors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2070" class="mis show_mis"><span class="n"><a href="#t2070">2070</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Lock doors closing start"</span><span class="op">,</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2071" class="mis show_mis"><span class="n"><a href="#t2071">2071</a></span><span class="t">        <span class="key">yield</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">doors_close</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2072" class="mis show_mis"><span class="n"><a href="#t2072">2072</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Lock doors closing stop"</span><span class="op">,</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2073" class="pln"><span class="n"><a href="#t2073">2073</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2074" class="pln"><span class="n"><a href="#t2074">2074</a></span><span class="t">        <span class="com"># Convert the chamber</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2075" class="mis show_mis"><span class="n"><a href="#t2075">2075</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Lock chamber converting start"</span><span class="op">,</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2076" class="pln"><span class="n"><a href="#t2076">2076</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2077" class="pln"><span class="n"><a href="#t2077">2077</a></span><span class="t">        <span class="com"># Water level will shift</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2078" class="mis show_mis"><span class="n"><a href="#t2078">2078</a></span><span class="t">        <span class="key">yield</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">operation_time</span><span class="op">(</span><span class="nam">environment</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2079" class="mis show_mis"><span class="n"><a href="#t2079">2079</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">change_water_level</span><span class="op">(</span><span class="nam">new_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2080" class="mis show_mis"><span class="n"><a href="#t2080">2080</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Lock chamber converting stop"</span><span class="op">,</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2081" class="pln"><span class="n"><a href="#t2081">2081</a></span><span class="t">        <span class="com"># Open the doors</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2082" class="mis show_mis"><span class="n"><a href="#t2082">2082</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Lock doors opening start"</span><span class="op">,</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2083" class="mis show_mis"><span class="n"><a href="#t2083">2083</a></span><span class="t">        <span class="key">yield</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">doors_open</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2084" class="mis show_mis"><span class="n"><a href="#t2084">2084</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Lock doors opening stop"</span><span class="op">,</span> <span class="nam">environment</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">number_of_vessels</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2085" class="pln"><span class="n"><a href="#t2085">2085</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2086" class="run"><span class="n"><a href="#t2086">2086</a></span><span class="t">    <span class="key">def</span> <span class="nam">change_water_level</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">side</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2087" class="pln"><span class="n"><a href="#t2087">2087</a></span><span class="t">        <span class="str">""" Function which changes the water level in the lock chamber and priorities in queue """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2088" class="pln"><span class="n"><a href="#t2088">2088</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2089" class="mis show_mis"><span class="n"><a href="#t2089">2089</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">water_level</span> <span class="op">=</span> <span class="nam">side</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2090" class="pln"><span class="n"><a href="#t2090">2090</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2091" class="mis show_mis"><span class="n"><a href="#t2091">2091</a></span><span class="t">        <span class="key">for</span> <span class="nam">request</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2092" class="mis show_mis"><span class="n"><a href="#t2092">2092</a></span><span class="t">            <span class="nam">request</span><span class="op">.</span><span class="nam">priority</span> <span class="op">=</span> <span class="op">-</span><span class="num">1</span> <span class="key">if</span> <span class="nam">request</span><span class="op">.</span><span class="nam">priority</span> <span class="op">==</span> <span class="num">0</span> <span class="key">else</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2093" class="pln"><span class="n"><a href="#t2093">2093</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2094" class="mis show_mis"><span class="n"><a href="#t2094">2094</a></span><span class="t">            <span class="key">if</span> <span class="nam">request</span><span class="op">.</span><span class="nam">priority</span> <span class="op">==</span> <span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2095" class="mis show_mis"><span class="n"><a href="#t2095">2095</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2096" class="pln"><span class="n"><a href="#t2096">2096</a></span><span class="t">                    <span class="num">0</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">request</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2097" class="pln"><span class="n"><a href="#t2097">2097</a></span><span class="t">                <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2098" class="pln"><span class="n"><a href="#t2098">2098</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2099" class="mis show_mis"><span class="n"><a href="#t2099">2099</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2100" class="pln"><span class="n"><a href="#t2100">2100</a></span><span class="t">                    <span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">resource</span><span class="op">.</span><span class="nam">queue</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">request</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2101" class="pln"><span class="n"><a href="#t2101">2101</a></span><span class="t">                <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2102" class="pln"><span class="n"><a href="#t2102">2102</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2103" class="run"><span class="n"><a href="#t2103">2103</a></span><span class="t"><span class="key">class</span> <span class="nam">PassSection</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2104" class="pln"><span class="n"><a href="#t2104">2104</a></span><span class="t">    <span class="str">"""Mixin class: Collection of functions that release and request sections. Important to obey the traffic regulations (safety distance and one-way-traffic) """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2105" class="pln"><span class="n"><a href="#t2105">2105</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2106" class="run"><span class="n"><a href="#t2106">2106</a></span><span class="t">    <span class="key">def</span> <span class="nam">release_access_previous_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2107" class="pln"><span class="n"><a href="#t2107">2107</a></span><span class="t">        <span class="str">""" Function: when a vessel sails out of a section, it releases the request of the previous section</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2108" class="pln"><span class="n"><a href="#t2108">2108</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2109" class="pln"><span class="n"><a href="#t2109">2109</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2110" class="pln"><span class="n"><a href="#t2110">2110</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2111" class="pln"><span class="n"><a href="#t2111">2111</a></span><span class="t"><span class="str">                - origin: string that contains the node that the vessel is currently on</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2112" class="pln"><span class="n"><a href="#t2112">2112</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2113" class="pln"><span class="n"><a href="#t2113">2113</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2114" class="pln"><span class="n"><a href="#t2114">2114</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2115" class="pln"><span class="n"><a href="#t2115">2115</a></span><span class="t">        <span class="com"># Reversely loop over the nodes of the route of the vessel (from the node that it is currently on backwards)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2116" class="mis show_mis"><span class="n"><a href="#t2116">2116</a></span><span class="t">        <span class="key">for</span> <span class="nam">n</span> <span class="key">in</span> <span class="nam">reversed</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">:</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">origin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2117" class="pln"><span class="n"><a href="#t2117">2117</a></span><span class="t">            <span class="com"># If a junction is encountered on that node: extract information of the previous junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2118" class="mis show_mis"><span class="n"><a href="#t2118">2118</a></span><span class="t">            <span class="key">if</span> <span class="str">'Junction'</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2119" class="mis show_mis"><span class="n"><a href="#t2119">2119</a></span><span class="t">                <span class="nam">junction</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">[</span><span class="str">'Junction'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2120" class="pln"><span class="n"><a href="#t2120">2120</a></span><span class="t">                <span class="com"># Loop over the section of that junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2121" class="mis show_mis"><span class="n"><a href="#t2121">2121</a></span><span class="t">                <span class="key">for</span> <span class="nam">section</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">junction</span><span class="op">.</span><span class="nam">section</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2122" class="pln"><span class="n"><a href="#t2122">2122</a></span><span class="t">                    <span class="com"># Pick the correct section by checking which section contains the current node of the vessel:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2123" class="mis show_mis"><span class="n"><a href="#t2123">2123</a></span><span class="t">                    <span class="key">if</span> <span class="nam">origin</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2124" class="mis show_mis"><span class="n"><a href="#t2124">2124</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2125" class="pln"><span class="n"><a href="#t2125">2125</a></span><span class="t">                    <span class="com"># Release the request of that section made previously by the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2126" class="mis show_mis"><span class="n"><a href="#t2126">2126</a></span><span class="t">                    <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_section</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2127" class="pln"><span class="n"><a href="#t2127">2127</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2128" class="pln"><span class="n"><a href="#t2128">2128</a></span><span class="t">                    <span class="com"># If the section is of type 'one-way traffic':</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2129" class="mis show_mis"><span class="n"><a href="#t2129">2129</a></span><span class="t">                    <span class="key">if</span> <span class="nam">junction</span><span class="op">.</span><span class="nam">type</span><span class="op">[</span><span class="nam">section</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'one-way_traffic'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2130" class="pln"><span class="n"><a href="#t2130">2130</a></span><span class="t">                        <span class="com"># If the entrance/exit resources are not in the previous junction: find the current junction and release the specific requests at that junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2131" class="mis show_mis"><span class="n"><a href="#t2131">2131</a></span><span class="t">                        <span class="key">if</span> <span class="str">'access1'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">junction</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2132" class="mis show_mis"><span class="n"><a href="#t2132">2132</a></span><span class="t">                            <span class="nam">junction</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'Junction'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2133" class="mis show_mis"><span class="n"><a href="#t2133">2133</a></span><span class="t">                            <span class="key">for</span> <span class="nam">section</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">junction</span><span class="op">.</span><span class="nam">section</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2134" class="mis show_mis"><span class="n"><a href="#t2134">2134</a></span><span class="t">                                <span class="key">if</span> <span class="nam">n</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2135" class="mis show_mis"><span class="n"><a href="#t2135">2135</a></span><span class="t">                                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2136" class="mis show_mis"><span class="n"><a href="#t2136">2136</a></span><span class="t">                                <span class="nam">junction</span><span class="op">.</span><span class="nam">access2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_entrance_section</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2137" class="mis show_mis"><span class="n"><a href="#t2137">2137</a></span><span class="t">                                <span class="nam">junction</span><span class="op">.</span><span class="nam">access1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_exit_section</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2138" class="pln"><span class="n"><a href="#t2138">2138</a></span><span class="t">                        <span class="com"># Else: release the specific requests of the entrance/exit resources at the previous junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2139" class="pln"><span class="n"><a href="#t2139">2139</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2140" class="mis show_mis"><span class="n"><a href="#t2140">2140</a></span><span class="t">                            <span class="nam">junction</span><span class="op">.</span><span class="nam">access1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_entrance_section</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2141" class="mis show_mis"><span class="n"><a href="#t2141">2141</a></span><span class="t">                            <span class="nam">junction</span><span class="op">.</span><span class="nam">access2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_exit_section</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2142" class="mis show_mis"><span class="n"><a href="#t2142">2142</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2143" class="mis show_mis"><span class="n"><a href="#t2143">2143</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2144" class="mis show_mis"><span class="n"><a href="#t2144">2144</a></span><span class="t">        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2145" class="pln"><span class="n"><a href="#t2145">2145</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2146" class="run"><span class="n"><a href="#t2146">2146</a></span><span class="t">    <span class="key">def</span> <span class="nam">request_access_next_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2147" class="pln"><span class="n"><a href="#t2147">2147</a></span><span class="t">        <span class="str">""" Function: when a vessel sails out of a section, it releases the request of the previous section</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2148" class="pln"><span class="n"><a href="#t2148">2148</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2149" class="pln"><span class="n"><a href="#t2149">2149</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2150" class="pln"><span class="n"><a href="#t2150">2150</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2151" class="pln"><span class="n"><a href="#t2151">2151</a></span><span class="t"><span class="str">                - origin: string that contains the node of the route that the vessel is currently on</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2152" class="pln"><span class="n"><a href="#t2152">2152</a></span><span class="t"><span class="str">                - destination: string that contains the node of the route that the vessel is heading to</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2153" class="pln"><span class="n"><a href="#t2153">2153</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2154" class="pln"><span class="n"><a href="#t2154">2154</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2155" class="pln"><span class="n"><a href="#t2155">2155</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2156" class="pln"><span class="n"><a href="#t2156">2156</a></span><span class="t">        <span class="com"># Loop over the nodes of the route of the vessel (from the node that it is heading to onwards)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2157" class="mis show_mis"><span class="n"><a href="#t2157">2157</a></span><span class="t">        <span class="key">for</span> <span class="nam">n</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2158" class="pln"><span class="n"><a href="#t2158">2158</a></span><span class="t">            <span class="com"># If a junction is encountered on that node: extract information of the current junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2159" class="mis show_mis"><span class="n"><a href="#t2159">2159</a></span><span class="t">            <span class="key">if</span> <span class="str">'Junction'</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2160" class="mis show_mis"><span class="n"><a href="#t2160">2160</a></span><span class="t">                <span class="nam">junction</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'Junction'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2161" class="pln"><span class="n"><a href="#t2161">2161</a></span><span class="t">                <span class="com"># Loop over the section of that junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2162" class="mis show_mis"><span class="n"><a href="#t2162">2162</a></span><span class="t">                <span class="key">for</span> <span class="nam">section</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">junction</span><span class="op">.</span><span class="nam">section</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2163" class="pln"><span class="n"><a href="#t2163">2163</a></span><span class="t">                    <span class="com"># Pick the correct section by checking which section contains the current node of the vessel:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2164" class="mis show_mis"><span class="n"><a href="#t2164">2164</a></span><span class="t">                    <span class="key">if</span> <span class="nam">n</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2165" class="mis show_mis"><span class="n"><a href="#t2165">2165</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2166" class="pln"><span class="n"><a href="#t2166">2166</a></span><span class="t">                    <span class="com"># Setting the stopping distance and stopping time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2167" class="mis show_mis"><span class="n"><a href="#t2167">2167</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">stopping_distance</span> <span class="op">=</span> <span class="num">15</span> <span class="op">*</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2168" class="mis show_mis"><span class="n"><a href="#t2168">2168</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">stopping_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">stopping_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2169" class="pln"><span class="n"><a href="#t2169">2169</a></span><span class="t">                    <span class="com"># If there is already a vessel present in the section and the time the current vessel arrives within the safety distance: request access and yield timeout until safety distance is complied to</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2170" class="mis show_mis"><span class="n"><a href="#t2170">2170</a></span><span class="t">                    <span class="key">if</span> <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">ta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">stopping_time</span><span class="op">)</span> <span class="op">></span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2171" class="mis show_mis"><span class="n"><a href="#t2171">2171</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_section</span> <span class="op">=</span> <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2172" class="mis show_mis"><span class="n"><a href="#t2172">2172</a></span><span class="t">                        <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2173" class="mis show_mis"><span class="n"><a href="#t2173">2173</a></span><span class="t">                        <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">ta</span> <span class="op">=</span> <span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">ta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">stopping_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2174" class="mis show_mis"><span class="n"><a href="#t2174">2174</a></span><span class="t">                        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">]</span><span class="op">.</span><span class="nam">ta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">stopping_time</span><span class="op">)</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2175" class="pln"><span class="n"><a href="#t2175">2175</a></span><span class="t">                    <span class="com"># Else if there are no other vessels present in the section: request access</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2176" class="pln"><span class="n"><a href="#t2176">2176</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2177" class="mis show_mis"><span class="n"><a href="#t2177">2177</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_section</span> <span class="op">=</span> <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2178" class="mis show_mis"><span class="n"><a href="#t2178">2178</a></span><span class="t">                        <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">ta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2179" class="mis show_mis"><span class="n"><a href="#t2179">2179</a></span><span class="t">                        <span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">id</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2180" class="pln"><span class="n"><a href="#t2180">2180</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2181" class="pln"><span class="n"><a href="#t2181">2181</a></span><span class="t">                    <span class="com"># If the section is of type 'one-way traffic':</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2182" class="mis show_mis"><span class="n"><a href="#t2182">2182</a></span><span class="t">                    <span class="key">if</span> <span class="nam">junction</span><span class="op">.</span><span class="nam">type</span><span class="op">[</span><span class="nam">section</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="str">'one-way_traffic'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2183" class="pln"><span class="n"><a href="#t2183">2183</a></span><span class="t">                        <span class="com"># If the entrance/exit resources are not in the current junction: find the next junction and request the specific requests at that junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2184" class="mis show_mis"><span class="n"><a href="#t2184">2184</a></span><span class="t">                        <span class="key">if</span> <span class="str">'access1'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">junction</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2185" class="mis show_mis"><span class="n"><a href="#t2185">2185</a></span><span class="t">                            <span class="nam">junction</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">[</span><span class="str">'Junction'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2186" class="mis show_mis"><span class="n"><a href="#t2186">2186</a></span><span class="t">                            <span class="key">for</span> <span class="nam">section</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">junction</span><span class="op">.</span><span class="nam">section</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2187" class="mis show_mis"><span class="n"><a href="#t2187">2187</a></span><span class="t">                                <span class="key">if</span> <span class="nam">origin</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">section</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2188" class="mis show_mis"><span class="n"><a href="#t2188">2188</a></span><span class="t">                                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2189" class="pln"><span class="n"><a href="#t2189">2189</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2190" class="mis show_mis"><span class="n"><a href="#t2190">2190</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_entrance_section</span> <span class="op">=</span> <span class="nam">junction</span><span class="op">.</span><span class="nam">access2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2191" class="mis show_mis"><span class="n"><a href="#t2191">2191</a></span><span class="t">                                <span class="nam">junction</span><span class="op">.</span><span class="nam">access2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">id</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2192" class="mis show_mis"><span class="n"><a href="#t2192">2192</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_exit_section</span> <span class="op">=</span> <span class="nam">junction</span><span class="op">.</span><span class="nam">access1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2193" class="mis show_mis"><span class="n"><a href="#t2193">2193</a></span><span class="t">                                <span class="nam">junction</span><span class="op">.</span><span class="nam">access1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">id</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2194" class="pln"><span class="n"><a href="#t2194">2194</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2195" class="pln"><span class="n"><a href="#t2195">2195</a></span><span class="t">                        <span class="com"># Else: request the specific requests for the entrance/exit resources at the current junction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2196" class="pln"><span class="n"><a href="#t2196">2196</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2197" class="mis show_mis"><span class="n"><a href="#t2197">2197</a></span><span class="t">                            <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_entrance_section</span> <span class="op">=</span> <span class="nam">junction</span><span class="op">.</span><span class="nam">access1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2198" class="mis show_mis"><span class="n"><a href="#t2198">2198</a></span><span class="t">                            <span class="nam">junction</span><span class="op">.</span><span class="nam">access1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">id</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2199" class="mis show_mis"><span class="n"><a href="#t2199">2199</a></span><span class="t">                            <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_exit_section</span> <span class="op">=</span> <span class="nam">junction</span><span class="op">.</span><span class="nam">access2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2200" class="mis show_mis"><span class="n"><a href="#t2200">2200</a></span><span class="t">                            <span class="nam">junction</span><span class="op">.</span><span class="nam">access2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">id</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">id</span> <span class="com">#section[0]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2201" class="mis show_mis"><span class="n"><a href="#t2201">2201</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2202" class="mis show_mis"><span class="n"><a href="#t2202">2202</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2203" class="mis show_mis"><span class="n"><a href="#t2203">2203</a></span><span class="t">        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2204" class="pln"><span class="n"><a href="#t2204">2204</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2205" class="run"><span class="n"><a href="#t2205">2205</a></span><span class="t"><span class="key">class</span> <span class="nam">PassTerminal</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2206" class="pln"><span class="n"><a href="#t2206">2206</a></span><span class="t">    <span class="str">"""Mixin class: Collection of interacting functions that handle the vessels that call at a terminal and take the correct measures"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2207" class="pln"><span class="n"><a href="#t2207">2207</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2208" class="run"><span class="n"><a href="#t2208">2208</a></span><span class="t">    <span class="key">def</span> <span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2209" class="pln"><span class="n"><a href="#t2209">2209</a></span><span class="t">        <span class="str">""" Function: calulates the time that a vessel has to wait depending on the available tidal windows</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2210" class="pln"><span class="n"><a href="#t2210">2210</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2211" class="pln"><span class="n"><a href="#t2211">2211</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2212" class="pln"><span class="n"><a href="#t2212">2212</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2213" class="pln"><span class="n"><a href="#t2213">2213</a></span><span class="t"><span class="str">                - route: a list of strings that resemble the route of the vessel (can be different than the vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2214" class="pln"><span class="n"><a href="#t2214">2214</a></span><span class="t"><span class="str">                - delay: a delay that can be included to calculate a future situation</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2215" class="pln"><span class="n"><a href="#t2215">2215</a></span><span class="t"><span class="str">                - plot: bool that specifies if a plot is requested or not</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2216" class="pln"><span class="n"><a href="#t2216">2216</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2217" class="pln"><span class="n"><a href="#t2217">2217</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2218" class="pln"><span class="n"><a href="#t2218">2218</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2219" class="pln"><span class="n"><a href="#t2219">2219</a></span><span class="t">        <span class="com"># If the sail-in times of the vessel is not calculated before: request VesselTrafficService what are the available sail-in times given the tidal window policy</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2220" class="mis show_mis"><span class="n"><a href="#t2220">2220</a></span><span class="t">        <span class="key">if</span> <span class="str">'sail_in_times'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">vessel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2221" class="mis show_mis"><span class="n"><a href="#t2221">2221</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_sail_in_times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">=</span><span class="nam">route</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="nam">plot</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2222" class="pln"><span class="n"><a href="#t2222">2222</a></span><span class="t">        <span class="com"># If a vessel is bound for offshore (meaning that sail-out times have already been calculated): store its sail-in times in a parameter and use the sail-out times as input (sail-in times)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2223" class="mis show_mis"><span class="n"><a href="#t2223">2223</a></span><span class="t">        <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">==</span> <span class="str">'outbound'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2224" class="mis show_mis"><span class="n"><a href="#t2224">2224</a></span><span class="t">            <span class="nam">sail_in_times</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2225" class="mis show_mis"><span class="n"><a href="#t2225">2225</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2226" class="pln"><span class="n"><a href="#t2226">2226</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2227" class="pln"><span class="n"><a href="#t2227">2227</a></span><span class="t">        <span class="com"># Set default parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2228" class="mis show_mis"><span class="n"><a href="#t2228">2228</a></span><span class="t">        <span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2229" class="mis show_mis"><span class="n"><a href="#t2229">2229</a></span><span class="t">        <span class="nam">current_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">+</span><span class="nam">delay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2230" class="pln"><span class="n"><a href="#t2230">2230</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2231" class="pln"><span class="n"><a href="#t2231">2231</a></span><span class="t">        <span class="com"># Loop over the available sail-in (or sail-out) times:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2232" class="mis show_mis"><span class="n"><a href="#t2232">2232</a></span><span class="t">        <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2233" class="pln"><span class="n"><a href="#t2233">2233</a></span><span class="t">            <span class="com"># If the next sail-in time contains a starting condition for a restriction: if it is the last time, then let the vessel wait wait for this time, else continue the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2234" class="mis show_mis"><span class="n"><a href="#t2234">2234</a></span><span class="t">            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2235" class="mis show_mis"><span class="n"><a href="#t2235">2235</a></span><span class="t">                <span class="key">if</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2236" class="mis show_mis"><span class="n"><a href="#t2236">2236</a></span><span class="t">                    <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2237" class="mis show_mis"><span class="n"><a href="#t2237">2237</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2238" class="pln"><span class="n"><a href="#t2238">2238</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2239" class="mis show_mis"><span class="n"><a href="#t2239">2239</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2240" class="pln"><span class="n"><a href="#t2240">2240</a></span><span class="t">            <span class="com"># If the current time of the vessel is greater or equal to the next sail-in time containing a stopping condition for a restriction and is smaller than the next starting time of a restriction: waiting time = 0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2241" class="mis show_mis"><span class="n"><a href="#t2241">2241</a></span><span class="t">            <span class="key">if</span> <span class="nam">current_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2242" class="mis show_mis"><span class="n"><a href="#t2242">2242</a></span><span class="t">                <span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2243" class="mis show_mis"><span class="n"><a href="#t2243">2243</a></span><span class="t">                <span class="key">if</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span><span class="op">-</span><span class="num">1</span> <span class="key">or</span> <span class="nam">current_time</span> <span class="op">&lt;</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2244" class="mis show_mis"><span class="n"><a href="#t2244">2244</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2245" class="pln"><span class="n"><a href="#t2245">2245</a></span><span class="t">            <span class="com"># Else if the current time of the vessel is smaller or equal to the next sail-in time containing a stopping condition for a restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2246" class="mis show_mis"><span class="n"><a href="#t2246">2246</a></span><span class="t">            <span class="key">elif</span> <span class="nam">current_time</span> <span class="op">&lt;=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2247" class="pln"><span class="n"><a href="#t2247">2247</a></span><span class="t">                <span class="com"># And is smaller than the previous starting time of a restriction: waiting time = 0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2248" class="mis show_mis"><span class="n"><a href="#t2248">2248</a></span><span class="t">                <span class="key">if</span> <span class="nam">current_time</span> <span class="op">&lt;</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2249" class="mis show_mis"><span class="n"><a href="#t2249">2249</a></span><span class="t">                    <span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2250" class="pln"><span class="n"><a href="#t2250">2250</a></span><span class="t">                <span class="com"># Waiting time = next stopping time - current time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2251" class="pln"><span class="n"><a href="#t2251">2251</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2252" class="mis show_mis"><span class="n"><a href="#t2252">2252</a></span><span class="t">                    <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2253" class="mis show_mis"><span class="n"><a href="#t2253">2253</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2254" class="pln"><span class="n"><a href="#t2254">2254</a></span><span class="t">            <span class="com"># Else if it is the last time, then let the vessel wait wait for this time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2255" class="mis show_mis"><span class="n"><a href="#t2255">2255</a></span><span class="t">            <span class="key">elif</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2256" class="mis show_mis"><span class="n"><a href="#t2256">2256</a></span><span class="t">                <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2257" class="pln"><span class="n"><a href="#t2257">2257</a></span><span class="t">            <span class="com"># Else if none of the above conditions hold: continue the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2258" class="pln"><span class="n"><a href="#t2258">2258</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2259" class="mis show_mis"><span class="n"><a href="#t2259">2259</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2260" class="pln"><span class="n"><a href="#t2260">2260</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2261" class="pln"><span class="n"><a href="#t2261">2261</a></span><span class="t">        <span class="com"># If vessel is bound for offshore: reset the sail-in times to their original</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2262" class="mis show_mis"><span class="n"><a href="#t2262">2262</a></span><span class="t">        <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">==</span> <span class="str">'outbound'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2263" class="mis show_mis"><span class="n"><a href="#t2263">2263</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span> <span class="op">=</span> <span class="nam">sail_in_times</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2264" class="pln"><span class="n"><a href="#t2264">2264</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2265" class="pln"><span class="n"><a href="#t2265">2265</a></span><span class="t">        <span class="com"># Else if the vessel is bound for the terminal: request the sail-out times by reversing the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2266" class="mis show_mis"><span class="n"><a href="#t2266">2266</a></span><span class="t">        <span class="key">elif</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">==</span> <span class="str">'inbound'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2267" class="mis show_mis"><span class="n"><a href="#t2267">2267</a></span><span class="t">            <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2268" class="mis show_mis"><span class="n"><a href="#t2268">2268</a></span><span class="t">            <span class="nam">distance_to_node</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2269" class="mis show_mis"><span class="n"><a href="#t2269">2269</a></span><span class="t">            <span class="nam">route</span><span class="op">.</span><span class="nam">reverse</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2270" class="pln"><span class="n"><a href="#t2270">2270</a></span><span class="t">            <span class="com"># Calculate the total time that a vessel will spend in the port before returning: sailing time of the vessel + 2 times (de)berthing time + (un)loading time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2271" class="mis show_mis"><span class="n"><a href="#t2271">2271</a></span><span class="t">            <span class="key">for</span> <span class="nam">n</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">route</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2272" class="mis show_mis"><span class="n"><a href="#t2272">2272</a></span><span class="t">                <span class="key">if</span> <span class="nam">n</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2273" class="mis show_mis"><span class="n"><a href="#t2273">2273</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2274" class="mis show_mis"><span class="n"><a href="#t2274">2274</a></span><span class="t">                <span class="key">elif</span> <span class="nam">n</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">route</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2275" class="mis show_mis"><span class="n"><a href="#t2275">2275</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2276" class="mis show_mis"><span class="n"><a href="#t2276">2276</a></span><span class="t">                <span class="nam">distance_to_node</span> <span class="op">+=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">'WGS84'</span><span class="op">)</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">n</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2277" class="pln"><span class="n"><a href="#t2277">2277</a></span><span class="t">                                                                   <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">n</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2278" class="pln"><span class="n"><a href="#t2278">2278</a></span><span class="t">                                                                   <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2279" class="pln"><span class="n"><a href="#t2279">2279</a></span><span class="t">                                                                   <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2280" class="pln"><span class="n"><a href="#t2280">2280</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2281" class="mis show_mis"><span class="n"><a href="#t2281">2281</a></span><span class="t">            <span class="nam">sailing_time</span> <span class="op">=</span> <span class="nam">distance_to_node</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2282" class="pln"><span class="n"><a href="#t2282">2282</a></span><span class="t">            <span class="com"># Calculate delay and include in current time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2283" class="mis show_mis"><span class="n"><a href="#t2283">2283</a></span><span class="t">            <span class="nam">delay</span> <span class="op">=</span> <span class="nam">sailing_time</span> <span class="op">+</span> <span class="num">2</span> <span class="op">*</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">waiting_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2284" class="mis show_mis"><span class="n"><a href="#t2284">2284</a></span><span class="t">            <span class="nam">current_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">delay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2285" class="pln"><span class="n"><a href="#t2285">2285</a></span><span class="t">            <span class="com"># Request the sail-out times by temporarily setting the vessel bound as outbound</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2286" class="mis show_mis"><span class="n"><a href="#t2286">2286</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2287" class="mis show_mis"><span class="n"><a href="#t2287">2287</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_sail_in_times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">=</span><span class="nam">route</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="nam">plot</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2288" class="mis show_mis"><span class="n"><a href="#t2288">2288</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2289" class="pln"><span class="n"><a href="#t2289">2289</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2290" class="pln"><span class="n"><a href="#t2290">2290</a></span><span class="t">            <span class="com"># Loop over the provided sail-out times: if there is no suitable tidal window or if the waiting time is too large: set waiting time to maximum waiting time of vessel (it will return without entering the port)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2291" class="mis show_mis"><span class="n"><a href="#t2291">2291</a></span><span class="t">            <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2292" class="pln"><span class="n"><a href="#t2292">2292</a></span><span class="t">                <span class="com"># If the next sail-in time contains a starting condition for a restriction: continue the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2293" class="mis show_mis"><span class="n"><a href="#t2293">2293</a></span><span class="t">                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2294" class="mis show_mis"><span class="n"><a href="#t2294">2294</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2295" class="pln"><span class="n"><a href="#t2295">2295</a></span><span class="t">                <span class="com"># If the current time of the vessel is greater or equal to the next sail-in time containing a stopping condition for a restriction and is smaller than the next starting time of a restriction: break loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2296" class="mis show_mis"><span class="n"><a href="#t2296">2296</a></span><span class="t">                <span class="key">if</span> <span class="nam">current_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2297" class="mis show_mis"><span class="n"><a href="#t2297">2297</a></span><span class="t">                    <span class="key">if</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">)</span><span class="op">-</span><span class="num">1</span> <span class="key">or</span> <span class="nam">current_time</span> <span class="op">&lt;</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">[</span><span class="nam">t</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2298" class="mis show_mis"><span class="n"><a href="#t2298">2298</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2299" class="pln"><span class="n"><a href="#t2299">2299</a></span><span class="t">                <span class="com"># Else if the current time of the vessel is smaller or equal to the next sail-in time containing a stopping condition for a restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2300" class="mis show_mis"><span class="n"><a href="#t2300">2300</a></span><span class="t">                <span class="key">elif</span> <span class="nam">current_time</span> <span class="op">&lt;=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2301" class="pln"><span class="n"><a href="#t2301">2301</a></span><span class="t">                    <span class="com"># Determine if the waiting time is allowed or not: if not revise waiting time to maximum waiting time, else break the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2302" class="mis show_mis"><span class="n"><a href="#t2302">2302</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="nam">current_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2303" class="mis show_mis"><span class="n"><a href="#t2303">2303</a></span><span class="t">                        <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2304" class="pln"><span class="n"><a href="#t2304">2304</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2305" class="mis show_mis"><span class="n"><a href="#t2305">2305</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2306" class="pln"><span class="n"><a href="#t2306">2306</a></span><span class="t">                <span class="com"># Else if it is the last time, then revise waiting time to maximum waiting time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2307" class="mis show_mis"><span class="n"><a href="#t2307">2307</a></span><span class="t">                <span class="key">elif</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_out_times</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2308" class="mis show_mis"><span class="n"><a href="#t2308">2308</a></span><span class="t">                    <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2309" class="pln"><span class="n"><a href="#t2309">2309</a></span><span class="t">                <span class="com"># Else if none of the conditions holds: continue the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2310" class="pln"><span class="n"><a href="#t2310">2310</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2311" class="mis show_mis"><span class="n"><a href="#t2311">2311</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2312" class="pln"><span class="n"><a href="#t2312">2312</a></span><span class="t">            <span class="com"># Reset the route</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2313" class="mis show_mis"><span class="n"><a href="#t2313">2313</a></span><span class="t">            <span class="nam">route</span><span class="op">.</span><span class="nam">reverse</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2314" class="pln"><span class="n"><a href="#t2314">2314</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2315" class="pln"><span class="n"><a href="#t2315">2315</a></span><span class="t">        <span class="com"># Return the vessel waiting time. If the vessel is not able to return within the maximum waiting time at the terminal: the waiting time is unacceptable and the vessel will return</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2316" class="mis show_mis"><span class="n"><a href="#t2316">2316</a></span><span class="t">        <span class="key">return</span> <span class="nam">waiting_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2317" class="pln"><span class="n"><a href="#t2317">2317</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2318" class="run"><span class="n"><a href="#t2318">2318</a></span><span class="t">    <span class="key">def</span> <span class="nam">move_to_anchorage</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">node</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2319" class="pln"><span class="n"><a href="#t2319">2319</a></span><span class="t">        <span class="str">""" Function: moves a vessel to the anchorage area instead of continuing its route to the terminal if a vessel is required to wait in the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2320" class="pln"><span class="n"><a href="#t2320">2320</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2321" class="pln"><span class="n"><a href="#t2321">2321</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2322" class="pln"><span class="n"><a href="#t2322">2322</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2323" class="pln"><span class="n"><a href="#t2323">2323</a></span><span class="t"><span class="str">                - node: a string that contains the node of the route that the vessel is currently on</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2324" class="pln"><span class="n"><a href="#t2324">2324</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2325" class="pln"><span class="n"><a href="#t2325">2325</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2326" class="pln"><span class="n"><a href="#t2326">2326</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2327" class="pln"><span class="n"><a href="#t2327">2327</a></span><span class="t">        <span class="com"># Set some default parameters:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2328" class="mis show_mis"><span class="n"><a href="#t2328">2328</a></span><span class="t">        <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2329" class="mis show_mis"><span class="n"><a href="#t2329">2329</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_in_anchorage</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2330" class="mis show_mis"><span class="n"><a href="#t2330">2330</a></span><span class="t">        <span class="nam">nodes_of_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2331" class="mis show_mis"><span class="n"><a href="#t2331">2331</a></span><span class="t">        <span class="nam">capacity_of_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2332" class="mis show_mis"><span class="n"><a href="#t2332">2332</a></span><span class="t">        <span class="nam">users_of_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2333" class="mis show_mis"><span class="n"><a href="#t2333">2333</a></span><span class="t">        <span class="nam">sailing_distances_from_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2334" class="pln"><span class="n"><a href="#t2334">2334</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2335" class="pln"><span class="n"><a href="#t2335">2335</a></span><span class="t">        <span class="com"># Loop over the nodes of the network and identify all the anchorage areas:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2336" class="mis show_mis"><span class="n"><a href="#t2336">2336</a></span><span class="t">        <span class="key">for</span> <span class="nam">node_anchorage</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2337" class="mis show_mis"><span class="n"><a href="#t2337">2337</a></span><span class="t">            <span class="key">if</span> <span class="str">'Anchorage'</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node_anchorage</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2338" class="pln"><span class="n"><a href="#t2338">2338</a></span><span class="t">                <span class="com">#Extract information over the individual anchorage areas: capacity, users, and the sailing distance to the anchorage area from the designated terminal the vessel is planning to call</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2339" class="mis show_mis"><span class="n"><a href="#t2339">2339</a></span><span class="t">                <span class="nam">nodes_of_anchorages</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">node_anchorage</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2340" class="mis show_mis"><span class="n"><a href="#t2340">2340</a></span><span class="t">                <span class="nam">capacity_of_anchorages</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node_anchorage</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">anchorage_area</span><span class="op">[</span><span class="nam">node_anchorage</span><span class="op">]</span><span class="op">.</span><span class="nam">capacity</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2341" class="mis show_mis"><span class="n"><a href="#t2341">2341</a></span><span class="t">                <span class="nam">users_of_anchorages</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node_anchorage</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">anchorage_area</span><span class="op">[</span><span class="nam">node_anchorage</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2342" class="mis show_mis"><span class="n"><a href="#t2342">2342</a></span><span class="t">                <span class="nam">route_from_anchorage</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">node_anchorage</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2343" class="mis show_mis"><span class="n"><a href="#t2343">2343</a></span><span class="t">                <span class="nam">sailing_distance_from_anchorage</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2344" class="mis show_mis"><span class="n"><a href="#t2344">2344</a></span><span class="t">                <span class="key">for</span> <span class="nam">route_node</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">route_from_anchorage</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2345" class="mis show_mis"><span class="n"><a href="#t2345">2345</a></span><span class="t">                    <span class="key">if</span> <span class="nam">route_node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2346" class="mis show_mis"><span class="n"><a href="#t2346">2346</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2347" class="mis show_mis"><span class="n"><a href="#t2347">2347</a></span><span class="t">                    <span class="nam">_</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">distance</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route_from_anchorage</span><span class="op">[</span><span class="nam">route_node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2348" class="pln"><span class="n"><a href="#t2348">2348</a></span><span class="t">                                                      <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route_from_anchorage</span><span class="op">[</span><span class="nam">route_node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2349" class="pln"><span class="n"><a href="#t2349">2349</a></span><span class="t">                                                      <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route_from_anchorage</span><span class="op">[</span><span class="nam">route_node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2350" class="pln"><span class="n"><a href="#t2350">2350</a></span><span class="t">                                                      <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route_from_anchorage</span><span class="op">[</span><span class="nam">route_node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2351" class="mis show_mis"><span class="n"><a href="#t2351">2351</a></span><span class="t">                    <span class="nam">sailing_distance_from_anchorage</span> <span class="op">+=</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2352" class="mis show_mis"><span class="n"><a href="#t2352">2352</a></span><span class="t">                <span class="nam">sailing_distances_from_anchorages</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">sailing_distance_from_anchorage</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2353" class="pln"><span class="n"><a href="#t2353">2353</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2354" class="pln"><span class="n"><a href="#t2354">2354</a></span><span class="t">        <span class="com"># Sort the lists based on the sailing distance to the anchorage area from the designated terminal the vessel is planning to call</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2355" class="mis show_mis"><span class="n"><a href="#t2355">2355</a></span><span class="t">        <span class="nam">sorted_nodes_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="nam">nodes</span> <span class="key">for</span> <span class="op">(</span><span class="nam">distances</span><span class="op">,</span><span class="nam">nodes</span><span class="op">)</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">sailing_distances_from_anchorages</span><span class="op">,</span> <span class="nam">nodes_of_anchorages</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2356" class="mis show_mis"><span class="n"><a href="#t2356">2356</a></span><span class="t">        <span class="nam">sorted_users_of_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="nam">nodes</span> <span class="key">for</span> <span class="op">(</span><span class="nam">distances</span><span class="op">,</span><span class="nam">nodes</span><span class="op">)</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">sailing_distances_from_anchorages</span><span class="op">,</span> <span class="nam">users_of_anchorages</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2357" class="mis show_mis"><span class="n"><a href="#t2357">2357</a></span><span class="t">        <span class="nam">sorted_capacity_of_anchorages</span> <span class="op">=</span> <span class="op">[</span><span class="nam">nodes</span> <span class="key">for</span> <span class="op">(</span><span class="nam">distances</span><span class="op">,</span><span class="nam">nodes</span><span class="op">)</span> <span class="key">in</span> <span class="nam">sorted</span><span class="op">(</span><span class="nam">zip</span><span class="op">(</span><span class="nam">sailing_distances_from_anchorages</span><span class="op">,</span> <span class="nam">capacity_of_anchorages</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2358" class="pln"><span class="n"><a href="#t2358">2358</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2359" class="pln"><span class="n"><a href="#t2359">2359</a></span><span class="t">        <span class="com"># Take the anchorage area that is closest to the designated terminal the vessel is planning to call if there is sufficient capacity:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2360" class="mis show_mis"><span class="n"><a href="#t2360">2360</a></span><span class="t">        <span class="nam">node_anchorage</span> <span class="op">=</span> <span class="nam">sorted_nodes_anchorages</span><span class="op">[</span><span class="nam">np</span><span class="op">.</span><span class="nam">argmin</span><span class="op">(</span><span class="nam">sailing_distances_from_anchorages</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2361" class="mis show_mis"><span class="n"><a href="#t2361">2361</a></span><span class="t">        <span class="key">for</span> <span class="nam">node_anchorage_area</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">sorted_nodes_anchorages</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2362" class="mis show_mis"><span class="n"><a href="#t2362">2362</a></span><span class="t">            <span class="key">if</span> <span class="nam">sorted_users_of_anchorages</span><span class="op">[</span><span class="nam">node_anchorage_area</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">sorted_capacity_of_anchorages</span><span class="op">[</span><span class="nam">node_anchorage_area</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2363" class="mis show_mis"><span class="n"><a href="#t2363">2363</a></span><span class="t">                <span class="nam">node_anchorage</span> <span class="op">=</span> <span class="nam">node_anchorage_area</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2364" class="mis show_mis"><span class="n"><a href="#t2364">2364</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2365" class="pln"><span class="n"><a href="#t2365">2365</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2366" class="pln"><span class="n"><a href="#t2366">2366</a></span><span class="t">        <span class="com"># If there is not an available anchorage area: leave the port after entering the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2367" class="mis show_mis"><span class="n"><a href="#t2367">2367</a></span><span class="t">        <span class="key">if</span> <span class="nam">node_anchorage</span> <span class="op">!=</span> <span class="nam">node_anchorage_area</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2368" class="mis show_mis"><span class="n"><a href="#t2368">2368</a></span><span class="t">           <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2369" class="mis show_mis"><span class="n"><a href="#t2369">2369</a></span><span class="t">           <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2370" class="pln"><span class="n"><a href="#t2370">2370</a></span><span class="t">        <span class="com"># Set the route that the vessel will take after calling at the terminal (back to the origin) and after waiting in the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2371" class="mis show_mis"><span class="n"><a href="#t2371">2371</a></span><span class="t">        <span class="nam">anchorage</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node_anchorage</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2372" class="mis show_mis"><span class="n"><a href="#t2372">2372</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2373" class="mis show_mis"><span class="n"><a href="#t2373">2373</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">true_origin</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2374" class="mis show_mis"><span class="n"><a href="#t2374">2374</a></span><span class="t">        <span class="nam">current_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2375" class="mis show_mis"><span class="n"><a href="#t2375">2375</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">node_anchorage</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2376" class="mis show_mis"><span class="n"><a href="#t2376">2376</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2377" class="pln"><span class="n"><a href="#t2377">2377</a></span><span class="t">        <span class="com"># Start the moving process by setting the route of the vessel from current node to chosen anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2378" class="mis show_mis"><span class="n"><a href="#t2378">2378</a></span><span class="t">        <span class="key">yield</span> <span class="key">from</span> <span class="nam">Movable</span><span class="op">.</span><span class="nam">pass_edge</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2379" class="mis show_mis"><span class="n"><a href="#t2379">2379</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">node_anchorage</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2380" class="mis show_mis"><span class="n"><a href="#t2380">2380</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2381" class="mis show_mis"><span class="n"><a href="#t2381">2381</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">move</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2382" class="mis show_mis"><span class="n"><a href="#t2382">2382</a></span><span class="t">        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2383" class="pln"><span class="n"><a href="#t2383">2383</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2384" class="run"><span class="n"><a href="#t2384">2384</a></span><span class="t">    <span class="key">def</span> <span class="nam">pass_anchorage</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">node</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2385" class="pln"><span class="n"><a href="#t2385">2385</a></span><span class="t">        <span class="str">""" Function: function that handles a vessel waiting in an anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2386" class="pln"><span class="n"><a href="#t2386">2386</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2387" class="pln"><span class="n"><a href="#t2387">2387</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2388" class="pln"><span class="n"><a href="#t2388">2388</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2389" class="pln"><span class="n"><a href="#t2389">2389</a></span><span class="t"><span class="str">                - node: string that contains the node of the route that the vessel is moving to (the anchorage area)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2390" class="pln"><span class="n"><a href="#t2390">2390</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2391" class="pln"><span class="n"><a href="#t2391">2391</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2392" class="pln"><span class="n"><a href="#t2392">2392</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2393" class="pln"><span class="n"><a href="#t2393">2393</a></span><span class="t">        <span class="com"># Set default parameter and extract information of anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2394" class="mis show_mis"><span class="n"><a href="#t2394">2394</a></span><span class="t">        <span class="nam">network</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2395" class="mis show_mis"><span class="n"><a href="#t2395">2395</a></span><span class="t">        <span class="nam">anchorage</span> <span class="op">=</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2396" class="pln"><span class="n"><a href="#t2396">2396</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2397" class="pln"><span class="n"><a href="#t2397">2397</a></span><span class="t">        <span class="com"># Moves the vessel to the node of the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2398" class="pln"><span class="n"><a href="#t2398">2398</a></span><span class="t">        <span class="com">#yield from Movable.pass_edge(vessel, vessel.route[vessel.route.index(node) - 1],vessel.route[vessel.route.index(node)])</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2399" class="pln"><span class="n"><a href="#t2399">2399</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2400" class="pln"><span class="n"><a href="#t2400">2400</a></span><span class="t">        <span class="com"># Request access to the anchorage area and log this to the anchorage area log and vessel log (including the calculated value for the net ukc)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2401" class="mis show_mis"><span class="n"><a href="#t2401">2401</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">anchorage_access</span> <span class="op">=</span> <span class="nam">anchorage</span><span class="op">.</span><span class="nam">anchorage_area</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2402" class="mis show_mis"><span class="n"><a href="#t2402">2402</a></span><span class="t">        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">anchorage_access</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2403" class="mis show_mis"><span class="n"><a href="#t2403">2403</a></span><span class="t">        <span class="nam">anchorage</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel arrival"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">anchorage</span><span class="op">.</span><span class="nam">anchorage_area</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">)</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2404" class="mis show_mis"><span class="n"><a href="#t2404">2404</a></span><span class="t">        <span class="nam">current_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2405" class="mis show_mis"><span class="n"><a href="#t2405">2405</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2406" class="mis show_mis"><span class="n"><a href="#t2406">2406</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting in anchorage start"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2407" class="pln"><span class="n"><a href="#t2407">2407</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2408" class="pln"><span class="n"><a href="#t2408">2408</a></span><span class="t">        <span class="com"># Determine the sailing distance to the destined terminal (important for later in the calculation)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2409" class="mis show_mis"><span class="n"><a href="#t2409">2409</a></span><span class="t">        <span class="nam">edge</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2410" class="mis show_mis"><span class="n"><a href="#t2410">2410</a></span><span class="t">        <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2411" class="mis show_mis"><span class="n"><a href="#t2411">2411</a></span><span class="t">        <span class="nam">sailing_distance</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2412" class="mis show_mis"><span class="n"><a href="#t2412">2412</a></span><span class="t">        <span class="key">for</span> <span class="nam">nodes</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2413" class="mis show_mis"><span class="n"><a href="#t2413">2413</a></span><span class="t">            <span class="nam">_</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">distance</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2414" class="pln"><span class="n"><a href="#t2414">2414</a></span><span class="t">                                              <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2415" class="pln"><span class="n"><a href="#t2415">2415</a></span><span class="t">                                              <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2416" class="pln"><span class="n"><a href="#t2416">2416</a></span><span class="t">                                              <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2417" class="mis show_mis"><span class="n"><a href="#t2417">2417</a></span><span class="t">            <span class="nam">sailing_distance</span> <span class="op">+=</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2418" class="pln"><span class="n"><a href="#t2418">2418</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2419" class="pln"><span class="n"><a href="#t2419">2419</a></span><span class="t">        <span class="com"># If the vessel is allowed in (so has not to return to sea) and should wait in the anchorage area for an available berth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2420" class="mis show_mis"><span class="n"><a href="#t2420">2420</a></span><span class="t">        <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">==</span> <span class="key">False</span> <span class="key">and</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_for_availability_terminal</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2421" class="pln"><span class="n"><a href="#t2421">2421</a></span><span class="t">            <span class="com"># Vessel waits for the available berth, or if it takes longer than the permitted maximum waiting time: the vessel will wait until that specific waiting time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2422" class="mis show_mis"><span class="n"><a href="#t2422">2422</a></span><span class="t">            <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_in_anchorage</span> <span class="op">|</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2423" class="mis show_mis"><span class="n"><a href="#t2423">2423</a></span><span class="t">            <span class="nam">new_current_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2424" class="pln"><span class="n"><a href="#t2424">2424</a></span><span class="t">            <span class="com"># If waiting time is greater or equal than the maximum waiting time: vessel returns to sea and releases its request for the berth at the terminal of call</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2425" class="mis show_mis"><span class="n"><a href="#t2425">2425</a></span><span class="t">            <span class="key">if</span> <span class="nam">new_current_time</span> <span class="op">-</span> <span class="nam">current_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2426" class="mis show_mis"><span class="n"><a href="#t2426">2426</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2427" class="mis show_mis"><span class="n"><a href="#t2427">2427</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2428" class="mis show_mis"><span class="n"><a href="#t2428">2428</a></span><span class="t">                <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span> <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2429" class="mis show_mis"><span class="n"><a href="#t2429">2429</a></span><span class="t">                <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span> <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2430" class="mis show_mis"><span class="n"><a href="#t2430">2430</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_in_anchorage</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2431" class="pln"><span class="n"><a href="#t2431">2431</a></span><span class="t">            <span class="com"># Else:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2432" class="pln"><span class="n"><a href="#t2432">2432</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2433" class="pln"><span class="n"><a href="#t2433">2433</a></span><span class="t">                <span class="com"># If terminal of call is of type 'quay': determine the quay position, request the quay length and adjust the available quay length</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2434" class="mis show_mis"><span class="n"><a href="#t2434">2434</a></span><span class="t">                <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2435" class="mis show_mis"><span class="n"><a href="#t2435">2435</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_quay_position</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">request_quay_position</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2436" class="mis show_mis"><span class="n"><a href="#t2436">2436</a></span><span class="t">                    <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">adjust_available_quay_lengths</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_quay_position</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2437" class="mis show_mis"><span class="n"><a href="#t2437">2437</a></span><span class="t">                    <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2438" class="pln"><span class="n"><a href="#t2438">2438</a></span><span class="t">                <span class="com"># Else if terminal of call is of type 'jetty': request terminal again (with priority) before releasing the initial request (based on which the waiting time was calculated)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2439" class="mis show_mis"><span class="n"><a href="#t2439">2439</a></span><span class="t">                <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2440" class="mis show_mis"><span class="n"><a href="#t2440">2440</a></span><span class="t">                    <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2441" class="mis show_mis"><span class="n"><a href="#t2441">2441</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="nam">priority</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2442" class="mis show_mis"><span class="n"><a href="#t2442">2442</a></span><span class="t">                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_in_anchorage</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2443" class="mis show_mis"><span class="n"><a href="#t2443">2443</a></span><span class="t">                    <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2444" class="pln"><span class="n"><a href="#t2444">2444</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2445" class="pln"><span class="n"><a href="#t2445">2445</a></span><span class="t">                <span class="com"># Determine the new sail-in times of the vessel (since the vessel had to wait in the anchorage area, the available sail-in times are now different)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2446" class="mis show_mis"><span class="n"><a href="#t2446">2446</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_sail_in_times_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2447" class="pln"><span class="n"><a href="#t2447">2447</a></span><span class="t">                <span class="com"># Loop over the sail-in times to determine if the vessel should wait or not, or even has to return to sea (due to non-allowable waiting time by exceeding the set maximum)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2448" class="mis show_mis"><span class="n"><a href="#t2448">2448</a></span><span class="t">                <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2449" class="pln"><span class="n"><a href="#t2449">2449</a></span><span class="t">                    <span class="com"># If the next sail-in time contains a starting condition for a restriction: if it is the last time, then let the vessel wait wait for this time (if permitted, else return to sea), else continue the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2450" class="mis show_mis"><span class="n"><a href="#t2450">2450</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="str">'Start'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2451" class="mis show_mis"><span class="n"><a href="#t2451">2451</a></span><span class="t">                        <span class="key">if</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2452" class="mis show_mis"><span class="n"><a href="#t2452">2452</a></span><span class="t">                            <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2453" class="mis show_mis"><span class="n"><a href="#t2453">2453</a></span><span class="t">                            <span class="key">if</span> <span class="nam">waiting_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2454" class="mis show_mis"><span class="n"><a href="#t2454">2454</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2455" class="mis show_mis"><span class="n"><a href="#t2455">2455</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2456" class="mis show_mis"><span class="n"><a href="#t2456">2456</a></span><span class="t">                                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2457" class="mis show_mis"><span class="n"><a href="#t2457">2457</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2458" class="pln"><span class="n"><a href="#t2458">2458</a></span><span class="t">                            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2459" class="pln"><span class="n"><a href="#t2459">2459</a></span><span class="t">                                <span class="com"># Yield waiting time and if terminal of call is of type 'jetty': calculate the estimated time of arrival and departure (important for the queuing procedure)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2460" class="mis show_mis"><span class="n"><a href="#t2460">2460</a></span><span class="t">                                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2461" class="mis show_mis"><span class="n"><a href="#t2461">2461</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">new_current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2462" class="mis show_mis"><span class="n"><a href="#t2462">2462</a></span><span class="t">                                    <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2463" class="mis show_mis"><span class="n"><a href="#t2463">2463</a></span><span class="t">                                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2464" class="mis show_mis"><span class="n"><a href="#t2464">2464</a></span><span class="t">                                    <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2465" class="mis show_mis"><span class="n"><a href="#t2465">2465</a></span><span class="t">                                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2466" class="mis show_mis"><span class="n"><a href="#t2466">2466</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2467" class="mis show_mis"><span class="n"><a href="#t2467">2467</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2468" class="mis show_mis"><span class="n"><a href="#t2468">2468</a></span><span class="t">                                <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">new_current_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2469" class="mis show_mis"><span class="n"><a href="#t2469">2469</a></span><span class="t">                            <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2470" class="pln"><span class="n"><a href="#t2470">2470</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2471" class="mis show_mis"><span class="n"><a href="#t2471">2471</a></span><span class="t">                            <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2472" class="pln"><span class="n"><a href="#t2472">2472</a></span><span class="t">                    <span class="com"># If the current time of the vessel is greater or equal to the next sail-in time containing a stopping condition for a restriction and is smaller than the next starting time of a restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2473" class="mis show_mis"><span class="n"><a href="#t2473">2473</a></span><span class="t">                    <span class="key">if</span> <span class="nam">new_current_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2474" class="mis show_mis"><span class="n"><a href="#t2474">2474</a></span><span class="t">                        <span class="key">if</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">or</span> <span class="nam">new_current_time</span> <span class="op">&lt;</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2475" class="pln"><span class="n"><a href="#t2475">2475</a></span><span class="t">                            <span class="com"># No waiting time and if terminal of call is of type 'jetty': calculate the estimated time of arrival and departure (important for the queuing procedure)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2476" class="mis show_mis"><span class="n"><a href="#t2476">2476</a></span><span class="t">                            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2477" class="mis show_mis"><span class="n"><a href="#t2477">2477</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2478" class="mis show_mis"><span class="n"><a href="#t2478">2478</a></span><span class="t">                                <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2479" class="mis show_mis"><span class="n"><a href="#t2479">2479</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2480" class="mis show_mis"><span class="n"><a href="#t2480">2480</a></span><span class="t">                                <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2481" class="mis show_mis"><span class="n"><a href="#t2481">2481</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2482" class="mis show_mis"><span class="n"><a href="#t2482">2482</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2483" class="mis show_mis"><span class="n"><a href="#t2483">2483</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2484" class="mis show_mis"><span class="n"><a href="#t2484">2484</a></span><span class="t">                            <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2485" class="pln"><span class="n"><a href="#t2485">2485</a></span><span class="t">                    <span class="com"># Else if the current time of the vessel is smaller or equal to the next sail-in time containing a stopping condition for a restriction</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2486" class="mis show_mis"><span class="n"><a href="#t2486">2486</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">new_current_time</span> <span class="op">&lt;=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2487" class="pln"><span class="n"><a href="#t2487">2487</a></span><span class="t">                        <span class="com"># If the current time of the vessel is smaller than the next starting time of a restriction:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2488" class="mis show_mis"><span class="n"><a href="#t2488">2488</a></span><span class="t">                        <span class="key">if</span> <span class="nam">new_current_time</span> <span class="op">&lt;</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2489" class="pln"><span class="n"><a href="#t2489">2489</a></span><span class="t">                            <span class="com"># No waiting time and if terminal of call is of type 'jetty': calculate the estimated time of arrival and departure (important for the queuing procedure)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2490" class="mis show_mis"><span class="n"><a href="#t2490">2490</a></span><span class="t">                            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2491" class="mis show_mis"><span class="n"><a href="#t2491">2491</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2492" class="mis show_mis"><span class="n"><a href="#t2492">2492</a></span><span class="t">                                <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2493" class="mis show_mis"><span class="n"><a href="#t2493">2493</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2494" class="mis show_mis"><span class="n"><a href="#t2494">2494</a></span><span class="t">                                <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2495" class="mis show_mis"><span class="n"><a href="#t2495">2495</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2496" class="mis show_mis"><span class="n"><a href="#t2496">2496</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2497" class="mis show_mis"><span class="n"><a href="#t2497">2497</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2498" class="pln"><span class="n"><a href="#t2498">2498</a></span><span class="t">                        <span class="com"># Else: there is waiting time: determine if allowed or not (exceeds the maximum permitted or not)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2499" class="pln"><span class="n"><a href="#t2499">2499</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2500" class="mis show_mis"><span class="n"><a href="#t2500">2500</a></span><span class="t">                            <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2501" class="mis show_mis"><span class="n"><a href="#t2501">2501</a></span><span class="t">                            <span class="key">if</span> <span class="nam">waiting_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2502" class="mis show_mis"><span class="n"><a href="#t2502">2502</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2503" class="mis show_mis"><span class="n"><a href="#t2503">2503</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2504" class="mis show_mis"><span class="n"><a href="#t2504">2504</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2505" class="pln"><span class="n"><a href="#t2505">2505</a></span><span class="t">                            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2506" class="pln"><span class="n"><a href="#t2506">2506</a></span><span class="t">                                <span class="com"># Yield waiting time and if terminal of call is of type 'jetty': calculate the estimated time of arrival and departure (important for the queuing procedure)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2507" class="mis show_mis"><span class="n"><a href="#t2507">2507</a></span><span class="t">                                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2508" class="mis show_mis"><span class="n"><a href="#t2508">2508</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">new_current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2509" class="mis show_mis"><span class="n"><a href="#t2509">2509</a></span><span class="t">                                    <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2510" class="mis show_mis"><span class="n"><a href="#t2510">2510</a></span><span class="t">                                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2511" class="mis show_mis"><span class="n"><a href="#t2511">2511</a></span><span class="t">                                    <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2512" class="mis show_mis"><span class="n"><a href="#t2512">2512</a></span><span class="t">                                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2513" class="mis show_mis"><span class="n"><a href="#t2513">2513</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2514" class="mis show_mis"><span class="n"><a href="#t2514">2514</a></span><span class="t">                                    <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2515" class="mis show_mis"><span class="n"><a href="#t2515">2515</a></span><span class="t">                                <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">new_current_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2516" class="mis show_mis"><span class="n"><a href="#t2516">2516</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2517" class="pln"><span class="n"><a href="#t2517">2517</a></span><span class="t">                    <span class="com"># Else if it is the last time, then there is waiting time, so determine if allowed or not (exceeds the maximum permitted or not)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2518" class="mis show_mis"><span class="n"><a href="#t2518">2518</a></span><span class="t">                    <span class="key">elif</span> <span class="nam">t</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2519" class="mis show_mis"><span class="n"><a href="#t2519">2519</a></span><span class="t">                        <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2520" class="mis show_mis"><span class="n"><a href="#t2520">2520</a></span><span class="t">                        <span class="key">if</span> <span class="nam">waiting_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2521" class="mis show_mis"><span class="n"><a href="#t2521">2521</a></span><span class="t">                            <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2522" class="mis show_mis"><span class="n"><a href="#t2522">2522</a></span><span class="t">                            <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2523" class="mis show_mis"><span class="n"><a href="#t2523">2523</a></span><span class="t">                            <span class="nam">terminal</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2524" class="pln"><span class="n"><a href="#t2524">2524</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2525" class="pln"><span class="n"><a href="#t2525">2525</a></span><span class="t">                            <span class="com"># Yield waiting time and if terminal of call is of type 'jetty': calculate the estimated time of arrival and departure (important for the queuing procedure)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2526" class="mis show_mis"><span class="n"><a href="#t2526">2526</a></span><span class="t">                            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2527" class="mis show_mis"><span class="n"><a href="#t2527">2527</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">new_current_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2528" class="mis show_mis"><span class="n"><a href="#t2528">2528</a></span><span class="t">                                <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2529" class="mis show_mis"><span class="n"><a href="#t2529">2529</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2530" class="mis show_mis"><span class="n"><a href="#t2530">2530</a></span><span class="t">                                <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2531" class="mis show_mis"><span class="n"><a href="#t2531">2531</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2532" class="mis show_mis"><span class="n"><a href="#t2532">2532</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2533" class="mis show_mis"><span class="n"><a href="#t2533">2533</a></span><span class="t">                                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2534" class="mis show_mis"><span class="n"><a href="#t2534">2534</a></span><span class="t">                            <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">sail_in_times</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">-</span> <span class="nam">new_current_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2535" class="pln"><span class="n"><a href="#t2535">2535</a></span><span class="t">                    <span class="com"># Else if none of the conditions holds: continue the loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2536" class="pln"><span class="n"><a href="#t2536">2536</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2537" class="mis show_mis"><span class="n"><a href="#t2537">2537</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2538" class="pln"><span class="n"><a href="#t2538">2538</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2539" class="pln"><span class="n"><a href="#t2539">2539</a></span><span class="t">        <span class="com"># Else if the vessel (so has not to return to sea) and should wait in the anchorage area for an available tidal window:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2540" class="mis show_mis"><span class="n"><a href="#t2540">2540</a></span><span class="t">        <span class="key">elif</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">==</span> <span class="key">False</span> <span class="key">and</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2541" class="pln"><span class="n"><a href="#t2541">2541</a></span><span class="t">            <span class="com"># If terminal of call is of type 'jetty': calculate the estimated time of arrival and departure (important for the queuing procedure) including the waiting time for the tidal window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2542" class="mis show_mis"><span class="n"><a href="#t2542">2542</a></span><span class="t">            <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2543" class="mis show_mis"><span class="n"><a href="#t2543">2543</a></span><span class="t">                <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2544" class="mis show_mis"><span class="n"><a href="#t2544">2544</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2545" class="mis show_mis"><span class="n"><a href="#t2545">2545</a></span><span class="t">                <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2546" class="mis show_mis"><span class="n"><a href="#t2546">2546</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2547" class="mis show_mis"><span class="n"><a href="#t2547">2547</a></span><span class="t">                <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2548" class="mis show_mis"><span class="n"><a href="#t2548">2548</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2549" class="mis show_mis"><span class="n"><a href="#t2549">2549</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2550" class="mis show_mis"><span class="n"><a href="#t2550">2550</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2551" class="pln"><span class="n"><a href="#t2551">2551</a></span><span class="t">            <span class="com"># Else if terminal of call is of type 'quay': vessel will pick predetermined quay position, get this length, so adjust available quay lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2552" class="mis show_mis"><span class="n"><a href="#t2552">2552</a></span><span class="t">            <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2553" class="mis show_mis"><span class="n"><a href="#t2553">2553</a></span><span class="t">                <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">adjust_available_quay_lengths</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_quay_position</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2554" class="pln"><span class="n"><a href="#t2554">2554</a></span><span class="t">            <span class="com"># Determine the new time: if the maximum allowabel waiting time will be or has been exceeded: return to sea, otherwise yield waiting time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2555" class="mis show_mis"><span class="n"><a href="#t2555">2555</a></span><span class="t">            <span class="nam">new_current_time</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2556" class="mis show_mis"><span class="n"><a href="#t2556">2556</a></span><span class="t">            <span class="key">if</span> <span class="nam">new_current_time</span> <span class="op">-</span> <span class="nam">current_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2557" class="mis show_mis"><span class="n"><a href="#t2557">2557</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2558" class="mis show_mis"><span class="n"><a href="#t2558">2558</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2559" class="mis show_mis"><span class="n"><a href="#t2559">2559</a></span><span class="t">            <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2560" class="pln"><span class="n"><a href="#t2560">2560</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2561" class="pln"><span class="n"><a href="#t2561">2561</a></span><span class="t">        <span class="com"># If vessel does not has to return to sea: log this in the anchorage log and vessel log, set the route from anchorage to terminal, release the access to the section to the anchorage area, and request access to the first section on its route and initate the move</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2562" class="mis show_mis"><span class="n"><a href="#t2562">2562</a></span><span class="t">        <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">==</span> <span class="key">False</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2563" class="mis show_mis"><span class="n"><a href="#t2563">2563</a></span><span class="t">            <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2564" class="mis show_mis"><span class="n"><a href="#t2564">2564</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting in anchorage stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2565" class="mis show_mis"><span class="n"><a href="#t2565">2565</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2566" class="pln"><span class="n"><a href="#t2566">2566</a></span><span class="t">        <span class="com"># Else if the vessel has to return to sea: log this as well in the log files of the anchorage and vessel, set route back to origin, release the access to the section to the anchorage area, and request access to the first section on its route and initate the move</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2567" class="pln"><span class="n"><a href="#t2567">2567</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2568" class="mis show_mis"><span class="n"><a href="#t2568">2568</a></span><span class="t">            <span class="key">if</span> <span class="str">'waiting_time_in_anchorage'</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">vessel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2569" class="mis show_mis"><span class="n"><a href="#t2569">2569</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_in_anchorage</span><span class="op">.</span><span class="nam">cancel</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2570" class="mis show_mis"><span class="n"><a href="#t2570">2570</a></span><span class="t">            <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2571" class="mis show_mis"><span class="n"><a href="#t2571">2571</a></span><span class="t">            <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2572" class="mis show_mis"><span class="n"><a href="#t2572">2572</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting in anchorage stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2573" class="mis show_mis"><span class="n"><a href="#t2573">2573</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">true_origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2574" class="mis show_mis"><span class="n"><a href="#t2574">2574</a></span><span class="t">        <span class="nam">PassSection</span><span class="op">.</span><span class="nam">release_access_previous_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2575" class="mis show_mis"><span class="n"><a href="#t2575">2575</a></span><span class="t">        <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassSection</span><span class="op">.</span><span class="nam">request_access_next_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2576" class="mis show_mis"><span class="n"><a href="#t2576">2576</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2577" class="pln"><span class="n"><a href="#t2577">2577</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2578" class="mis show_mis"><span class="n"><a href="#t2578">2578</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">move</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2579" class="mis show_mis"><span class="n"><a href="#t2579">2579</a></span><span class="t">        <span class="nam">anchorage</span><span class="op">.</span><span class="nam">anchorage_area</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">anchorage_access</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2580" class="mis show_mis"><span class="n"><a href="#t2580">2580</a></span><span class="t">        <span class="nam">anchorage</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel departure"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">anchorage</span><span class="op">.</span><span class="nam">anchorage_area</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">)</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2581" class="pln"><span class="n"><a href="#t2581">2581</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2582" class="run"><span class="n"><a href="#t2582">2582</a></span><span class="t">    <span class="key">def</span> <span class="nam">request_quay_position</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2583" class="pln"><span class="n"><a href="#t2583">2583</a></span><span class="t">        <span class="str">""" Function that claims a length along the quay equal to the length of the vessel itself and calculates the relative position of the vessel along the quay. If there are multiple</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2584" class="pln"><span class="n"><a href="#t2584">2584</a></span><span class="t"><span class="str">            relative positions possible, the vessel claims the first position. If there is no suitable position availalble (vessel does not fit), then it returns the action</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2585" class="pln"><span class="n"><a href="#t2585">2585</a></span><span class="t"><span class="str">            of moving to the anchorage area.</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2586" class="pln"><span class="n"><a href="#t2586">2586</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2587" class="pln"><span class="n"><a href="#t2587">2587</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2588" class="pln"><span class="n"><a href="#t2588">2588</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2589" class="pln"><span class="n"><a href="#t2589">2589</a></span><span class="t"><span class="str">                - terminal: the terminal of call of the vessel, created with the IsTerminal-class</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2590" class="pln"><span class="n"><a href="#t2590">2590</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2591" class="pln"><span class="n"><a href="#t2591">2591</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2592" class="pln"><span class="n"><a href="#t2592">2592</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2593" class="pln"><span class="n"><a href="#t2593">2593</a></span><span class="t">        <span class="com"># Set some default parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2594" class="mis show_mis"><span class="n"><a href="#t2594">2594</a></span><span class="t">        <span class="nam">available_quay_lengths</span> <span class="op">=</span> <span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2595" class="mis show_mis"><span class="n"><a href="#t2595">2595</a></span><span class="t">        <span class="nam">aql</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span> <span class="com">#the current configuration of vessels located at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2596" class="mis show_mis"><span class="n"><a href="#t2596">2596</a></span><span class="t">        <span class="nam">index_quay_position</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2597" class="mis show_mis"><span class="n"><a href="#t2597">2597</a></span><span class="t">        <span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2598" class="pln"><span class="n"><a href="#t2598">2598</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2599" class="pln"><span class="n"><a href="#t2599">2599</a></span><span class="t">        <span class="com"># Loop over the locations of the current configuration of vessels located at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2600" class="mis show_mis"><span class="n"><a href="#t2600">2600</a></span><span class="t">        <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2601" class="pln"><span class="n"><a href="#t2601">2601</a></span><span class="t">            <span class="com"># If the index of the locaton is 0, or if the previous location is the same as the current location (and hence the index of the location is not 0) or if the location is not available (value = 1):</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2602" class="mis show_mis"><span class="n"><a href="#t2602">2602</a></span><span class="t">            <span class="key">if</span> <span class="nam">index</span> <span class="op">==</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">or</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2603" class="pln"><span class="n"><a href="#t2603">2603</a></span><span class="t">                <span class="com"># Continue, else if its the last index and there is not yet a suitable index found for an available location: return that vessel has to move to anchorage</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2604" class="mis show_mis"><span class="n"><a href="#t2604">2604</a></span><span class="t">                <span class="key">if</span> <span class="nam">index</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">index_quay_position</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2605" class="mis show_mis"><span class="n"><a href="#t2605">2605</a></span><span class="t">                    <span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2606" class="mis show_mis"><span class="n"><a href="#t2606">2606</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2607" class="pln"><span class="n"><a href="#t2607">2607</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2608" class="pln"><span class="n"><a href="#t2608">2608</a></span><span class="t">            <span class="com"># If there is an available location: append indexes to list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2609" class="mis show_mis"><span class="n"><a href="#t2609">2609</a></span><span class="t">            <span class="nam">available_quay_lengths</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2610" class="pln"><span class="n"><a href="#t2610">2610</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2611" class="pln"><span class="n"><a href="#t2611">2611</a></span><span class="t">            <span class="com"># Loop over the list:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2612" class="mis show_mis"><span class="n"><a href="#t2612">2612</a></span><span class="t">            <span class="key">for</span> <span class="nam">jndex</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">available_quay_lengths</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2613" class="pln"><span class="n"><a href="#t2613">2613</a></span><span class="t">                <span class="com"># If there is the available location is suitable (available length of that location is greater than the vessel length): return index and break loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2614" class="mis show_mis"><span class="n"><a href="#t2614">2614</a></span><span class="t">                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">&lt;=</span> <span class="nam">available_quay_lengths</span><span class="op">[</span><span class="nam">jndex</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2615" class="mis show_mis"><span class="n"><a href="#t2615">2615</a></span><span class="t">                    <span class="nam">index_quay_position</span> <span class="op">=</span> <span class="nam">index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2616" class="mis show_mis"><span class="n"><a href="#t2616">2616</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2617" class="pln"><span class="n"><a href="#t2617">2617</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2618" class="pln"><span class="n"><a href="#t2618">2618</a></span><span class="t">                <span class="com"># Else: if there were not available locations found: return that vessel has to move to anchorage</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2619" class="mis show_mis"><span class="n"><a href="#t2619">2619</a></span><span class="t">                <span class="key">elif</span> <span class="nam">jndex</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">available_quay_lengths</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">index_quay_position</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2620" class="mis show_mis"><span class="n"><a href="#t2620">2620</a></span><span class="t">                    <span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2621" class="pln"><span class="n"><a href="#t2621">2621</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2622" class="pln"><span class="n"><a href="#t2622">2622</a></span><span class="t">            <span class="com"># The index can only still be default if the vessel has to move to the anchorage area: so break the loop then</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2623" class="mis show_mis"><span class="n"><a href="#t2623">2623</a></span><span class="t">            <span class="key">if</span> <span class="nam">index_quay_position</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2624" class="mis show_mis"><span class="n"><a href="#t2624">2624</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2625" class="pln"><span class="n"><a href="#t2625">2625</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2626" class="mis show_mis"><span class="n"><a href="#t2626">2626</a></span><span class="t">        <span class="key">return</span> <span class="nam">index_quay_position</span><span class="op">,</span> <span class="nam">move_to_anchorage</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2627" class="pln"><span class="n"><a href="#t2627">2627</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2628" class="run"><span class="n"><a href="#t2628">2628</a></span><span class="t">    <span class="key">def</span> <span class="nam">calculate_quay_length_level</span><span class="op">(</span><span class="nam">terminal</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2629" class="pln"><span class="n"><a href="#t2629">2629</a></span><span class="t">        <span class="str">""" Function that keeps track of the maximum length that is available at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2630" class="pln"><span class="n"><a href="#t2630">2630</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2631" class="pln"><span class="n"><a href="#t2631">2631</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2632" class="pln"><span class="n"><a href="#t2632">2632</a></span><span class="t"><span class="str">                - terminal: the terminal of call of the vessel, created with the IsTerminal-class</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2633" class="pln"><span class="n"><a href="#t2633">2633</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2634" class="pln"><span class="n"><a href="#t2634">2634</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2635" class="pln"><span class="n"><a href="#t2635">2635</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2636" class="pln"><span class="n"><a href="#t2636">2636</a></span><span class="t">        <span class="com"># Set default parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2637" class="mis show_mis"><span class="n"><a href="#t2637">2637</a></span><span class="t">        <span class="nam">aql</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2638" class="mis show_mis"><span class="n"><a href="#t2638">2638</a></span><span class="t">        <span class="nam">available_quay_lengths</span> <span class="op">=</span> <span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2639" class="pln"><span class="n"><a href="#t2639">2639</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2640" class="pln"><span class="n"><a href="#t2640">2640</a></span><span class="t">        <span class="com"># Loop over the position indexes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2641" class="mis show_mis"><span class="n"><a href="#t2641">2641</a></span><span class="t">        <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2642" class="pln"><span class="n"><a href="#t2642">2642</a></span><span class="t">            <span class="com"># If the index of the locaton is 0, or if the previous location is the same as the current location (and hence the index of the location is not 0) or if the location is not available (value = 1):</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2643" class="mis show_mis"><span class="n"><a href="#t2643">2643</a></span><span class="t">            <span class="key">if</span> <span class="nam">index</span> <span class="op">==</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="key">or</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2644" class="pln"><span class="n"><a href="#t2644">2644</a></span><span class="t">                <span class="com"># Continue, else if its the last index and there is not yet a suitable index found for an available location: return that available length is the last one in the list (=0)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2645" class="mis show_mis"><span class="n"><a href="#t2645">2645</a></span><span class="t">                <span class="key">if</span> <span class="nam">index</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2646" class="mis show_mis"><span class="n"><a href="#t2646">2646</a></span><span class="t">                    <span class="nam">new_level</span> <span class="op">=</span> <span class="nam">available_quay_lengths</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2647" class="mis show_mis"><span class="n"><a href="#t2647">2647</a></span><span class="t">                <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2648" class="pln"><span class="n"><a href="#t2648">2648</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2649" class="pln"><span class="n"><a href="#t2649">2649</a></span><span class="t">            <span class="com"># If there is an available location: append length to list and return the maximum of the list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2650" class="mis show_mis"><span class="n"><a href="#t2650">2650</a></span><span class="t">            <span class="nam">available_quay_lengths</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">-</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2651" class="mis show_mis"><span class="n"><a href="#t2651">2651</a></span><span class="t">            <span class="nam">new_level</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="nam">available_quay_lengths</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2652" class="mis show_mis"><span class="n"><a href="#t2652">2652</a></span><span class="t">        <span class="key">return</span> <span class="nam">new_level</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2653" class="pln"><span class="n"><a href="#t2653">2653</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2654" class="run"><span class="n"><a href="#t2654">2654</a></span><span class="t">    <span class="key">def</span> <span class="nam">adjust_available_quay_lengths</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">,</span> <span class="nam">index_quay_position</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2655" class="pln"><span class="n"><a href="#t2655">2655</a></span><span class="t">        <span class="str">""" Function that adjusts the available quay lenghts and positions given a honored request of a vessel at a given position</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2656" class="pln"><span class="n"><a href="#t2656">2656</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2657" class="pln"><span class="n"><a href="#t2657">2657</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2658" class="pln"><span class="n"><a href="#t2658">2658</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2659" class="pln"><span class="n"><a href="#t2659">2659</a></span><span class="t"><span class="str">                - terminal: the terminal of call of the vessel, created with the IsTerminal-class</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2660" class="pln"><span class="n"><a href="#t2660">2660</a></span><span class="t"><span class="str">                - index_quay_position: quay position index at which the vessel is located at the quay with respect to the other vessels</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2661" class="pln"><span class="n"><a href="#t2661">2661</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2662" class="pln"><span class="n"><a href="#t2662">2662</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2663" class="pln"><span class="n"><a href="#t2663">2663</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2664" class="pln"><span class="n"><a href="#t2664">2664</a></span><span class="t">        <span class="com"># Import the locations of the current configuration of vessels located at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2665" class="mis show_mis"><span class="n"><a href="#t2665">2665</a></span><span class="t">        <span class="nam">aql</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2666" class="pln"><span class="n"><a href="#t2666">2666</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2667" class="pln"><span class="n"><a href="#t2667">2667</a></span><span class="t">        <span class="com"># Determine the current maximum available length of the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2668" class="mis show_mis"><span class="n"><a href="#t2668">2668</a></span><span class="t">        <span class="nam">old_level</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">calculate_quay_length_level</span><span class="op">(</span><span class="nam">terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2669" class="pln"><span class="n"><a href="#t2669">2669</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2670" class="pln"><span class="n"><a href="#t2670">2670</a></span><span class="t">        <span class="com"># If the value of the position index before the honered quay position (start of the available position) is still available (=0), change it to 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2671" class="mis show_mis"><span class="n"><a href="#t2671">2671</a></span><span class="t">        <span class="key">if</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2672" class="mis show_mis"><span class="n"><a href="#t2672">2672</a></span><span class="t">            <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2673" class="pln"><span class="n"><a href="#t2673">2673</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2674" class="pln"><span class="n"><a href="#t2674">2674</a></span><span class="t">        <span class="com"># If the value of the honered quay position (end of the available position) is still available (=0) and the end of this position equals the start of the position added with the vessel length, change it to 1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2675" class="mis show_mis"><span class="n"><a href="#t2675">2675</a></span><span class="t">        <span class="key">if</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2676" class="mis show_mis"><span class="n"><a href="#t2676">2676</a></span><span class="t">            <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2677" class="pln"><span class="n"><a href="#t2677">2677</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2678" class="pln"><span class="n"><a href="#t2678">2678</a></span><span class="t">        <span class="com"># Else insert a new stopping location in the locations of the current configuration of vessels located at the quay by twice adding the vessel length to the start position of the location, once with a occupied value (=1), followed by a available value (=0)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2679" class="pln"><span class="n"><a href="#t2679">2679</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2680" class="mis show_mis"><span class="n"><a href="#t2680">2680</a></span><span class="t">            <span class="nam">aql</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="nam">index_quay_position</span><span class="op">,</span> <span class="op">[</span><span class="num">1</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">+</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2681" class="mis show_mis"><span class="n"><a href="#t2681">2681</a></span><span class="t">            <span class="nam">aql</span><span class="op">.</span><span class="nam">insert</span><span class="op">(</span><span class="nam">index_quay_position</span> <span class="op">+</span> <span class="num">1</span><span class="op">,</span> <span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">+</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2682" class="pln"><span class="n"><a href="#t2682">2682</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2683" class="pln"><span class="n"><a href="#t2683">2683</a></span><span class="t">        <span class="com"># Replace the list of the locations of the current configuration of vessels located at the quay of the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2684" class="mis show_mis"><span class="n"><a href="#t2684">2684</a></span><span class="t">        <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span> <span class="op">=</span> <span class="nam">aql</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2685" class="pln"><span class="n"><a href="#t2685">2685</a></span><span class="t">        <span class="com"># Calculate the quay position and append to the vessel (mid-length of the vessel + starting length of the position)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2686" class="mis show_mis"><span class="n"><a href="#t2686">2686</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">quay_position</span> <span class="op">=</span> <span class="num">0.5</span> <span class="op">*</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">+</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index_quay_position</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2687" class="pln"><span class="n"><a href="#t2687">2687</a></span><span class="t">        <span class="com"># Determine the new current maximum available length of the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2688" class="mis show_mis"><span class="n"><a href="#t2688">2688</a></span><span class="t">        <span class="nam">new_level</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">calculate_quay_length_level</span><span class="op">(</span><span class="nam">terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2689" class="pln"><span class="n"><a href="#t2689">2689</a></span><span class="t">        <span class="com"># If the old level does not equal (is greater than) the new level and the vessel does not have to wait in the anchorage first: then claim the difference between these lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2690" class="mis show_mis"><span class="n"><a href="#t2690">2690</a></span><span class="t">        <span class="key">if</span> <span class="nam">old_level</span> <span class="op">!=</span> <span class="nam">new_level</span> <span class="key">and</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_in_anchorage</span> <span class="op">!=</span> <span class="key">True</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2691" class="mis show_mis"><span class="n"><a href="#t2691">2691</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">old_level</span> <span class="op">-</span> <span class="nam">new_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2692" class="pln"><span class="n"><a href="#t2692">2692</a></span><span class="t">        <span class="com"># Else if the vessel has to wait in the anchorage first: calculate the difference between the lengths corrected by the vessel length to be claimed by the vessel (account for this vessel, so that it has priority over new vessels)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2693" class="mis show_mis"><span class="n"><a href="#t2693">2693</a></span><span class="t">        <span class="key">elif</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_in_anchorage</span> <span class="op">==</span> <span class="key">True</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2694" class="mis show_mis"><span class="n"><a href="#t2694">2694</a></span><span class="t">            <span class="nam">new_level</span> <span class="op">=</span> <span class="nam">old_level</span><span class="op">-</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">-</span><span class="nam">new_level</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2695" class="pln"><span class="n"><a href="#t2695">2695</a></span><span class="t">            <span class="com"># If this difference is negative: give absolute length back to terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2696" class="mis show_mis"><span class="n"><a href="#t2696">2696</a></span><span class="t">            <span class="key">if</span> <span class="nam">new_level</span> <span class="op">&lt;</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2697" class="mis show_mis"><span class="n"><a href="#t2697">2697</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">put</span><span class="op">(</span><span class="op">-</span><span class="nam">new_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2698" class="pln"><span class="n"><a href="#t2698">2698</a></span><span class="t">            <span class="com"># Else if this difference is positive: claim this length of the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2699" class="mis show_mis"><span class="n"><a href="#t2699">2699</a></span><span class="t">            <span class="key">elif</span> <span class="nam">new_level</span> <span class="op">></span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2700" class="mis show_mis"><span class="n"><a href="#t2700">2700</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">new_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2701" class="mis show_mis"><span class="n"><a href="#t2701">2701</a></span><span class="t">        <span class="key">return</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2702" class="pln"><span class="n"><a href="#t2702">2702</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2703" class="run"><span class="n"><a href="#t2703">2703</a></span><span class="t">    <span class="key">def</span> <span class="nam">request_terminal_access</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">,</span> <span class="nam">node</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2704" class="pln"><span class="n"><a href="#t2704">2704</a></span><span class="t">        <span class="str">""" Function: function that handles the request of a vessel to access the terminal of call: it lets the vessel move to the correct terminal (quay position and jetty) or moves it to the</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2705" class="pln"><span class="n"><a href="#t2705">2705</a></span><span class="t"><span class="str">            anchorage area to wait on either the terminal (quay or jetty) availability or tidal window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2706" class="pln"><span class="n"><a href="#t2706">2706</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2707" class="pln"><span class="n"><a href="#t2707">2707</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2708" class="pln"><span class="n"><a href="#t2708">2708</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2709" class="pln"><span class="n"><a href="#t2709">2709</a></span><span class="t"><span class="str">                - edge: list of two strings that form the edge at which the terminal is located</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2710" class="pln"><span class="n"><a href="#t2710">2710</a></span><span class="t"><span class="str">                - node: string that contains the node of the route that the vessel is currently on (either the origin or anchorage area)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2711" class="pln"><span class="n"><a href="#t2711">2711</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2712" class="pln"><span class="n"><a href="#t2712">2712</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2713" class="pln"><span class="n"><a href="#t2713">2713</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2714" class="pln"><span class="n"><a href="#t2714">2714</a></span><span class="t">        <span class="com"># Set some default parameters</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2715" class="mis show_mis"><span class="n"><a href="#t2715">2715</a></span><span class="t">        <span class="nam">node</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2716" class="mis show_mis"><span class="n"><a href="#t2716">2716</a></span><span class="t">        <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2717" class="mis show_mis"><span class="n"><a href="#t2717">2717</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2718" class="mis show_mis"><span class="n"><a href="#t2718">2718</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_in_anchorage</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2719" class="mis show_mis"><span class="n"><a href="#t2719">2719</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_for_availability_terminal</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2720" class="pln"><span class="n"><a href="#t2720">2720</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2721" class="pln"><span class="n"><a href="#t2721">2721</a></span><span class="t">        <span class="com"># Function that is used in the request procedure</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2722" class="mis show_mis"><span class="n"><a href="#t2722">2722</a></span><span class="t">        <span class="key">def</span> <span class="nam">checks_waiting_time_due_to_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span><span class="op">,</span> <span class="nam">node</span><span class="op">,</span> <span class="nam">maximum_waiting_time</span> <span class="op">=</span> <span class="key">False</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2723" class="pln"><span class="n"><a href="#t2723">2723</a></span><span class="t">            <span class="str">""" Function: function that checks if the vessel arrives beyond a tidal window and calculates the waiting time if that is the case (or return no waiting time otherwise)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2724" class="pln"><span class="n"><a href="#t2724">2724</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2725" class="pln"><span class="n"><a href="#t2725">2725</a></span><span class="t"><span class="str">                Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2726" class="pln"><span class="n"><a href="#t2726">2726</a></span><span class="t"><span class="str">                    - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2727" class="pln"><span class="n"><a href="#t2727">2727</a></span><span class="t"><span class="str">                    - route: list of strings that resemble the route of the vessel (can be different than vessel.route)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2728" class="pln"><span class="n"><a href="#t2728">2728</a></span><span class="t"><span class="str">                    - node: string that contains the node of the route that the vessel is currently on (origin)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2729" class="pln"><span class="n"><a href="#t2729">2729</a></span><span class="t"><span class="str">                    - maximum_waiting_time: bool that specifies if there is a maximum to the waiting time of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2730" class="pln"><span class="n"><a href="#t2730">2730</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2731" class="pln"><span class="n"><a href="#t2731">2731</a></span><span class="t"><span class="str">            """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2732" class="pln"><span class="n"><a href="#t2732">2732</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2733" class="pln"><span class="n"><a href="#t2733">2733</a></span><span class="t">            <span class="com"># Calculate the waiting time using the waiting_time_for_tidal_window-function</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2734" class="mis show_mis"><span class="n"><a href="#t2734">2734</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">=</span><span class="nam">route</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2735" class="pln"><span class="n"><a href="#t2735">2735</a></span><span class="t">            <span class="com"># If there is a maximum waiting time and this is exceeded: vessel will have to return to sea with zero waiting time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2736" class="mis show_mis"><span class="n"><a href="#t2736">2736</a></span><span class="t">            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'max_waiting_time'</span><span class="op">]</span> <span class="key">and</span> <span class="nam">maximum_waiting_time</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2737" class="mis show_mis"><span class="n"><a href="#t2737">2737</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2738" class="mis show_mis"><span class="n"><a href="#t2738">2738</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2739" class="pln"><span class="n"><a href="#t2739">2739</a></span><span class="t">            <span class="com"># Else: vessel does not have to return to sea</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2740" class="pln"><span class="n"><a href="#t2740">2740</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2741" class="mis show_mis"><span class="n"><a href="#t2741">2741</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2742" class="pln"><span class="n"><a href="#t2742">2742</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2743" class="pln"><span class="n"><a href="#t2743">2743</a></span><span class="t">        <span class="com"># Calculate the waiting time and whether this waiting time is acceptable</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2744" class="mis show_mis"><span class="n"><a href="#t2744">2744</a></span><span class="t">        <span class="nam">checks_waiting_time_due_to_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">route</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">,</span> <span class="nam">node</span> <span class="op">=</span> <span class="nam">node</span><span class="op">,</span> <span class="nam">maximum_waiting_time</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2745" class="pln"><span class="n"><a href="#t2745">2745</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2746" class="pln"><span class="n"><a href="#t2746">2746</a></span><span class="t">        <span class="com"># Set default parameter</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2747" class="mis show_mis"><span class="n"><a href="#t2747">2747</a></span><span class="t">        <span class="nam">available_turning_basin</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2748" class="pln"><span class="n"><a href="#t2748">2748</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2749" class="pln"><span class="n"><a href="#t2749">2749</a></span><span class="t">        <span class="com"># Loop over the nodes of the route and determine whether there is turning basin that suits the vessel (dependent on a vessel length restriction)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2750" class="mis show_mis"><span class="n"><a href="#t2750">2750</a></span><span class="t">        <span class="key">for</span> <span class="nam">basin</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2751" class="mis show_mis"><span class="n"><a href="#t2751">2751</a></span><span class="t">            <span class="key">if</span> <span class="str">'Turning Basin'</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">basin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2752" class="mis show_mis"><span class="n"><a href="#t2752">2752</a></span><span class="t">                <span class="nam">turning_basin</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">basin</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning Basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2753" class="mis show_mis"><span class="n"><a href="#t2753">2753</a></span><span class="t">                <span class="key">if</span> <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">length</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2754" class="mis show_mis"><span class="n"><a href="#t2754">2754</a></span><span class="t">                    <span class="nam">available_turning_basin</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2755" class="mis show_mis"><span class="n"><a href="#t2755">2755</a></span><span class="t">                    <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2756" class="pln"><span class="n"><a href="#t2756">2756</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2757" class="pln"><span class="n"><a href="#t2757">2757</a></span><span class="t">        <span class="com"># If there is no available turning basin: vessel will have to return to sea without waiting in the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2758" class="mis show_mis"><span class="n"><a href="#t2758">2758</a></span><span class="t">        <span class="key">if</span> <span class="nam">available_turning_basin</span> <span class="op">==</span> <span class="key">False</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2759" class="mis show_mis"><span class="n"><a href="#t2759">2759</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2760" class="mis show_mis"><span class="n"><a href="#t2760">2760</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2761" class="pln"><span class="n"><a href="#t2761">2761</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2762" class="pln"><span class="n"><a href="#t2762">2762</a></span><span class="t">        <span class="com"># If vessel does not have to return to sea:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2763" class="mis show_mis"><span class="n"><a href="#t2763">2763</a></span><span class="t">        <span class="key">if</span> <span class="key">not</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2764" class="pln"><span class="n"><a href="#t2764">2764</a></span><span class="t">            <span class="com"># If the terminal is of type 'jetty:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2765" class="mis show_mis"><span class="n"><a href="#t2765">2765</a></span><span class="t">            <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2766" class="pln"><span class="n"><a href="#t2766">2766</a></span><span class="t">                <span class="com"># Set empty default lists</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2767" class="mis show_mis"><span class="n"><a href="#t2767">2767</a></span><span class="t">                <span class="nam">minimum_waiting_time</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2768" class="mis show_mis"><span class="n"><a href="#t2768">2768</a></span><span class="t">                <span class="nam">vessels_waiting</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2769" class="pln"><span class="n"><a href="#t2769">2769</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2770" class="pln"><span class="n"><a href="#t2770">2770</a></span><span class="t">                <span class="com"># Loop over the jetties of the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2771" class="mis show_mis"><span class="n"><a href="#t2771">2771</a></span><span class="t">                <span class="key">for</span> <span class="nam">jetty</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2772" class="pln"><span class="n"><a href="#t2772">2772</a></span><span class="t">                    <span class="com"># If the length of the vessel is greater than the maximum allowable length of the jetty: vessel has to move to the anchorage area (for now), but continue loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2773" class="mis show_mis"><span class="n"><a href="#t2773">2773</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">></span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetty_lengths</span><span class="op">[</span><span class="nam">jetty</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2774" class="mis show_mis"><span class="n"><a href="#t2774">2774</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2775" class="mis show_mis"><span class="n"><a href="#t2775">2775</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2776" class="pln"><span class="n"><a href="#t2776">2776</a></span><span class="t">                    <span class="com"># Else if the length of the vessel is less or equal than the maximum allowable length of the jetty and there are no vessels at this jetty or waiting for this jetty: vessel does not have to move to the anchorage area, break loop</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2777" class="mis show_mis"><span class="n"><a href="#t2777">2777</a></span><span class="t">                    <span class="key">if</span> <span class="nam">jetty</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span> <span class="key">and</span> <span class="nam">jetty</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">queue</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2778" class="mis show_mis"><span class="n"><a href="#t2778">2778</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span> <span class="op">=</span> <span class="nam">jetty</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2779" class="mis show_mis"><span class="n"><a href="#t2779">2779</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2780" class="mis show_mis"><span class="n"><a href="#t2780">2780</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2781" class="pln"><span class="n"><a href="#t2781">2781</a></span><span class="t">                    <span class="com"># Else if the length of the vessel is less or equal than the maximum allowable length of the jetty but there are vessel at this jetty already or waiting for this jetty:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2782" class="pln"><span class="n"><a href="#t2782">2782</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2783" class="pln"><span class="n"><a href="#t2783">2783</a></span><span class="t">                        <span class="com"># If the queue is still empty: calculate the estimated time of departure of the currently (un)loading vessel and append to list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2784" class="mis show_mis"><span class="n"><a href="#t2784">2784</a></span><span class="t">                        <span class="key">if</span> <span class="nam">jetty</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">queue</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2785" class="mis show_mis"><span class="n"><a href="#t2785">2785</a></span><span class="t">                            <span class="nam">minimum_waiting_time</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">jetty</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2786" class="pln"><span class="n"><a href="#t2786">2786</a></span><span class="t">                        <span class="com"># Else append zero to the list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2787" class="pln"><span class="n"><a href="#t2787">2787</a></span><span class="t">                        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2788" class="mis show_mis"><span class="n"><a href="#t2788">2788</a></span><span class="t">                            <span class="nam">minimum_waiting_time</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2789" class="pln"><span class="n"><a href="#t2789">2789</a></span><span class="t">                        <span class="com"># Append the number of vessels waiting in the queue for the specific jetty to the list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2790" class="mis show_mis"><span class="n"><a href="#t2790">2790</a></span><span class="t">                        <span class="nam">vessels_waiting</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">jetty</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">queue</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2791" class="pln"><span class="n"><a href="#t2791">2791</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2792" class="pln"><span class="n"><a href="#t2792">2792</a></span><span class="t">                        <span class="com"># Continue loop if the jetty is not the last jetty in the list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2793" class="mis show_mis"><span class="n"><a href="#t2793">2793</a></span><span class="t">                        <span class="key">if</span> <span class="nam">jetty</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2794" class="mis show_mis"><span class="n"><a href="#t2794">2794</a></span><span class="t">                            <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2795" class="pln"><span class="n"><a href="#t2795">2795</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2796" class="pln"><span class="n"><a href="#t2796">2796</a></span><span class="t">                    <span class="com"># If loop is not broken, then vessel has to move to the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2797" class="mis show_mis"><span class="n"><a href="#t2797">2797</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2798" class="pln"><span class="n"><a href="#t2798">2798</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2799" class="pln"><span class="n"><a href="#t2799">2799</a></span><span class="t">            <span class="com"># Else if the terminal is of type 'quay:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2800" class="mis show_mis"><span class="n"><a href="#t2800">2800</a></span><span class="t">            <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2801" class="pln"><span class="n"><a href="#t2801">2801</a></span><span class="t">                <span class="com"># Import the locations of the current configuration of vessels located at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2802" class="mis show_mis"><span class="n"><a href="#t2802">2802</a></span><span class="t">                <span class="nam">aql</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2803" class="pln"><span class="n"><a href="#t2803">2803</a></span><span class="t">                <span class="com"># If the queue of vessels waiting for an available quay length is still empty: request quay position</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2804" class="mis show_mis"><span class="n"><a href="#t2804">2804</a></span><span class="t">                <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">get_queue</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2805" class="mis show_mis"><span class="n"><a href="#t2805">2805</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_quay_position</span><span class="op">,</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">request_quay_position</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2806" class="pln"><span class="n"><a href="#t2806">2806</a></span><span class="t">                <span class="com"># Else if this queue is not empty: vessel has to move to anchorage area (according to FCFS-policy)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2807" class="pln"><span class="n"><a href="#t2807">2807</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2808" class="mis show_mis"><span class="n"><a href="#t2808">2808</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2809" class="pln"><span class="n"><a href="#t2809">2809</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2810" class="pln"><span class="n"><a href="#t2810">2810</a></span><span class="t">            <span class="com"># If the vessel has some waiting time due to the fact that it has arrived beyond a tidal window (move to anchorage still set to False)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2811" class="mis show_mis"><span class="n"><a href="#t2811">2811</a></span><span class="t">            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="key">and</span> <span class="key">not</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2812" class="mis show_mis"><span class="n"><a href="#t2812">2812</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">move_to_anchorage</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2813" class="pln"><span class="n"><a href="#t2813">2813</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2814" class="pln"><span class="n"><a href="#t2814">2814</a></span><span class="t">            <span class="com"># Else if the vessel has to wait because there is no available spot at the terminal (move to anchorage was set to True)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2815" class="mis show_mis"><span class="n"><a href="#t2815">2815</a></span><span class="t">            <span class="key">elif</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">move_to_anchorage</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2816" class="pln"><span class="n"><a href="#t2816">2816</a></span><span class="t">                <span class="com"># Set bool that says that vessel has to wait in the anchorage area because its waiting for an available spot at the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2817" class="mis show_mis"><span class="n"><a href="#t2817">2817</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_for_availability_terminal</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2818" class="pln"><span class="n"><a href="#t2818">2818</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2819" class="pln"><span class="n"><a href="#t2819">2819</a></span><span class="t">                <span class="com"># If the terminal is of type 'quay:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2820" class="mis show_mis"><span class="n"><a href="#t2820">2820</a></span><span class="t">                <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2821" class="pln"><span class="n"><a href="#t2821">2821</a></span><span class="t">                    <span class="com"># Make a request by getting the length of the terminal equal to the length of the vessel (which was not available), which functions as a yield timeout event equal to the waiting time for availability terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2822" class="mis show_mis"><span class="n"><a href="#t2822">2822</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_in_anchorage</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2823" class="pln"><span class="n"><a href="#t2823">2823</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2824" class="pln"><span class="n"><a href="#t2824">2824</a></span><span class="t">                <span class="com"># Else if the terminal is of type 'jetty:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2825" class="mis show_mis"><span class="n"><a href="#t2825">2825</a></span><span class="t">                <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2826" class="pln"><span class="n"><a href="#t2826">2826</a></span><span class="t">                    <span class="com"># Set defual position index of the jetty</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2827" class="mis show_mis"><span class="n"><a href="#t2827">2827</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2828" class="pln"><span class="n"><a href="#t2828">2828</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2829" class="pln"><span class="n"><a href="#t2829">2829</a></span><span class="t">                    <span class="com"># Determine which indexes have an empty queue (jetties which have no vessels waiting)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2830" class="mis show_mis"><span class="n"><a href="#t2830">2830</a></span><span class="t">                    <span class="nam">indices_empty_queue_for_jetty</span> <span class="op">=</span> <span class="op">[</span><span class="nam">waiting_vessels</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">for</span> <span class="nam">waiting_vessels</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">vessels_waiting</span><span class="op">)</span> <span class="key">if</span> <span class="nam">waiting_vessels</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2831" class="pln"><span class="n"><a href="#t2831">2831</a></span><span class="t">                    <span class="com"># If this list of indexes is not empty:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2832" class="mis show_mis"><span class="n"><a href="#t2832">2832</a></span><span class="t">                    <span class="key">if</span> <span class="nam">indices_empty_queue_for_jetty</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2833" class="pln"><span class="n"><a href="#t2833">2833</a></span><span class="t">                        <span class="com"># Set default minimum waiting time (equal to the first jetty without queue)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2834" class="mis show_mis"><span class="n"><a href="#t2834">2834</a></span><span class="t">                        <span class="nam">min_minimum_waiting_time</span> <span class="op">=</span> <span class="nam">minimum_waiting_time</span><span class="op">[</span><span class="nam">indices_empty_queue_for_jetty</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2835" class="pln"><span class="n"><a href="#t2835">2835</a></span><span class="t">                        <span class="com"># Loop over the jetty indexes which do not have a queue:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2836" class="mis show_mis"><span class="n"><a href="#t2836">2836</a></span><span class="t">                        <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">indices_empty_queue_for_jetty</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2837" class="pln"><span class="n"><a href="#t2837">2837</a></span><span class="t">                            <span class="com"># If the minimum waiting time of the jetty is equal or less than the minimum waiting time for a jetty that was found up to now and the length of the vessel fits the jetty length: overwrite minimum waiting time with the minimum waiting time of that jetty and (temporarily) set the index of this jetty as the jetty index the vessel will be waiting for</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2838" class="mis show_mis"><span class="n"><a href="#t2838">2838</a></span><span class="t">                            <span class="key">if</span> <span class="nam">minimum_waiting_time</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="nam">min_minimum_waiting_time</span> <span class="key">and</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">&lt;=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetty_lengths</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2839" class="mis show_mis"><span class="n"><a href="#t2839">2839</a></span><span class="t">                                <span class="nam">min_minimum_waiting_time</span> <span class="op">=</span> <span class="nam">minimum_waiting_time</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2840" class="mis show_mis"><span class="n"><a href="#t2840">2840</a></span><span class="t">                                <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span> <span class="op">=</span> <span class="nam">index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2841" class="pln"><span class="n"><a href="#t2841">2841</a></span><span class="t">                    <span class="com"># Else if the list was empty and there is still no chosen jetty index: pick the jetty with the least number of vessels waiting in the queue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2842" class="mis show_mis"><span class="n"><a href="#t2842">2842</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span> <span class="op">==</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2843" class="pln"><span class="n"><a href="#t2843">2843</a></span><span class="t">                        <span class="com"># Set defaul indexes list:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2844" class="mis show_mis"><span class="n"><a href="#t2844">2844</a></span><span class="t">                        <span class="nam">indexes</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2845" class="pln"><span class="n"><a href="#t2845">2845</a></span><span class="t">                        <span class="com"># Loop over the lenghts of the jetties:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2846" class="mis show_mis"><span class="n"><a href="#t2846">2846</a></span><span class="t">                        <span class="key">for</span> <span class="nam">length</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">jetty_lengths</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2847" class="pln"><span class="n"><a href="#t2847">2847</a></span><span class="t">                            <span class="com">#If the length of the vessel fits in the jetty: append index to list</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2848" class="mis show_mis"><span class="n"><a href="#t2848">2848</a></span><span class="t">                            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span> <span class="op">&lt;=</span> <span class="nam">length</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2849" class="mis show_mis"><span class="n"><a href="#t2849">2849</a></span><span class="t">                                <span class="nam">indexes</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">length</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2850" class="pln"><span class="n"><a href="#t2850">2850</a></span><span class="t">                        <span class="com"># If the list of indexes are not empty: pick the jetty with the least number of vessels in the queue waiting for this particular jetty</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2851" class="mis show_mis"><span class="n"><a href="#t2851">2851</a></span><span class="t">                        <span class="key">if</span> <span class="nam">indexes</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2852" class="mis show_mis"><span class="n"><a href="#t2852">2852</a></span><span class="t">                            <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">min</span><span class="op">(</span><span class="op">[</span><span class="nam">y</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">vessels_waiting</span><span class="op">)</span> <span class="key">if</span> <span class="nam">y</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">in</span> <span class="nam">indexes</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2853" class="pln"><span class="n"><a href="#t2853">2853</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2854" class="pln"><span class="n"><a href="#t2854">2854</a></span><span class="t">                    <span class="com"># If the jetty has been chosen: request that jetty which will function as the timeout event equalling the time that the jetty will be available</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2855" class="mis show_mis"><span class="n"><a href="#t2855">2855</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span> <span class="op">!=</span> <span class="op">[</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2856" class="mis show_mis"><span class="n"><a href="#t2856">2856</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time_in_anchorage</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2857" class="pln"><span class="n"><a href="#t2857">2857</a></span><span class="t">                    <span class="com"># Else if there is no suitable jetty: vessel will return to sea without waiting in the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2858" class="pln"><span class="n"><a href="#t2858">2858</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2859" class="mis show_mis"><span class="n"><a href="#t2859">2859</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2860" class="mis show_mis"><span class="n"><a href="#t2860">2860</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2861" class="pln"><span class="n"><a href="#t2861">2861</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2862" class="pln"><span class="n"><a href="#t2862">2862</a></span><span class="t">                <span class="com"># Move vessel to the anchorage area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2863" class="mis show_mis"><span class="n"><a href="#t2863">2863</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">move_to_anchorage</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2864" class="pln"><span class="n"><a href="#t2864">2864</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2865" class="pln"><span class="n"><a href="#t2865">2865</a></span><span class="t">            <span class="com"># Else if the vessel does not have to wait for either an available terminal or tidal window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2866" class="pln"><span class="n"><a href="#t2866">2866</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2867" class="mis show_mis"><span class="n"><a href="#t2867">2867</a></span><span class="t">                <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2868" class="mis show_mis"><span class="n"><a href="#t2868">2868</a></span><span class="t">                    <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">adjust_available_quay_lengths</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">index_quay_position</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2869" class="pln"><span class="n"><a href="#t2869">2869</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2870" class="pln"><span class="n"><a href="#t2870">2870</a></span><span class="t">            <span class="com"># If the vessel does not have to return to sea</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2871" class="mis show_mis"><span class="n"><a href="#t2871">2871</a></span><span class="t">            <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">return_to_sea</span> <span class="op">==</span> <span class="key">False</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2872" class="pln"><span class="n"><a href="#t2872">2872</a></span><span class="t">                <span class="com"># Import information about the terminal, based on the terminal type (and if type 'jetty': based on the picked jetty position).</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2873" class="mis show_mis"><span class="n"><a href="#t2873">2873</a></span><span class="t">                <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2874" class="mis show_mis"><span class="n"><a href="#t2874">2874</a></span><span class="t">                    <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2875" class="mis show_mis"><span class="n"><a href="#t2875">2875</a></span><span class="t">                <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2876" class="mis show_mis"><span class="n"><a href="#t2876">2876</a></span><span class="t">                    <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2877" class="pln"><span class="n"><a href="#t2877">2877</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2878" class="pln"><span class="n"><a href="#t2878">2878</a></span><span class="t">                <span class="com"># If the terminal type is 'jetty' and the vessel has to wait for an available jetty: pass; else: continue code</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2879" class="mis show_mis"><span class="n"><a href="#t2879">2879</a></span><span class="t">                <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span> <span class="key">and</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_for_availability_terminal</span> <span class="op">==</span> <span class="key">True</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2880" class="mis show_mis"><span class="n"><a href="#t2880">2880</a></span><span class="t">                    <span class="key">pass</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2881" class="pln"><span class="n"><a href="#t2881">2881</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2882" class="pln"><span class="n"><a href="#t2882">2882</a></span><span class="t">                    <span class="com"># Request access to the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2883" class="mis show_mis"><span class="n"><a href="#t2883">2883</a></span><span class="t">                    <span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2884" class="mis show_mis"><span class="n"><a href="#t2884">2884</a></span><span class="t">                    <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2885" class="pln"><span class="n"><a href="#t2885">2885</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2886" class="pln"><span class="n"><a href="#t2886">2886</a></span><span class="t">                    <span class="com"># If terminal type is 'quay': revise the locations of the current configuration of vessels located at the quay with the new configuration</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2887" class="mis show_mis"><span class="n"><a href="#t2887">2887</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2888" class="mis show_mis"><span class="n"><a href="#t2888">2888</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">available_quay_lengths</span> <span class="op">=</span> <span class="nam">aql</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2889" class="pln"><span class="n"><a href="#t2889">2889</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2890" class="pln"><span class="n"><a href="#t2890">2890</a></span><span class="t">                    <span class="com"># Set route after the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2891" class="mis show_mis"><span class="n"><a href="#t2891">2891</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2892" class="mis show_mis"><span class="n"><a href="#t2892">2892</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_anchorage</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">true_origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2893" class="pln"><span class="n"><a href="#t2893">2893</a></span><span class="t">                    <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2894" class="mis show_mis"><span class="n"><a href="#t2894">2894</a></span><span class="t">                        <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2895" class="pln"><span class="n"><a href="#t2895">2895</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2896" class="pln"><span class="n"><a href="#t2896">2896</a></span><span class="t">                    <span class="com"># If terminal is of type 'jetty': calculate the estimated time of departure consisting of the estimated time of arrival (sailing distance + berthing time + current time) + waiting time + (un)loading time + berthing time again</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2897" class="mis show_mis"><span class="n"><a href="#t2897">2897</a></span><span class="t">                    <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2898" class="pln"><span class="n"><a href="#t2898">2898</a></span><span class="t">                        <span class="com"># Take the route when the vessel is leaving the terminal and reverse this route:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2899" class="mis show_mis"><span class="n"><a href="#t2899">2899</a></span><span class="t">                        <span class="nam">route</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2900" class="mis show_mis"><span class="n"><a href="#t2900">2900</a></span><span class="t">                        <span class="nam">route</span><span class="op">.</span><span class="nam">reverse</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2901" class="mis show_mis"><span class="n"><a href="#t2901">2901</a></span><span class="t">                        <span class="nam">sailing_distance</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2902" class="pln"><span class="n"><a href="#t2902">2902</a></span><span class="t">                        <span class="com"># Loop over the route to calculate the total sailing distance and time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2903" class="mis show_mis"><span class="n"><a href="#t2903">2903</a></span><span class="t">                        <span class="key">for</span> <span class="nam">nodes</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">route</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2904" class="mis show_mis"><span class="n"><a href="#t2904">2904</a></span><span class="t">                            <span class="nam">_</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">distance</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2905" class="pln"><span class="n"><a href="#t2905">2905</a></span><span class="t">                                                              <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2906" class="pln"><span class="n"><a href="#t2906">2906</a></span><span class="t">                                                              <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2907" class="pln"><span class="n"><a href="#t2907">2907</a></span><span class="t">                                                              <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">route</span><span class="op">[</span><span class="nam">nodes</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2908" class="mis show_mis"><span class="n"><a href="#t2908">2908</a></span><span class="t">                            <span class="nam">sailing_distance</span> <span class="op">+=</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2909" class="mis show_mis"><span class="n"><a href="#t2909">2909</a></span><span class="t">                        <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span> <span class="op">+</span> <span class="nam">sailing_distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2910" class="mis show_mis"><span class="n"><a href="#t2910">2910</a></span><span class="t">                        <span class="nam">vessel_etd</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">eta</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2911" class="mis show_mis"><span class="n"><a href="#t2911">2911</a></span><span class="t">                        <span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route_after_terminal</span><span class="op">,</span> <span class="nam">delay</span><span class="op">=</span><span class="nam">vessel_etd</span><span class="op">-</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2912" class="mis show_mis"><span class="n"><a href="#t2912">2912</a></span><span class="t">                        <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">etd</span> <span class="op">=</span> <span class="nam">vessel_etd</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span> <span class="nam">waiting_time</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span> <span class="op">*</span> <span class="num">60</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2913" class="mis show_mis"><span class="n"><a href="#t2913">2913</a></span><span class="t">                        <span class="nam">terminal</span><span class="op">.</span><span class="nam">users</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">type</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2914" class="pln"><span class="n"><a href="#t2914">2914</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2915" class="pln"><span class="n"><a href="#t2915">2915</a></span><span class="t">        <span class="com"># Else if vessel has to return to sea: move vessel to anchorage first</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2916" class="pln"><span class="n"><a href="#t2916">2916</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2917" class="mis show_mis"><span class="n"><a href="#t2917">2917</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">move_to_anchorage</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">node</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2918" class="pln"><span class="n"><a href="#t2918">2918</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2919" class="run"><span class="n"><a href="#t2919">2919</a></span><span class="t">    <span class="key">def</span> <span class="nam">pass_terminal</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">edge</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2920" class="pln"><span class="n"><a href="#t2920">2920</a></span><span class="t">        <span class="str">""" Function: function that handles the vessel at the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2921" class="pln"><span class="n"><a href="#t2921">2921</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2922" class="pln"><span class="n"><a href="#t2922">2922</a></span><span class="t"><span class="str">            Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2923" class="pln"><span class="n"><a href="#t2923">2923</a></span><span class="t"><span class="str">                - vessel: an identity which is Identifiable, Movable, and Routable, and has VesselProperties</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2924" class="pln"><span class="n"><a href="#t2924">2924</a></span><span class="t"><span class="str">                - edge: list of two strings that form the edge at which the terminal is located</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2925" class="pln"><span class="n"><a href="#t2925">2925</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2926" class="pln"><span class="n"><a href="#t2926">2926</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2927" class="pln"><span class="n"><a href="#t2927">2927</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2928" class="pln"><span class="n"><a href="#t2928">2928</a></span><span class="t">        <span class="com"># Import information about the terminal and the corresponding index of the start of the edge at which the terminal is located</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2929" class="mis show_mis"><span class="n"><a href="#t2929">2929</a></span><span class="t">        <span class="nam">terminal</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">"Terminal"</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2930" class="mis show_mis"><span class="n"><a href="#t2930">2930</a></span><span class="t">        <span class="nam">index</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2931" class="pln"><span class="n"><a href="#t2931">2931</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2932" class="pln"><span class="n"><a href="#t2932">2932</a></span><span class="t">        <span class="com"># Calculate the location of the assigned position along the edge at which the terminal is located and finish the pass_edge move</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2933" class="mis show_mis"><span class="n"><a href="#t2933">2933</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_accessed</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2934" class="mis show_mis"><span class="n"><a href="#t2934">2934</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span> <span class="op">=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">"WGS84"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2935" class="mis show_mis"><span class="n"><a href="#t2935">2935</a></span><span class="t">        <span class="op">[</span><span class="nam">origin_lat</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2936" class="pln"><span class="n"><a href="#t2936">2936</a></span><span class="t">         <span class="nam">origin_lon</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2937" class="pln"><span class="n"><a href="#t2937">2937</a></span><span class="t">         <span class="nam">destination_lat</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2938" class="pln"><span class="n"><a href="#t2938">2938</a></span><span class="t">         <span class="nam">destination_lon</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2939" class="pln"><span class="n"><a href="#t2939">2939</a></span><span class="t">                             <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2940" class="pln"><span class="n"><a href="#t2940">2940</a></span><span class="t">                             <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2941" class="pln"><span class="n"><a href="#t2941">2941</a></span><span class="t">                             <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2942" class="mis show_mis"><span class="n"><a href="#t2942">2942</a></span><span class="t">        <span class="nam">fwd_azimuth</span><span class="op">,</span> <span class="nam">_</span><span class="op">,</span> <span class="nam">_</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">origin_lat</span><span class="op">,</span> <span class="nam">origin_lon</span><span class="op">,</span> <span class="nam">destination_lat</span><span class="op">,</span> <span class="nam">destination_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2943" class="pln"><span class="n"><a href="#t2943">2943</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2944" class="mis show_mis"><span class="n"><a href="#t2944">2944</a></span><span class="t">        <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2945" class="mis show_mis"><span class="n"><a href="#t2945">2945</a></span><span class="t">            <span class="nam">position</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">quay_position</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2946" class="pln"><span class="n"><a href="#t2946">2946</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2947" class="mis show_mis"><span class="n"><a href="#t2947">2947</a></span><span class="t">        <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2948" class="mis show_mis"><span class="n"><a href="#t2948">2948</a></span><span class="t">            <span class="nam">position</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetty_locations</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2949" class="pln"><span class="n"><a href="#t2949">2949</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2950" class="mis show_mis"><span class="n"><a href="#t2950">2950</a></span><span class="t">        <span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">,</span> <span class="nam">_</span><span class="op">]</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">fwd</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2951" class="pln"><span class="n"><a href="#t2951">2951</a></span><span class="t">                                                                                 <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2952" class="pln"><span class="n"><a href="#t2952">2952</a></span><span class="t">                                                                                 <span class="nam">fwd_azimuth</span><span class="op">,</span> <span class="nam">position</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2953" class="pln"><span class="n"><a href="#t2953">2953</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2954" class="mis show_mis"><span class="n"><a href="#t2954">2954</a></span><span class="t">        <span class="nam">orig</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2955" class="mis show_mis"><span class="n"><a href="#t2955">2955</a></span><span class="t">        <span class="nam">dest</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2956" class="mis show_mis"><span class="n"><a href="#t2956">2956</a></span><span class="t">        <span class="nam">distance</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">orig</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2957" class="pln"><span class="n"><a href="#t2957">2957</a></span><span class="t">                                    <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">orig</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2958" class="pln"><span class="n"><a href="#t2958">2958</a></span><span class="t">                                    <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">dest</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2959" class="pln"><span class="n"><a href="#t2959">2959</a></span><span class="t">                                    <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">dest</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span> <span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2960" class="pln"><span class="n"><a href="#t2960">2960</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2961" class="mis show_mis"><span class="n"><a href="#t2961">2961</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2962" class="mis show_mis"><span class="n"><a href="#t2962">2962</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} start"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">orig</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2963" class="mis show_mis"><span class="n"><a href="#t2963">2963</a></span><span class="t">        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">distance</span> <span class="op">/</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">current_speed</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2964" class="mis show_mis"><span class="n"><a href="#t2964">2964</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2965" class="mis show_mis"><span class="n"><a href="#t2965">2965</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} stop"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">dest</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2966" class="pln"><span class="n"><a href="#t2966">2966</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2967" class="pln"><span class="n"><a href="#t2967">2967</a></span><span class="t">        <span class="com"># If the terminal is of type 'quay': log in logfile of terminal keeping track of the available length (by getting the so-called position length)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2968" class="mis show_mis"><span class="n"><a href="#t2968">2968</a></span><span class="t">        <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2969" class="mis show_mis"><span class="n"><a href="#t2969">2969</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">pos_length</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2970" class="mis show_mis"><span class="n"><a href="#t2970">2970</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Arrival of vessel"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">capacity</span><span class="op">-</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">pos_length</span><span class="op">.</span><span class="nam">level</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2971" class="pln"><span class="n"><a href="#t2971">2971</a></span><span class="t">        <span class="com"># Else if terminal is of type 'jetty': log in logfile of terminal calculating keeping track of number of jetties to be occupied</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2972" class="mis show_mis"><span class="n"><a href="#t2972">2972</a></span><span class="t">        <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2973" class="mis show_mis"><span class="n"><a href="#t2973">2973</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetties_occupied</span> <span class="op">+=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2974" class="mis show_mis"><span class="n"><a href="#t2974">2974</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Arrival of vessel"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetties_occupied</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2975" class="pln"><span class="n"><a href="#t2975">2975</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2976" class="pln"><span class="n"><a href="#t2976">2976</a></span><span class="t">        <span class="com"># Berthing: log the start and stop of this event in log file of vessel including the calculated net ukc, and yield timeout equal to the time it takes to berth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2977" class="mis show_mis"><span class="n"><a href="#t2977">2977</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2978" class="mis show_mis"><span class="n"><a href="#t2978">2978</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Berthing start"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2979" class="mis show_mis"><span class="n"><a href="#t2979">2979</a></span><span class="t">        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span><span class="op">*</span><span class="num">60</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2980" class="mis show_mis"><span class="n"><a href="#t2980">2980</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2981" class="mis show_mis"><span class="n"><a href="#t2981">2981</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Berthing stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2982" class="pln"><span class="n"><a href="#t2982">2982</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2983" class="pln"><span class="n"><a href="#t2983">2983</a></span><span class="t">        <span class="com"># If terminal is part of a junction: release request of this section (vessel is berthed and not in channel/basin)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2984" class="mis show_mis"><span class="n"><a href="#t2984">2984</a></span><span class="t">        <span class="key">if</span> <span class="str">'Junction'</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2985" class="mis show_mis"><span class="n"><a href="#t2985">2985</a></span><span class="t">            <span class="nam">PassSection</span><span class="op">.</span><span class="nam">release_access_previous_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2986" class="pln"><span class="n"><a href="#t2986">2986</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2987" class="pln"><span class="n"><a href="#t2987">2987</a></span><span class="t">        <span class="com"># Unloading: log the start and stop of this event in log file of vessel including the calculated net ukc, and yield timeout equal to the time it takes to unload</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2988" class="mis show_mis"><span class="n"><a href="#t2988">2988</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2989" class="mis show_mis"><span class="n"><a href="#t2989">2989</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Unloading start"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2990" class="mis show_mis"><span class="n"><a href="#t2990">2990</a></span><span class="t">        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span><span class="op">*</span><span class="num">60</span><span class="op">/</span><span class="num">2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2991" class="mis show_mis"><span class="n"><a href="#t2991">2991</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2992" class="mis show_mis"><span class="n"><a href="#t2992">2992</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Unloading stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2993" class="pln"><span class="n"><a href="#t2993">2993</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t2994" class="pln"><span class="n"><a href="#t2994">2994</a></span><span class="t">        <span class="com"># Loading: log the start and stop of this event in log file of vessel including the calculated net ukc, and yield timeout equal to the time it takes to load</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2995" class="mis show_mis"><span class="n"><a href="#t2995">2995</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2996" class="mis show_mis"><span class="n"><a href="#t2996">2996</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Loading start"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2997" class="mis show_mis"><span class="n"><a href="#t2997">2997</a></span><span class="t">        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_l'</span><span class="op">]</span><span class="op">*</span><span class="num">60</span><span class="op">/</span><span class="num">2</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2998" class="mis show_mis"><span class="n"><a href="#t2998">2998</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t2999" class="mis show_mis"><span class="n"><a href="#t2999">2999</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Loading stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3000" class="pln"><span class="n"><a href="#t3000">3000</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3001" class="pln"><span class="n"><a href="#t3001">3001</a></span><span class="t">        <span class="com"># Determine the new route of the vessel (depending on whether the vessel came from the anchorage area or sailed to the terminal directly) and changing the direction of the vessel</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3002" class="mis show_mis"><span class="n"><a href="#t3002">3002</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>  <span class="com"># to be removed later</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3003" class="mis show_mis"><span class="n"><a href="#t3003">3003</a></span><span class="t">        <span class="key">if</span> <span class="str">'true_origin'</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">vessel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3004" class="mis show_mis"><span class="n"><a href="#t3004">3004</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">true_origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3005" class="pln"><span class="n"><a href="#t3005">3005</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3006" class="mis show_mis"><span class="n"><a href="#t3006">3006</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">dijkstra_path</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3007" class="mis show_mis"><span class="n"><a href="#t3007">3007</a></span><span class="t">        <span class="key">if</span> <span class="nam">edge</span> <span class="op">==</span> <span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'outbound'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3008" class="pln"><span class="n"><a href="#t3008">3008</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3009" class="pln"><span class="n"><a href="#t3009">3009</a></span><span class="t">        <span class="com"># Calculate if the vessel has to wait due to be ready for departure beyond an available tidal window</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3010" class="mis show_mis"><span class="n"><a href="#t3010">3010</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">waiting_time_for_tidal_window</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span><span class="nam">route</span><span class="op">=</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">,</span><span class="nam">delay</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">plot</span><span class="op">=</span><span class="key">False</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3011" class="pln"><span class="n"><a href="#t3011">3011</a></span><span class="t">        <span class="com"># If there is waiting time: log the start and stop of this event in log file of vessel including the calculated net ukc, and yield timeout equal to the waiting time</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3012" class="mis show_mis"><span class="n"><a href="#t3012">3012</a></span><span class="t">        <span class="key">if</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3013" class="mis show_mis"><span class="n"><a href="#t3013">3013</a></span><span class="t">            <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3014" class="mis show_mis"><span class="n"><a href="#t3014">3014</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting for tidal window start"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3015" class="mis show_mis"><span class="n"><a href="#t3015">3015</a></span><span class="t">            <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">max</span><span class="op">(</span><span class="op">[</span><span class="num">0</span><span class="op">,</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">-</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span><span class="op">*</span><span class="num">60</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3016" class="mis show_mis"><span class="n"><a href="#t3016">3016</a></span><span class="t">            <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3017" class="mis show_mis"><span class="n"><a href="#t3017">3017</a></span><span class="t">            <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting for tidal window stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3018" class="pln"><span class="n"><a href="#t3018">3018</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3019" class="pln"><span class="n"><a href="#t3019">3019</a></span><span class="t">        <span class="com"># Deberthing: if the terminal is part of an section, request access to this section first</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3020" class="mis show_mis"><span class="n"><a href="#t3020">3020</a></span><span class="t">        <span class="key">if</span> <span class="str">'Junction'</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3021" class="mis show_mis"><span class="n"><a href="#t3021">3021</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassSection</span><span class="op">.</span><span class="nam">request_access_next_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3022" class="pln"><span class="n"><a href="#t3022">3022</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3023" class="pln"><span class="n"><a href="#t3023">3023</a></span><span class="t">        <span class="com"># Deberthing: if the terminal is attached to a turning basin: check whether the vessel can turn here (if the length of the vessel allows to turn the vessel in this basin)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3024" class="mis show_mis"><span class="n"><a href="#t3024">3024</a></span><span class="t">        <span class="key">if</span> <span class="str">'Turning Basin'</span> <span class="key">in</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3025" class="mis show_mis"><span class="n"><a href="#t3025">3025</a></span><span class="t">            <span class="nam">turning_basin</span> <span class="op">=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning Basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3026" class="mis show_mis"><span class="n"><a href="#t3026">3026</a></span><span class="t">            <span class="key">if</span> <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">length</span> <span class="op">>=</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3027" class="mis show_mis"><span class="n"><a href="#t3027">3027</a></span><span class="t">                <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_turning_basin</span> <span class="op">=</span> <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">turning_basin</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3028" class="mis show_mis"><span class="n"><a href="#t3028">3028</a></span><span class="t">                <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">request_access_turning_basin</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3029" class="pln"><span class="n"><a href="#t3029">3029</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3030" class="pln"><span class="n"><a href="#t3030">3030</a></span><span class="t">        <span class="com"># Deberthing: log the start and stop of this event in log file of vessel including the calculated net ukc, and yield timeout equal to the time it takes to deberth</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3031" class="mis show_mis"><span class="n"><a href="#t3031">3031</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3032" class="mis show_mis"><span class="n"><a href="#t3032">3032</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Deberthing start"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3033" class="mis show_mis"><span class="n"><a href="#t3033">3033</a></span><span class="t">        <span class="key">yield</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'t_b'</span><span class="op">]</span><span class="op">*</span><span class="num">60</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3034" class="mis show_mis"><span class="n"><a href="#t3034">3034</a></span><span class="t">        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3035" class="mis show_mis"><span class="n"><a href="#t3035">3035</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Deberthing stop"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3036" class="pln"><span class="n"><a href="#t3036">3036</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3037" class="pln"><span class="n"><a href="#t3037">3037</a></span><span class="t">        <span class="com"># Move vessel to start node of the terminal, release request of this section, and change vessel route by removing the first node of the route (as vessel will already be located in the second node of the route after the move event)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3038" class="mis show_mis"><span class="n"><a href="#t3038">3038</a></span><span class="t">        <span class="nam">PassSection</span><span class="op">.</span><span class="nam">release_access_previous_section</span><span class="op">(</span><span class="nam">vessel</span><span class="op">,</span> <span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3039" class="pln"><span class="n"><a href="#t3039">3039</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3040" class="pln"><span class="n"><a href="#t3040">3040</a></span><span class="t">        <span class="com"># If the terminal is of type 'quay'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3041" class="mis show_mis"><span class="n"><a href="#t3041">3041</a></span><span class="t">        <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'quay'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3042" class="pln"><span class="n"><a href="#t3042">3042</a></span><span class="t">            <span class="com"># Determine the old maximum available length of the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3043" class="mis show_mis"><span class="n"><a href="#t3043">3043</a></span><span class="t">            <span class="nam">old_level</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">calculate_quay_length_level</span><span class="op">(</span><span class="nam">terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3044" class="pln"><span class="n"><a href="#t3044">3044</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3045" class="pln"><span class="n"><a href="#t3045">3045</a></span><span class="t">            <span class="com"># Function that is used to readjust the available quay lengths:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3046" class="mis show_mis"><span class="n"><a href="#t3046">3046</a></span><span class="t">            <span class="key">def</span> <span class="nam">readjust_available_quay_lengths</span><span class="op">(</span><span class="nam">terminal</span><span class="op">,</span><span class="nam">position</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3047" class="pln"><span class="n"><a href="#t3047">3047</a></span><span class="t">                <span class="str">""" Function that readjusts the available quay lenghts and positions given a release of a request of a vessel at a given position</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3048" class="pln"><span class="n"><a href="#t3048">3048</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3049" class="pln"><span class="n"><a href="#t3049">3049</a></span><span class="t"><span class="str">                    Input:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3050" class="pln"><span class="n"><a href="#t3050">3050</a></span><span class="t"><span class="str">                        - terminal: the terminal of call of the vessel, created with the IsTerminal-class</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3051" class="pln"><span class="n"><a href="#t3051">3051</a></span><span class="t"><span class="str">                        - position: quay position index at which the vessel is located at the quay with respect to the other vessels</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3052" class="pln"><span class="n"><a href="#t3052">3052</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3053" class="pln"><span class="n"><a href="#t3053">3053</a></span><span class="t"><span class="str">                """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3054" class="pln"><span class="n"><a href="#t3054">3054</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3055" class="pln"><span class="n"><a href="#t3055">3055</a></span><span class="t">                <span class="com"># Import the locations of the current configuration of vessels located at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3056" class="mis show_mis"><span class="n"><a href="#t3056">3056</a></span><span class="t">                <span class="nam">aql</span> <span class="op">=</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3057" class="pln"><span class="n"><a href="#t3057">3057</a></span><span class="t">                <span class="com"># Loop over the position indexes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3058" class="mis show_mis"><span class="n"><a href="#t3058">3058</a></span><span class="t">                <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3059" class="pln"><span class="n"><a href="#t3059">3059</a></span><span class="t">                    <span class="com"># Skip the first position index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3060" class="mis show_mis"><span class="n"><a href="#t3060">3060</a></span><span class="t">                    <span class="key">if</span> <span class="nam">index</span> <span class="op">==</span> <span class="num">0</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3061" class="mis show_mis"><span class="n"><a href="#t3061">3061</a></span><span class="t">                        <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3062" class="pln"><span class="n"><a href="#t3062">3062</a></span><span class="t">                    <span class="com"># If the position of the vessel falls within the position bounds in the current configuration: break loop (save index)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3063" class="mis show_mis"><span class="n"><a href="#t3063">3063</a></span><span class="t">                    <span class="key">if</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="nam">position</span> <span class="key">and</span> <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">></span> <span class="nam">position</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3064" class="mis show_mis"><span class="n"><a href="#t3064">3064</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3065" class="pln"><span class="n"><a href="#t3065">3065</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3066" class="pln"><span class="n"><a href="#t3066">3066</a></span><span class="t">                <span class="com"># Set both values of these position bounds to zero (available again)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3067" class="mis show_mis"><span class="n"><a href="#t3067">3067</a></span><span class="t">                <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3068" class="mis show_mis"><span class="n"><a href="#t3068">3068</a></span><span class="t">                <span class="nam">aql</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3069" class="pln"><span class="n"><a href="#t3069">3069</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3070" class="pln"><span class="n"><a href="#t3070">3070</a></span><span class="t">                <span class="com"># Set a default list of redundant indexes to be removed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3071" class="mis show_mis"><span class="n"><a href="#t3071">3071</a></span><span class="t">                <span class="nam">to_remove</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3072" class="pln"><span class="n"><a href="#t3072">3072</a></span><span class="t">                <span class="com"># Nested loop over the position indexes</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3073" class="mis show_mis"><span class="n"><a href="#t3073">3073</a></span><span class="t">                <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3074" class="mis show_mis"><span class="n"><a href="#t3074">3074</a></span><span class="t">                    <span class="key">for</span> <span class="nam">jndex</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">aql</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3075" class="pln"><span class="n"><a href="#t3075">3075</a></span><span class="t">                        <span class="com"># If the two indexes are not equal and the value at position index 1 and index 2 are both zero (available) and the locations of the two indexes are equal: remove the first positional index</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3076" class="mis show_mis"><span class="n"><a href="#t3076">3076</a></span><span class="t">                        <span class="key">if</span> <span class="nam">index</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">!=</span> <span class="nam">jndex</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="key">and</span> <span class="nam">index</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">jndex</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">==</span> <span class="num">0</span> <span class="key">and</span> <span class="nam">index</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">jndex</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3077" class="mis show_mis"><span class="n"><a href="#t3077">3077</a></span><span class="t">                            <span class="nam">to_remove</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">index</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3078" class="pln"><span class="n"><a href="#t3078">3078</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3079" class="pln"><span class="n"><a href="#t3079">3079</a></span><span class="t">                <span class="com"># If there are indexes to be removed, loop over these indexes and remove them</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3080" class="mis show_mis"><span class="n"><a href="#t3080">3080</a></span><span class="t">                <span class="key">for</span> <span class="nam">index</span> <span class="key">in</span> <span class="nam">list</span><span class="op">(</span><span class="nam">reversed</span><span class="op">(</span><span class="nam">to_remove</span><span class="op">)</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3081" class="mis show_mis"><span class="n"><a href="#t3081">3081</a></span><span class="t">                    <span class="nam">aql</span><span class="op">.</span><span class="nam">pop</span><span class="op">(</span><span class="nam">index</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3082" class="pln"><span class="n"><a href="#t3082">3082</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3083" class="pln"><span class="n"><a href="#t3083">3083</a></span><span class="t">                <span class="com"># Return the locations of the new configuration of vessels located at the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3084" class="mis show_mis"><span class="n"><a href="#t3084">3084</a></span><span class="t">                <span class="key">return</span> <span class="nam">aql</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3085" class="pln"><span class="n"><a href="#t3085">3085</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3086" class="pln"><span class="n"><a href="#t3086">3086</a></span><span class="t">            <span class="com"># Readjust the available quay lengths as the vessel is leaving the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3087" class="mis show_mis"><span class="n"><a href="#t3087">3087</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">available_quay_lengths</span> <span class="op">=</span> <span class="nam">readjust_available_quay_lengths</span><span class="op">(</span><span class="nam">terminal</span><span class="op">,</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">quay_position</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3088" class="pln"><span class="n"><a href="#t3088">3088</a></span><span class="t">            <span class="com"># Calculate the new maximum available quay length</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3089" class="mis show_mis"><span class="n"><a href="#t3089">3089</a></span><span class="t">            <span class="nam">new_level</span> <span class="op">=</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">calculate_quay_length_level</span><span class="op">(</span><span class="nam">terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3090" class="pln"><span class="n"><a href="#t3090">3090</a></span><span class="t">            <span class="com"># If this length does not equal the current maximum available quay length (is smaller), then put this length back to the quay</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3091" class="mis show_mis"><span class="n"><a href="#t3091">3091</a></span><span class="t">            <span class="key">if</span> <span class="nam">old_level</span> <span class="op">!=</span> <span class="nam">new_level</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3092" class="mis show_mis"><span class="n"><a href="#t3092">3092</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">put</span><span class="op">(</span><span class="nam">new_level</span> <span class="op">-</span> <span class="nam">old_level</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3093" class="pln"><span class="n"><a href="#t3093">3093</a></span><span class="t">            <span class="com"># Give vessel length back to keep track of the total claimed vessel length and log this value and the departure event in the logfile of the terminal, and release the request of the vessel to access the terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3094" class="mis show_mis"><span class="n"><a href="#t3094">3094</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">pos_length</span><span class="op">.</span><span class="nam">put</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3095" class="mis show_mis"><span class="n"><a href="#t3095">3095</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Departure of vessel"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">.</span><span class="nam">capacity</span><span class="op">-</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">pos_length</span><span class="op">.</span><span class="nam">level</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">,</span> <span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3096" class="mis show_mis"><span class="n"><a href="#t3096">3096</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3097" class="pln"><span class="n"><a href="#t3097">3097</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3098" class="pln"><span class="n"><a href="#t3098">3098</a></span><span class="t">        <span class="com"># Else if the terminal is of type 'jetty': adjust number of vessels occupying a jetty, log the departure of this vessel and this number, and release the request of the vessel for the specific jetty</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3099" class="mis show_mis"><span class="n"><a href="#t3099">3099</a></span><span class="t">        <span class="key">elif</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3100" class="mis show_mis"><span class="n"><a href="#t3100">3100</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetties_occupied</span> <span class="op">-=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3101" class="mis show_mis"><span class="n"><a href="#t3101">3101</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Departure of vessel"</span><span class="op">,</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">jetties_occupied</span><span class="op">,</span><span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3102" class="mis show_mis"><span class="n"><a href="#t3102">3102</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">terminal</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">index_jetty_position</span><span class="op">]</span><span class="op">[</span><span class="nam">edge</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">access_terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3103" class="pln"><span class="n"><a href="#t3103">3103</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3104" class="pln"><span class="n"><a href="#t3104">3104</a></span><span class="t">        <span class="com"># Initiate move of vessel back to sea, setting a bool of leaving port to true</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3105" class="mis show_mis"><span class="n"><a href="#t3105">3105</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3106" class="mis show_mis"><span class="n"><a href="#t3106">3106</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">move</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3107" class="mis show_mis"><span class="n"><a href="#t3107">3107</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">leaving_port</span> <span class="op">=</span> <span class="key">True</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3108" class="pln"><span class="n"><a href="#t3108">3108</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3109" class="run"><span class="n"><a href="#t3109">3109</a></span><span class="t"><span class="key">class</span> <span class="nam">Output</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3110" class="pln"><span class="n"><a href="#t3110">3110</a></span><span class="t">    <span class="str">""" mixing class: collection of unfinished functions that should store the output to the vessels and the network in the future development of OpenTNSim"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3111" class="pln"><span class="n"><a href="#t3111">3111</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3112" class="run"><span class="n"><a href="#t3112">3112</a></span><span class="t">    <span class="key">def</span> <span class="nam">general_output</span><span class="op">(</span><span class="nam">sim</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3113" class="mis show_mis"><span class="n"><a href="#t3113">3113</a></span><span class="t">        <span class="nam">sim</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Avg_turnaround_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3114" class="mis show_mis"><span class="n"><a href="#t3114">3114</a></span><span class="t">        <span class="nam">sim</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Avg_sailing_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3115" class="mis show_mis"><span class="n"><a href="#t3115">3115</a></span><span class="t">        <span class="nam">sim</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Avg_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3116" class="mis show_mis"><span class="n"><a href="#t3116">3116</a></span><span class="t">        <span class="nam">sim</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Avg_service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3117" class="mis show_mis"><span class="n"><a href="#t3117">3117</a></span><span class="t">        <span class="nam">sim</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Total_throughput'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3118" class="pln"><span class="n"><a href="#t3118">3118</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3119" class="run"><span class="n"><a href="#t3119">3119</a></span><span class="t">    <span class="key">def</span> <span class="nam">vessel_dependent_output</span><span class="op">(</span><span class="nam">vessel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3120" class="mis show_mis"><span class="n"><a href="#t3120">3120</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'route'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3121" class="mis show_mis"><span class="n"><a href="#t3121">3121</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'speed'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3122" class="mis show_mis"><span class="n"><a href="#t3122">3122</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'sailing_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3123" class="mis show_mis"><span class="n"><a href="#t3123">3123</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'freeboard'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3124" class="mis show_mis"><span class="n"><a href="#t3124">3124</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'throughput'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3125" class="mis show_mis"><span class="n"><a href="#t3125">3125</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'n_encouters'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3126" class="mis show_mis"><span class="n"><a href="#t3126">3126</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'n_overtaking'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3127" class="mis show_mis"><span class="n"><a href="#t3127">3127</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'n_overtaken'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3128" class="mis show_mis"><span class="n"><a href="#t3128">3128</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'terminals_called'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3129" class="mis show_mis"><span class="n"><a href="#t3129">3129</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'anchorages_used'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3130" class="mis show_mis"><span class="n"><a href="#t3130">3130</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3131" class="mis show_mis"><span class="n"><a href="#t3131">3131</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3132" class="mis show_mis"><span class="n"><a href="#t3132">3132</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'total_sailing_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3133" class="mis show_mis"><span class="n"><a href="#t3133">3133</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'total_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3134" class="mis show_mis"><span class="n"><a href="#t3134">3134</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'total_service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3135" class="mis show_mis"><span class="n"><a href="#t3135">3135</a></span><span class="t">        <span class="nam">vessel</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'turnaround_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3136" class="pln"><span class="n"><a href="#t3136">3136</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3137" class="run"><span class="n"><a href="#t3137">3137</a></span><span class="t">    <span class="key">def</span> <span class="nam">node_dependent_output</span><span class="op">(</span><span class="nam">network</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3138" class="mis show_mis"><span class="n"><a href="#t3138">3138</a></span><span class="t">        <span class="key">for</span> <span class="nam">node</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3139" class="mis show_mis"><span class="n"><a href="#t3139">3139</a></span><span class="t">            <span class="key">if</span> <span class="str">'Anchorage'</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3140" class="mis show_mis"><span class="n"><a href="#t3140">3140</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Anchorage_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3141" class="mis show_mis"><span class="n"><a href="#t3141">3141</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Anchorage_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3142" class="mis show_mis"><span class="n"><a href="#t3142">3142</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Anchorage_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3143" class="mis show_mis"><span class="n"><a href="#t3143">3143</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Anchorage'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Anchorage_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3144" class="pln"><span class="n"><a href="#t3144">3144</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3145" class="mis show_mis"><span class="n"><a href="#t3145">3145</a></span><span class="t">            <span class="key">if</span> <span class="str">'Turning basin'</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3146" class="mis show_mis"><span class="n"><a href="#t3146">3146</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Turning_basin_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3147" class="mis show_mis"><span class="n"><a href="#t3147">3147</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Turning_basin_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3148" class="mis show_mis"><span class="n"><a href="#t3148">3148</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Turning_basin_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3149" class="mis show_mis"><span class="n"><a href="#t3149">3149</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Turning_basin_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3150" class="pln"><span class="n"><a href="#t3150">3150</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3151" class="run"><span class="n"><a href="#t3151">3151</a></span><span class="t">    <span class="key">def</span> <span class="nam">edge_dependent_output</span><span class="op">(</span><span class="nam">network</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3152" class="mis show_mis"><span class="n"><a href="#t3152">3152</a></span><span class="t">        <span class="key">for</span> <span class="nam">edge</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3153" class="mis show_mis"><span class="n"><a href="#t3153">3153</a></span><span class="t">            <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Output'</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="str">'v_traffic'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3154" class="pln"><span class="n"><a href="#t3154">3154</a></span><span class="t">                                             <span class="str">'h_req_traffic'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3155" class="pln"><span class="n"><a href="#t3155">3155</a></span><span class="t">                                             <span class="str">'throughput_traffic'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3156" class="pln"><span class="n"><a href="#t3156">3156</a></span><span class="t">                                             <span class="str">'n_encounters'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3157" class="pln"><span class="n"><a href="#t3157">3157</a></span><span class="t">                                             <span class="str">'n_overtakes'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3158" class="pln"><span class="n"><a href="#t3158">3158</a></span><span class="t">                                             <span class="str">'t_passages'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3159" class="pln"><span class="n"><a href="#t3159">3159</a></span><span class="t">                                             <span class="str">'n_passages'</span><span class="op">:</span> <span class="op">[</span><span class="op">]</span><span class="op">}</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3160" class="pln"><span class="n"><a href="#t3160">3160</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3161" class="mis show_mis"><span class="n"><a href="#t3161">3161</a></span><span class="t">            <span class="key">if</span> <span class="str">'Terminal'</span> <span class="key">in</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3162" class="mis show_mis"><span class="n"><a href="#t3162">3162</a></span><span class="t">                <span class="key">if</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3163" class="mis show_mis"><span class="n"><a href="#t3163">3163</a></span><span class="t">                    <span class="nam">units</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">jetty_lengths</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3164" class="pln"><span class="n"><a href="#t3164">3164</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3165" class="mis show_mis"><span class="n"><a href="#t3165">3165</a></span><span class="t">                    <span class="nam">units</span> <span class="op">=</span> <span class="num">1</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3166" class="mis show_mis"><span class="n"><a href="#t3166">3166</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_vessels_served'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3167" class="mis show_mis"><span class="n"><a href="#t3167">3167</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3168" class="mis show_mis"><span class="n"><a href="#t3168">3168</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3169" class="mis show_mis"><span class="n"><a href="#t3169">3169</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_net_throughput'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3170" class="mis show_mis"><span class="n"><a href="#t3170">3170</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3171" class="mis show_mis"><span class="n"><a href="#t3171">3171</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3172" class="mis show_mis"><span class="n"><a href="#t3172">3172</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_productivity'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">[</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">units</span><span class="op">)</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3173" class="mis show_mis"><span class="n"><a href="#t3173">3173</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_productivity'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3174" class="mis show_mis"><span class="n"><a href="#t3174">3174</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_interarrival_times'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3175" class="mis show_mis"><span class="n"><a href="#t3175">3175</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_interdeparture_times'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3176" class="mis show_mis"><span class="n"><a href="#t3176">3176</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3177" class="mis show_mis"><span class="n"><a href="#t3177">3177</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3178" class="mis show_mis"><span class="n"><a href="#t3178">3178</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3179" class="mis show_mis"><span class="n"><a href="#t3179">3179</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3180" class="mis show_mis"><span class="n"><a href="#t3180">3180</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3181" class="mis show_mis"><span class="n"><a href="#t3181">3181</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_vessels_served'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3182" class="mis show_mis"><span class="n"><a href="#t3182">3182</a></span><span class="t">                <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_net_throughput'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3183" class="pln"><span class="n"><a href="#t3183">3183</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3184" class="run"><span class="n"><a href="#t3184">3184</a></span><span class="t">    <span class="key">def</span> <span class="nam">real_time_terminal_output</span><span class="op">(</span><span class="nam">terminal</span><span class="op">,</span><span class="nam">berth</span><span class="op">,</span><span class="nam">vessel</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3185" class="mis show_mis"><span class="n"><a href="#t3185">3185</a></span><span class="t">        <span class="key">if</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3186" class="mis show_mis"><span class="n"><a href="#t3186">3186</a></span><span class="t">            <span class="nam">terminal_type</span> <span class="op">=</span> <span class="str">'Berth'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3187" class="mis show_mis"><span class="n"><a href="#t3187">3187</a></span><span class="t">        <span class="key">elif</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'terminal'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3188" class="mis show_mis"><span class="n"><a href="#t3188">3188</a></span><span class="t">            <span class="nam">terminal_type</span> <span class="op">=</span> <span class="str">'Terminal'</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3189" class="mis show_mis"><span class="n"><a href="#t3189">3189</a></span><span class="t">        <span class="key">for</span> <span class="nam">berth</span> <span class="key">in</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">berths</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3190" class="mis show_mis"><span class="n"><a href="#t3190">3190</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_vessels_served'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3191" class="mis show_mis"><span class="n"><a href="#t3191">3191</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_vessels_lengths'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">L</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3192" class="mis show_mis"><span class="n"><a href="#t3192">3192</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">arrival_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3193" class="mis show_mis"><span class="n"><a href="#t3193">3193</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">departure_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3194" class="mis show_mis"><span class="n"><a href="#t3194">3194</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_net_throughput'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">throughput_departure</span> <span class="op">-</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">throughput_arrival</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3195" class="mis show_mis"><span class="n"><a href="#t3195">3195</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_waiting_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3196" class="mis show_mis"><span class="n"><a href="#t3196">3196</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_service_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">service_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3197" class="mis show_mis"><span class="n"><a href="#t3197">3197</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_turnaround_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">service_time</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3198" class="mis show_mis"><span class="n"><a href="#t3198">3198</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="nam">terminal_type</span><span class="op">+</span><span class="str">'_productivity'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">.</span><span class="nam">extend</span><span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">service_time</span> <span class="op">/</span> <span class="op">(</span><span class="nam">vessel</span><span class="op">.</span><span class="nam">waiting_time</span> <span class="op">+</span> <span class="nam">vessel</span><span class="op">.</span><span class="nam">service_time</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3199" class="pln"><span class="n"><a href="#t3199">3199</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3200" class="run"><span class="n"><a href="#t3200">3200</a></span><span class="t">    <span class="key">def</span> <span class="nam">post_process_terminal_output</span><span class="op">(</span><span class="nam">terminal</span><span class="op">,</span> <span class="nam">berth</span><span class="op">,</span> <span class="nam">simulation_duration</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3201" class="mis show_mis"><span class="n"><a href="#t3201">3201</a></span><span class="t">        <span class="key">if</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'jetty'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3202" class="mis show_mis"><span class="n"><a href="#t3202">3202</a></span><span class="t">            <span class="key">for</span> <span class="nam">berth</span> <span class="key">in</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">berths</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3203" class="mis show_mis"><span class="n"><a href="#t3203">3203</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_productivity'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_sevice_time'</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_waiting_time'</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_service_time'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3204" class="mis show_mis"><span class="n"><a href="#t3204">3204</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_interarrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">=</span> <span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">-</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="key">if</span> <span class="nam">t</span><span class="op">></span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3205" class="mis show_mis"><span class="n"><a href="#t3205">3205</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_interdeparture_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">-</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="key">if</span> <span class="nam">t</span> <span class="op">></span> <span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3206" class="mis show_mis"><span class="n"><a href="#t3206">3206</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_occupancy'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">-</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_vessels_served'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="nam">simulation_duration</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3207" class="mis show_mis"><span class="n"><a href="#t3207">3207</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_availability'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="num">1</span><span class="op">-</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_occupancy'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3208" class="mis show_mis"><span class="n"><a href="#t3208">3208</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Effective_berth_occupancy'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_vessels_lengths'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">*</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_productivity'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">*</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_turnaround_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_vessels_served'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">*</span><span class="nam">simulation_duration</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3209" class="mis show_mis"><span class="n"><a href="#t3209">3209</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Potential_berth_availability'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="num">1</span><span class="op">-</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_effective_berth_occupancy'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3210" class="mis show_mis"><span class="n"><a href="#t3210">3210</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_waiting_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_waiting_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3211" class="mis show_mis"><span class="n"><a href="#t3211">3211</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_service_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_service_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3212" class="mis show_mis"><span class="n"><a href="#t3212">3212</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_turnaround_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_turnaround_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3213" class="mis show_mis"><span class="n"><a href="#t3213">3213</a></span><span class="t">                <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_total_net_throughput'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_net_throughput'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3214" class="mis show_mis"><span class="n"><a href="#t3214">3214</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_occupancy'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3215" class="mis show_mis"><span class="n"><a href="#t3215">3215</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="num">1</span><span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_berth_occupancy'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3216" class="mis show_mis"><span class="n"><a href="#t3216">3216</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Effective_terminal_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_effective_berth_occupancy'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3217" class="mis show_mis"><span class="n"><a href="#t3217">3217</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Potential_terminal_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="num">1</span><span class="op">-</span><span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_effective_berth_occupancy'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3218" class="mis show_mis"><span class="n"><a href="#t3218">3218</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_waiting_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3219" class="mis show_mis"><span class="n"><a href="#t3219">3219</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_service_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3220" class="mis show_mis"><span class="n"><a href="#t3220">3220</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_turnaround_time'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_turnaround_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3221" class="mis show_mis"><span class="n"><a href="#t3221">3221</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_total_net_throughput'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_net_throughput'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3222" class="pln"><span class="n"><a href="#t3222">3222</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3223" class="mis show_mis"><span class="n"><a href="#t3223">3223</a></span><span class="t">        <span class="key">elif</span> <span class="nam">network</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">edge</span><span class="op">]</span><span class="op">[</span><span class="str">'Terminal'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">type</span> <span class="op">==</span> <span class="str">'terminal'</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3224" class="mis show_mis"><span class="n"><a href="#t3224">3224</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Mean_terminal_productivity'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_sevice_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_waiting_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_sevice_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3225" class="mis show_mis"><span class="n"><a href="#t3225">3225</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_interarrival_times'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">-</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_arrival_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="key">if</span> <span class="nam">t</span> <span class="op">></span> <span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3226" class="mis show_mis"><span class="n"><a href="#t3226">3226</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_interdeparture_times'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="op">-</span> <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span> <span class="op">-</span> <span class="num">1</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Berth_departure_times'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="key">if</span> <span class="nam">t</span> <span class="op">></span> <span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3227" class="mis show_mis"><span class="n"><a href="#t3227">3227</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Quay_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_vessels_lengths'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">*</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_turnaround_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_vessels_served'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">*</span><span class="nam">simulation_duration</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3228" class="mis show_mis"><span class="n"><a href="#t3228">3228</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Effective_quay_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="op">[</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_vessels_lengths'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">*</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_productivity'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span><span class="op">*</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_turnaround_time'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">[</span><span class="nam">t</span><span class="op">]</span> <span class="key">for</span> <span class="nam">t</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_vessels_served'</span><span class="op">]</span><span class="op">[</span><span class="nam">berth</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">length</span><span class="op">*</span><span class="nam">simulation_duration</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3229" class="mis show_mis"><span class="n"><a href="#t3229">3229</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span> <span class="com">#information about the number of cranes per vessels required (not yet included in the model)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3230" class="mis show_mis"><span class="n"><a href="#t3230">3230</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span> <span class="com">#idem</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3231" class="mis show_mis"><span class="n"><a href="#t3231">3231</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Effective_terminal_occupancy'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span> <span class="com">#idem</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3232" class="mis show_mis"><span class="n"><a href="#t3232">3232</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Potential_terminal_availability'</span><span class="op">]</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span> <span class="com">#idem</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3233" class="mis show_mis"><span class="n"><a href="#t3233">3233</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_waiting_time'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_waiting_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3234" class="mis show_mis"><span class="n"><a href="#t3234">3234</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_service_time'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_service_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3235" class="mis show_mis"><span class="n"><a href="#t3235">3235</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_turnaround_time'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">mean</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_turnaround_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3236" class="mis show_mis"><span class="n"><a href="#t3236">3236</a></span><span class="t">            <span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_total_net_throughput'</span><span class="op">]</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">sum</span><span class="op">(</span><span class="nam">terminal</span><span class="op">.</span><span class="nam">output</span><span class="op">[</span><span class="str">'Terminal_net_throughput'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3237" class="pln"><span class="n"><a href="#t3237">3237</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3238" class="run"><span class="n"><a href="#t3238">3238</a></span><span class="t"><span class="key">class</span> <span class="nam">Movable</span><span class="op">(</span><span class="nam">Locatable</span><span class="op">,</span> <span class="nam">Routeable</span><span class="op">,</span> <span class="nam">Log</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3239" class="pln"><span class="n"><a href="#t3239">3239</a></span><span class="t">    <span class="str">"""Mixin class: Something can move</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3240" class="pln"><span class="n"><a href="#t3240">3240</a></span><span class="t"><span class="str">    Used for object that can move with a fixed speed</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3241" class="pln"><span class="n"><a href="#t3241">3241</a></span><span class="t"><span class="str">    geometry: point used to track its current location</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3242" class="pln"><span class="n"><a href="#t3242">3242</a></span><span class="t"><span class="str">    v: speed"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3243" class="pln"><span class="n"><a href="#t3243">3243</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3244" class="run"><span class="n"><a href="#t3244">3244</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">v</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3245" class="mis show_mis"><span class="n"><a href="#t3245">3245</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3246" class="pln"><span class="n"><a href="#t3246">3246</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3247" class="mis show_mis"><span class="n"><a href="#t3247">3247</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">v</span> <span class="op">=</span> <span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3248" class="mis show_mis"><span class="n"><a href="#t3248">3248</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3249" class="mis show_mis"><span class="n"><a href="#t3249">3249</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_look_ahead_to_node</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3250" class="mis show_mis"><span class="n"><a href="#t3250">3250</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_edge</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3251" class="mis show_mis"><span class="n"><a href="#t3251">3251</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span> <span class="op">=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">"WGS84"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3252" class="pln"><span class="n"><a href="#t3252">3252</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3253" class="run"><span class="n"><a href="#t3253">3253</a></span><span class="t">    <span class="key">def</span> <span class="nam">initial_timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3254" class="mis show_mis"><span class="n"><a href="#t3254">3254</a></span><span class="t">        <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'start_time'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3255" class="mis show_mis"><span class="n"><a href="#t3255">3255</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'start_time'</span><span class="op">]</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3256" class="pln"><span class="n"><a href="#t3256">3256</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3257" class="run"><span class="n"><a href="#t3257">3257</a></span><span class="t">    <span class="key">def</span> <span class="nam">move</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3258" class="pln"><span class="n"><a href="#t3258">3258</a></span><span class="t">        <span class="str">"""determine distance between origin and destination, and</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3259" class="pln"><span class="n"><a href="#t3259">3259</a></span><span class="t"><span class="str">        yield the time it takes to travel it</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3260" class="pln"><span class="n"><a href="#t3260">3260</a></span><span class="t"><span class="str">        Assumption is that self.path is in the right order - vessel moves from route[0] to route[-1].</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3261" class="pln"><span class="n"><a href="#t3261">3261</a></span><span class="t"><span class="str">        """</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3262" class="mis show_mis"><span class="n"><a href="#t3262">3262</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">=</span> <span class="num">0</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3263" class="mis show_mis"><span class="n"><a href="#t3263">3263</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">metadata</span><span class="op">[</span><span class="str">'start_time'</span><span class="op">]</span> <span class="op">!=</span> <span class="num">0</span><span class="op">:</span> <span class="key">yield</span> <span class="key">from</span> <span class="nam">Movable</span><span class="op">.</span><span class="nam">initial_timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3264" class="pln"><span class="n"><a href="#t3264">3264</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3265" class="pln"><span class="n"><a href="#t3265">3265</a></span><span class="t">        <span class="com"># Check if vessel is at correct location - if not, move to location</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3266" class="mis show_mis"><span class="n"><a href="#t3266">3266</a></span><span class="t">        <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">!=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3267" class="mis show_mis"><span class="n"><a href="#t3267">3267</a></span><span class="t">            <span class="nam">orig</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">geometry</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3268" class="mis show_mis"><span class="n"><a href="#t3268">3268</a></span><span class="t">            <span class="nam">dest</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3269" class="mis show_mis"><span class="n"><a href="#t3269">3269</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">+=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">orig</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3270" class="pln"><span class="n"><a href="#t3270">3270</a></span><span class="t">                                            <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">orig</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3271" class="pln"><span class="n"><a href="#t3271">3271</a></span><span class="t">                                            <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">dest</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3272" class="pln"><span class="n"><a href="#t3272">3272</a></span><span class="t">                                            <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">dest</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3273" class="pln"><span class="n"><a href="#t3273">3273</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3274" class="mis show_mis"><span class="n"><a href="#t3274">3274</a></span><span class="t">            <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">current_speed</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3275" class="mis show_mis"><span class="n"><a href="#t3275">3275</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing to start"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">distance</span><span class="op">,</span> <span class="nam">dest</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3276" class="pln"><span class="n"><a href="#t3276">3276</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3277" class="pln"><span class="n"><a href="#t3277">3277</a></span><span class="t">        <span class="com"># Move over the path and log every step</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3278" class="mis show_mis"><span class="n"><a href="#t3278">3278</a></span><span class="t">        <span class="key">for</span> <span class="nam">node</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3279" class="mis show_mis"><span class="n"><a href="#t3279">3279</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">node</span> <span class="op">=</span> <span class="nam">node</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3280" class="pln"><span class="n"><a href="#t3280">3280</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3281" class="mis show_mis"><span class="n"><a href="#t3281">3281</a></span><span class="t">            <span class="key">if</span> <span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">2</span> <span class="op">&lt;=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3282" class="mis show_mis"><span class="n"><a href="#t3282">3282</a></span><span class="t">                <span class="nam">origin</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3283" class="mis show_mis"><span class="n"><a href="#t3283">3283</a></span><span class="t">                <span class="nam">destination</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">1</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3284" class="pln"><span class="n"><a href="#t3284">3284</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3285" class="mis show_mis"><span class="n"><a href="#t3285">3285</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3286" class="mis show_mis"><span class="n"><a href="#t3286">3286</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">look_ahead_to_node</span><span class="op">(</span><span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3287" class="mis show_mis"><span class="n"><a href="#t3287">3287</a></span><span class="t">            <span class="key">except</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3288" class="mis show_mis"><span class="n"><a href="#t3288">3288</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3289" class="pln"><span class="n"><a href="#t3289">3289</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3290" class="mis show_mis"><span class="n"><a href="#t3290">3290</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3291" class="mis show_mis"><span class="n"><a href="#t3291">3291</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">pass_node</span><span class="op">(</span><span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3292" class="mis show_mis"><span class="n"><a href="#t3292">3292</a></span><span class="t">            <span class="key">except</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3293" class="mis show_mis"><span class="n"><a href="#t3293">3293</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3294" class="pln"><span class="n"><a href="#t3294">3294</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3295" class="mis show_mis"><span class="n"><a href="#t3295">3295</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3296" class="mis show_mis"><span class="n"><a href="#t3296">3296</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">self</span><span class="op">.</span><span class="nam">pass_edge</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3297" class="mis show_mis"><span class="n"><a href="#t3297">3297</a></span><span class="t">            <span class="key">except</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3298" class="mis show_mis"><span class="n"><a href="#t3298">3298</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3299" class="pln"><span class="n"><a href="#t3299">3299</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3300" class="mis show_mis"><span class="n"><a href="#t3300">3300</a></span><span class="t">            <span class="key">if</span> <span class="nam">node</span><span class="op">[</span><span class="num">0</span><span class="op">]</span> <span class="op">+</span> <span class="num">2</span> <span class="op">==</span> <span class="nam">len</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3301" class="mis show_mis"><span class="n"><a href="#t3301">3301</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3302" class="pln"><span class="n"><a href="#t3302">3302</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3303" class="mis show_mis"><span class="n"><a href="#t3303">3303</a></span><span class="t">        <span class="nam">logger</span><span class="op">.</span><span class="nam">debug</span><span class="op">(</span><span class="str">"  distance: "</span> <span class="op">+</span> <span class="str">"%4.2f"</span> <span class="op">%</span> <span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">+</span> <span class="str">" m"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3304" class="mis show_mis"><span class="n"><a href="#t3304">3304</a></span><span class="t">        <span class="nam">logger</span><span class="op">.</span><span class="nam">debug</span><span class="op">(</span><span class="str">"  sailing:  "</span> <span class="op">+</span> <span class="str">"%4.2f"</span> <span class="op">%</span> <span class="nam">self</span><span class="op">.</span><span class="nam">current_speed</span> <span class="op">+</span> <span class="str">" m/s"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3305" class="mis show_mis"><span class="n"><a href="#t3305">3305</a></span><span class="t">        <span class="nam">logger</span><span class="op">.</span><span class="nam">debug</span><span class="op">(</span><span class="str">"  duration: "</span> <span class="op">+</span> <span class="str">"%4.2f"</span> <span class="op">%</span> <span class="op">(</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">current_speed</span><span class="op">)</span> <span class="op">/</span> <span class="num">3600</span><span class="op">)</span> <span class="op">+</span> <span class="str">" hrs"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3306" class="pln"><span class="n"><a href="#t3306">3306</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3307" class="run"><span class="n"><a href="#t3307">3307</a></span><span class="t">    <span class="key">def</span> <span class="nam">look_ahead_to_node</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3308" class="mis show_mis"><span class="n"><a href="#t3308">3308</a></span><span class="t">        <span class="key">for</span> <span class="nam">gen</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">on_look_ahead_to_node</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3309" class="mis show_mis"><span class="n"><a href="#t3309">3309</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3310" class="mis show_mis"><span class="n"><a href="#t3310">3310</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">gen</span><span class="op">(</span><span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3311" class="mis show_mis"><span class="n"><a href="#t3311">3311</a></span><span class="t">            <span class="key">except</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3312" class="mis show_mis"><span class="n"><a href="#t3312">3312</a></span><span class="t">                <span class="nam">logger</span><span class="op">.</span><span class="nam">debug</span><span class="op">(</span><span class="str">"Re-routing"</span><span class="op">,</span> <span class="nam">exc_info</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3313" class="mis show_mis"><span class="n"><a href="#t3313">3313</a></span><span class="t">                <span class="key">raise</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span><span class="op">(</span><span class="str">'Re-routing'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3314" class="mis show_mis"><span class="n"><a href="#t3314">3314</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3315" class="pln"><span class="n"><a href="#t3315">3315</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3316" class="run"><span class="n"><a href="#t3316">3316</a></span><span class="t">    <span class="key">def</span> <span class="nam">pass_node</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3317" class="mis show_mis"><span class="n"><a href="#t3317">3317</a></span><span class="t">        <span class="key">for</span> <span class="nam">gen</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3318" class="mis show_mis"><span class="n"><a href="#t3318">3318</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3319" class="mis show_mis"><span class="n"><a href="#t3319">3319</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">gen</span><span class="op">(</span><span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3320" class="mis show_mis"><span class="n"><a href="#t3320">3320</a></span><span class="t">            <span class="key">except</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3321" class="mis show_mis"><span class="n"><a href="#t3321">3321</a></span><span class="t">                <span class="nam">logger</span><span class="op">.</span><span class="nam">debug</span><span class="op">(</span><span class="str">"Re-routing"</span><span class="op">,</span> <span class="nam">exc_info</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3322" class="mis show_mis"><span class="n"><a href="#t3322">3322</a></span><span class="t">                <span class="key">raise</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span><span class="op">(</span><span class="str">'Re-routing'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3323" class="mis show_mis"><span class="n"><a href="#t3323">3323</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3324" class="pln"><span class="n"><a href="#t3324">3324</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3325" class="run"><span class="n"><a href="#t3325">3325</a></span><span class="t">    <span class="key">def</span> <span class="nam">pass_edge</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3326" class="mis show_mis"><span class="n"><a href="#t3326">3326</a></span><span class="t">        <span class="nam">edge</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3327" class="mis show_mis"><span class="n"><a href="#t3327">3327</a></span><span class="t">        <span class="nam">orig</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3328" class="mis show_mis"><span class="n"><a href="#t3328">3328</a></span><span class="t">        <span class="nam">dest</span> <span class="op">=</span> <span class="nam">nx</span><span class="op">.</span><span class="nam">get_node_attributes</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">,</span> <span class="str">"geometry"</span><span class="op">)</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3329" class="pln"><span class="n"><a href="#t3329">3329</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3330" class="mis show_mis"><span class="n"><a href="#t3330">3330</a></span><span class="t">        <span class="key">for</span> <span class="nam">gen</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_edge</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3331" class="mis show_mis"><span class="n"><a href="#t3331">3331</a></span><span class="t">            <span class="key">try</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3332" class="mis show_mis"><span class="n"><a href="#t3332">3332</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">gen</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3333" class="mis show_mis"><span class="n"><a href="#t3333">3333</a></span><span class="t">            <span class="key">except</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span> <span class="key">as</span> <span class="nam">e</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3334" class="mis show_mis"><span class="n"><a href="#t3334">3334</a></span><span class="t">                <span class="nam">logger</span><span class="op">.</span><span class="nam">debug</span><span class="op">(</span><span class="str">"Re-routing"</span><span class="op">,</span> <span class="nam">exc_info</span><span class="op">=</span><span class="key">True</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3335" class="mis show_mis"><span class="n"><a href="#t3335">3335</a></span><span class="t">                <span class="key">raise</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span><span class="op">(</span><span class="str">'Re-routing'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3336" class="mis show_mis"><span class="n"><a href="#t3336">3336</a></span><span class="t">                <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3337" class="pln"><span class="n"><a href="#t3337">3337</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3338" class="mis show_mis"><span class="n"><a href="#t3338">3338</a></span><span class="t">        <span class="key">if</span> <span class="str">"Lock"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3339" class="mis show_mis"><span class="n"><a href="#t3339">3339</a></span><span class="t">            <span class="nam">orig</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_pos_lat</span><span class="op">,</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_pos_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3340" class="pln"><span class="n"><a href="#t3340">3340</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3341" class="mis show_mis"><span class="n"><a href="#t3341">3341</a></span><span class="t">        <span class="key">if</span> <span class="str">"Lock"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3342" class="mis show_mis"><span class="n"><a href="#t3342">3342</a></span><span class="t">            <span class="nam">dest</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_pos_lat</span><span class="op">,</span><span class="nam">self</span><span class="op">.</span><span class="nam">lock_pos_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3343" class="pln"><span class="n"><a href="#t3343">3343</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3344" class="mis show_mis"><span class="n"><a href="#t3344">3344</a></span><span class="t">        <span class="key">if</span> <span class="str">"Line-up area"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3345" class="mis show_mis"><span class="n"><a href="#t3345">3345</a></span><span class="t">            <span class="nam">orig</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">lineup_pos_lat</span><span class="op">,</span><span class="nam">self</span><span class="op">.</span><span class="nam">lineup_pos_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3346" class="pln"><span class="n"><a href="#t3346">3346</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3347" class="mis show_mis"><span class="n"><a href="#t3347">3347</a></span><span class="t">        <span class="key">if</span> <span class="str">"Line-up area"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3348" class="mis show_mis"><span class="n"><a href="#t3348">3348</a></span><span class="t">            <span class="nam">dest</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">lineup_pos_lat</span><span class="op">,</span><span class="nam">self</span><span class="op">.</span><span class="nam">lineup_pos_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3349" class="pln"><span class="n"><a href="#t3349">3349</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3350" class="mis show_mis"><span class="n"><a href="#t3350">3350</a></span><span class="t">        <span class="key">if</span> <span class="str">"Terminal"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">origin</span><span class="op">,</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3351" class="mis show_mis"><span class="n"><a href="#t3351">3351</a></span><span class="t">            <span class="nam">orig</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">terminal_pos_lat</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">terminal_pos_lon</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3352" class="pln"><span class="n"><a href="#t3352">3352</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3353" class="mis show_mis"><span class="n"><a href="#t3353">3353</a></span><span class="t">        <span class="key">if</span> <span class="str">'geometry'</span> <span class="key">in</span> <span class="nam">edge</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3354" class="mis show_mis"><span class="n"><a href="#t3354">3354</a></span><span class="t">            <span class="nam">edge_route</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3355" class="pln"><span class="n"><a href="#t3355">3355</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3356" class="pln"><span class="n"><a href="#t3356">3356</a></span><span class="t">            <span class="com"># check if edge is in the sailing direction, otherwise flip it</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3357" class="mis show_mis"><span class="n"><a href="#t3357">3357</a></span><span class="t">            <span class="nam">distance_from_start</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">orig</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">orig</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span><span class="nam">edge_route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">edge_route</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3358" class="mis show_mis"><span class="n"><a href="#t3358">3358</a></span><span class="t">            <span class="nam">distance_from_stop</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">orig</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span><span class="nam">orig</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span><span class="nam">edge_route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">edge_route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3359" class="mis show_mis"><span class="n"><a href="#t3359">3359</a></span><span class="t">            <span class="key">if</span> <span class="nam">distance_from_start</span><span class="op">></span><span class="nam">distance_from_stop</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3360" class="pln"><span class="n"><a href="#t3360">3360</a></span><span class="t">                <span class="com"># when the distance from the starting point is greater than from the end point</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3361" class="mis show_mis"><span class="n"><a href="#t3361">3361</a></span><span class="t">                <span class="nam">edge_route</span> <span class="op">=</span> <span class="nam">np</span><span class="op">.</span><span class="nam">flipud</span><span class="op">(</span><span class="nam">np</span><span class="op">.</span><span class="nam">array</span><span class="op">(</span><span class="nam">edge</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3362" class="pln"><span class="n"><a href="#t3362">3362</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3363" class="mis show_mis"><span class="n"><a href="#t3363">3363</a></span><span class="t">            <span class="key">for</span> <span class="nam">index</span><span class="op">,</span> <span class="nam">pt</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">edge_route</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3364" class="mis show_mis"><span class="n"><a href="#t3364">3364</a></span><span class="t">                <span class="nam">sub_orig</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">edge_route</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">edge_route</span><span class="op">[</span><span class="nam">index</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3365" class="mis show_mis"><span class="n"><a href="#t3365">3365</a></span><span class="t">                <span class="nam">sub_dest</span> <span class="op">=</span> <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">Point</span><span class="op">(</span><span class="nam">edge_route</span><span class="op">[</span><span class="nam">index</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">edge_route</span><span class="op">[</span><span class="nam">index</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3366" class="pln"><span class="n"><a href="#t3366">3366</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3367" class="mis show_mis"><span class="n"><a href="#t3367">3367</a></span><span class="t">                <span class="nam">distance</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">sub_orig</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3368" class="pln"><span class="n"><a href="#t3368">3368</a></span><span class="t">                                          <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">sub_orig</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3369" class="pln"><span class="n"><a href="#t3369">3369</a></span><span class="t">                                          <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">sub_dest</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3370" class="pln"><span class="n"><a href="#t3370">3370</a></span><span class="t">                                          <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">sub_dest</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3371" class="mis show_mis"><span class="n"><a href="#t3371">3371</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">+=</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3372" class="mis show_mis"><span class="n"><a href="#t3372">3372</a></span><span class="t">                <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3373" class="mis show_mis"><span class="n"><a href="#t3373">3373</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} sub edge {} start"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">,</span> <span class="nam">index</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">sub_orig</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3374" class="mis show_mis"><span class="n"><a href="#t3374">3374</a></span><span class="t">                <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">distance</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">current_speed</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3375" class="mis show_mis"><span class="n"><a href="#t3375">3375</a></span><span class="t">                <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3376" class="mis show_mis"><span class="n"><a href="#t3376">3376</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} sub edge {} stop"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">,</span> <span class="nam">index</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">sub_dest</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3377" class="mis show_mis"><span class="n"><a href="#t3377">3377</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">=</span> <span class="nam">dest</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3378" class="pln"><span class="n"><a href="#t3378">3378</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3379" class="pln"><span class="n"><a href="#t3379">3379</a></span><span class="t">        <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3380" class="mis show_mis"><span class="n"><a href="#t3380">3380</a></span><span class="t">            <span class="nam">distance</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span><span class="op">.</span><span class="nam">inv</span><span class="op">(</span><span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">orig</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3381" class="pln"><span class="n"><a href="#t3381">3381</a></span><span class="t">                                      <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">orig</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3382" class="pln"><span class="n"><a href="#t3382">3382</a></span><span class="t">                                      <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">dest</span><span class="op">)</span><span class="op">.</span><span class="nam">x</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3383" class="pln"><span class="n"><a href="#t3383">3383</a></span><span class="t">                                      <span class="nam">shapely</span><span class="op">.</span><span class="nam">geometry</span><span class="op">.</span><span class="nam">asShape</span><span class="op">(</span><span class="nam">dest</span><span class="op">)</span><span class="op">.</span><span class="nam">y</span><span class="op">,</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3384" class="pln"><span class="n"><a href="#t3384">3384</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3385" class="mis show_mis"><span class="n"><a href="#t3385">3385</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">distance</span> <span class="op">+=</span> <span class="nam">distance</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3386" class="mis show_mis"><span class="n"><a href="#t3386">3386</a></span><span class="t">            <span class="nam">arrival</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3387" class="pln"><span class="n"><a href="#t3387">3387</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3388" class="pln"><span class="n"><a href="#t3388">3388</a></span><span class="t">            <span class="com"># Act based on resources</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3389" class="mis show_mis"><span class="n"><a href="#t3389">3389</a></span><span class="t">            <span class="key">if</span> <span class="str">"Resources"</span> <span class="key">in</span> <span class="nam">edge</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3390" class="mis show_mis"><span class="n"><a href="#t3390">3390</a></span><span class="t">                <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3391" class="mis show_mis"><span class="n"><a href="#t3391">3391</a></span><span class="t">                <span class="key">with</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">]</span><span class="op">[</span><span class="str">"Resources"</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span> <span class="key">as</span> <span class="nam">request</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3392" class="mis show_mis"><span class="n"><a href="#t3392">3392</a></span><span class="t">                    <span class="key">yield</span> <span class="nam">request</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3393" class="pln"><span class="n"><a href="#t3393">3393</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3394" class="mis show_mis"><span class="n"><a href="#t3394">3394</a></span><span class="t">                    <span class="key">if</span> <span class="nam">arrival</span> <span class="op">!=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3395" class="mis show_mis"><span class="n"><a href="#t3395">3395</a></span><span class="t">                        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting to pass edge {} - {} start"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">,</span> <span class="nam">arrival</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">orig</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3396" class="mis show_mis"><span class="n"><a href="#t3396">3396</a></span><span class="t">                        <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3397" class="mis show_mis"><span class="n"><a href="#t3397">3397</a></span><span class="t">                        <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Waiting to pass edge {} - {} stop"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">orig</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3398" class="pln"><span class="n"><a href="#t3398">3398</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3399" class="mis show_mis"><span class="n"><a href="#t3399">3399</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} start"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">orig</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3400" class="mis show_mis"><span class="n"><a href="#t3400">3400</a></span><span class="t">                    <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">distance</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">current_speed</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3401" class="mis show_mis"><span class="n"><a href="#t3401">3401</a></span><span class="t">                    <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3402" class="mis show_mis"><span class="n"><a href="#t3402">3402</a></span><span class="t">                    <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} stop"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">dest</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3403" class="pln"><span class="n"><a href="#t3403">3403</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3404" class="pln"><span class="n"><a href="#t3404">3404</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3405" class="mis show_mis"><span class="n"><a href="#t3405">3405</a></span><span class="t">                <span class="key">if</span> <span class="str">'Info'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3406" class="mis show_mis"><span class="n"><a href="#t3406">3406</a></span><span class="t">                    <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3407" class="pln"><span class="n"><a href="#t3407">3407</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3408" class="mis show_mis"><span class="n"><a href="#t3408">3408</a></span><span class="t">                    <span class="nam">ukc</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3409" class="mis show_mis"><span class="n"><a href="#t3409">3409</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} start"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">orig</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3410" class="mis show_mis"><span class="n"><a href="#t3410">3410</a></span><span class="t">                <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="nam">distance</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">current_speed</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3411" class="mis show_mis"><span class="n"><a href="#t3411">3411</a></span><span class="t">                <span class="key">if</span> <span class="str">'Info'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3412" class="mis show_mis"><span class="n"><a href="#t3412">3412</a></span><span class="t">                    <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3413" class="pln"><span class="n"><a href="#t3413">3413</a></span><span class="t">                <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3414" class="mis show_mis"><span class="n"><a href="#t3414">3414</a></span><span class="t">                    <span class="nam">ukc</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3415" class="mis show_mis"><span class="n"><a href="#t3415">3415</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Sailing from node {} to node {} stop"</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">dest</span><span class="op">,</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3416" class="mis show_mis"><span class="n"><a href="#t3416">3416</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">geometry</span> <span class="op">=</span> <span class="nam">dest</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3417" class="pln"><span class="n"><a href="#t3417">3417</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3418" class="run"><span class="n"><a href="#t3418">3418</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3419" class="run"><span class="n"><a href="#t3419">3419</a></span><span class="t">    <span class="key">def</span> <span class="nam">current_speed</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3420" class="mis show_mis"><span class="n"><a href="#t3420">3420</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3421" class="pln"><span class="n"><a href="#t3421">3421</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3422" class="run"><span class="n"><a href="#t3422">3422</a></span><span class="t"><span class="key">class</span> <span class="nam">HasTerminal</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3423" class="run"><span class="n"><a href="#t3423">3423</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3424" class="mis show_mis"><span class="n"><a href="#t3424">3424</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3425" class="mis show_mis"><span class="n"><a href="#t3425">3425</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_edge</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">pass_terminal</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3426" class="pln"><span class="n"><a href="#t3426">3426</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3427" class="run"><span class="n"><a href="#t3427">3427</a></span><span class="t">    <span class="key">def</span> <span class="nam">pass_terminal</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">origin</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3428" class="pln"><span class="n"><a href="#t3428">3428</a></span><span class="t">        <span class="com"># Terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3429" class="mis show_mis"><span class="n"><a href="#t3429">3429</a></span><span class="t">        <span class="key">if</span> <span class="str">'Terminal'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">edges</span><span class="op">[</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">destination</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3430" class="mis show_mis"><span class="n"><a href="#t3430">3430</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">pass_terminal</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">[</span><span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3431" class="mis show_mis"><span class="n"><a href="#t3431">3431</a></span><span class="t">            <span class="key">raise</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span><span class="op">(</span><span class="str">'New route determined'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3432" class="pln"><span class="n"><a href="#t3432">3432</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3433" class="run"><span class="n"><a href="#t3433">3433</a></span><span class="t"><span class="key">class</span> <span class="nam">HasOrigin</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3434" class="run"><span class="n"><a href="#t3434">3434</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3435" class="mis show_mis"><span class="n"><a href="#t3435">3435</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3436" class="mis show_mis"><span class="n"><a href="#t3436">3436</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">request_terminal_access</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3437" class="pln"><span class="n"><a href="#t3437">3437</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3438" class="run"><span class="n"><a href="#t3438">3438</a></span><span class="t">    <span class="key">def</span> <span class="nam">request_terminal_access</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3439" class="pln"><span class="n"><a href="#t3439">3439</a></span><span class="t">        <span class="com"># Request for a terminal</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3440" class="mis show_mis"><span class="n"><a href="#t3440">3440</a></span><span class="t">        <span class="key">if</span> <span class="str">"Origin"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span> <span class="key">and</span> <span class="str">'leaving_port'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">dir</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3441" class="mis show_mis"><span class="n"><a href="#t3441">3441</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">bound</span> <span class="op">=</span> <span class="str">'inbound'</span>  <span class="com">##to be removed later</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3442" class="mis show_mis"><span class="n"><a href="#t3442">3442</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">terminal_accessed</span> <span class="op">=</span> <span class="key">False</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3443" class="mis show_mis"><span class="n"><a href="#t3443">3443</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">request_terminal_access</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="op">[</span><span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">]</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">]</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3444" class="mis show_mis"><span class="n"><a href="#t3444">3444</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">waiting_in_anchorage</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3445" class="mis show_mis"><span class="n"><a href="#t3445">3445</a></span><span class="t">                <span class="key">raise</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span><span class="op">(</span><span class="str">'New route determined'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3446" class="pln"><span class="n"><a href="#t3446">3446</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3447" class="run"><span class="n"><a href="#t3447">3447</a></span><span class="t"><span class="key">class</span> <span class="nam">HasAnchorage</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3448" class="run"><span class="n"><a href="#t3448">3448</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3449" class="mis show_mis"><span class="n"><a href="#t3449">3449</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3450" class="mis show_mis"><span class="n"><a href="#t3450">3450</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_look_ahead_to_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">pass_anchorage_area</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3451" class="pln"><span class="n"><a href="#t3451">3451</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3452" class="run"><span class="n"><a href="#t3452">3452</a></span><span class="t">    <span class="key">def</span> <span class="nam">pass_anchorage_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3453" class="pln"><span class="n"><a href="#t3453">3453</a></span><span class="t">        <span class="com"># Anchorage</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3454" class="mis show_mis"><span class="n"><a href="#t3454">3454</a></span><span class="t">        <span class="key">if</span> <span class="str">'Anchorage'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span> <span class="key">and</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span> <span class="op">==</span> <span class="nam">destination</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3455" class="mis show_mis"><span class="n"><a href="#t3455">3455</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassTerminal</span><span class="op">.</span><span class="nam">pass_anchorage</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3456" class="mis show_mis"><span class="n"><a href="#t3456">3456</a></span><span class="t">            <span class="key">raise</span> <span class="nam">simpy</span><span class="op">.</span><span class="nam">exceptions</span><span class="op">.</span><span class="nam">Interrupt</span><span class="op">(</span><span class="str">'New route determined'</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3457" class="pln"><span class="n"><a href="#t3457">3457</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3458" class="run"><span class="n"><a href="#t3458">3458</a></span><span class="t"><span class="key">class</span> <span class="nam">HasLock</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3459" class="run"><span class="n"><a href="#t3459">3459</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3460" class="mis show_mis"><span class="n"><a href="#t3460">3460</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3461" class="mis show_mis"><span class="n"><a href="#t3461">3461</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">leave_lock_chamber</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3462" class="pln"><span class="n"><a href="#t3462">3462</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3463" class="run"><span class="n"><a href="#t3463">3463</a></span><span class="t">    <span class="key">def</span> <span class="nam">leave_lock_chamber</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3464" class="mis show_mis"><span class="n"><a href="#t3464">3464</a></span><span class="t">        <span class="key">if</span> <span class="str">"Lock"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># if vessel in lock</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3465" class="mis show_mis"><span class="n"><a href="#t3465">3465</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">lock_module</span><span class="op">.</span><span class="nam">PassLock</span><span class="op">.</span><span class="nam">leave_lock</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3466" class="mis show_mis"><span class="n"><a href="#t3466">3466</a></span><span class="t">            <span class="nam">self</span><span class="op">.</span><span class="nam">v</span> <span class="op">=</span> <span class="num">4</span> <span class="op">*</span> <span class="nam">self</span><span class="op">.</span><span class="nam">v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3467" class="pln"><span class="n"><a href="#t3467">3467</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3468" class="run"><span class="n"><a href="#t3468">3468</a></span><span class="t"><span class="key">class</span> <span class="nam">HasWaitingArea</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3469" class="run"><span class="n"><a href="#t3469">3469</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3470" class="mis show_mis"><span class="n"><a href="#t3470">3470</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3471" class="mis show_mis"><span class="n"><a href="#t3471">3471</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">leave_waiting_area</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3472" class="mis show_mis"><span class="n"><a href="#t3472">3472</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_look_ahead_to_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">approach_waiting_area</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3473" class="pln"><span class="n"><a href="#t3473">3473</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3474" class="run"><span class="n"><a href="#t3474">3474</a></span><span class="t">    <span class="key">def</span> <span class="nam">approach_waiting_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3475" class="mis show_mis"><span class="n"><a href="#t3475">3475</a></span><span class="t">        <span class="key">if</span> <span class="str">"Waiting area"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># if waiting area is located at next node</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3476" class="mis show_mis"><span class="n"><a href="#t3476">3476</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">lock_module</span><span class="op">.</span><span class="nam">PassLock</span><span class="op">.</span><span class="nam">approach_waiting_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3477" class="pln"><span class="n"><a href="#t3477">3477</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3478" class="run"><span class="n"><a href="#t3478">3478</a></span><span class="t">    <span class="key">def</span> <span class="nam">leave_waiting_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3479" class="mis show_mis"><span class="n"><a href="#t3479">3479</a></span><span class="t">        <span class="key">if</span> <span class="str">"Waiting area"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># if vessel is in waiting area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3480" class="mis show_mis"><span class="n"><a href="#t3480">3480</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">lock_module</span><span class="op">.</span><span class="nam">PassLock</span><span class="op">.</span><span class="nam">leave_waiting_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3481" class="pln"><span class="n"><a href="#t3481">3481</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3482" class="run"><span class="n"><a href="#t3482">3482</a></span><span class="t"><span class="key">class</span> <span class="nam">HasLineUpArea</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3483" class="run"><span class="n"><a href="#t3483">3483</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3484" class="mis show_mis"><span class="n"><a href="#t3484">3484</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3485" class="mis show_mis"><span class="n"><a href="#t3485">3485</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">leave_lineup_area</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3486" class="mis show_mis"><span class="n"><a href="#t3486">3486</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_look_ahead_to_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">approach_lineup_area</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3487" class="pln"><span class="n"><a href="#t3487">3487</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3488" class="run"><span class="n"><a href="#t3488">3488</a></span><span class="t">    <span class="key">def</span> <span class="nam">approach_lineup_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3489" class="mis show_mis"><span class="n"><a href="#t3489">3489</a></span><span class="t">        <span class="key">if</span> <span class="str">"Line-up area"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># if vessel is approaching the line-up area</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3490" class="mis show_mis"><span class="n"><a href="#t3490">3490</a></span><span class="t">            <span class="key">yield</span> <span class="key">from</span> <span class="nam">lock_module</span><span class="op">.</span><span class="nam">PassLock</span><span class="op">.</span><span class="nam">approach_lineup_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3491" class="pln"><span class="n"><a href="#t3491">3491</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3492" class="run"><span class="n"><a href="#t3492">3492</a></span><span class="t">    <span class="key">def</span> <span class="nam">leave_lineup_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3493" class="mis show_mis"><span class="n"><a href="#t3493">3493</a></span><span class="t">        <span class="key">if</span> <span class="str">"Line-up area"</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># if vessel is located in the line-up</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3494" class="mis show_mis"><span class="n"><a href="#t3494">3494</a></span><span class="t">            <span class="nam">lineup_areas</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">"Line-up area"</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3495" class="mis show_mis"><span class="n"><a href="#t3495">3495</a></span><span class="t">            <span class="key">for</span> <span class="nam">lineup_area</span> <span class="key">in</span> <span class="nam">lineup_areas</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3496" class="mis show_mis"><span class="n"><a href="#t3496">3496</a></span><span class="t">                <span class="key">if</span> <span class="nam">lineup_area</span><span class="op">.</span><span class="nam">name</span> <span class="op">!=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">lock_name</span><span class="op">:</span>  <span class="com"># picks the assigned parallel lock chain</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3497" class="mis show_mis"><span class="n"><a href="#t3497">3497</a></span><span class="t">                    <span class="key">continue</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3498" class="pln"><span class="n"><a href="#t3498">3498</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3499" class="mis show_mis"><span class="n"><a href="#t3499">3499</a></span><span class="t">                <span class="nam">index_node_lineup_area</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">.</span><span class="nam">index</span><span class="op">(</span><span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3500" class="mis show_mis"><span class="n"><a href="#t3500">3500</a></span><span class="t">                <span class="key">for</span> <span class="nam">node_lock</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">route</span><span class="op">[</span><span class="nam">index_node_lineup_area</span><span class="op">:</span><span class="op">]</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3501" class="mis show_mis"><span class="n"><a href="#t3501">3501</a></span><span class="t">                    <span class="key">if</span> <span class="str">'Lock'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node_lock</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3502" class="mis show_mis"><span class="n"><a href="#t3502">3502</a></span><span class="t">                        <span class="key">yield</span> <span class="key">from</span> <span class="nam">lock_module</span><span class="op">.</span><span class="nam">PassLock</span><span class="op">.</span><span class="nam">leave_lineup_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3503" class="mis show_mis"><span class="n"><a href="#t3503">3503</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3504" class="pln"><span class="n"><a href="#t3504">3504</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3505" class="mis show_mis"><span class="n"><a href="#t3505">3505</a></span><span class="t">                    <span class="key">elif</span> <span class="str">'Waiting area'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">node_lock</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>  <span class="com"># if vessel is leaving the lock complex</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3506" class="mis show_mis"><span class="n"><a href="#t3506">3506</a></span><span class="t">                        <span class="key">yield</span> <span class="key">from</span> <span class="nam">lock_module</span><span class="op">.</span><span class="nam">PassLock</span><span class="op">.</span><span class="nam">leave_opposite_lineup_area</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3507" class="mis show_mis"><span class="n"><a href="#t3507">3507</a></span><span class="t">                        <span class="key">break</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3508" class="pln"><span class="n"><a href="#t3508">3508</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3509" class="run"><span class="n"><a href="#t3509">3509</a></span><span class="t"><span class="key">class</span> <span class="nam">HasSection</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3510" class="run"><span class="n"><a href="#t3510">3510</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3511" class="mis show_mis"><span class="n"><a href="#t3511">3511</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3512" class="mis show_mis"><span class="n"><a href="#t3512">3512</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_edge</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">request_access_new_section</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3513" class="pln"><span class="n"><a href="#t3513">3513</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3514" class="run"><span class="n"><a href="#t3514">3514</a></span><span class="t">    <span class="key">def</span> <span class="nam">request_access_new_section</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="nam">origin</span><span class="op">,</span><span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3515" class="pln"><span class="n"><a href="#t3515">3515</a></span><span class="t">        <span class="com"># Leave and access waterway section</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3516" class="mis show_mis"><span class="n"><a href="#t3516">3516</a></span><span class="t">        <span class="key">if</span> <span class="str">'Junction'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3517" class="mis show_mis"><span class="n"><a href="#t3517">3517</a></span><span class="t">            <span class="key">if</span> <span class="str">'Anchorage'</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3518" class="mis show_mis"><span class="n"><a href="#t3518">3518</a></span><span class="t">                <span class="nam">PassSection</span><span class="op">.</span><span class="nam">release_access_previous_section</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3519" class="mis show_mis"><span class="n"><a href="#t3519">3519</a></span><span class="t">                <span class="key">yield</span> <span class="key">from</span> <span class="nam">PassSection</span><span class="op">.</span><span class="nam">request_access_next_section</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3520" class="pln"><span class="n"><a href="#t3520">3520</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3521" class="run"><span class="n"><a href="#t3521">3521</a></span><span class="t"><span class="key">class</span> <span class="nam">HasTurningBasin</span><span class="op">(</span><span class="nam">Movable</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3522" class="run"><span class="n"><a href="#t3522">3522</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3523" class="mis show_mis"><span class="n"><a href="#t3523">3523</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3524" class="mis show_mis"><span class="n"><a href="#t3524">3524</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_pass_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">enter_turning_basin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3525" class="mis show_mis"><span class="n"><a href="#t3525">3525</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">on_look_ahead_to_node</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">request_turning_basin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3526" class="pln"><span class="n"><a href="#t3526">3526</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3527" class="run"><span class="n"><a href="#t3527">3527</a></span><span class="t">    <span class="key">def</span> <span class="nam">enter_turning_basin</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3528" class="mis show_mis"><span class="n"><a href="#t3528">3528</a></span><span class="t">        <span class="key">if</span> <span class="str">'Turning Basin'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3529" class="mis show_mis"><span class="n"><a href="#t3529">3529</a></span><span class="t">            <span class="nam">turning_basin</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning Basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3530" class="mis show_mis"><span class="n"><a href="#t3530">3530</a></span><span class="t">            <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3531" class="mis show_mis"><span class="n"><a href="#t3531">3531</a></span><span class="t">            <span class="key">if</span> <span class="nam">self</span><span class="op">.</span><span class="nam">bound</span> <span class="op">==</span> <span class="str">'outbound'</span> <span class="key">and</span> <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">length</span> <span class="op">>=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">L</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3532" class="mis show_mis"><span class="n"><a href="#t3532">3532</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel Turning Start"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3533" class="mis show_mis"><span class="n"><a href="#t3533">3533</a></span><span class="t">                <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel Turning Start"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3534" class="mis show_mis"><span class="n"><a href="#t3534">3534</a></span><span class="t">                <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">timeout</span><span class="op">(</span><span class="num">10</span> <span class="op">*</span> <span class="num">60</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3535" class="mis show_mis"><span class="n"><a href="#t3535">3535</a></span><span class="t">                <span class="nam">ukc</span> <span class="op">=</span> <span class="nam">VesselTrafficService</span><span class="op">.</span><span class="nam">provide_ukc_clearance</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">origin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3536" class="mis show_mis"><span class="n"><a href="#t3536">3536</a></span><span class="t">                <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel Turning Stop"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="num">10</span> <span class="op">*</span> <span class="num">60</span><span class="op">,</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3537" class="pln"><span class="n"><a href="#t3537">3537</a></span><span class="t">                                        <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3538" class="mis show_mis"><span class="n"><a href="#t3538">3538</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel Turning Stop"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3539" class="pln"><span class="n"><a href="#t3539">3539</a></span><span class="t">            <span class="key">else</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3540" class="mis show_mis"><span class="n"><a href="#t3540">3540</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Passing Turning Basin"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="nam">ukc</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3541" class="mis show_mis"><span class="n"><a href="#t3541">3541</a></span><span class="t">                <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">log_entry</span><span class="op">(</span><span class="str">"Vessel Passing"</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">now</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">[</span><span class="str">'geometry'</span><span class="op">]</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3542" class="mis show_mis"><span class="n"><a href="#t3542">3542</a></span><span class="t">            <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">turning_basin</span><span class="op">[</span><span class="nam">origin</span><span class="op">]</span><span class="op">.</span><span class="nam">release</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">request_access_turning_basin</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3543" class="pln"><span class="n"><a href="#t3543">3543</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3544" class="run"><span class="n"><a href="#t3544">3544</a></span><span class="t">    <span class="key">def</span> <span class="nam">request_turning_basin</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">destination</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3545" class="mis show_mis"><span class="n"><a href="#t3545">3545</a></span><span class="t">        <span class="key">if</span> <span class="str">'Turning Basin'</span> <span class="key">in</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3546" class="mis show_mis"><span class="n"><a href="#t3546">3546</a></span><span class="t">            <span class="nam">turning_basin</span> <span class="op">=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">env</span><span class="op">.</span><span class="nam">FG</span><span class="op">.</span><span class="nam">nodes</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">[</span><span class="str">'Turning Basin'</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3547" class="mis show_mis"><span class="n"><a href="#t3547">3547</a></span><span class="t">            <span class="key">if</span> <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">length</span> <span class="op">>=</span> <span class="nam">self</span><span class="op">.</span><span class="nam">L</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3548" class="mis show_mis"><span class="n"><a href="#t3548">3548</a></span><span class="t">                <span class="nam">self</span><span class="op">.</span><span class="nam">request_access_turning_basin</span> <span class="op">=</span> <span class="nam">turning_basin</span><span class="op">.</span><span class="nam">turning_basin</span><span class="op">[</span><span class="nam">destination</span><span class="op">]</span><span class="op">.</span><span class="nam">request</span><span class="op">(</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3549" class="mis show_mis"><span class="n"><a href="#t3549">3549</a></span><span class="t">                <span class="key">yield</span> <span class="nam">self</span><span class="op">.</span><span class="nam">request_access_turning_basin</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3550" class="pln"><span class="n"><a href="#t3550">3550</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3551" class="run"><span class="n"><a href="#t3551">3551</a></span><span class="t"><span class="key">class</span> <span class="nam">ContainerDependentMovable</span><span class="op">(</span><span class="nam">Movable</span><span class="op">,</span> <span class="nam">HasContainer</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3552" class="pln"><span class="n"><a href="#t3552">3552</a></span><span class="t">    <span class="str">"""ContainerDependentMovable class</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3553" class="pln"><span class="n"><a href="#t3553">3553</a></span><span class="t"><span class="str">    Used for objects that move with a speed dependent on the container level</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3554" class="pln"><span class="n"><a href="#t3554">3554</a></span><span class="t"><span class="str">    compute_v: a function, given the fraction the container is filled (in [0,1]), returns the current speed"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3555" class="pln"><span class="n"><a href="#t3555">3555</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3556" class="run"><span class="n"><a href="#t3556">3556</a></span><span class="t">    <span class="key">def</span> <span class="nam">__init__</span><span class="op">(</span><span class="nam">self</span><span class="op">,</span> <span class="nam">compute_v</span><span class="op">,</span> <span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3557" class="mis show_mis"><span class="n"><a href="#t3557">3557</a></span><span class="t">        <span class="nam">super</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="nam">__init__</span><span class="op">(</span><span class="op">*</span><span class="nam">args</span><span class="op">,</span> <span class="op">**</span><span class="nam">kwargs</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3558" class="pln"><span class="n"><a href="#t3558">3558</a></span><span class="t">        <span class="str">"""Initialization"""</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3559" class="mis show_mis"><span class="n"><a href="#t3559">3559</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">compute_v</span> <span class="op">=</span> <span class="nam">compute_v</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3560" class="mis show_mis"><span class="n"><a href="#t3560">3560</a></span><span class="t">        <span class="nam">self</span><span class="op">.</span><span class="nam">wgs84</span> <span class="op">=</span> <span class="nam">pyproj</span><span class="op">.</span><span class="nam">Geod</span><span class="op">(</span><span class="nam">ellps</span><span class="op">=</span><span class="str">"WGS84"</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3561" class="pln"><span class="n"><a href="#t3561">3561</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
    <p id="t3562" class="run"><span class="n"><a href="#t3562">3562</a></span><span class="t">    <span class="op">@</span><span class="nam">property</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3563" class="run"><span class="n"><a href="#t3563">3563</a></span><span class="t">    <span class="key">def</span> <span class="nam">current_speed</span><span class="op">(</span><span class="nam">self</span><span class="op">)</span><span class="op">:</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3564" class="mis show_mis"><span class="n"><a href="#t3564">3564</a></span><span class="t">        <span class="key">return</span> <span class="nam">self</span><span class="op">.</span><span class="nam">compute_v</span><span class="op">(</span><span class="nam">self</span><span class="op">.</span><span class="nam">container</span><span class="op">.</span><span class="nam">level</span> <span class="op">/</span> <span class="nam">self</span><span class="op">.</span><span class="nam">container</span><span class="op">.</span><span class="nam">capacity</span><span class="op">)</span>&nbsp;</span><span class="r"></span></p>
    <p id="t3565" class="pln"><span class="n"><a href="#t3565">3565</a></span><span class="t">&nbsp;</span><span class="r"></span></p>
</div>
<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v5.5</a>,
            created at 2022-03-07 19:58 +0100
        </p>
    </div>
</div>
</body>
</html>
